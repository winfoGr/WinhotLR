Imports System.Net.Mail
Imports System.Net
Imports System.IO
Imports WebConnect
Imports System.Configuration
Imports System.Globalization
Imports System.Data.SqlClient
Imports System.Text
Imports MessagingToolkit.QRCode
Imports MessagingToolkit.QRCode.Codec

Public Class ErgasiesHmerasF


    Dim connectionString As String
    Dim myTipos As String
    Dim myInvId As Int32

    Dim prwinoflag As Byte = 1 'OLD TOWN=1 KAI VILAS=2  
    Dim afixflag As Byte = 1 ''OLD TOWN=1 KAI VILAS=2  
    Dim diamflag As Byte = 1 ''OLD TOWN=1 KAI VILAS=2  
    Dim rechte As Byte
    '*************Akyrosi APY - GE***********************************************
    Dim kwdDelApy, kwdDelGE As Integer


    '*******************GE************************GE*************************************GE
    Dim kwdKratGE As Integer
    Dim diamenKwd As Integer
    'edw globale Variablen gia Eisprakseis Praktoreiwn
    Dim kwdEisprPrakt As Integer
    Dim kwdEispTimol, kwdEispXrews, kwdEispr As Integer
    'edw globale Variablen gia ekdosi mem APY
    Dim apyDwm, apyVoucher, apyOnom As String 'se periptwsi pou exw polles kratiseis se mia APY->Me.DbhotelDataSet.kratiseis(0).voucher pou eixa xrisimopoieisi arxika itan lathos giati uparxei periptwsi na einai exei lathos stoixeia->px ean exei epilexthei  kratisi apo tin lista pou px "Διαφορετικό Πρακτορείο !"
    Dim apyEnil, apyPaid As Int16
    Dim simbKrat As Integer
    Dim simetKrat, prokatKrat As Single 'simetoxi,prokataboli einai Atribute tou timologiou Table->se periptwsi pou sena timologio exoume poles kratiseis tote prepei to sunolo simetox-prokat na apothikeuontai (athroistika)
    Dim kwdProsEkd() As Integer 'kwdikous kratisis pro timologisi
    Dim timolID As Integer = 20000 'ena ID pou to exw san initial
    Dim posostoTemp, posoTemp, freeTemp, cfeeTemp As Single 'tempraere apothikeusi twn ekptwsewn (apo tis kratiseis) gia tsekarisma sto telos ean o user edw tis alakse 
    Dim ekptosiKratOK As Boolean 'true ean yparxei ekptosi apo to menou kratisewn
    Dim kwdApyPrakt, kwdApyApy, kwdApyParast As Integer
    Dim aaKratApy As Byte = 0
    Dim sumYpnos, sumYpnosFpa, sumPrwino, sumPrwinoFpa, sumGeumata, sumGeumataFpa, sumExtra, sumExtraFpa, sumSumPosa, sumSynola, sumKratPosa, sumKratFpa As Single ' sumSumFpa,
    Dim timPoso As Single
    Dim kwdApyAfm As Integer ' DOMISI-> kwdikos etaireias poy ekdidei to timologio

    Dim kwdApyKrat As Integer  'edw globale Variablen gia ekdosi extra parastastikwn


    'edw globale Variablen gia ekdosi extra parastastikwn
    Dim synolFpa, synolKathPosa As Single
    Dim aktWerte(4) As Single ' gia tin YFAIRESI parakolouthw ta werte tou ypnou,geumatoa ktl, ean exoyn alaksei
    Dim praktParastKwd As Integer
    Dim parastParastKwd As Integer
    Dim parastCboxKwd() As Integer
    Dim aaParast As Integer ', maxAAParast
    Dim arxiEtous, telosEtous As Date '->gia na kanw abfrage gia max AA sto table Timologia(opou DEN iparxei Attribute Etos)->apo atribute imerominia!
    '(gia tin periptosi pou se kathe neo etos exoume NEA arithmisi AA gia timologia!)
    'Dim minParastDate As Date 'H Imerominia tou teleytaiou parastatikou->den epitrepetai na kopei neo me PROGENESTERI imerominia!
    Dim statusParast As Byte ' 1=Insert 2=Update timologio
    Dim kwdParastAfm As Integer 'DOMISI 

    'edw globale Variablen gia status xenodoxeiou
    Dim klinesKwd, tiposKwd As Integer
    Dim dAllotmSum(), dBookSum(), dKlDwmSum() As Int16 ' gia tis ektiposeis->Synola!, anzSum

    'edw globale Variablen gia status praktoreiwn
    Structure AbwechselStatus
        Dim simb As Integer
        Dim klines As Integer
        Dim tipos As Integer
        Dim guarantee As Boolean
    End Structure
    Dim datumAllotmSum(), datumBookSum() As Int16 ', datumKratSum()
    Dim praktStKwd As Integer
    'Dim simbPraktKwd() As Integer
    Dim praktStatus() As AbwechselStatus
    Dim indexPraktStat As Int16
    'edw globale Variablen gia status dwmatiwn
    Dim dwmatia(), dwm() As String
    Dim zeigerDwm1, zeigerDwm2 As Int16 ' Zeiger sto dwmatia() gia na bgazei kathe fora mia dekada

    'edw globale Variablen gia EMFANISI diamenontwn
    Dim praktDiamKwd As Integer = -1
    Dim simbDiamKwd As Integer = -1
    'edw globale Variablen gia EMFANISI kinisis TMIMATWN
    Dim tmimaKd As Integer = -1
    Structure Koordinaten ' exw Daiforetiko Anzahl apo Fpa sta tmimata-> merken Location sto malen pou einai i kefalida !!!!
        Dim locX As Single
        Dim fpa As Single 'Mono gia to FPA stin epikefalida-> alliws einai -1!!!!!!!
    End Structure

    'edw globale Variablen gia KATASTASI AFIXEWN_ANAXWRISEWN
    Dim praktK As Integer = -1
    Dim simbK As Integer = -1

    'edw globale Variablen twn tmimata LOGARIASMOI
    Dim kwdKratLDB, tmimaLKwd, pelatisKwd As Integer
    Dim afixiLog, anaxLog As Date

    'edw globale Variablen twn tmimata METRITOIS
    Structure Kinisi
        Dim kwdKin As Integer
        Dim fpa As Single
        Dim poso As Single
        Dim netopos As Single
        Dim fpapos As Single
        Dim maizon As Single
        Dim netomaizon As Single
        Dim fpamaizon As Single
        Dim sPoso As Single
        Dim sFpa As Single
        Dim sMaizon As Single
        Dim sMaizFpa As Single
    End Structure
    Dim sum(5) As Single
    Dim kiniseis() As Kinisi
    Dim eggrafesKwd() As Integer
    Dim tmimaMKwd, eggrafiKwd As Integer 'DB kwdikoi von Tmimata kai TmimataEggrafes

    'edw globale Variablen Guarantee
    Structure ImeraGurant
        Dim kwdDb As Integer '-1 as init Werte
        Dim plithosDwm As Int16 '0 as init Werte
        Dim timi As Single '0 as init Wert
    End Structure
    Dim praktKwd As Integer
    Dim guarant(4, 10) As ImeraGurant

    Friend WithEvents KratiseisTableadpter1 As New winhotel.dbhotelDataSet1TableAdapters.kratiseisTableAdapter
    Friend WithEvents PraktoreiaTableadpter1 As New winhotel.dbhotelDataSet1TableAdapters.praktoreiaTableAdapter
    Friend WithEvents OldCustomAdapter1 As New winhotel.dbhotelDataSet1TableAdapters.OldCustomersTableAdapter


    Dim availPath As String = "c:\winfo\availabilities.txt"
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS********KRATHSEIS********KRATHSEIS********KRATHSEIS***
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS********KRATHSEIS********KRATHSEIS********KRATHSEIS***
    Dim praktoreiokwdValue As Integer 'recht spaet eingefuehrt!->Fall: Diamenwntes kata tin diarkeia diamonis (oxi 1 mera) alazei to praktoreio
    'flagKr einai me ti kwdikous  ta diafora Controls (sto NAME) sto 'male_timokatalogous_pnl'  tha apothikeutoun gia na briskw meta me pnl(0) kai Find(0)
    'flagKrat=1->kwdikoi apo toyristperiodoi DB, flagkrat=2 kwdikoi apo timeskratisis! 
    'Dim dwmatioChanged As Boolean = False
    Dim flagKr As Byte ' ->wenn status =1 tote flagKrat einai PANTA 1 (kwdikoi apo touristpreodo DB sta Name twn Controls)!!!!!!!!!!!
    'wenn status=2 (diamenwntes)->A). flagKrat=1-> oi touristikoi periodoi > timeskratiseis.count (einai i periptwsi pou o user paratinei tin diamoni (anaxwrisi)
    'B). flagKrat=2->touristikoi periodoi <= timeskratiseis.count ->reload afixi ALLA kai gia tin  periptwsi pou meta apo allagi timwn exw timeskratisis > tourperiods (gia to biblio Portas)
    Dim sesionID As Integer 'gia concurence me allous users->ananewnetai me kathe nea kratisi(diladi se mia sesion gia enan user to sesionid tha ananevthei poles fores)

    Dim ekptPoso, ekptPososto, ekptFree, ekptCFee As Single
    'Dim languageEN = New System.Globalization.CultureInfo("en") ' 
    'Dim languageGR = New System.Globalization.CultureInfo("el-GR")
    Dim status As Byte '1=Kratiseis-Afixeis 2=Diamenwntes allagi stoixeiwn
    Dim anaxSperre As Boolean = False 'H Hmerominia Anaxwrisews einai mikroterh tis trexousas->PREPEI NA ALLAKSEI APARAITHTws (stou diamenvntes)
    Dim currentAfixi, currentAnaxwrisi As Date 'gia na parakolouthw allages imerominias->(to event valuechenged mou dimiourgouse problimata efoson exw masboxex na diksw)
    'Dim firstLoadDBEintrag As Boolean
    Dim isDBEintrag As Boolean = False
    Dim onomChangeOK As Boolean
    Dim imeromErgasias As Date ' = "25/5/2007"
    Dim kwdikoKratisisDB As Integer = -1
    Dim timokatalog() As Timokatalogos
    Dim etos As Int16
    Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio, praktXrewsKwd As Integer ' apoimeres
    Dim maxklines As Int16 'maxklines gia na foulara to klines Cbox stis kratiseis->SIMPIPTEI ma to DB kwdiko!!
    Dim currentimerom As Date ' Einai i trexousa Hmerominia apo Parametrous Etaireias (arxika to kanw san globale Vrble->meta parametros stin AUfruf tis ErgasiesHmerasF) 
    Dim tooltip As New ToolTip
    Dim fromkr As String '= Me.DbhotelDataSet.Mail(0).ffrom
    Dim subjectkr As String ' = Me.DbhotelDataSet.Mail(2).subject
    Dim smtpServerkr As String ' = Me.DbhotelDataSet.Mail(0).smtpServer
    Dim smtpUsernamekr As String '= Me.DbhotelDataSet.Mail(0).smtpUsername
    Dim smtpPasswordkr As String ' = Me.DbhotelDataSet.Mail(0).smtpPassword
    Dim bodykr As String '
    Structure Timokatalogos ' APothikeuei (kai) tous DB kwdikouws kathe Tomokatalogou->(enas Timokatalogos gia kathe tousristiki periodo tou simbolaiou)
        'Dim status As Byte '1=insert 2=update 3=delete
        Dim kwdDB As Integer
        Dim tourist As Integer
        Dim simfonia As Integer
        Dim xrewsiDB As Integer 'apothikeusi arxikis xrewsis stous diamenwntes->gia parakolouthisi alaghs xrewsis
        Dim xrewsi As Integer
        Dim timi As Integer
        Dim paroxiDB As Single
        Dim paroxi As Single
        Dim paroxiTemp As Single
        Dim apo As Date
        Dim mexri As Date
        Dim mexriDB As Date
        Dim imeresTotal As Int16
        Dim imeresPlirom As Int16
        Dim imeresPliromDB As Int16
        Dim ekptosi As Single
        Dim ekptosiDB As Single
        Dim ypnosDB As Single ' timi tis basis-> arxiki timi!->gia sugkrisi ean alaksan oi times apo user->xrisimeuei gia ypologismo "dedouleumenwn" stin allagi timwn stous diamenwntes!
        Dim ypnos As Single ' timi basis (alla me mia allagh->ean einai 0 i timi basis tote pairnei tin timi temp (sender.text)->gia upologismo ekptwsewn)
        Dim ypnosTemp As Single 'prwsorini apothikeusi allagwn timis ypnou (sender.text apo user) (-> gia na mporei na 'paizei' kaneis me ekptoseis epi twv arxikwn timwn
        Dim prwinoDB As Single
        Dim prwino As Single
        Dim prwinoTemp As Single
        Dim geumaDB As Single
        Dim geuma As Single
        Dim geumaTemp As Single
        Dim deipnoDB As Single
        Dim deipno As Single
        Dim deipnoTemp As Single
        Dim synoloDB As Single
        Dim synolo As Single
        Dim synoloTemp As Single
        Dim dedoulPos As Single
    End Structure
    Friend WithEvents myTimer, myTimer2 As New Timer
    Dim showLblText As Boolean = True

    Private Sub TreeViewErgHmeras_AfterSelect(ByVal sender As System.Object, ByVal e As System.Windows.Forms.TreeViewEventArgs) Handles TreeViewErgHmeras.AfterSelect
        Select Case Me.TreeViewErgHmeras.SelectedNode.Name.ToString

            Case "Akyrosi_apy_ge"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                akyrosi_apy_ge()
            Case "gramatio_eispraksis"
                Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                'Me.ParastatikaTableAdapter.Fill(Me.DbhotelDataSet.parastatika)
                'Me.PistwtikesTableAdapter.Fill(Me.DbhotelDataSet.pistwtikes)
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ekdosi_mem_ge()
            Case "PraktEispr"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Location = New System.Drawing.Point(5, 5)
                Me.ZentralPnl.Dock = DockStyle.Fill
                Me.eisprakseis_praktoreia()
            Case "ekdosi_mem_apy"
                Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                'Me.ParastatikaTableAdapter.Fill(Me.DbhotelDataSet.parastatika)
                'Me.PistwtikesTableAdapter.Fill(Me.DbhotelDataSet.pistwtikes)
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ekdosi_memonomenwn_apy()
            Case "Ekdosi_Extra_Parast"
                Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                'Me.ParastatikaTableAdapter.FillApyPistotika(Me.DbhotelDataSet.parastatika, 2, 5) ' fortwnw mono apy kai psitwtiko timologio->PREPEI na einai ta 2 prwta stin DB
                Me.ParastatikaTableAdapter.Fill(Me.DbhotelDataSet.parastatika)
                'Me.PistwtikesTableAdapter.Fill(Me.DbhotelDataSet.pistwtikes)
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ekdosi_extra_parastatikwn()
            Case "Dwmatia_pinakas"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                pinakas_status_dwmatiwn()
            Case "Estiatorio_katast"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                katast_prwinwn_oldtown()
            Case "Thalasses"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                katast_prwinwn_thalasses()
            Case "Lista_Praktoreiwn"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                lista_prktoreiwn()
            Case "Status_Xenodox"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                plirotita_xenodox()
            Case "Status_Praktoreiwn"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                plirotita_praktoreiwn()
            Case "Plirotita_Dwm"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                plirotita_dwmatiwn()
            Case "PlirotTimwn"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                plirotita_timwn()
            Case "Xenod"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                plirotita_old_town()
            Case "diamenontes_old"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                emf_diamenontwn_oldtown()
            Case "diamenontes_viles"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                emf_diamenontwn_viles()
            Case "Emf_Kns_Tmt"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                emf_kinisis_tmimatwn()
            Case "Afix_Anax_old"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ekt_afix_anax_zeig_old()
            Case "Afix_Anax_viles"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ekt_afix_anax_zeig_viles()
            Case "Dimenontes"
                status = 2
                DateTimePicker2.Enabled = False
                'Me.KlinesTableAdapter.FillByMexriKlines(Me.DbhotelDataSet.klines, maxklines)
                'Me.XrewseisTableAdapter.Fill(Me.DbhotelDataSet.xrewseis)
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ZentralPnl.Location = New Point(Kratiseis4Pnl.Location.X + Kratiseis4Pnl.Width - SynolPnl.Width, Kratiseis4Pnl.Location.Y + Kratiseis4Pnl.Height + SynolPnl.Height + 10)
                init_kratiseis_diamenontes(False)
                'Me.kratiseis_zeig(False)
            Case "Kratiseis"
                status = 1
                praktoreiokwdValue = -1
                praktoreiokwd = -1
                DateTimePicker2.Enabled = True
                'Me.KlinesTableAdapter.FillByMexriKlines(Me.DbhotelDataSet.klines, maxklines)
                'Me.XrewseisTableAdapter.Fill(Me.DbhotelDataSet.xrewseis)
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                ZentralPnl.Location = New Point(Kratiseis4Pnl.Location.X + Kratiseis4Pnl.Width - SynolPnl.Width, Kratiseis4Pnl.Location.Y + Kratiseis4Pnl.Height + SynolPnl.Height + 10)
                init_kratiseis_diamenontes(False)
                'Me.kratiseis_zeig(False)
            Case "Guarantee"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                Me.guarantee_zeig()
            Case "Metritis"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Location = New System.Drawing.Point(31, 52)
                Me.ZentralPnl.Dock = DockStyle.Fill
                Me.metritis_zeig()
            Case "Logariasmoi"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Location = New System.Drawing.Point(5, 5)
                Me.ZentralPnl.Dock = DockStyle.Fill
                Me.logariasmoi_zeig()
            Case "myData"
                Me.ZentralPnl.Controls.Clear()
                Me.ZentralPnl.BorderStyle = BorderStyle.Fixed3D
                Me.ZentralPnl.Dock = DockStyle.Fill
                emf_mydata()

        End Select
    End Sub
    '**********************MYDATA**************************************************************************
    '**********************MYDATA**************************************************************************
    '**********************MYDATA**************************************************************************
    Private Sub emf_mydata()
        Me.ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        EtikLbl.Text = "myDATA"
        EtikLbl.Location = New Point(myDataPnl.Width / 3, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        myDataPnl.Location = New Point(10, EtiketaErgHmPnl.Height)
        Me.myDataPnl.Size = New Point(873, 669)

        ' GrammatDwmTbx.Clear()
        GrammPelatisTbx.Clear()
        ''  EnoikosLbl.Text = ""
        '  PosonLbl.Text = ""
        '  kwdKratGE = -1
        ' diamenKwd = -1
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(myDataPnl)
        myInvId = Nothing
    End Sub
    Private Sub filter_myInvoices(ByVal flag As Byte)
        Dim param1 As String


        Dim searchQuery1 As String = "SELECT id, onomateponimo , nameLpt,eidos, uid, mark,cancelmark, tipos,  series, aa, issueDate, totalGrossvalue,corelatedInvoic from myinvoices "

        If mySentRdb.Checked Then
            param1 = "mark Is Not NULL And mark<>'' "
        Else
            param1 = "mark=''"
        End If
        Dim queri As String
        If flag = 1 Then
            queri = searchQuery1 + " WHERE " + param1 + " AND ((onomateponimo LIKE '%" + myNameTbx.Text + "%') OR (nameLpt LIKE '%" + myNameTbx.Text + "%')) Order by id DESC"
        Else
            queri = searchQuery1 + " WHERE " + param1 + " Order by id DESC"
        End If

        'Dim queri1 As String = searchQuery1 + " WHERE " + param1


        Using connection As New SqlConnection(connectionString)
            Dim da As New SqlDataAdapter
            Dim dt As New DataTable
            connection.Open()
            Dim cmd As New SqlCommand(queri, connection)
            da.SelectCommand = cmd
            dt.Clear()
            Try
                da.Fill(dt)
                myDtGrdView.DataSource = dt
                myDtGrdView.Columns(0).HeaderText = "ID"
                myDtGrdView.Columns(0).Width = 50
                myDtGrdView.Columns(1).HeaderText = "ΟΝΟΜΑΤΕΠΩΝΥΜΟ"
                myDtGrdView.Columns(2).HeaderText = "ΠΑΡΑΛΗΠΤΗΣ"
                myDtGrdView.Columns(3).HeaderText = "ΠΑΡΑΣΤΑΤΙΚΟ"
                myDtGrdView.Columns(4).HeaderText = "UID"
                myDtGrdView.Columns(5).HeaderText = "MARK"
                myDtGrdView.Columns(6).HeaderText = "CANCELMARK"
                myDtGrdView.Columns(7).HeaderText = "ΕΙΔΟΣ"

                myDtGrdView.Columns(8).HeaderText = "ΣΕΙΡΑ"
                myDtGrdView.Columns(8).Width = 50
                myDtGrdView.Columns(9).HeaderText = "ΑΡΙΘΜΟΣ"
                myDtGrdView.Columns(10).HeaderText = "ΗΜΕΡΟΜΗΝΙΑ"
                myDtGrdView.Columns(11).HeaderText = "ΑΞΙΑ"
                myDtGrdView.Columns(12).HeaderText = "ΣΥΣΧΕΤΙΖΟΜΕΝΟ"
            Catch ex As Exception

            End Try


        End Using


    End Sub
    Private Sub mySearchBtn_Click(sender As Object, e As EventArgs) Handles mySearchBtn.Click
        clear_pnl()
        filter_myInvoices(0)
    End Sub
    Private Sub myNameTbx_KeyUp(sender As Object, e As KeyEventArgs) Handles myNameTbx.KeyUp
        clear_pnl()
        filter_myInvoices(1)
    End Sub
    Private Sub myLoadBtn_Click(sender As Object, e As EventArgs) Handles myLoadBtn.Click
        Dim englishCulture As New CultureInfo("en-US", False)
        Try

            myInvId = CType(myIdTbx.Text, Int64)
            Using connection As New SqlConnection(connectionString)
                Dim command As New SqlCommand
                Dim myReader As SqlDataReader
                connection.Open()
                command.Connection = connection

                command.Parameters.AddWithValue("@id", myInvId)
                command.CommandText = "SELECT * FROM myinvoices WHERE (id=@id)" 'and (identifikation=?)
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                While myReader.Read()
                    myAadeTxt.Text = myReader.GetString(1)
                    myAadeKeyTxt.Text = myReader.GetString(2)
                    myEpixtbx.Text = myReader.GetString(3)
                    myEidosTbx.Text = myReader.GetString(4)
                    myMarkTbx.Text = myReader.GetString(7)
                    myCancelmarkTbx.Text = myReader.GetString(8)
                    myEkdAfmtbx.Text = myReader.GetString(10)
                    myEkdCountrytbx.Text = myReader.GetString(11)
                    myEkdBranchtbx.Text = myReader.GetString(12)
                    myPostalEkdTbx.Text = myReader.GetString(13)
                    myCityEkdTbx.Text = myReader.GetString(14)
                    If Not IsDBNull(myReader.GetString(15)) Then
                        myLiptAfmtbx.Text = myReader.GetString(15)
                    End If
                    If Not IsDBNull(myReader.GetString(16)) Then
                        myLiptCountrytbx.Text = myReader.GetString(16)
                    End If
                    If Not IsDBNull(myReader.GetString(17)) Then
                        myLiptBranchtbx.Text = myReader.GetString(17)
                    End If
                    myOnomaLptTbx.Text = myReader.GetString(18)
                    If Not IsDBNull(myReader.GetString(19)) Then
                        myLiptNametbx.Text = myReader.GetString(19)
                    End If
                    If Not IsDBNull(myReader.GetString(20)) Then
                        myLiptPostcaltbx.Text = myReader.GetString(20)
                    End If
                    If Not IsDBNull(myReader.GetString(21)) Then
                        myLiptCitytbx.Text = myReader.GetString(21)
                    End If


                    mySeriesTbx.Text = myReader.GetString(22)
                    myAAtbx.Text = myReader.GetString(23)
                    myIssueDpck.Value = myReader.GetDateTime(24)
                    myTypetbx.Text = myReader.GetString(9)
                    myTipos = myTypetbx.Text
                    If Not IsDBNull(myReader.GetString(26)) Then
                        myCorreltbx.Text = myReader.GetString(26)
                    End If





                    myPaymTypetbx.Text = myReader.GetString(25)
                    myPaymAmounttbx.Text = myReader.GetFloat(27).ToString

                    myYpnNettbx.Text = myReader.GetFloat(28).ToString
                    myYpnFpatbx.Text = myReader.GetFloat(32).ToString
                    myPrNettbx.Text = myReader.GetFloat(29).ToString
                    myPrFpatbx.Text = myReader.GetFloat(33).ToString
                    myGeuNettbx.Text = myReader.GetFloat(30).ToString
                    myGeuFpatbx.Text = myReader.GetFloat(34).ToString
                    myExtrNettbx.Text = myReader.GetFloat(31).ToString
                    myExtrFpatbx.Text = myReader.GetFloat(35).ToString


                    myTimolTxt.Text = myReader.GetInt32(5).ToString

                End While

                myReader.Close()
                command.Parameters.Clear()
            End Using

        Catch ex As InvalidCastException
            MsgBox("Δώστε ID!", MsgBoxStyle.Exclamation)
            myInvId = Nothing
            clear_pnl()
        End Try
    End Sub
    'Private Sub myLoadBtn_Click(sender As Object, e As EventArgs) Handles myLoadBtn.Click
    '    Dim englishCulture As New CultureInfo("en-US", False)
    '    Try
    '        myInvId = CType(myIdTbx.Text, Int64)
    '        Using connection As New SqlConnection(connectionString)
    '            connection.Open()
    '            Dim command As New SqlCommand("SELECT * FROM myinvoices WHERE id = @id", connection)
    '            command.Parameters.AddWithValue("@id", myInvId)

    '            Dim myReader As SqlDataReader = command.ExecuteReader()
    '            If myReader.Read() Then
    '                myAadeTxt.Text = myReader.GetString(1)
    '                myAadeKeyTxt.Text = myReader.GetString(2)
    '                myEpixtbx.Text = myReader.GetString(3)
    '                ' Populate other text boxes with the retrieved values

    '                myReader.Close()
    '            Else
    '                MsgBox("Δεν βρέθηκε η Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '                ClearTextBoxes()
    '            End If
    '        End Using
    '    Catch ex As InvalidCastException
    '        MsgBox("Δώστε ID!", MsgBoxStyle.Exclamation)
    '        myInvId = Nothing
    '        ClearTextBoxes()
    '    End Try
    'End Sub

    Private Sub ClearTextBoxes()
        myAadeTxt.Text = ""
        myAadeKeyTxt.Text = ""
        myEpixtbx.Text = ""
        ' Clear other text boxes
    End Sub

    'Private Sub myCancelBtn_Click(sender As Object, e As EventArgs) Handles myCancelBtn.Click
    '    Dim isAkyromeno As Boolean
    '    If myCancelmarkTbx.Text = "" Then
    '        Try
    '            myInvId = CType(myIdTbx.Text, Int64)
    '            Using connection As New OleDb.OleDbConnection(connectionString)
    '                Dim command As New OleDb.OleDbCommand()
    '                Dim myReader As OleDb.OleDbDataReader
    '                connection.Open()
    '                command.Connection = connection

    '                command.Parameters.AddWithValue("kwd", myTimolTxt.Text)
    '                command.CommandText = "SELECT akyromeno FROM timologia WHERE (kwd=?)" 'and (identifikation=?)
    '                myReader = command.ExecuteReader()
    '                command.Parameters.Clear()
    '                ' Always call Read before accessing data.
    '                While myReader.Read()

    '                    isAkyromeno = myReader.GetBoolean(0)

    '                End While

    '                myReader.Close()

    '            End Using

    '            If isAkyromeno Then

    '                Dim sendInvoice = New CancelInvoice(connectionString, myInvId) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
    '                sendInvoice.Send_request()
    '                myInvId = Nothing

    '                myNameTbx.Text = myOnomaLptTbx.Text
    '                filter_myInvoices(1)
    '                clear_pnl()
    '            Else
    '                MsgBox("To παραστατικό πρέπει να έχει ακυρωθεί άπό το προηγούμενο μενού ('Ακύρ. ΤΙΜ-ΑΠΥ')", MsgBoxStyle.Exclamation)
    '            End If
    '        Catch ex As InvalidCastException
    '            MsgBox("Δώστε ID!", MsgBoxStyle.Exclamation)
    '            myInvId = Nothing
    '            clear_pnl()
    '        End Try
    '    Else
    '        MsgBox("Είναι ήδη ακυρωμένο!", MsgBoxStyle.Exclamation)
    '    End If

    'End Sub
    Private Sub myCancelBtn_Click(sender As Object, e As EventArgs) Handles myCancelBtn.Click
        Dim isAkyromeno As Boolean
        If myCancelmarkTbx.Text = "" Then
            Try
                myInvId = CType(myIdTbx.Text, Int64)
                Using connection As New SqlConnection(connectionString)
                    connection.Open()
                    Dim command As New SqlCommand("SELECT akyromeno FROM timologia WHERE kwd = @kwd", connection)
                    command.Parameters.AddWithValue("@kwd", myTimolTxt.Text)

                    Dim isAkyromenoObject As Object = command.ExecuteScalar()
                    If isAkyromenoObject IsNot Nothing AndAlso Not DBNull.Value.Equals(isAkyromenoObject) Then
                        isAkyromeno = Convert.ToBoolean(isAkyromenoObject)
                    End If

                    If isAkyromeno Then
                        Dim sendInvoice = New CancelInvoice(connectionString, myInvId)
                        sendInvoice.Send_request()
                        myInvId = Nothing

                        myNameTbx.Text = myOnomaLptTbx.Text
                        filter_myInvoices(1)
                        clear_pnl()
                    Else
                        MsgBox("To παραστατικό πρέπει να έχει ακυρωθεί άπό το προηγούμενο μενού ('Ακύρ. ΤΙΜ-ΑΠΥ')", MsgBoxStyle.Exclamation)
                    End If
                End Using
            Catch ex As InvalidCastException
                MsgBox("Δώστε ID!", MsgBoxStyle.Exclamation)
                myInvId = Nothing
                clear_pnl()
            End Try
        Else
            MsgBox("Είναι ήδη ακυρωμένο!", MsgBoxStyle.Exclamation)
        End If
    End Sub

    Private Sub mySendBtn_Click(sender As Object, e As EventArgs) Handles mySendBtn.Click
        If Not String.IsNullOrEmpty(myAadeTxt.Text) And Not String.IsNullOrEmpty(myAadeKeyTxt.Text) Then
            Dim sendInvoice = New SendInvoices(connectionString, myAadeTxt.Text, myAadeKeyTxt.Text)
            'Dim sendInvoice = New SendInvoices("FOL1234", "5a27a4e443ab4e8e86f71fb1870a4e0a")
            'FOL1234  5a27a4e443ab4e8e86f71fb1870a4e0a
            'Dim sendInvoice = New SendInvoices(connectionString,"Stakap15ike", "0c425e78739a4cec96560223aebdc6ff")
            'Stakap15ike  0c425e78739a4cec96560223aebdc6ff
            Dim threadSendInvoice As Threading.Thread
            threadSendInvoice = sendInvoice.set_mode(2) ' do nothing with database
            threadSendInvoice = sendInvoice.send_XML_file_from_pc()
        Else
            MsgBox("Δώστε ID για φόρτωση κωδικών taxis!", MsgBoxStyle.Exclamation)
        End If

        '     If myInvId <> 0 Then
        '         Dim sendInvoice = New SendInvoices(connectionString, myAadeTxt.Text, myAadeKeyTxt.Text, myEpixtbx.Text, myEidosTbx.Text, myTimolTxt.Text, myTypetbx.Text, myEkdAfmtbx.Text, myEkdCountrytbx.Text, myEkdBranchtbx.Text, myPostalEkdTbx.Text, myCityEkdTbx.Text, myLiptAfmtbx.Text, myLiptCountrytbx.Text, myLiptBranchtbx.Text, myOnomaLptTbx.Text, myLiptNametbx.Text, myLiptPostcaltbx.Text, myLiptCitytbx.Text, mySeriesTbx.Text,
        '                                  myAAtbx.Text, myIssueDpck.Value.Date, myPaymTypetbx.Text, Nothing, CType(myPaymAmounttbx.Text, Single), CType(myYpnNettbx.Text, Single), CType(myPrNettbx.Text, Single), CType(myGeuNettbx.Text, Single), CType(myExtrNettbx.Text, Single), myYpnFpatbx.Text,
        'myPrFpatbx.Text, myGeuFpatbx.Text, myExtrFpatbx.Text) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
        '         Dim threadSendInvoice As Threading.Thread
        '         threadSendInvoice = sendInvoice.set_mode(myInvId)
        '         threadSendInvoice = sendInvoice.send_invoice()

        '         myInvId = Nothing

        '         ' mySentRdb.Checked = True
        '         '   myNameTbx.Text = myOnomaLptTbx.Text

        '         'filter_myInvoices(1)
        '         clear_pnl()
        '     End If


    End Sub
    Private Sub TXTBOX_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles myYpnNettbx.Leave, myPrNettbx.Leave, myGeuNettbx.Leave, myExtrNettbx.Leave, myPaymAmounttbx.Leave
        Dim y As Single = 0
        Dim englishCulture As New System.Globalization.CultureInfo("en-US", False)
        Try
            If CType(sender.text, Integer) Then
                y = sender.text
                sender.text = y.ToString("F")
            End If
        Catch ex As InvalidCastException
            sender.text = y.ToString("F")
        End Try
    End Sub
    Private Sub myPistwtikoBtn_Click(sender As Object, e As EventArgs) Handles myPistwtikoBtn.Click
        If myCancelmarkTbx.Text = "" Then
            If myMarkTbx.Text <> "" Then
                If myInvId <> 0 Then
                    Dim threadSendInvoice As Threading.Thread
                    If myTipos.Equals("2.1") Then
                        Dim sendInvoice = New SendInvoices(connectionString, myAadeTxt.Text, myAadeKeyTxt.Text, myEpixtbx.Text, myEidosTbx.Text, myTimolTxt.Text, "5.1", myEkdAfmtbx.Text, myEkdCountrytbx.Text, myEkdBranchtbx.Text, myPostalEkdTbx.Text, myCityEkdTbx.Text, myLiptAfmtbx.Text, myLiptCountrytbx.Text, myLiptBranchtbx.Text, myOnomaLptTbx.Text, myLiptNametbx.Text, myLiptPostcaltbx.Text, myLiptCitytbx.Text, mySeriesTbx.Text,
                                            myAAtbx.Text, myIssueDpck.Value.Date, myPaymTypetbx.Text, myMarkTbx.Text, CType(myPaymAmounttbx.Text, Single), CType(myYpnNettbx.Text, Single), CType(myPrNettbx.Text, Single), CType(myGeuNettbx.Text, Single), CType(myExtrNettbx.Text, Single), myYpnFpatbx.Text,
          myPrFpatbx.Text, myGeuFpatbx.Text, myExtrFpatbx.Text) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros

                        threadSendInvoice = sendInvoice.set_mode(myInvId)
                        threadSendInvoice = sendInvoice.send_invoice()

                        myInvId = Nothing
                        myTipos = ""
                        clear_pnl()
                    ElseIf myTipos.Equals("11.2") Then

                        Dim sendInvoice = New SendInvoices(connectionString, myAadeTxt.Text, myAadeKeyTxt.Text, myEpixtbx.Text, myEidosTbx.Text, myTimolTxt.Text, "11.4", myEkdAfmtbx.Text, myEkdCountrytbx.Text, myEkdBranchtbx.Text, myPostalEkdTbx.Text, myCityEkdTbx.Text, myLiptAfmtbx.Text, myLiptCountrytbx.Text, myLiptBranchtbx.Text, myOnomaLptTbx.Text, myLiptNametbx.Text, myLiptPostcaltbx.Text, myLiptCitytbx.Text, mySeriesTbx.Text,
                                            myAAtbx.Text, myIssueDpck.Value.Date, myPaymTypetbx.Text, myMarkTbx.Text, CType(myPaymAmounttbx.Text, Single), Math.Round(CType(myYpnNettbx.Text, Single), 2), CType(myPrNettbx.Text, Single), CType(myGeuNettbx.Text, Single), CType(myExtrNettbx.Text, Single), myYpnFpatbx.Text,
          myPrFpatbx.Text, myGeuFpatbx.Text, myExtrFpatbx.Text) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros

                        threadSendInvoice = sendInvoice.set_mode(myInvId)
                        threadSendInvoice = sendInvoice.send_invoice()

                        myInvId = Nothing
                        myTipos = ""
                        clear_pnl()
                    Else
                        MsgBox("Μη συμβατός τύπος παραστατικού για έκδοση συσχετιζόμενου πιστωτικού!", MsgBoxStyle.Exclamation)
                    End If


                    ' mySentRdb.Checked = True
                    '   myNameTbx.Text = myOnomaLptTbx.Text

                    'filter_myInvoices(1)

                End If


            End If


        End If
    End Sub
    Private Sub clear_pnl()
        myAadeTxt.Text = ""
        myAadeKeyTxt.Text = ""
        myEpixtbx.Text = ""
        myEidosTbx.Text = ""
        myMarkTbx.Text = ""
        myCancelmarkTbx.Text = ""
        myEkdAfmtbx.Text = ""
        myEkdCountrytbx.Text = ""
        myEkdBranchtbx.Text = ""
        myPostalEkdTbx.Text = ""
        myCityEkdTbx.Text = ""

        myLiptAfmtbx.Text = ""


        myLiptCountrytbx.Text = ""


        myLiptBranchtbx.Text = ""

        myOnomaLptTbx.Text = ""

        myLiptNametbx.Text = ""

        myLiptPostcaltbx.Text = ""

        myLiptCitytbx.Text = ""

        mySeriesTbx.Text = ""
        myAAtbx.Text = ""
        myIssueDpck.Value = imeromErgasias
        myTypetbx.Text = ""

        myCorreltbx.Text = ""



        myPaymTypetbx.Text = ""
        myPaymAmounttbx.Text = ""

        myYpnNettbx.Text = ""
        myYpnFpatbx.Text = ""
        myPrNettbx.Text = ""
        myPrFpatbx.Text = ""
        myGeuNettbx.Text = ""
        myGeuFpatbx.Text = ""
        myExtrNettbx.Text = ""
        myExtrFpatbx.Text = ""


        myTimolTxt.Text = ""
        myIdTbx.Text = ""
    End Sub
    '*****************AKYROSI APY GE**********************AKYROSI APY GE************************AKYROSI APY GE**
    '*******************AKYROSI APY GE********************AKYROSI APY GE*******************************AKYROSI APY GE******************AKYROSI APY GE**
    Private Sub akyrosi_apy_ge()

        Dim afmadapter As New dbhotelDataSetTableAdapters.afmTableAdapter


        kwdDelApy = -1
        kwdDelGE = -1

        EtikLbl.Text = "ΑΚΥΡΩΣΗ Α.Π.Υ. - Γ.Ε. ΣΗΜΕΡΙΝΗΣ ΗΜΕΡΟΜΗΝΙΑΣ"
        EtikLbl.Location = New Point(40, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        AkyrosiApyGePnl.Location = New Point(80, EtiketaErgHmPnl.Height)
        AkyrosiApyGePnl.Size = New Point(554, 317)
        afmadapter.Fill(Me.DbhotelDataSet.afm)
        clear_stoixeia()
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(AkyrosiApyGePnl)
        Me.ZentralPnl.Controls.Add(EtiketaErgHmPnl)
    End Sub

    Private Sub clear_stoixeia()
        AkyrosiApyAALbl.Text = ""
        AkyrosiApyImerLbl.Text = ""
        AkyrosiApyPelLbl.Text = ""
        AkyrosiApySynolLbl.Text = ""

        AkyrosiApyTbx1.Clear()
        AkyrosiGETbx2.Clear()
        TimAkyrCheck.Checked = True
        AkyrCbx.Items.Clear()
        fuehle_akyrosi_cbx()
        AkyrCbx.SelectedIndex = 0
        kwdDelApy = -1
        kwdDelGE = -1
    End Sub
    Private Sub fuehle_akyrosi_cbx()
        Dim j As Int16
        AkyrCbx.Items.Clear()

        For j = 0 To Me.DbhotelDataSet.afm.Count
            If j = 0 Then
                AkyrCbx.Items.Add("<Εταιρεία>")
            Else
                AkyrCbx.Items.Add(Me.DbhotelDataSet.afm(j - 1).epixirisi)
            End If

        Next
    End Sub
    Private Sub AkyrCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AkyrCbx.SelectedIndexChanged
        If sender.selectedIndex < 1 Then
            kwdApyAfm = -1
        Else
            kwdApyAfm = Me.DbhotelDataSet.afm(sender.selectedINdex - 1).kwd
        End If


    End Sub
    Private Sub TimAkyrCheck_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TimAkyrCheck.CheckedChanged
        If TimAkyrCheck.Checked = True Then
            Label145.Text = "A/A Τιμ.:"
        Else
            Label145.Text = "A/A Α.Π.Υ.:"
        End If
    End Sub
    Private Sub Suche_Apy_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AkyrosiBtn1.Click
        Dim parastatiko As Integer

        If TimAkyrCheck.Checked Then
            parastatiko = get_kwdparast_ekdosis_tim(kwdApyAfm, 2) 'Me.DbhotelDataSet.etaireia(0).timolkwd
        Else
            parastatiko = get_kwdparast_ekdosis_tim(kwdApyAfm, 1) 'Me.DbhotelDataSet.etaireia(0).apykwd
        End If

        If Not AkyrosiApyTbx1.Text.Equals("") Then
            Try
                Me.EpanekdositimologiouTableAdapter.FillTimolImerasProsAkyrosiByAAParstImerom(Me.DbhotelDataSet.epanekdositimologiou, CType(AkyrosiApyTbx1.Text, Int16), imeromErgasias, False, parastatiko)

                If Me.DbhotelDataSet.epanekdositimologiou.Count = 1 Then
                    kwdDelApy = Me.DbhotelDataSet.epanekdositimologiou(0).timkwd
                    kwdDelGE = -1
                    AkyrosiApyAALbl.Text = Me.DbhotelDataSet.epanekdositimologiou(0).aa
                    AkyrosiApyImerLbl.Text = Me.DbhotelDataSet.epanekdositimologiou(0).imerominia
                    AkyrosiApyPelLbl.Text = Me.DbhotelDataSet.epanekdositimologiou(0).eponimia
                    AkyrosiApySynolLbl.Text = Me.DbhotelDataSet.epanekdositimologiou(0).synola.ToString("C2")
                Else
                    clear_stoixeia()
                End If
            Catch ex As InvalidCastException
                MsgBox("Δώστε Αριθμό ΑΠΥ !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                clear_stoixeia()
                Exit Sub
            Catch ex1 As OverflowException
                'MsgBox("Δώστε Αριθμό ΓΕ !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                clear_stoixeia()
                Exit Sub
            End Try

        Else
            Try
                Dim form As New AkyrosiApyGeSuche(imeromErgasias, 1, parastatiko)
                form.ShowDialog()
                kwdDelApy = form.return_kwdiko_apy
                kwdDelGE = -1
                If kwdDelApy <> -1 Then
                    AkyrosiApyAALbl.Text = form.return_aa_apy
                    AkyrosiApyTbx1.Text = AkyrosiApyAALbl.Text
                    AkyrosiApyImerLbl.Text = imeromErgasias
                    AkyrosiApyPelLbl.Text = form.return_eponimia_apy
                    AkyrosiApySynolLbl.Text = (form.return_synol_poso_apy).ToString("C2")
                End If

                form.Dispose()
            Catch ex As System.Exception
                System.Windows.Forms.MessageBox.Show(ex.Message)
                clear_stoixeia()
            End Try

        End If



    End Sub
    Private Sub Suche_GE_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AkyrosiBtn2.Click

        If Not AkyrosiGETbx2.Text.Equals("") Then
            Try
                Me.GramatiaTableAdapter.FilJoinGramatioOnomalByAAImerAkyro(Me.DbhotelDataSet.gramatia, CType(AkyrosiGETbx2.Text, Int16), imeromErgasias, False)
                If Me.DbhotelDataSet.gramatia.Count = 1 Then
                    kwdDelApy = -1
                    kwdDelGE = Me.DbhotelDataSet.gramatia(0).kwd
                    AkyrosiApyImerLbl.Text = Me.DbhotelDataSet.gramatia(0).imerominia
                    AkyrosiApyAALbl.Text = Me.DbhotelDataSet.gramatia(0).aa
                    AkyrosiApyPelLbl.Text = Me.DbhotelDataSet.gramatia(0).onoma
                    AkyrosiApySynolLbl.Text = (Me.DbhotelDataSet.gramatia(0).poso).ToString("C2")
                Else
                    clear_stoixeia()
                End If

            Catch ex As InvalidCastException
                MsgBox("Δώστε Αριθμό ΓΕ !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                clear_stoixeia()
                Exit Sub
            Catch ex1 As OverflowException
                'MsgBox("Δώστε Αριθμό ΓΕ !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                clear_stoixeia()
                Exit Sub
            End Try
        Else
            Try
                Dim form As New AkyrosiApyGeSuche(imeromErgasias, 2, 0)
                form.ShowDialog()
                kwdDelGE = form.return_kwdiko_ge
                kwdDelApy = -1
                If kwdDelGE <> -1 Then
                    AkyrosiApyAALbl.Text = form.return_aa_ge
                    AkyrosiApyImerLbl.Text = imeromErgasias
                    AkyrosiApyPelLbl.Text = form.return_eponimia_ge
                    AkyrosiApySynolLbl.Text = (form.return_synol_poso_ge).ToString("C2")
                End If
                form.Dispose()
            Catch ex As System.Exception
                System.Windows.Forms.MessageBox.Show(ex.Message)
                clear_stoixeia()
            End Try

        End If

    End Sub

    Private Sub AkyrosiBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles AkyrosiBtn.Click
        Dim ok As Boolean = False
        If kwdDelApy <> -1 Then
            Try
                Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                If Me.DbhotelDataSet.etaireia(0).ektportasapyflag = 0 And Me.DbhotelDataSet.etaireia(0).ektportasflag = 0 Then
                    ok = akyrose_timologio_me_kratisi(kwdDelApy, CType(AkyrosiApyAALbl.Text, Int16))
                Else
                    MsgBox("Οι Καταστάσεις έχουν ήδη βγει: Η Ακύρωση του Τιμολογίου μπορεί " & vbCrLf & "να γίνει μόνο στο Μενού <Ακύρωση Κλεισίματος Ημέρας>!", MsgBoxStyle.Information, "winfo\nikEl.")
                    Exit Sub
                End If

            Catch ex As System.Exception
                System.Windows.Forms.MessageBox.Show(ex.Message)
            End Try

            If ok Then
                Me.EtaireiaTableAdapter.SetFlagsEktiposewn(0, 0, imeromErgasias)
                MsgBox("To Τιμολόγιο ακυρώθηκε !", MsgBoxStyle.Information, "winfo\nikEl.")
                clear_stoixeia()
            End If
        ElseIf kwdDelGE <> -1 Then
            Try
                ok = akyrose_gramatio_eispraksis(kwdDelGE, CType(AkyrosiApyAALbl.Text, Int16))
            Catch ex As System.Exception
                System.Windows.Forms.MessageBox.Show(ex.Message)
            End Try
            If ok Then
                MsgBox("Tο Γραμμάτιο Είσπραξης ακυρώθηκε !", MsgBoxStyle.Information, "winfo\nikEl.")
                clear_stoixeia()
            End If
        Else
            clear_stoixeia()
            MsgBox("Κάνετε κλικ στον φακό για επιλογή !", MsgBoxStyle.Information, "winfo\nikEl.")

        End If
    End Sub
    'Public Function akyrose_timologio_me_kratisi(ByVal kwdTimol As Integer, ByVal aa As Int16) As Boolean
    '    Dim parastatiko As Integer
    '    'Public Function akyrose_timologia_kratiseis() As Boolean
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim command2 As New OleDb.OleDbCommand()
    '        Dim transaction As OleDb.OleDbTransaction = Nothing
    '        Dim kwdTemp As Integer
    '        Dim aaOld, aaNeu As Int16

    '        Try
    '            connection.Open()
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection
    '            command.Transaction = transaction
    '            command2.Connection = connection
    '            command2.Transaction = transaction

    '            Dim myReader As OleDb.OleDbDataReader
    '            command.Parameters.AddWithValue("kwd", kwdTimol)
    '            command.CommandText = "SELECT parastatiko FROM timologia where (kwd=?)"
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.
    '            While myReader.Read()
    '                parastatiko = myReader.GetInt32(0)
    '            End While
    '            myReader.Close()

    '            'to biblio portas mporei na exei bgei se proxiri ektiposi->uparxei eintrag me to APY stis anaxwriseis(status=2) me flag=0 (anektipoto)
    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("arapy", aa)
    '            command.Parameters.AddWithValue("parastatiko", parastatiko)
    '            command.CommandText = "DELETE FROM biblioportas WHERE (imerominia=?) and (status=2) and (arapy=?) and (flag=0) and (parastatiko=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            command.Parameters.AddWithValue("etos", etos)
    '            command.Parameters.AddWithValue("apy", aa)
    '            command.Parameters.AddWithValue("parastatiko", parastatiko)
    '            command.CommandText = "UPDATE kratiseis SET checkout=false, timologio=0, apy=0, parastatiko=0 WHERE (etos=?) and (timologio=1) and (apy=?) and (parastatiko=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            'ola ta APY me megalutero aa apo to akyromeno
    '            command.Parameters.AddWithValue("parastatiko", parastatiko)
    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("aa", aa)
    '            command.CommandText = "SELECT * FROM timologia WHERE (parastatiko=?) and (imerominia=?) and (aa>?) and (akyromeno=false) ORDER BY aa ASC" 'and (identifikation=?)
    '            'Dim myReader As OleDb.OleDbDataReader
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.

    '            ' Always call Read before accessing data.
    '            While myReader.Read()
    '                kwdTemp = myReader.Item("kwd")
    '                aaOld = myReader.Item("aa")
    '                aaNeu = aaOld - 1

    '                command2.Parameters.AddWithValue("arapy", aaNeu)
    '                command2.Parameters.AddWithValue("imerominia", imeromErgasias)
    '                command2.Parameters.AddWithValue("arapy", aaOld)
    '                command2.Parameters.AddWithValue("parastatiko", parastatiko)
    '                command2.CommandText = "UPDATE biblioportas SET arapy=? WHERE (imerominia=?) and (status=2) and (arapy=?)" 'and (status=2) and (arapy=?) and (flag=0) and (parastatiko=?)
    '                command2.ExecuteNonQuery()
    '                command2.Parameters.Clear()

    '                command2.Parameters.AddWithValue("apy", aaNeu)
    '                command2.Parameters.AddWithValue("etos", etos)
    '                command2.Parameters.AddWithValue("apy", aaOld)
    '                command2.Parameters.AddWithValue("parastatiko", parastatiko)
    '                command2.CommandText = "UPDATE kratiseis SET  apy=? WHERE (etos=?) and (apy=?) and (parastatiko=?)"
    '                command2.ExecuteNonQuery()
    '                command2.Parameters.Clear()

    '                command2.Parameters.AddWithValue("aa", aaNeu)
    '                command2.Parameters.AddWithValue("kwd", kwdTemp)
    '                command2.CommandText = "UPDATE timologia SET aa=? WHERE (kwd=?)"
    '                command2.ExecuteNonQuery()
    '                command2.Parameters.Clear()
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()

    '            If aa > aaOld Then
    '                command.Parameters.AddWithValue("aritthmos", aa - 1)
    '            Else
    '                command.Parameters.AddWithValue("aritthmos", aaNeu)
    '            End If
    '            command.Parameters.AddWithValue("kwd", parastatiko)
    '            command.CommandText = "UPDATE parastatika SET aritthmos=? WHERE (kwd=?)" 'APY STARRES KWD=1!!!!!!!
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()



    '            command.Parameters.AddWithValue("kwd", kwdTimol)
    '            command.CommandText = "UPDATE timologia SET akyromeno=true WHERE (kwd=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            transaction.Commit()
    '            Return True
    '        Catch ex As Exception
    '            MsgBox("Η Διαδικασία Ακύρωσης του Τιμολογίου-Α.Π.Υ " + aa.ToString + " απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
    '            Try
    '                transaction.Rollback()
    '                Return False
    '            Catch
    '                Return False
    '            End Try
    '        End Try
    '    End Using

    'End Function
    Public Function akyrose_timologio_me_kratisi(ByVal kwdTimol As Integer, ByVal aa As Int16) As Boolean
        Dim parastatiko As Integer
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim command2 As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim kwdTemp As Integer
            Dim aaOld, aaNeu As Int16

            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction
                command2.Connection = connection
                command2.Transaction = transaction

                command.Parameters.AddWithValue("@kwd", kwdTimol)
                command.CommandText = "SELECT parastatiko FROM timologia WHERE kwd = @kwd"
                parastatiko = Convert.ToInt32(command.ExecuteScalar())
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                command.Parameters.AddWithValue("@arapy", aa)
                command.Parameters.AddWithValue("@parastatiko", parastatiko)
                command.CommandText = "DELETE FROM biblioportas WHERE imerominia = @imerominia AND status = 2 AND arapy = @arapy AND flag = 0 AND parastatiko = @parastatiko"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@etos", etos)
                command.Parameters.AddWithValue("@apy", aa)
                command.Parameters.AddWithValue("@parastatiko", parastatiko)
                command.CommandText = "UPDATE kratiseis SET checkout = 0, timologio = 0, apy = 0, parastatiko = 0 WHERE etos = @etos AND timologio = 1 AND apy = @apy AND parastatiko = @parastatiko"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@parastatiko", parastatiko)
                command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                command.Parameters.AddWithValue("@aa", aa)
                command.CommandText = "SELECT * FROM timologia WHERE parastatiko = @parastatiko AND imerominia = @imerominia AND aa > @aa AND akyromeno = 0 ORDER BY aa ASC"
                Dim myReader As SqlDataReader = command.ExecuteReader()

                While myReader.Read()
                    kwdTemp = myReader.GetInt32(0)
                    aaOld = myReader.GetInt16(1)
                    aaNeu = aaOld - 1

                    command2.Parameters.AddWithValue("@arapy", aaNeu)
                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                    command2.Parameters.AddWithValue("@arapy", aaOld)
                    command2.Parameters.AddWithValue("@parastatiko", parastatiko)
                    command2.CommandText = "UPDATE biblioportas SET arapy = @arapy WHERE imerominia = @imerominia AND status = 2 AND arapy = @arapy"
                    command2.ExecuteNonQuery()
                    command2.Parameters.Clear()

                    command2.Parameters.AddWithValue("@apy", aaNeu)
                    command2.Parameters.AddWithValue("@etos", etos)
                    command2.Parameters.AddWithValue("@apy", aaOld)
                    command2.Parameters.AddWithValue("@parastatiko", parastatiko)
                    command2.CommandText = "UPDATE kratiseis SET apy = @apy WHERE etos = @etos AND apy = @apy AND parastatiko = @parastatiko"
                    command2.ExecuteNonQuery()
                    command2.Parameters.Clear()

                    command2.Parameters.AddWithValue("@aa", aaNeu)
                    command2.Parameters.AddWithValue("@kwd", kwdTemp)
                    command2.CommandText = "UPDATE timologia SET aa = @aa WHERE kwd = @kwd"
                    command2.ExecuteNonQuery()
                    command2.Parameters.Clear()
                End While
                command.Parameters.Clear()
                myReader.Close()

                If aa > aaOld Then
                    command.Parameters.AddWithValue("@aritthmos", aa - 1)
                Else
                    command.Parameters.AddWithValue("@aritthmos", aaNeu)
                End If
                command.Parameters.AddWithValue("@kwd", parastatiko)
                command.CommandText = "UPDATE parastatika SET aritthmos = @aritthmos WHERE kwd = @kwd"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@kwd", kwdTimol)
                command.CommandText = "UPDATE timologia SET akyromeno = 1 WHERE kwd = @kwd"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                transaction.Commit()
                Return True
            Catch ex As Exception
                MsgBox("Η Διαδικασία Ακύρωσης του Τιμολογίου-Α.Π.Υ " + aa.ToString + " απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return False
                Catch
                    Return False
                End Try
            End Try
        End Using
    End Function

    'Public Function akyrose_gramatio_eispraksis(ByVal kwdGE As Integer, ByVal aa As Int16) As Boolean
    '    Dim kwdTemp As Integer
    '    Dim aaOld, aaNeu As Int16
    '    Dim datum As Date

    '    datum = "1/1/" + etos.ToString
    '    'Public Function akyrose_timologia_kratiseis() As Boolean
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command, command2 As New OleDb.OleDbCommand()
    '        Dim transaction As OleDb.OleDbTransaction = Nothing

    '        Try
    '            connection.Open()
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection
    '            command.Transaction = transaction
    '            command2.Connection = connection
    '            command2.Transaction = transaction

    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("aagramatio", aa)
    '            command.CommandText = "UPDATE logariasmoidiam SET aagramatio=0 WHERE (imerominia=?) and (aagramatio=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("aa", aa)
    '            command.CommandText = "SELECT * FROM gramatia WHERE (imerominia=?) and (aa>?) and (akyro=false) ORDER BY aa ASC" 'and (identifikation=?)
    '            Dim myReader As OleDb.OleDbDataReader
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.

    '            ' Always call Read before accessing data.
    '            While myReader.Read()
    '                kwdTemp = myReader.Item("kwd")
    '                aaOld = myReader.Item("aa")
    '                aaNeu = aaOld - 1


    '                command2.Parameters.AddWithValue("aagramatio", aaNeu)
    '                command2.Parameters.AddWithValue("imerominia", datum)
    '                command2.Parameters.AddWithValue("aagramatio", aaOld)
    '                command2.CommandText = "UPDATE logariasmoidiam SET aagramatio=? WHERE (imerominia>?) and (aagramatio=?)"
    '                command2.ExecuteNonQuery()
    '                command2.Parameters.Clear()

    '                command2.Parameters.AddWithValue("aa", aaNeu)
    '                command2.Parameters.AddWithValue("kwd", kwdTemp)
    '                command2.CommandText = "UPDATE gramatia SET aa=? WHERE (kwd=?)"
    '                command2.ExecuteNonQuery()
    '                command2.Parameters.Clear()
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()

    '            If aa > aaOld Then
    '                command.Parameters.AddWithValue("aritthmos", aa - 1)
    '            Else
    '                command.Parameters.AddWithValue("aritthmos", aaNeu)
    '            End If
    '            command.CommandText = "UPDATE parastatika SET aritthmos=? WHERE (kwd=3)" 'APY STARRES KWD=1!!!!!!!
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            command.Parameters.AddWithValue("kwd", kwdGE)
    '            command.CommandText = "UPDATE gramatia SET akyro=true WHERE (kwd=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            transaction.Commit()
    '            Return True
    '        Catch ex As Exception
    '            MsgBox("Η Διαδικασία Ακύρωσης του ΓΕ " + aa.ToString + " απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
    '            Try
    '                transaction.Rollback()
    '                Return False
    '            Catch
    '                Return False
    '            End Try
    '        End Try
    '    End Using

    'End Function
    Public Function akyrose_gramatio_eispraksis(ByVal kwdGE As Integer, ByVal aa As Int16) As Boolean
        Dim kwdTemp As Integer
        Dim aaOld, aaNeu As Int16
        Dim datum As Date

        datum = "1/1/" + etos.ToString
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim command2 As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing

            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction
                command2.Connection = connection
                command2.Transaction = transaction

                command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                command.Parameters.AddWithValue("@aagramatio", aa)
                command.CommandText = "UPDATE logariasmoidiam SET aagramatio = 0 WHERE imerominia = @imerominia AND aagramatio = @aagramatio"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                command.Parameters.AddWithValue("@aa", aa)
                command.CommandText = "SELECT * FROM gramatia WHERE imerominia = @imerominia AND aa > @aa AND akyro = 0 ORDER BY aa ASC"
                Dim myReader As SqlDataReader = command.ExecuteReader()

                While myReader.Read()
                    kwdTemp = myReader.GetInt32(0)
                    aaOld = myReader.GetInt16(1)
                    aaNeu = aaOld - 1

                    command2.Parameters.AddWithValue("@aagramatio", aaNeu)
                    command2.Parameters.AddWithValue("@imerominia", datum)
                    command2.Parameters.AddWithValue("@aagramatio", aaOld)
                    command2.CommandText = "UPDATE logariasmoidiam SET aagramatio = @aagramatio WHERE imerominia > @imerominia AND aagramatio = @aagramatio"
                    command2.ExecuteNonQuery()
                    command2.Parameters.Clear()

                    command2.Parameters.AddWithValue("@aa", aaNeu)
                    command2.Parameters.AddWithValue("@kwd", kwdTemp)
                    command2.CommandText = "UPDATE gramatia SET aa = @aa WHERE kwd = @kwd"
                    command2.ExecuteNonQuery()
                    command2.Parameters.Clear()
                End While
                command.Parameters.Clear()
                myReader.Close()

                If aa > aaOld Then
                    command.Parameters.AddWithValue("@aritthmos", aa - 1)
                Else
                    command.Parameters.AddWithValue("@aritthmos", aaNeu)
                End If
                command.CommandText = "UPDATE parastatika SET aritthmos = @aritthmos WHERE kwd = 3"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@kwd", kwdGE)
                command.CommandText = "UPDATE gramatia SET akyro = 1 WHERE kwd = @kwd"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                transaction.Commit()
                Return True
            Catch ex As Exception
                MsgBox("Η Διαδικασία Ακύρωσης του ΓΕ " + aa.ToString + " απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return False
                Catch
                    Return False
                End Try
            End Try
        End Using
    End Function


    '*******************GE************************GE*************************************GE '*******************GE************************GE*************************************GE
    '*******************GE************************GE*************************************GE '*******************GE************************GE*************************************GE
    Private Sub ekdosi_mem_ge()

        Me.ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        EtikLbl.Text = "ΕΚΔΟΣΗ ΜΕΜΟΝΟΜΕΝΩΝ ΓΡΑΜΜΑΤΙΩΝ ΕΙΣΠΡΑΞΗΣ"
        EtikLbl.Location = New Point(GrammatioPnl.Width / 7, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        GrammatioPnl.Location = New Point(150, EtiketaErgHmPnl.Height)
        Me.GrammatioPnl.Size = New Point(385, 300)

        GrammatDwmTbx.Clear()
        GrammPelatisTbx.Clear()
        EnoikosLbl.Text = ""
        PosonLbl.Text = ""
        kwdKratGE = -1
        diamenKwd = -1
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(GrammatioPnl)
    End Sub
    Private Sub GrammPelatis(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GrammPelatisTbx.Enter
        Dim kwdKratTemp As Integer
        Dim s As Single = 0
        Dim poso As Single

        Dim form As New KratiseisSucheF(imeromErgasias, True, False, 3, rechte)
        form.StartPosition = FormStartPosition.CenterParent
        form.ShowDialog()
        kwdKratTemp = form.return_kwdiko_kratisis()
        If kwdKratTemp <> -1 Then
            kwdKratGE = kwdKratTemp
            Try
                GrammPelatisTbx.Text = form.return_onoma
                GrammatDwmTbx.Text = form.return_dwmatio
                diamenKwd = Me.EnilikesTableAdapter.GetKwdByKratisiOnomatep(kwdKratGE, GrammPelatisTbx.Text)
            Catch ex As InvalidOperationException
                MsgBox("Δεν επιλέχθηκε Πελάτης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                GrammatDwmTbx.Clear()
                GrammPelatisTbx.Clear()
                kwdKratGE = -1
                diamenKwd = -1
                EnoikosLbl.Text = ""
                PosonLbl.Text = ""
                form.Dispose()
                Exit Sub
            End Try
        ElseIf kwdKratGE <> -1 Then
            MsgBox("Δεν επιλέχθηκε Πελάτης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            GrammatEkdsBtn.Focus()
            Exit Sub
        End If
        GrammPelatisTbx.Text = form.return_onoma


        If kwdKratGE <> -1 Then
            EnoikosLbl.Text = form.return_afixi + " - " + form.return_anaxwrisi
            If GrammRdb1.Checked Then
                poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoKratAAgram(kwdKratGE, 0)
            Else
                If diamenKwd <> -1 Then
                    Try
                        poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoDiamenwnAAgram(diamenKwd, 0)
                    Catch ex As Exception
                        poso = 0
                    End Try

                End If
            End If
            PosonLbl.Text = poso.ToString("C2")
        End If
        form.Dispose()
        GrammatEkdsBtn.Focus()
    End Sub

    Private Sub GrammatBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GrammatBtn.Click
        Dim kwdKratTemp As Integer
        Dim diarkeia As String = ""
        Dim poso As Single

        If Not GrammatDwmTbx.Text.Equals("") Then

            Me.LogariasmoidiamTableAdapter.FillLogariasmoiDwmatiouByDwmatioChkoutAAgram(Me.DbhotelDataSet.logariasmoidiam, GrammatDwmTbx.Text, 0, False)

            If Me.DbhotelDataSet.logariasmoidiam.Count = 1 Then 'To Dwmatio einai mono 1 fora vergeben!
                kwdKratGE = Me.DbhotelDataSet.logariasmoidiam(0).kratisi
                Me.LogariasmoidiamTableAdapter.FillByKratisiAAgramm(Me.DbhotelDataSet.logariasmoidiam, kwdKratGE, 0)
                diamenKwd = Me.DbhotelDataSet.logariasmoidiam(0).diamenwn
                Me.EnilikesTableAdapter.FillByKwdiko(Me.DbhotelDataSet.enilikes, diamenKwd)
                GrammPelatisTbx.Text = Me.DbhotelDataSet.enilikes(0).onomateponimo
                Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdKratGE)
                diarkeia = Me.DbhotelDataSet.kratiseis(0).afixi.ToShortDateString + " - " + Me.DbhotelDataSet.kratiseis(0).anaxwrisi.ToShortDateString

                'Me.EnilikesTableAdapter.FillByKwdiko(Me.DbhotelDataSet.enilikes, Me.DbhotelDataSet.logariasmoidiam(0).diamenwn)
                'GrammPelatisTbx.Text = Me.DbhotelDataSet.enilikes(0).onomateponimo
            ElseIf Me.DbhotelDataSet.logariasmoidiam.Count > 1 Then
                Dim form As New KratiseisSucheF(imeromErgasias, True, False, GrammatDwmTbx.Text, 3)
                form.StartPosition = FormStartPosition.CenterParent
                form.ShowDialog()
                kwdKratTemp = form.return_kwdiko_kratisis()
                If kwdKratTemp <> -1 Then
                    kwdKratGE = kwdKratTemp
                    Try
                        GrammPelatisTbx.Text = form.return_onoma
                        GrammatDwmTbx.Text = form.return_dwmatio
                        diamenKwd = Me.EnilikesTableAdapter.GetKwdByKratisiOnomatep(kwdKratGE, GrammPelatisTbx.Text)
                        diarkeia = form.return_afixi + " - " + form.return_anaxwrisi
                    Catch ex As InvalidOperationException

                        MsgBox("Δεν επιλέχθηκε Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        GrammatDwmTbx.Clear()
                        GrammPelatisTbx.Clear()
                        kwdKratGE = -1
                        diamenKwd = -1
                        EnoikosLbl.Text = ""
                        PosonLbl.Text = ""
                        form.Dispose()
                        GrammatDwmTbx.Focus()
                        Exit Sub
                    End Try
                ElseIf kwdKratGE <> -1 Then
                    MsgBox("Δεν επιλέχθηκε Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    form.Dispose()
                    GrammatDwmTbx.Focus()
                    Exit Sub
                End If
                GrammPelatisTbx.Text = form.return_onoma
                form.Dispose()
            ElseIf Me.DbhotelDataSet.logariasmoidiam.Count = 0 Then
                MsgBox("Δεν βρέθηκε χρέωση !", MsgBoxStyle.Information, "winfo\nikEl.")
                GrammatDwmTbx.Clear()
                GrammPelatisTbx.Clear()
                kwdKratGE = -1
                diamenKwd = -1
                EnoikosLbl.Text = ""
                PosonLbl.Text = ""
                GrammatDwmTbx.Focus()
                Exit Sub
            End If
        Else
            Dim form As New KratiseisSucheF(imeromErgasias, True, False, 3, rechte)
            form.StartPosition = FormStartPosition.CenterParent
            form.ShowDialog()
            kwdKratTemp = form.return_kwdiko_kratisis()
            If kwdKratTemp <> -1 Then
                kwdKratGE = kwdKratTemp
                Try
                    GrammPelatisTbx.Text = form.return_onoma
                    GrammatDwmTbx.Text = form.return_dwmatio
                    diamenKwd = Me.EnilikesTableAdapter.GetKwdByKratisiOnomatep(kwdKratGE, GrammPelatisTbx.Text)
                    diarkeia = form.return_afixi + " - " + form.return_anaxwrisi
                Catch ex As InvalidOperationException

                    MsgBox("Δεν επιλέχθηκε Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    GrammatDwmTbx.Clear()
                    GrammPelatisTbx.Clear()
                    kwdKratGE = -1
                    diamenKwd = -1
                    EnoikosLbl.Text = ""
                    PosonLbl.Text = ""
                    form.Dispose()
                    GrammatDwmTbx.Focus()
                    Exit Sub
                End Try
            ElseIf kwdKratGE <> -1 Then
                MsgBox("Δεν επιλέχθηκε Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                form.Dispose()
                GrammatDwmTbx.Focus()
                Exit Sub
            End If
            GrammPelatisTbx.Text = form.return_onoma
            form.Dispose()
        End If


        If kwdKratGE <> -1 Then
            EnoikosLbl.Text = diarkeia
            If GrammRdb1.Checked Then
                poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoKratAAgram(kwdKratGE, 0)
            Else
                If diamenKwd <> -1 Then
                    Try
                        poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoDiamenwnAAgram(diamenKwd, 0)
                    Catch ex As Exception
                        poso = 0
                    End Try
                Else
                    MsgBox("Δεν επιλέχθηκε Πελάτης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Exit Sub
                End If
            End If
            PosonLbl.Text = poso.ToString("C2")
        End If
        GrammatEkdsBtn.Focus()
    End Sub
    Private Sub GrammRdb1_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GrammRdb1.Click
        Dim poso As Single
        If kwdKratGE <> -1 Then
            'EnoikosLbl.Text = diarkeia
            Try
                poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoKratAAgram(kwdKratGE, 0)
                PosonLbl.Text = poso.ToString("C2")
            Catch ex As Exception
                poso = 0
                PosonLbl.Text = poso.ToString("C2")
            End Try

        End If
    End Sub
    Private Sub GrammRdb2_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GrammRdb2.Click
        Dim poso As Single
        If diamenKwd <> -1 Then
            Try
                poso = Me.LogariasmoidiamTableAdapter.GetYpoloipoDiamenwnAAgram(diamenKwd, 0)
                PosonLbl.Text = poso.ToString("C2")
            Catch ex As Exception
                poso = 0
                PosonLbl.Text = poso.ToString("C2")
            End Try
        End If
    End Sub
    Private Sub GrammatEkdsBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles GrammatEkdsBtn.Click
        Dim aa As Int16
        If kwdKratGE <> -1 AndAlso diamenKwd <> -1 Then
            If CType(PosonLbl.Text, Single) <> 0 Then
                Try
                    aa = ekdosi_ge_transaction(connectionString) 'dbhotel.mdb
                Catch ex As System.Exception
                    System.Windows.Forms.MessageBox.Show(ex.Message)
                End Try
                If aa <> -1 Then
                    Me.DbhotelDataSet.ektiposeis_genika.Rows.Clear()
                    Me.DbhotelDataSet.logariasmoidiam.Rows.Clear()
                    Me.DbhotelDataSet.ektiposeis_genika.Rows.Add()
                    Me.DbhotelDataSet.ektiposeis_genika(0).perigrafi = GrammPelatisTbx.Text
                    Me.DbhotelDataSet.ektiposeis_genika(0).ekdosi = imeromErgasias
                    If GrammRdb2.Checked Then 'mono enas DIAMENWN ksexrewnei kai OXI i Kratisi (dwmatio)!
                        'ola ta exoflimena (aage <> 0 !!!) Eitraege tou Diamenwnta 
                        Me.LogariasmoidiamTableAdapter.FillKsexrewmenoiLogByKratDiamenwnAAgramm(Me.DbhotelDataSet.logariasmoidiam, kwdKratGE, diamenKwd, aa)
                    Else
                        'oles oi xrewseis tou Dwmatiou->ich gehe davon aus dass ola ta eintraege tis Kratisis sto Table exoun aage <>0!
                        Me.LogariasmoidiamTableAdapter.FillKsexrewmenoiLogarByKratAAgramm(Me.DbhotelDataSet.logariasmoidiam, kwdKratGE, aa)
                    End If
                    'Me.TmimataTableAdapter.FillByZentral(Me.DbhotelDataSet.tmimata, True)
                    preoepiskopisi_ge()

                    GrammatDwmTbx.Clear()
                    GrammPelatisTbx.Clear()
                    kwdKratGE = -1
                    diamenKwd = -1
                    EnoikosLbl.Text = ""
                    PosonLbl.Text = ""
                    GrammatDwmTbx.Focus()
                Else
                    MsgBox("Η Διαδικασία έκδοσης της Γραμμάτιου Είσπραξης απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                End If
            End If
        End If
    End Sub

    'Private Function ekdosi_ge_transaction(ByVal connectionstring As String) As Int16
    '    Dim aa As Int16
    '    Using connection As New OleDb.OleDbConnection(connectionstring)


    '        Dim pliromi As String = ""
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim transaction As OleDb.OleDbTransaction = Nothing
    '        Try
    '            connection.Open()
    '            'tha mporeousa na xrisimopoiisw IsolationsLevel.ReadUncommited gia na apofugw tin extrem periptwsi pou 2 user diabasoun ton
    '            'tautoxrona ton Idio aage apo etaireia->alla ich nehme das schon im Kauf, da aage Nicht so wichtig!
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            command.Connection = connection
    '            command.Transaction = transaction

    '            'command.CommandText = "CREATE TABLE Simple (ID long)"

    '            'diabazw o aa twn GE apo etaireia 
    '            command.CommandText = "SELECT aritthmos FROM parastatika where (kwd=3)" 'and (identifikation=?)
    '            Dim myReader As OleDb.OleDbDataReader
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.
    '            myReader.Read()
    '            aa = myReader.GetInt32(0)
    '            ' always call Close when done reading.
    '            myReader.Close()
    '            command.Parameters.Clear()

    '            aa += 1

    '            command.Parameters.AddWithValue("aa", aa)
    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("diamenwn", diamenKwd)
    '            command.Parameters.AddWithValue("poso", CType(PosonLbl.Text, Single))
    '            command.CommandText = "INSERT INTO gramatia (aa, imerominia, diamenwn, poso, akyro)" &
    '            "VALUES (aa, imerominia, diamenwn, poso, false)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()


    '            command.Parameters.AddWithValue("aagramatio", aa)
    '            command.Parameters.AddWithValue("kratisi", kwdKratGE)
    '            If GrammRdb2.Checked Then 'mono enas DIAMENWN ksexrewnei kai OXI i Kratisi (dwmatio)!
    '                command.Parameters.AddWithValue("diamenwn", diamenKwd)
    '                command.CommandText = "UPDATE logariasmoidiam SET aagramatio=? WHERE (kratisi=?) and (diamenwn=?) and (aagramatio=0)"
    '            Else ' Olo to dwmatio ksexrewnetai
    '                command.CommandText = "UPDATE logariasmoidiam SET aagramatio=? WHERE (kratisi=?)and (aagramatio=0)"
    '            End If
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()


    '            command.Parameters.AddWithValue("aage", aa)
    '            'command.Parameters.AddWithValue("identifikation", timolID)
    '            command.CommandText = "UPDATE parastatika SET aritthmos=? where (kwd=3)" 'and (identifikation=?)
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()


    '            transaction.Commit()

    '        Catch ex As Exception
    '            Try
    '                transaction.Rollback()
    '                Return -1
    '            Catch
    '                Return -1
    '            End Try

    '        End Try
    '    End Using

    '    Return aa
    'End Function
    Private Function ekdosi_ge_transaction(ByVal connectionstring As String) As Int16
        Dim aa As Int16
        Using connection As New SqlConnection(connectionstring)
            Dim pliromi As String = ""
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Try
                connection.Open()
                ' You can use IsolationLevel.ReadUncommitted for Read Uncommitted isolation level
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                command.Connection = connection
                command.Transaction = transaction

                'command.CommandText = "CREATE TABLE Simple (ID bigint)"

                ' Read the value of 'aa' from 'parastatika' table
                command.CommandText = "SELECT aritthmos FROM parastatika WHERE kwd = 3"
                Dim myReader As SqlDataReader
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                myReader.Read()
                aa = myReader.GetInt32(0)
                ' Always call Close when done reading.
                myReader.Close()
                command.Parameters.Clear()

                aa += 1

                command.Parameters.AddWithValue("aa", aa)
                command.Parameters.AddWithValue("imerominia", imeromErgasias)
                command.Parameters.AddWithValue("diamenwn", diamenKwd)
                command.Parameters.AddWithValue("poso", CType(PosonLbl.Text, Single))
                command.CommandText = "INSERT INTO gramatia (aa, imerominia, diamenwn, poso, akyro) VALUES (@aa, @imerominia, @diamenwn, @poso, 0)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("aagramatio", aa)
                command.Parameters.AddWithValue("kratisi", kwdKratGE)
                If GrammRdb2.Checked Then ' Only one DIAMENWN excludes the Kratisi (dwmatio)!
                    command.Parameters.AddWithValue("diamenwn", diamenKwd)
                    command.CommandText = "UPDATE logariasmoidiam SET aagramatio = @aagramatio WHERE kratisi = @kratisi AND diamenwn = @diamenwn AND aagramatio = 0"
                Else ' The whole dwmatio is considered
                    command.CommandText = "UPDATE logariasmoidiam SET aagramatio = @aagramatio WHERE kratisi = @kratisi AND aagramatio = 0"
                End If
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("aage", aa)
                command.CommandText = "UPDATE parastatika SET aritthmos = @aa WHERE kwd = 3"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                transaction.Commit()
            Catch ex As Exception
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using

        Return aa
    End Function

    Private Sub preoepiskopisi_ge()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New GrammEispraksis()

        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
    End Sub

    '**********************EISPRAKSEIS *************************EISPRAKSEIS *****EISPRAKSEIS *************EISPRAKSEIS *********EISPRAKSEIS **************

    'YPARXOUN 2 DB TABLES->XREWSEISPRAKTOREIA KAI EISPRAKSEISPRAKTOREIA...EDW MPOREI KANEIS EPILEGWNTAS XREWSH NA FORTWSEI TIMOLOGIO POU EXEI EKDOTHEI APO TO MENU EXTRA 
    'PARASTATIKA (DINONTAS PRAKT-IMEROM KAI EPILEGVNTAS APO LISTA(->DTGRD KYALIA)->SE PERIPTWSI POU ALAKSEI THN XREWSH TOTE TO TIMOLOGIO POU EXEI 
    'EKDOTHEI APO TA EXTRA PARAST MARKARETAI WS MAYRO(!) KAI DEN THA PAIZEI ROLO STHN KARTELA TOY PRAKTOREIOY ALLA ANSTELLE H KAINOYRGIA XREWSH!
    '(RUECKGAENGIG MPOREI NA GINEI EAN KSANAPAEI STA EXTRA, FORTWSEI TO MAYRO KAI APOTHIKEUSEI PALI->KSEMARKARETAI APO MAYRO KAI H XREWSI POU EIXE 
    'DHMIOURGITHEI STO TABLE XREWSEISPRAKT DIAGRAFETAI ORISTIKA->ARXIKH KATASTASH LOIPON!
    'GIA EISPRAKSEIS TA PRAGMATA EINAI APLA->INSERT NEA EISPRAKSI KAI FORTWSI APO KIALIA MIAS PALAISA DINONTAS HMEROMINIA-PRAKTOREIO!

    Private Sub eisprakseis_praktoreia()

        initialisieren_felder_variablen()
        EtikLbl.Text = "ΕΙΣΠΡΑΞΕΙΣ - ΧΡΕΩΣΕΙΣ ΠΡΑΚΤΟΡΕΙΩΝ"
        EtikLbl.Location = New Point(EispraxeisKataxPnl.Width / 7, 25)

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        EispraxeisKataxPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.EispraxeisKataxPnl.Size = New Point(830, ZentralPnl.Height)
        EispKataxParTrPlirCbx.Items.Clear()
        EispraxeisKatax3Pnl.Visible = False
        EispKataxParEispRdb.Checked = True
        EispraxeisKataxPck.Value = imeromErgasias
        EispraxeisKataxPck.MinDate = "1/1/" + etos.ToString
        EispraxeisKataxPck.MaxDate = "31/12/" + etos.ToString

        'AddHandler EispKataxParEisprTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler EispKataxParSinPlinTbx.KeyPress, AddressOf komma_einschalten

        'AddHandler EispKataxParEisprTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler EispKataxParSinPlinTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler EispKataxParXrewsiTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler EispKataxParProkTbx.KeyPress, AddressOf komma_einschalten
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(EispraxeisKataxPnl)
    End Sub

    Private Sub EispKataxParEispRdb_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParEispRdb.CheckedChanged, EispKataxParXrewsRdb.CheckedChanged
        If sender.name.Equals("EispKataxParEispRdb") Then
            initialisieren_felder_variablen()
            init_tr_plirom_cbox()

            EispraxeisKatax2Pnl.Location = New Point(10, 205)
            EispraxeisKatax3Pnl.Visible = False
            EispraxeisKatax2Pnl.Visible = True
        Else
            initialisieren_felder_variablen()
            EispraxeisKatax3Pnl.Location = New Point(10, 205)
            EispraxeisKatax2Pnl.Visible = False
            EispraxeisKatax3Pnl.Visible = True
        End If
    End Sub
    Private Sub KwdPrakt_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KwdPrktTbx.Leave
        Dim kwdikos As Integer
        Try

            If CType(sender.text, Integer) > 0 Then
                Dim count As Int16
                kwdikos = sender.text
                initialisieren_felder_variablen()
                count = Me.PraktoreiaTableAdapter.ExistPraktoreia(kwdikos)
                If count <> 0 Then
                    Me.PraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.praktoreia, kwdikos)
                Else
                    MsgBox("O κωδικός δεν αντιστοιχεί σε  Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")

                    sender.clear()
                    KwdPrktTbx.Clear()
                    'sender.focus()
                    Exit Sub
                End If
                If Me.DbhotelDataSet.praktoreia.Count = 1 Then
                    EispraxeisKataxPraktTbx.Text = Me.DbhotelDataSet.praktoreia(0).eponimia
                    kwdEisprPrakt = Me.DbhotelDataSet.praktoreia(0).kwd
                    sender.text = kwdikos
                Else
                    'EispraxeisKataxPraktTbx.Text = "< κλίκ εδώ πάνω >"
                    initialisieren_felder_variablen()
                    kwdEisprPrakt = -1
                End If

            End If
        Catch ex As InvalidCastException
            If Not kwdikos.Equals("") Then
                MsgBox(" Δώστε Αριθμό !", MsgBoxStyle.Information, "winfo\nikEl.")
                initialisieren_felder_variablen()
                'sender.clear()
                'EispraxeisKataxPraktTbx.Text = "< κλίκ εδώ πάνω >"
                'KwdPrktTbx.Clear()
                kwdEisprPrakt = -1
            End If

        End Try


    End Sub
    Private Sub EispraxeisKataxPraktTbx_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispraxeisKataxPraktTbx.Click
        Dim PraktForm As New SimbolaiaFrm()
        Dim kwdikos As Integer
        initialisieren_felder_variablen()
        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        kwdikos = PraktForm.return_praktoreio_kwdikos

        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If kwdEisprPrakt = -1 Then
                EispraxeisKataxPraktTbx.Text = "< κλίκ εδώ πάνω >"
                KwdPrktTbx.Clear()
                Exit Sub
            End If
        Else
            kwdEisprPrakt = kwdikos
            KwdPraktTbx1.Text = kwdikos
            EispraxeisKataxPraktTbx.Text = PraktForm.return_praktoreio
            KwdPrktTbx.Text = PraktForm.return_praktoreio_kwdikos
        End If
    End Sub

    Private Sub EispKataxParSucheBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParSucheBtn.Click
        If EispKataxParEispRdb.Checked Then
            If kwdEisprPrakt <> -1 Then
                Dim form1 As New Eisprakseis(kwdEisprPrakt, EispraxeisKataxPck.Value.Date)
                form1.ShowDialog()
                kwdEispr = form1.return_kwd_eispraksis()
                If kwdEispr = Nothing Then
                    kwdEispr = -1
                End If
                form1.Dispose()
                fuelle_felder_eispraksis()
            End If
        Else
            If kwdEisprPrakt <> -1 Then
                Dim form1 As New XrewseisPrakt(kwdEisprPrakt, EispraxeisKataxPck.Value.Date)

                form1.ShowDialog()
                kwdEispTimol = form1.return_kwd_timolog
                If kwdEispTimol = Nothing Then
                    kwdEispTimol = -1
                End If
                kwdEispXrews = form1.return_kwd_xrewsisprakt
                If kwdEispXrews = Nothing Then
                    kwdEispXrews = -1
                End If
                form1.Dispose()
                fuelle_felder_xrewsis()
            End If
        End If
    End Sub
    Private Sub fuelle_felder_eispraksis()
        If kwdEispr <> -1 Then
            Me.EisprakseispraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.eisprakseispraktoreia, kwdEispr)
            EispKataxPar1Tbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).parast1
            EispKataxPar2Tbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).parast2
            EispKataxPar3Tbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).parast3
            EispraxeisKataxAitTbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).aitiologia
            EispKataxParEisprTbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).eispraksi.ToString("N")
            EispKataxParSinPlinTbx.Text = Me.DbhotelDataSet.eisprakseispraktoreia(0).sunplin.ToString("N")
        End If
    End Sub
    Private Sub fuelle_felder_xrewsis()
        If kwdEispTimol <> -1 Then
            Me.TimologiaTableAdapter.FillTimologioByKwdikoAkyr(Me.DbhotelDataSet.timologia, kwdEispTimol, False)
            EispKataxPar1Tbx.Text = Me.DbhotelDataSet.timologia(0).seira
            EispKataxPar2Tbx.Text = Me.DbhotelDataSet.timologia(0).parastatiko
            EispKataxPar3Tbx.Text = Me.DbhotelDataSet.timologia(0).aa
            EispraxeisKataxAitTbx.Text = Me.DbhotelDataSet.timologia(0).aitiologia
            EispKataxParXrewsiTbx.Text = Me.DbhotelDataSet.timologia(0).synola.ToString("N")
            EispKataxParProkTbx.Text = Me.DbhotelDataSet.timologia(0).prokataboli.ToString("N")
        ElseIf kwdEispXrews <> -1 Then
            Me.XrewseispraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.xrewseispraktoreia, kwdEispXrews)
            EispKataxPar1Tbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).parast1
            EispKataxPar2Tbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).parast2
            EispKataxPar3Tbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).parast3
            EispraxeisKataxAitTbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).aitiologia
            EispKataxParXrewsiTbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).xrewsi.ToString("N")
            EispKataxParProkTbx.Text = Me.DbhotelDataSet.xrewseispraktoreia(0).prokataboli.ToString("N")
            If Me.DbhotelDataSet.xrewseispraktoreia(0).metritois Then
                EispKataxParTrPlirCbx.SelectedIndex = 0
            Else
                EispKataxParTrPlirCbx.SelectedIndex = 1
            End If

        End If
    End Sub
    Private Sub EispKataxParTrPlirCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParTrPlirCbx.SelectedIndexChanged

    End Sub

    Private Sub EispKataxParKataxBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParKataxBtn.Click
        Dim metritoisOK As Boolean
        If EispKataxParEispRdb.Checked Then
            If kwdEisprPrakt <> -1 AndAlso CType(EispKataxParEisprTbx.Text, Single) <> 0 Then
                If kwdEispr = -1 Then 'kainouria eispraksi
                    Me.EisprakseispraktoreiaTableAdapter.InsertEispraksiPrakt(EispKataxPar1Tbx.Text, EispKataxPar2Tbx.Text, EispKataxPar3Tbx.Text, EispraxeisKataxPck.Value.Date,
                                            kwdEisprPrakt, EispraxeisKataxAitTbx.Text, EispKataxParEisprTbx.Text, EispKataxParSinPlinTbx.Text)

                Else
                    Me.EisprakseispraktoreiaTableAdapter.UpdateEispraksi(EispKataxPar1Tbx.Text, EispKataxPar2Tbx.Text, EispKataxPar3Tbx.Text, EispraxeisKataxPck.Value.Date,
                                            kwdEisprPrakt, EispraxeisKataxAitTbx.Text, EispKataxParEisprTbx.Text, EispKataxParSinPlinTbx.Text, kwdEispr)
                End If
                MsgBox("Η Είσπραξη καταχωρήθηκε επιτυχώς !", MsgBoxStyle.Information, "winfo\nikEl.")
                initialisieren_felder_variablen()
            End If
        Else
            If kwdEisprPrakt <> -1 Then 'AndAlso CType(EispKataxParXrewsiTbx.Text, Single) <> 0 
                If EispKataxParTrPlirCbx.SelectedIndex = 0 Then
                    metritoisOK = True
                Else
                    metritoisOK = False
                End If
                If (kwdEispTimol <> -1 OrElse kwdEispXrews = -1) AndAlso CType(EispKataxParXrewsiTbx.Text, Single) <> 0 Then
                    'kainouria xrewsi stin thesi tis timologiakis xrewsis (apo ta extra parastatika)
                    Try
                        Me.XrewseispraktoreiaTableAdapter.InsertXrewsiPrakt(EispKataxPar1Tbx.Text, EispKataxPar2Tbx.Text, EispKataxPar3Tbx.Text, kwdEispTimol, kwdEisprPrakt,
                                                          EispraxeisKataxAitTbx.Text, EispKataxParXrewsiTbx.Text, EispKataxParProkTbx.Text, metritoisOK, EispraxeisKataxPck.Value.Date)
                        If kwdEispTimol <> -1 Then
                            Me.TimologiaTableAdapter.SetMauroByKwd(True, kwdEispTimol)
                        End If
                        MsgBox("Η Χρέωση καταχωρήθηκε επιτυχώς !", MsgBoxStyle.Information, "winfo\nikEl.")
                    Catch ex As Exception
                        MsgBox("Παρουσιάστηκε σφάλμα κατά την εκτέλεση αυτής της ενέργειας !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    End Try
                    initialisieren_felder_variablen()

                    'to timologio einai twra Mayro->metraei gia to praktoreio i kainoyria xrewsi sto DB Table Xrewsiprakt...
                ElseIf kwdEispXrews <> -1 Then
                    If CType(EispKataxParXrewsiTbx.Text, Single) <> 0 Then
                        Me.XrewseispraktoreiaTableAdapter.UpdateXrewsiPraktoreiou(EispKataxPar1Tbx.Text, EispKataxPar2Tbx.Text, EispKataxPar3Tbx.Text, EispraxeisKataxAitTbx.Text, EispKataxParXrewsiTbx.Text, EispKataxParProkTbx.Text, metritoisOK, kwdEispXrews)
                    ElseIf CType(EispKataxParXrewsiTbx.Text, Single) = 0 Then
                        Me.XrewseispraktoreiaTableAdapter.DeleteByKwd(kwdEispXrews)

                    End If
                    MsgBox("Η Χρέωση καταχωρήθηκε επιτυχώς !", MsgBoxStyle.Information, "winfo\nikEl.")
                    initialisieren_felder_variablen()
                End If
            End If
        End If
    End Sub
    Private Sub EispKataxPar3Tbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxPar3Tbx.Leave
        Dim i As Integer
        Try
            i = CType(sender.text, Integer)
        Catch ex As InvalidCastException
            sender.text = 0
        End Try

    End Sub
    Private Sub posa_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParEisprTbx.Leave, EispKataxParSinPlinTbx.Leave, EispKataxParXrewsiTbx.Leave, EispKataxParProkTbx.Leave
        Dim d As Single = 0

        Try
            d = CType(sender.text, Single)
            sender.text = d.ToString("N")
        Catch ex As Exception
            sender.text = d.ToString("N")
        End Try

    End Sub
    Private Sub initialisieren_felder_variablen()
        EispKataxParTrPlirCbx.SelectedIndex = -1

        clear_eispraks_panel()
        clear_panel_1()
        init_eispr_felder()
        init_global_var()
    End Sub
    Private Sub init_eispr_felder()
        Dim d As Single = 0
        EispKataxPar3Tbx.Text = d
        EispKataxParEisprTbx.Text = d.ToString("N")
        EispKataxParSinPlinTbx.Text = d.ToString("N")
        EispKataxParXrewsiTbx.Text = d.ToString("N")
        EispKataxParProkTbx.Text = d.ToString("N")
        EispraxeisKataxPraktTbx.Text = "< κλίκ εδώ πάνω >"
        KwdPrktTbx.Clear()
    End Sub
    Private Sub clear_eispraks_panel()
        EispKataxParEisprTbx.Clear()
        EispKataxParSinPlinTbx.Clear()
    End Sub
    Private Sub clear_panel_1()
        EispraxeisKataxPraktTbx.Clear()
        EispKataxPar1Tbx.Clear()
        EispKataxPar2Tbx.Clear()
        EispKataxPar3Tbx.Clear()
        EispraxeisKataxAitTbx.Clear()

    End Sub
    Private Sub init_global_var()
        kwdEisprPrakt = -1
        kwdEispTimol = -1
        kwdEispXrews = -1
        kwdEispr = -1
    End Sub
    Private Sub clear_xrews_panel()

        EispKataxParXrewsiTbx.Clear()
        EispKataxParProkTbx.Clear()
        EispKataxParTrPlirCbx.SelectedIndex = -1
        EispKataxParTrPlirCbx.Items.Clear()
        init_tr_plirom_cbox()
    End Sub
    Private Sub init_tr_plirom_cbox()
        EispKataxParTrPlirCbx.Items.Clear()
        EispKataxParTrPlirCbx.Items.Add("Μετρητοίς")
        EispKataxParTrPlirCbx.Items.Add("Επί Πιστώση")


    End Sub
    Private Sub EispKataxParClearBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParClearBtn.Click
        initialisieren_felder_variablen()

    End Sub


    Private Sub EisprakseispraktoreiaBindingNavigatorSaveItem_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Me.Validate()
        Me.EisprakseispraktoreiaBindingSource.EndEdit()
        Me.EisprakseispraktoreiaTableAdapter.Update(Me.DbhotelDataSet.eisprakseispraktoreia)

    End Sub
    Private Sub EispKataxParEisprTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EispKataxParXrewsiTbx.Click, EispKataxParEisprTbx.Click, EispKataxParSinPlinTbx.Click, EispKataxParProkTbx.Click
        sender.selectall()
    End Sub

    '**********************EKDOSI MEMONOMENWN APY *************************EKDOSI MEMONOMENWN APY *****EKDOSI MEMONOMENWN APY******************
    'YPARXOYN 3 DBTABLES->timologia kai timologiaanalysis (kai tinologioktratiseis ->sena timologio poles kratiseis) poy emperiexoun tis times 
    'gia kathe periodo diamonis (ean yparxoun kai alles toyrist periodoi), opws fainetai kai stin ektiposi tou APY
    'sto DB timologianalysis oi times ypnou, prwinou ktl. einai kathares kai synolikes gia OLI thn periodo (attribute preistag= timi imeras me fpa)
    '(oi epimerous times FPA einai kai aytes gia oli thn diarkeia)(PROSOSXI->se periptwsi ekptosis tote stis times DEN ypoligizetai i ektosi)
    '->posa PRO ekptosis->se periptwsi epanekdosis prepei na ypologistei to  poso ekptosis apo p.x. to pososto ekptwsis)
    '(Ekptwseis->pososto:ypologizetai gia OLA ta epimerous posa, poso ekptsis: poso*fpaypnoy/100), cancalation fee:(-anzahlfee*total imeras(brutto)/fpaYpnou)
    'imeres ekptosis:Gia KATHENA epimerous katharo poso->anzahlimeres*poso/diarkeia)
    'STO TIMOLOGIA EXEI 3 attribute gia times->sumkathposa(->PREPEI NA EINAI ISOS ME TO ATHROISMA OLWN TWN TIMILOGIAANALYSIS SUMKATHPOSA)
    '(to idio isxuei kai me tis stiles tou fpa kai synola)
    Private Sub ekdosi_memonomenwn_apy()
        Dim afmadapter As New dbhotelDataSetTableAdapters.afmTableAdapter
        'EkdosiParastSynolaLbl.Size = New Point(85, 22)
        Me.ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        EtikLbl.Text = "ΕΚΔΟΣΗ ΜΕΜΟΝΟΜΕΝΩΝ Α.Π.Υ."
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 5, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        MemApyPanel.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.MemApyPanel.Size = New Point(830, ZentralPnl.Height)
        init_mem_apy_felder()
        MemApyDwmTbx.Clear()
        TimologioChk.Checked = False
        'aaApy = Me.ParastatikaTableAdapter.GetArxikoAAParast(Me.DbhotelDataSet.etaireia(0).aaapy)
        'MemApyArApyLbl.Text = aaApy + 1

        init_ekpt_felder(0, 0, 0, 0)
        MemApyTrPlCbx.SelectedIndex = -1
        MemApyTrPlCbx.Items.Clear()
        MemApyCountries.SelectedIndex = 0
        trop_pliromis_cbox_fuelle()
        ' MemApyCountries.AutoCompleteMode = AutoCompleteSource.ListItems
        kwdApyKrat = -1
        kwdApyPrakt = -1

        kwdApyParast = -1
        kwdApyApy = -1
        kwdApyAfm = -1
        'delete_timologia_von_systemabsturz()
        clear_dataset_ekt()
        'kwdApyDwm = -1


        timolID = 20000
        Me.KratiseisTableAdapter.UpdateTimologioByAnaxTimol(0, imeromErgasias, 2)
        ReDim kwdProsEkd(-1)
        afmadapter.FillByEikoniko(Me.DbhotelDataSet.afm, True)
        fuehle_parast_apy_cbx()
        'AddHandler MemApyPosostoTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler MemApyPosoTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler MemApyImerFreeTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler MemApyFeeTbx.KeyPress, AddressOf komma_einschalten
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(MemApyPanel)
    End Sub
    Private Sub myTimer_Tick2(ByVal sender As Object, ByVal e As System.EventArgs) Handles myTimer2.Tick

        'Static labelText As String = Label1.Text
        showLblText = Not showLblText

        If showLblText = True Then
            blinkLbl2.Text = "PAYMENT NOT COMPLETED"
        Else
            blinkLbl2.Text = String.Empty
        End If

    End Sub
    'Private Sub TimologioChk_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TimologioChk.CheckedChanged
    '    Dim aaApy As Integer
    '    Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
    '    If TimologioChk.Checked Then
    '        aaApy = Me.ParastatikaTableAdapter.GetArxikoAAParastByKwdiko(Me.DbhotelDataSet.etaireia(0).timolkwd)
    '        MemApyArApyLbl.Text = aaApy + 1
    '    Else
    '        aaApy = Me.ParastatikaTableAdapter.GetArxikoAAParastByKwdiko(Me.DbhotelDataSet.etaireia(0).apykwd)
    '        MemApyArApyLbl.Text = aaApy + 1
    '    End If
    'End Sub
    Private Sub MemApyDwmTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyDwmTbx.Leave
        init_mem_apy_felder()
    End Sub
    Private Sub MemApySuch_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApySuchBtn.Click
        suche_mem_apy_diamenontes(sender, e)

    End Sub
    Private Function to_idio_praktoreio_oder_private_pelatis() As Boolean
        'Dim kwdikos As Integer
        'If kwdApyPrakt <> -1 AndAlso kwdApyPrakt <> Me.DbhotelDataSet.kratiseis(0).praktimologio Then
        '    kwdApyAPy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
        '    MsgBox("Διαφορετικό Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '    kwdApyKrat = -1
        '    Exit Function
        'ElseIf kwdApyAPy <> -1 Then
        '    Try
        '        kwdikos = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)

        '    Catch ex As Exception

        '    End Try


        'End If
    End Function


    Private Sub suche_mem_apy_diamenontes(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim onomateponimo As String
        Dim arApyDwm As String
        'Dim countAPY As Integer


        If Not MemApyDwmTbx.Text.Equals("") Then

            Me.KratiseisTableAdapter.FillByDwmChInOutTimologio(Me.DbhotelDataSet.kratiseis, Trim(MemApyDwmTbx.Text), True, False, 0)

            If Me.DbhotelDataSet.kratiseis.Count = 1 Then '
                kwdApyKrat = Me.DbhotelDataSet.kratiseis(0).kwd 'koitw ean uyparxei PRIVATE  stoixeia timologiou(->oxi gia praktoreio)
                Try
                    kwdApyApy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat) ' GIA MEMONOMENOUS PELATES
                    'MemApySynexBtn.Enabled = False
                    If kwdApyPrakt <> -1 Then
                        MsgBox("Διαφορετικά στοιχεία Τιμολογίου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyApy = -1
                        kwdApyKrat = -1
                        Exit Sub
                    End If
                Catch ex As InvalidOperationException
                    kwdApyApy = -1
                End Try

                If Me.DbhotelDataSet.kratiseis(0).timologio = -1 Then
                    MsgBox("Διαδικασία για εκδοση Α.Π.Υ. σε εξέλιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                ElseIf Me.DbhotelDataSet.kratiseis(0).timologio = 1 Then
                    MsgBox("Εχει εκδοθεί ήδη Α.Π.Υ. !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                End If

                If kwdApyPrakt <> -1 AndAlso kwdApyPrakt <> Me.DbhotelDataSet.kratiseis(0).praktimologio Then
                    'kwdApyAPy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
                    MsgBox("Διαφορετικό Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                End If
                'If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> imeromErgasias Then
                '    MsgBox(" Η Αναχώρηση δεν είναι προγραμματισμένη για σήμερα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                '    kwdApyKrat = -1
                '    kwdApyApy = -1
                '    Exit Sub
                'End If
                'kwdApyKrat = tempkwdApyKrat
                'kwdApyPrakt = Me.DbhotelDataSet.kratiseis(0).praktimologio
                If kwdApyAfm <> -1 AndAlso kwdApyAfm <> get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio) Then  '1AndAlso ParastΑpyCbx.SelectedIndex < 1
                    MsgBox(" Διαφορετικό Α.Φ.Μ. !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                End If

                fuehle_pnl_stoixeia(Nothing, kwdApyApy, Me.DbhotelDataSet.kratiseis(0).praktimologio)
                arApyDwm = Me.DbhotelDataSet.kratiseis(0).dwmatio
                MemApyDwmTbx.Text = Me.DbhotelDataSet.kratiseis(0).dwmatio


            ElseIf Me.DbhotelDataSet.kratiseis.Count > 1 Then 'kwd apy praktorieou LATHOS

                'Catch ex As InvalidCastException
                Dim form As New KratiseisSucheF(imeromErgasias, True, False, Trim(MemApyDwmTbx.Text), 2)

                form.ShowDialog()
                kwdApyKrat = form.return_kwdiko_kratisis()
                onomateponimo = form.return_onoma
                arApyDwm = form.return_dwmatio
                Try
                    kwdApyApy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
                    'MemApySynexBtn.Enabled = False
                    If kwdApyPrakt <> -1 Then
                        MsgBox("Διαφορετικά στοιχεία Τιμολογίου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyApy = -1
                        kwdApyKrat = -1
                        Exit Sub
                    End If
                Catch ex As InvalidOperationException
                    kwdApyApy = -1
                End Try
                form.Dispose()
                init_mem_apy_felder()
                If kwdApyKrat <> -1 Then
                    Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdApyKrat)
                    If Me.DbhotelDataSet.kratiseis(0).timologio = 2 Then
                        MsgBox("Διαδικασία για εκδοση Α.Π.Υ. σε εξέλιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    ElseIf Me.DbhotelDataSet.kratiseis(0).timologio = 1 Then
                        MsgBox("Εχει εκδοθεί ήδη Α.Π.Υ. !", MsgBoxStyle.Information, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If

                    If kwdApyPrakt <> -1 AndAlso kwdApyPrakt <> Me.DbhotelDataSet.kratiseis(0).praktimologio Then
                        MsgBox("Διαφορετικό Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If
                    If kwdApyAfm <> -1 AndAlso kwdApyAfm <> get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio) Then ' 2AndAlso ParastΑpyCbx.SelectedIndex < 1
                        MsgBox(" Διαφορετικό Α.Φ.Μ. !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If
                    'If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> imeromErgasias Then
                    '    MsgBox(" Η Αναχώρηση δεν είναι προγραμματισμένη για σήμερα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    '    kwdApyKrat = -1
                    '    kwdApyApy = -1
                    '    Exit Sub
                    'End If

                    MemApyDwmTbx.Text = arApyDwm
                    fuehle_pnl_stoixeia(onomateponimo, kwdApyApy, Me.DbhotelDataSet.kratiseis(0).praktimologio)
                End If
            ElseIf Me.DbhotelDataSet.kratiseis.Count = 0 Then
                Dim form As New KratiseisSucheF(imeromErgasias, True, False, 2, rechte)
                init_mem_apy_felder()
                form.ShowDialog()
                kwdApyKrat = form.return_kwdiko_kratisis()
                Try
                    kwdApyApy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
                    'MemApySynexBtn.Enabled = False
                    If kwdApyPrakt <> -1 Then
                        MsgBox("Διαφορετικά στοιχεία Τιμολογίου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyApy = -1
                        kwdApyKrat = -1
                        Exit Sub
                    End If
                Catch ex As InvalidOperationException
                    kwdApyApy = -1
                End Try

                'countAPY = Me.TimologiokratisiTableAdapter.ExistTimologioByKratisi(kwdApyKrat)
                'If countAPY <> 0 Then
                '    countAPY = Me.TimologiokratisiTableAdapter.DiadikasiaSeExelixiByKratisi(kwdApyKrat)
                '    If countAPY <> 0 Then
                '        MsgBox("Διαδικασία για εκδοση Α.Π.Υ. σε εξέλιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                '    Else
                '        MsgBox("Εχει εκδοθεί ήδη Α.Π.Υ. !", MsgBoxStyle.Information, "winfo\nikEl.")
                '    End If
                '    kwdApyKrat = -1
                '    Exit Sub
                'End If
                arApyDwm = form.return_dwmatio
                onomateponimo = form.return_onoma
                form.Dispose()
                If kwdApyKrat <> -1 Then
                    Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdApyKrat)
                    If Me.DbhotelDataSet.kratiseis(0).timologio = 2 Then
                        MsgBox("Διαδικασία για εκδοση Α.Π.Υ. σε εξέλιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    ElseIf Me.DbhotelDataSet.kratiseis(0).timologio = 1 Then
                        MsgBox("Εχει εκδοθεί ήδη Α.Π.Υ. !", MsgBoxStyle.Information, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If
                    If kwdApyPrakt <> -1 AndAlso kwdApyPrakt <> Me.DbhotelDataSet.kratiseis(0).praktimologio Then
                        MsgBox("Διαφορετικό Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                        'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If
                    If kwdApyAfm <> -1 AndAlso kwdApyAfm <> get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio) Then '3AndAlso ParastΑpyCbx.SelectedIndex < 1
                        MsgBox(" Διαφορετικό Α.Φ.Μ. !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        kwdApyKrat = -1
                        kwdApyApy = -1
                        Exit Sub
                    End If
                    'kwdApyKrat = tempkwdApyKrat
                    'kwdApyPrakt = Me.DbhotelDataSet.kratiseis(0).praktimologio
                    MemApyDwmTbx.Text = arApyDwm

                    fuehle_pnl_stoixeia(onomateponimo, kwdApyApy, Me.DbhotelDataSet.kratiseis(0).praktimologio)
                    If Me.PraktoreiaTableAdapter.IstIndividualByKwd(Me.DbhotelDataSet.kratiseis(0).praktimologio) Then
                        Me.TimologioChk.Checked = False
                    Else
                        Me.TimologioChk.Checked = True
                    End If
                End If
            End If
        Else
            Dim form As New KratiseisSucheF(imeromErgasias, True, False, 1, rechte)
            'Dim form As New KratiseisSucheF(imeromErgasias, True, False, 2)
            init_mem_apy_felder()
            form.ShowDialog()
            kwdApyKrat = form.return_kwdiko_kratisis()
            Try
                kwdApyApy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
                'MemApySynexBtn.Enabled = False
                If kwdApyPrakt <> -1 Then
                    MsgBox("Διαφορετικά στοιχεία Τιμολογίου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyApy = -1
                    kwdApyKrat = -1
                    Exit Sub
                End If
            Catch ex As InvalidOperationException
                kwdApyApy = -1
            End Try

            arApyDwm = form.return_dwmatio
            onomateponimo = form.return_onoma
            form.Dispose()
            If kwdApyKrat <> -1 Then
                Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdApyKrat)
                If Me.DbhotelDataSet.kratiseis(0).timologio = 2 Then
                    MsgBox("Διαδικασία για εκδοση Α.Π.Υ. σε εξέλιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                ElseIf Me.DbhotelDataSet.kratiseis(0).timologio = 1 Then
                    MsgBox("Εχει εκδοθεί ήδη Α.Π.Υ. !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    Exit Sub
                End If
                If kwdApyPrakt <> -1 AndAlso kwdApyPrakt <> Me.DbhotelDataSet.kratiseis(0).praktimologio Then
                    MsgBox("Διαφορετικό Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'simetKrat = simetKrat - Me.DbhotelDataSet.kratiseis(0).simetoxi
                    'prokatKrat = prokatKrat - Me.DbhotelDataSet.kratiseis(0).prokataboli

                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                End If
                If kwdApyAfm <> -1 AndAlso kwdApyAfm <> get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio) Then '4 AndAlso ParastΑpyCbx.SelectedIndex < 1
                    MsgBox(" Διαφορετικό Α.Φ.Μ. !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    kwdApyKrat = -1
                    kwdApyApy = -1
                    Exit Sub
                End If
                'kwdApyPrakt = Me.DbhotelDataSet.kratiseis(0).praktimologio
                MemApyDwmTbx.Text = arApyDwm

                fuehle_pnl_stoixeia(onomateponimo, kwdApyApy, Me.DbhotelDataSet.kratiseis(0).praktimologio)
                If Me.PraktoreiaTableAdapter.IstIndividualByKwd(Me.DbhotelDataSet.kratiseis(0).praktimologio) Then
                    Me.TimologioChk.Checked = False
                Else
                    Me.TimologioChk.Checked = True
                End If
            End If
        End If
    End Sub
    'Private Function get_etairia_ekdosis_tim(ByVal dwm As String) As Integer
    '    Dim etairKwd As Integer = -1
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        command.Connection = connection

    '        command.Parameters.AddWithValue("arithmos", dwm)
    '        command.CommandText = "SELECT afm FROM dwmatia WHERE (arithmos=?)" 'and (identifikation=?)
    '        myReader = command.ExecuteReader()
    '        ' Always call Read before accessing data.
    '        myReader.Read()
    '        etairKwd = CType(myReader.Item(0), Integer)
    '        ' always call Close when done reading.
    '        myReader.Close()
    '        command.Parameters.Clear()
    '    End Using
    '    Return etairKwd

    'End Function
    Private Function get_etairia_ekdosis_tim(ByVal dwm As String) As Integer
        Dim etairKwd As Integer = -1
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection

            command.Parameters.AddWithValue("arithmos", dwm)
            command.CommandText = "SELECT afm FROM dwmatia WHERE (arithmos = @arithmos)"
            myReader = command.ExecuteReader()
            ' Always call Read before accessing data.
            myReader.Read()
            etairKwd = CType(myReader.Item(0), Integer)
            ' always call Close when done reading.
            myReader.Close()
            command.Parameters.Clear()
        End Using
        Return etairKwd
    End Function

    'Private Function get_kwdparast_ekdosis_tim(ByVal kwd As Integer, ByVal index As Byte) As Integer
    '    Dim kwdparast As Integer = -1
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        command.Connection = connection

    '        If index = 1 Then
    '            command.Parameters.AddWithValue("kwd", kwd)
    '            command.CommandText = "SELECT apykwd FROM afm WHERE (kwd=?)" 'and (identifikation=?)
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.
    '            myReader.Read()
    '            Try
    '                kwdparast = CType(myReader.Item(0), Integer)
    '            Catch ex As InvalidOperationException
    '                myReader.Close()
    '                connection.Close()
    '                Return -1
    '            End Try
    '            ' always call Close when done reading.
    '            myReader.Close()
    '            command.Parameters.Clear()
    '        ElseIf index = 2 Then
    '            command.Parameters.AddWithValue("kwd", kwd)
    '            command.CommandText = "SELECT timolkwd FROM afm WHERE (kwd=?)" 'and (identifikation=?)
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.
    '            myReader.Read()
    '            Try
    '                kwdparast = CType(myReader.Item(0), Integer)
    '            Catch ex As InvalidOperationException
    '                myReader.Close()
    '                connection.Close()
    '                Return -1
    '            End Try

    '            ' always call Close when done reading.
    '            myReader.Close()
    '            command.Parameters.Clear()

    '        End If

    '    End Using
    '    Return kwdparast

    'End Function
    Private Function get_kwdparast_ekdosis_tim(ByVal kwd As Integer, ByVal index As Byte) As Integer
        Dim kwdparast As Integer = -1
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection

            If index = 1 Then
                command.Parameters.AddWithValue("kwd", kwd)
                command.CommandText = "SELECT apykwd FROM afm WHERE (kwd = @kwd)"
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                myReader.Read()
                Try
                    kwdparast = CType(myReader.Item(0), Integer)
                Catch ex As InvalidOperationException
                    myReader.Close()
                    connection.Close()
                    Return -1
                End Try
                ' always call Close when done reading.
                myReader.Close()
                command.Parameters.Clear()
            ElseIf index = 2 Then
                command.Parameters.AddWithValue("kwd", kwd)
                command.CommandText = "SELECT timolkwd FROM afm WHERE (kwd = @kwd)"
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                myReader.Read()
                Try
                    kwdparast = CType(myReader.Item(0), Integer)
                Catch ex As InvalidOperationException
                    myReader.Close()
                    connection.Close()
                    Return -1
                End Try

                ' always call Close when done reading.
                myReader.Close()
                command.Parameters.Clear()

            End If

        End Using
        Return kwdparast
    End Function

    Private Sub fuehle_pnl_stoixeia(ByVal onomateponimo As String, ByVal kwdApy As Integer, ByVal kwdPrakt As Integer)
        Dim j As Int16

        If kwdApy <> -1 Then
            Me.PelatisLbl.Text = Me.ApyTableAdapter.GetEponimiaByKwd(kwdApy)
        Else
            Me.PelatisLbl.Text = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(kwdPrakt)
        End If

        MemApyAfixiLbl.Text = Me.DbhotelDataSet.kratiseis(0).afixi.Date
        MemApyAnaxLbl.Text = Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date
        MemApyEnilLbl.Text = Me.DbhotelDataSet.kratiseis(0).enilikes
        apyEnil = Me.DbhotelDataSet.kratiseis(0).enilikes
        'Domisi alaksa to voucher me ar kratisi
        apyVoucher = Me.DbhotelDataSet.kratiseis(0).arithmos ' Me.DbhotelDataSet.kratiseis(0).voucher
        apyDwm = Me.DbhotelDataSet.kratiseis(0).dwmatio

        If onomateponimo = Nothing Then
            Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, Me.DbhotelDataSet.kratiseis(0).kwd)
            If Me.DbhotelDataSet.enilikes.Count <> 0 Then
                MemApyOnomLbl.Text = Me.DbhotelDataSet.enilikes(0).onomateponimo
                apyOnom = Me.DbhotelDataSet.enilikes(0).onomateponimo
            End If
        Else
            MemApyOnomLbl.Text = onomateponimo
            apyOnom = onomateponimo
        End If


        Me.PaidiaTableAdapter.FillByKratisi(Me.DbhotelDataSet.paidia, Me.DbhotelDataSet.kratiseis(0).kwd)
        For j = 0 To Me.DbhotelDataSet.paidia.Count - 1
            If j = 0 Then
                MemApyIlik1Lbl.Text = Me.DbhotelDataSet.paidia(j).ilikia
                MemApyCot1Lbl.Text = Me.DbhotelDataSet.paidia(j).cot
            ElseIf j = 1 Then
                MemApyIlik2Lbl.Text = Me.DbhotelDataSet.paidia(j).ilikia
                MemApyCot2Lbl.Text = Me.DbhotelDataSet.paidia(j).cot
            ElseIf j = 2 Then
                MemApyIlik3Lbl.Text = Me.DbhotelDataSet.paidia(j).ilikia
                MemApyCot3Lbl.Text = Me.DbhotelDataSet.paidia(j).cot
            End If
        Next
        apyPaid = Me.DbhotelDataSet.paidia.Count

        MemApyEthnAr1Lbl.Text = Me.DbhotelDataSet.kratiseis(0).anzethnikotites
        Try
            MemApyEthn1Lbl.Text = Me.EthnikotitesTableAdapter.GetSintomeusiByKwd(Me.DbhotelDataSet.kratiseis(0).ethnikotites)
        Catch ex As InvalidOperationException
        End Try

        MemApyEthnAr2Lbl.Text = Me.DbhotelDataSet.kratiseis(0).anzethnikotites2
        Try
            MemApyEthn2Lbl.Text = Me.EthnikotitesTableAdapter.GetSintomeusiByKwd(Me.DbhotelDataSet.kratiseis(0).ethnikotites2)
        Catch ex As InvalidOperationException

        End Try

        timPoso = Me.DbhotelDataSet.kratiseis(0).synolo
        MemApyLogarLbl.Text = Me.DbhotelDataSet.kratiseis(0).synolo.ToString("N")
        MemApyImerLbl.Text = Me.DbhotelDataSet.kratiseis(0).anaxwrisi.DayOfYear - Me.DbhotelDataSet.kratiseis(0).afixi.DayOfYear
        MemApyProkatLbl.Text = Me.DbhotelDataSet.kratiseis(0).prokataboli.ToString("N")

        If timPoso > Me.DbhotelDataSet.kratiseis(0).prokataboli Then
            myTimer2.Interval = 1000
            myTimer2.Start()
        Else
            blinkLbl2.Text = ""
            myTimer2.Stop()
        End If

        ekptosiKratOK = Me.DbhotelDataSet.kratiseis(0).ekptosi
        If ekptosiKratOK Then
            posostoTemp = Me.DbhotelDataSet.kratiseis(0).ekptpososto
            posoTemp = Me.DbhotelDataSet.kratiseis(0).ekptposo
            freeTemp = Me.DbhotelDataSet.kratiseis(0).ekptimeres
            cfeeTemp = Me.DbhotelDataSet.kratiseis(0).fee
        End If
        MemApyPosostoTbx.Text = Me.DbhotelDataSet.kratiseis(0).ekptpososto.ToString("N")
        MemApyPosoTbx.Text = Me.DbhotelDataSet.kratiseis(0).ekptposo.ToString("N")
        MemApyImerFreeTbx.Text = Me.DbhotelDataSet.kratiseis(0).ekptimeres.ToString("N1")
        MemApyFeeTbx.Text = Me.DbhotelDataSet.kratiseis(0).fee.ToString("N1")

    End Sub
    Private Sub MemApyEkdBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyEkdBtn.Click
        Dim pliromi As String
        Dim j As Int16
        'aaKratApy = 1
        If Me.DbhotelDataSet.kratiseis.Count = 1 Then
            If kwdApyKrat <> -1 AndAlso Not exist_schon_kwd_kratisis(Me.DbhotelDataSet.kratiseis(0).kwd) Then
                kwdApyPrakt = Me.DbhotelDataSet.kratiseis(0).praktimologio
                If kwdApyAfm = -1 Then
                    kwdApyAfm = get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio)
                End If
                If kwdApyAfm <> -1 Then
                    'If Me.PraktoreiaTableAdapter.IstIndividualByKwd(kwdApyPrakt) Then
                    If Not TimologioChk.Checked Then
                        kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 1) ' kwdApyParast = Me.DbhotelDataSet.etaireia(0).apykwd
                    Else
                        kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 2) '  kwdApyParast = Me.DbhotelDataSet.etaireia(0).timolkwd
                    End If

                    'Else
                    '    TimologioChk.Checked = True
                    '    kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 2) 'Me.DbhotelDataSet.etaireia(0).timolkwd
                    'End If
                Else
                    MsgBox(" Εταιρία έκδοσης Παραστατικού ?", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Exit Sub
                End If

                simetKrat = 0 'simetKrat + Me.DbhotelDataSet.kratiseis(0).simetoxi
                prokatKrat = prokatKrat + Me.DbhotelDataSet.kratiseis(0).prokataboli
                If simbKrat = 0 Then 'arxika simbKrat=0->Zuordnen
                    simbKrat = Me.DbhotelDataSet.kratiseis(0).simbolaio
                Else 'wenn synexeia sto idio timologio->sugkrisi twn simbKwd->ean einai ta idia OK alliws sto timologio mpainei -1
                    If simbKrat <> Me.DbhotelDataSet.kratiseis(0).simbolaio Then
                        simbKrat = -1
                    End If
                End If
                'MsgBox("add")
                add_kwdiko_kratisis(Me.DbhotelDataSet.kratiseis(0).kwd) ' edw apothikeuw tis kratiseis pou einai pros timologisi gia 
                'na kanw abfrage meta ean kapoios allos user ebgale entometaksi to timologio me tin kratisi_>concurency!!!!!!
            End If

        Else
            If kwdProsEkd.Length = 0 Then
                Exit Sub
            End If

        End If
        Me.Cursor = Cursors.WaitCursor

        If erzeuge_apy(True, ist_mauri_etaireia(kwdApyAfm)) Then
            'If kwdApyAfm = 6 Or kwdApyAfm = 7 Then ' Or kwdApyAfm = 4
            Dim msg As New CustomMessageBox
                Dim result = msg.ShowDialog()

                If result = Windows.Forms.DialogResult.Yes Then

                    pliromi = "Μετρητοίς"

                ElseIf result = Windows.Forms.DialogResult.No Then

                    pliromi = "Κάρτα"

                Else

                    pliromi = "Επί Πιστώση"
                End If

                For j = 0 To kwdProsEkd.Length - 1
                If execute_foros_klima(kwdApyAfm, kwdProsEkd(j), pliromi) Then
                    print_foros(kwdProsEkd(j))
                End If

            Next
            'End If
        End If




        Me.Cursor = Cursors.Default
        init_mem_apy_felder()
        MemApyDwmTbx.Clear()
        TimologioChk.Checked = False
        init_ekpt_felder(0, 0, 0, 0)

        kwdApyKrat = -1
        kwdApyPrakt = -1
        kwdApyAfm = -1
        kwdApyParast = -1
        clear_dataset_ekt()
        init_globale_var()
        aaKratApy = 0
        timolID = 20000
        ReDim kwdProsEkd(-1) 'initialiseiren kwdikous kratisis pro timologisi
    End Sub

    'Private Function execute_foros_diamonis(ByVal etaireia As Int32, ByVal kwdikos As Int32, ByVal pliromi As String) As Boolean
    '    Dim afixi, anaxwrisi As Date
    '    Dim dwmatio, eponimia, epaggelma, dieuthinsi, afm, doy, onomateponimo, postalCodeLpt, cityLpt As String
    '    Dim apy, parastatiko, aa, rowCount, rows, days As Int16
    '    Dim foros As Single = 0
    '    rowCount = 0
    '    eponimia = ""
    '    epaggelma = ""
    '    dieuthinsi = ""
    '    afm = ""
    '    doy = ""
    '    Using connection As New SqlConnection(connectionString)
    '        Dim myReader As SqlDataReader
    '        Dim command As New SqlCommand()
    '        Dim transaction As SqlTransaction = Nothing
    '        Try
    '            connection.Open()
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection
    '            command.Transaction = transaction

    '            command.Parameters.Clear()
    '            command.Parameters.AddWithValue("kwd", kwdikos)
    '            command.CommandText = "SELECT afixi, anaxwrisi, dwmatio, apy, parastatiko FROM kratiseis WHERE kwd = @kwd"

    '            myReader = command.ExecuteReader()
    '            myReader.Read()
    '            afixi = CType(myReader.Item("afixi"), Date)
    '            anaxwrisi = CType(myReader.Item("anaxwrisi"), Date)
    '            dwmatio = myReader.Item("dwmatio")
    '            apy = myReader.Item("apy")
    '            parastatiko = myReader.Item("parastatiko")
    '            'kalutera diktes apo pou mexri pou sto imeresStat

    '            myReader.Close()
    '            command.Parameters.Clear()
    '            command.Parameters.AddWithValue("etaireia", etaireia)
    '            command.CommandText = "SELECT MAX(arithmos) FROM forosdiamonis WHERE etaireia = @etaireia"
    '            myReader = command.ExecuteReader()
    '            myReader.Read()

    '            Try
    '                aa = myReader.Item(0)
    '            Catch ex As Exception
    '                aa = 0
    '            End Try

    '            myReader.Close()

    '            command.Parameters.Clear()
    '            command.Parameters.AddWithValue("kwd", kwdikos)
    '            command.CommandText = "SELECT eponimia, epaggelma, dieuthinsi, afm, doy, postalcode, city FROM apy WHERE kratisi = @kwd"

    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                rowCount = rowCount + 1
    '                eponimia = myReader.GetString(0)
    '                epaggelma = myReader.GetString(1)
    '                dieuthinsi = myReader.GetString(2)
    '                afm = myReader.GetString(3)
    '                doy = myReader.GetString(4)
    '                postalCodeLpt = myReader.GetString(5)
    '                cityLpt = myReader.GetString(6)
    '            End While
    '            ' always call Close when done reading.
    '            myReader.Close()
    '            command.Parameters.Clear()

    '            If rowCount = 0 Then
    '                command.Parameters.AddWithValue("kratisi", kwdikos)
    '                command.CommandText = "SELECT onomateponimo FROM enilikes WHERE kratisi = @kratisi"
    '                myReader = command.ExecuteReader()
    '                myReader.Read()
    '                onomateponimo = myReader.Item(0)
    '                myReader.Close()
    '                command.Parameters.Clear()
    '            End If

    '            aa = aa + 1
    '            days = anaxwrisi.Subtract(afixi).Days
    '            foros = days * Me.DbhotelDataSet.etaireia(0).dimforos2

    '            If pliromi = "Κάρτα" Then
    '                If MemApyTrPlCbx.SelectedItem = "VISA" Or MemApyTrPlCbx.SelectedItem = "MASTERCARD" Or MemApyTrPlCbx.SelectedItem = "DINNERS" Or MemApyTrPlCbx.SelectedItem = "AMERICAN EXPRESS" Or MemApyTrPlCbx.SelectedItem = "DEBIT" Then
    '                    pliromi = MemApyTrPlCbx.SelectedItem
    '                Else
    '                    pliromi = "MASTERCARD"
    '                End If
    '            End If

    '            command.Parameters.AddWithValue("etaireia", etaireia)
    '            command.Parameters.AddWithValue("kratisi", kwdikos)
    '            command.Parameters.AddWithValue("imerominia", imeromErgasias)
    '            command.Parameters.AddWithValue("arithmos", aa)
    '            command.Parameters.AddWithValue("onoma", eponimia)
    '            command.Parameters.AddWithValue("drastiriotita", epaggelma)
    '            command.Parameters.AddWithValue("dieuthinsi", dieuthinsi)
    '            command.Parameters.AddWithValue("afm", afm)
    '            command.Parameters.AddWithValue("doy", doy)
    '            command.Parameters.AddWithValue("afixi", afixi)
    '            command.Parameters.AddWithValue("anaxwrisi", anaxwrisi)
    '            command.Parameters.AddWithValue("days", days)
    '            command.Parameters.AddWithValue("room", dwmatio)
    '            command.Parameters.AddWithValue("apy", apy)
    '            command.Parameters.AddWithValue("parastatiko", parastatiko)
    '            command.Parameters.AddWithValue("foros", foros)
    '            command.Parameters.AddWithValue("pliromi", pliromi)

    '            command.CommandText = "INSERT INTO forosdiamonis (etaireia, kratisi, imerominia, arithmos, onoma, drastiriotita, dieuthinsi, afm, doy, afixi, anaxwrisi, days, " &
    '                            "room, apy, parastatiko, foros, pliromi) VALUES (@etaireia, @kratisi, @imerominia, @arithmos, @onoma, @drastiriotita, @dieuthinsi, @afm, @doy, @afixi, @anaxwrisi, @days, " &
    '                            "@room, @apy, @parastatiko, @foros, @pliromi)"

    '            rows = command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            If rows = 1 Then
    '                transaction.Commit()
    '                Return True
    '            Else
    '                Return False
    '            End If
    '        Catch ex As Exception
    '            transaction.Rollback()
    '            Return False
    '            'MsgBox("H ΑΠΥ δεν πορεί να εκδοθεί !", MsgBoxStyle.Information, "winfo\nikEl.")
    '        End Try
    '    End Using

    'End Function
    Private Function execute_foros_klima(ByVal etaireia As Int32, ByVal kwdikos As Int32, ByVal pliromi As String) As Boolean
        Dim afixi, anaxwrisi As Date
        Dim dwmatio, eponimia, epaggelma, dieuthinsi, afm, doy, onomateponimo, postalCodeLpt, cityLpt, correlatedInv As String
        Dim apy, aa, rowCount, rows, days As Int16
        Dim dimeres As Int16
        Dim telos As Single = 0
        Dim foros As Single = 0
        Dim synolo As Single = 0
        Dim ekptposo As Single = 0
        Dim praktimologio, parastatiko As Int64
        rowCount = 0
        eponimia = ""
        epaggelma = ""
        dieuthinsi = ""
        afm = ""
        doy = ""
        onomateponimo = ""
        postalCodeLpt = ""
        cityLpt = ""
        correlatedInv = ""
        Using connection As New SqlConnection(connectionString)
            Dim myReader As SqlDataReader
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.Clear()
                command.Parameters.AddWithValue("kwd", kwdikos)
                command.CommandText = "SELECT afixi, anaxwrisi, dwmatio, apy, parastatiko, praktimologio, synolo, ekptposo FROM kratiseis WHERE kwd = @kwd"

                myReader = command.ExecuteReader()
                myReader.Read()
                afixi = CType(myReader.Item("afixi"), Date)
                anaxwrisi = CType(myReader.Item("anaxwrisi"), Date)
                dwmatio = myReader.Item("dwmatio")
                apy = myReader.Item("apy")
                parastatiko = CType(myReader.Item("parastatiko"), Int64)
                'parastatiko = myReader.Item("parastatiko")
                praktimologio = CType(myReader.Item("praktimologio"), Int64)
                synolo = CType(myReader.Item("synolo"), Single)
                ekptposo = myReader.Item("ekptposo")
                myReader.Close()
                command.Parameters.Clear()

                Dim teloskratisis As New teloskratisis(connectionString, kwdikos, dwmatio, praktimologio, afixi, anaxwrisi, synolo, ekptposo, 3)
                command.Parameters.AddWithValue("kwd", kwdikos)
                command.CommandText = "SELECT dimeres, poso FROM telosdiamonis WHERE kratisi = @kwd"
                myReader = command.ExecuteReader()
                myReader.Read()
                If myReader.HasRows() Then
                    dimeres = myReader.Item("dimeres")
                    telos = myReader.Item("poso")


                End If
                myReader.Close()
                command.Parameters.Clear()


                If telos > 0 Then

                    command.Parameters.AddWithValue("etaireia", etaireia)
                    command.CommandText = "SELECT MAX(arithmos) FROM forosdiamonis WHERE etaireia = @etaireia"
                    myReader = command.ExecuteReader()
                    myReader.Read()
                    Try
                        aa = myReader.Item(0)
                    Catch ex As Exception
                        aa = 0
                    End Try

                    myReader.Close()

                    command.Parameters.Clear()
                    command.Parameters.AddWithValue("kwd", kwdikos)
                    command.CommandText = "SELECT eponimia, epaggelma, dieuthinsi, afm, doy, postalcode, city FROM apy WHERE kratisi = @kwd"

                    myReader = command.ExecuteReader()
                    While myReader.Read()
                        rowCount = rowCount + 1
                        eponimia = myReader.GetString(0)
                        epaggelma = myReader.GetString(1)
                        dieuthinsi = myReader.GetString(2)
                        afm = myReader.GetString(3)
                        doy = myReader.GetString(4)
                        postalCodeLpt = myReader.GetString(5)
                        cityLpt = myReader.GetString(6)
                    End While
                    ' always call Close when done reading.
                    myReader.Close()
                    command.Parameters.Clear()
                    If rowCount = 0 Then
                        command.Parameters.AddWithValue("kratisi", kwdikos)
                        command.CommandText = "SELECT onomateponimo FROM enilikes WHERE kratisi = @kratisi"
                        myReader = command.ExecuteReader()
                        While myReader.Read()
                            If Not myReader.IsDBNull(0) Then
                                onomateponimo = myReader.Item(0)
                            Else
                                onomateponimo = ""
                            End If

                        End While

                        myReader.Close()
                        command.Parameters.Clear()
                    End If
                    aa = aa + 1
                    'days = anaxwrisi.Subtract(afixi).Days
                    days = dimeres
                    foros = telos

                    If pliromi = "Κάρτα" Then
                        If MemApyTrPlCbx.SelectedItem = "VISA" Or MemApyTrPlCbx.SelectedItem = "MASTERCARD" Or MemApyTrPlCbx.SelectedItem = "DINNERS" Or MemApyTrPlCbx.SelectedItem = "AMERICAN EXPRESS" Or MemApyTrPlCbx.SelectedItem = "DEBIT" Then
                            pliromi = MemApyTrPlCbx.SelectedItem
                        Else
                            pliromi = "MASTERCARD"
                        End If
                    End If

                    command.Parameters.AddWithValue("etaireia", etaireia)
                    command.Parameters.AddWithValue("kratisi", kwdikos)
                    'command.Parameters.Add("imerominia", SqlDbType.DateTime2).Value = DateTime.Now.Date
                    command.Parameters.AddWithValue("imerominia", imeromErgasias)
                    command.Parameters.AddWithValue("arithmos", aa)
                    If Not String.IsNullOrEmpty(eponimia) Then
                        command.Parameters.AddWithValue("onoma", eponimia)
                    Else
                        command.Parameters.AddWithValue("onoma", onomateponimo)

                    End If

                    command.Parameters.AddWithValue("drastiriotita", epaggelma)
                    command.Parameters.AddWithValue("dieuthinsi", dieuthinsi)
                    command.Parameters.AddWithValue("afm", afm)
                    command.Parameters.AddWithValue("doy", doy)
                    command.Parameters.AddWithValue("afixi", anaxwrisi.AddDays(-dimeres))
                    command.Parameters.AddWithValue("anaxwrisi", anaxwrisi)
                    command.Parameters.AddWithValue("days", dimeres)
                    command.Parameters.AddWithValue("room", dwmatio)
                    command.Parameters.AddWithValue("apy", apy)
                    command.Parameters.AddWithValue("parastatiko", parastatiko)
                    command.Parameters.AddWithValue("foros", telos)
                    command.Parameters.AddWithValue("pliromi", pliromi)

                    command.CommandText = "INSERT INTO forosdiamonis (etaireia, kratisi, imerominia, arithmos, onoma, drastiriotita, dieuthinsi, afm, doy, afixi, anaxwrisi, days, " &
                                    "room, apy, parastatiko, foros, pliromi) VALUES (@etaireia, @kratisi, @imerominia, @arithmos, @onoma, @drastiriotita, @dieuthinsi, @afm, @doy, @afixi, @anaxwrisi, @days, " &
                                    "@room, @apy, @parastatiko, @foros, @pliromi)"

                    rows = command.ExecuteNonQuery()
                    command.Parameters.Clear()
                    If rows = 1 Then
                        If Me.DbhotelDataSet.etaireia(0).ktimis Then

                            Dim tipos As String = ""
                            Dim response As MsgBoxResult
                            Dim kwdForosDiamonis As Int32



                            response = MsgBox("Ενημέρωση myData με φόρο ανθεκτικότητας ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                            If response = MsgBoxResult.Yes Then

                                'gia MyDATA domisi me tis poles etaireies
                                command.Parameters.AddWithValue("kratisi", kwdikos)
                                command.Parameters.Add("imerominia", SqlDbType.DateTime2).Value = DateTime.Now.Date
                                'command.Parameters.AddWithValue("identifikation", timolID)

                                command.CommandText = "SELECT kwd FROM forosdiamonis WHERE (kratisi = @kratisi) AND (imerominia = @imerominia)" 'and (identifikation=?)

                                myReader = command.ExecuteReader()

                                kwdForosDiamonis = myReader.GetInt32(0)

                                ' always call Close when done reading.
                                myReader.Close()
                                command.Parameters.Clear()
                                command.Parameters.AddWithValue("kwd", kwdApyParast)
                                command.CommandText = "SELECT afm.afm, afm.epixirisi, parastatika.tipos, afm.kwd FROM afm INNER JOIN parastatika ON afm.kwd=parastatika.etaireia WHERE (parastatika.kwd=@kwd)" 'and (identifikation=@identifikation)

                                myReader = command.ExecuteReader()
                                ' Always call Read before accessing data.
                                myReader.Read()
                                Dim afmDomisi, epixirisiDomisi, tiposparDomisi, apiKey, postalCodeEkd, cityEkd, branchEkd, countryEkd, qrUrl As String
                                Dim aadeUserId As String = String.Empty
                                Dim afmKwd As Int32
                                Try
                                    afmDomisi = myReader.Item(0)
                                    afmKwd = myReader.Item(3)
                                Catch ex As InvalidCastException
                                    afmDomisi = ""
                                End Try
                                Try
                                    epixirisiDomisi = myReader.Item(1)
                                    tiposparDomisi = myReader.Item(2)
                                Catch ex As InvalidCastException
                                    epixirisiDomisi = ""
                                    tiposparDomisi = ""
                                End Try
                                myReader.Close()
                                command.Parameters.Clear()
                                command.Parameters.AddWithValue("kwd", afmKwd)
                                command.CommandText = "SELECT mydata.aadeUserId, mydata.apiKey, branch, postalCode, city, country FROM afm INNER JOIN mydata ON afm.kwd=mydata.afm WHERE (afm.kwd=@kwd)"
                                myReader = command.ExecuteReader()
                                ' Always call Read before accessing data.
                                If myReader.HasRows AndAlso myReader.Read() Then
                                    Try
                                        aadeUserId = myReader.Item(0)
                                        apiKey = myReader.Item(1)
                                        branchEkd = myReader.Item(2)
                                        postalCodeEkd = myReader.Item(3)
                                        cityEkd = myReader.Item(4)
                                        countryEkd = myReader.Item(5)
                                    Catch ex As InvalidCastException
                                        MsgBox("Cannot find myDATA credentilas!", MsgBoxStyle.Critical)
                                    End Try
                                End If



                                myReader.Close()
                                command.Parameters.Clear()

                                Dim sendInvoice = New SendInvoices(connectionString, aadeUserId, apiKey, epixirisiDomisi, "ΦΟΡΟΣ ΔΙΑΜΟΝΗΣ", kwdForosDiamonis, tipos, afmDomisi, countryEkd, branchEkd, postalCodeEkd, cityEkd, afm, "", "0", "", "", "", "", "A",
                                             aa, imeromErgasias, pliromi, correlatedInv, foros, Nothing, Nothing, Nothing, Nothing, Nothing,
            Nothing, Nothing, Nothing) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros

                                '                Dim sendInvoice = New SendInvoices(connectionString, aadeUserId, apiKey, epixirisiNef, "ΦΟΡΟΣ ΔΙΑΜΟΝΗΣ", kwdikos, tipos, "131485023", countryEkd, branchEkd, postalCodeEkd, cityEkd, "094293117", "GR", "0", onomateponimo, eponimia, postalCodeLpt, cityLpt, "A",
                                '                                 aa, imeromErgasias, pliromi, Nothing, foros, Nothing, Nothing, Nothing, Nothing, Nothing,
                                'Nothing, Nothing, Nothing) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
                                Dim threadSendInvoice As Threading.Thread
                                threadSendInvoice = sendInvoice.set_mode(0)
                                threadSendInvoice = sendInvoice.send_invoice()

                                Dim timeoutMilliseconds As Integer = 10000 ' Set your desired timeout in milliseconds (10 seconds in this example)
                                Dim startTime As DateTime = DateTime.Now

                                While threadSendInvoice.IsAlive
                                    ' Your loop body here

                                    ' Check if the timeout has been reached
                                    Dim elapsedMilliseconds As Integer = CInt((DateTime.Now - startTime).TotalMilliseconds)
                                    If elapsedMilliseconds >= timeoutMilliseconds Then
                                        ' Timeout reached, break out of the loop
                                        Exit While
                                    End If

                                    ' Optionally, you can add a small delay to reduce CPU usage
                                    'System.Threading.Thread.Sleep(100) ' Sleep for 100 milliseconds (adjust as needed)
                                End While
                                qrUrl = ""
                                command.Parameters.AddWithValue("timologio", kwdForosDiamonis)
                                command.CommandText = "SELECT qrcode FROM myinvoices WHERE (timologio=@timologio)"
                                myReader = command.ExecuteReader()
                                ' Always call Read before accessing data.
                                If myReader.HasRows AndAlso myReader.Read() Then
                                    Try
                                        qrUrl = myReader.Item(0)
                                        'Dim encoder As New QRCodeEncoder()

                                        '' Set encoding properties
                                        'encoder.QRCodeEncodeMode = QRCodeEncoder.ENCODE_MODE.BYTE
                                        'encoder.QRCodeScale = 4
                                        'encoder.QRCodeVersion = 8
                                        'encoder.QRCodeErrorCorrect = QRCodeEncoder.ERROR_CORRECTION.L

                                        '' Encode the string as a QR code and get the Bitmap
                                        'Dim qrBitmap As Bitmap = encoder.Encode(qrUrl)

                                        '' Convert Bitmap to Byte array
                                        'Dim byteArray As Byte() = BitmapToByteArray(qrBitmap)

                                        Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode(qrUrl)

                                    Catch ex As InvalidCastException
                                        MsgBox("No QRCode!", MsgBoxStyle.Critical)
                                    End Try
                                End If

                                myReader.Close()
                                command.Parameters.Clear()

                                If Not String.IsNullOrEmpty(qrUrl) Then
                                    command.Parameters.AddWithValue("qrcode", qrUrl)
                                    command.Parameters.AddWithValue("timologio", kwdForosDiamonis)

                                    command.CommandText = "UPDATE forosdiamonis SET qrcode = @qrcode WHERE (kwd = @timologio)"
                                    command.ExecuteNonQuery()
                                    command.Parameters.Clear()
                                End If
                                'threadSendInvoice = sendInvoice.send_foros_diamonis()



                                'Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt  city

                                '       MsgBox(Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia)


                            End If

                        End If
                    Else
                            transaction.Rollback()
                        Return False

                    End If


                Else
                    Return False

                End If


                transaction.Commit()
                Return True



            Catch ex As Exception
                transaction.Rollback()
                Return False
                'MsgBox("H ΑΠΥ δεν πορεί να εκδοθεί !", MsgBoxStyle.Information, "winfo\nikEl.")
            End Try
        End Using

    End Function

    Private Sub print_foros(ByVal kwdikos As Integer)
        Dim adapter As New dbhotelDataSet1TableAdapters.forosdiamonisTableAdapter
        adapter.FillByKratisi(Me.DbhotelDataSet1.forosdiamonis, kwdikos)
        Dim adapter1 As New dbhotelDataSet1TableAdapters.afmTableAdapter
        adapter1.Fill(Me.DbhotelDataSet1.afm)
        Dim adapter2 As New dbhotelDataSet1TableAdapters.etaireiaTableAdapter
        adapter2.Fill(Me.DbhotelDataSet1.etaireia)
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New ForosEidik()


        ektiposi.SetDataSource(DbhotelDataSet1)

        'ektiposi.PrintToPrinter(2, False, 0, 0)
        'ektiposi.Close()
        'ektiposi.Dispose()
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
    End Sub

    Private Sub MemApySynexBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApySynexBtn.Click
        Dim response As MsgBoxResult

        If Me.DbhotelDataSet.kratiseis.Count = 1 Then
            If kwdApyKrat <> -1 AndAlso Not exist_schon_kwd_kratisis(Me.DbhotelDataSet.kratiseis(0).kwd) Then
                kwdApyPrakt = Me.DbhotelDataSet.kratiseis(0).praktimologio
                If kwdApyAfm = -1 Then
                    kwdApyAfm = get_etairia_ekdosis_tim(Me.DbhotelDataSet.kratiseis(0).dwmatio)
                End If
                If kwdApyAfm <> -1 Then
                    If Me.PraktoreiaTableAdapter.IstIndividualByKwd(kwdApyPrakt) Then
                        If Not TimologioChk.Checked Then
                            kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 1) 'Me.DbhotelDataSet.etaireia(0).apykwd
                        Else
                            kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 2)
                        End If
                    Else
                        TimologioChk.Checked = True
                        kwdApyParast = get_kwdparast_ekdosis_tim(kwdApyAfm, 2) 'kwdApyParast = Me.DbhotelDataSet.etaireia(0).timolkwd
                    End If
                Else
                    MsgBox(" Εταιρία έκδοσης Παραστατικού ?", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Exit Sub
                End If

                simetKrat = simetKrat + Me.DbhotelDataSet.kratiseis(0).simetoxi
                prokatKrat = prokatKrat + Me.DbhotelDataSet.kratiseis(0).prokataboli

                If simbKrat = 0 Then 'arxika simbKrat=0->Zuordnen
                    simbKrat = Me.DbhotelDataSet.kratiseis(0).simbolaio
                Else 'wenn synexeia sto idio timologio->sugkrisi twn simbKwd->ean einai ta idia OK alliws sto timologio mpainei -1
                    If simbKrat <> Me.DbhotelDataSet.kratiseis(0).simbolaio Then
                        simbKrat = -1
                    End If
                End If

                add_kwdiko_kratisis(Me.DbhotelDataSet.kratiseis(0).kwd) ' edw apothikeuw tis kratiseis pou einai pros timologisi gia 
                'na kanw abfrage meta ean kapoios allos user ebgale entometaksi to timologio me tin kratisi_>concurency!!!!!!
            End If
        Else
            Exit Sub
        End If
        If kwdApyApy <> -1 Then
            response = MsgBox("Δεν υφίσταται αυτή η επιλογή !" & vbCrLf & "Εκδοση του Παραστατικού; ", MsgBoxStyle.YesNo, "winfo\nikEl.")
            If response = MsgBoxResult.Yes Then
                MemApyEkdBtn_Click(sender, e)
            Else
                init_mem_apy_felder()
                MemApyDwmTbx.Clear()
                TimologioChk.Checked = False
                init_ekpt_felder(0, 0, 0, 0)
                kwdApyKrat = -1
                kwdApyPrakt = -1
                kwdApyAfm = -1
                kwdApyParast = -1
                kwdApyApy = -1
                clear_dataset_ekt()
                init_globale_var()
                aaKratApy = 0
                timolID = 20000
                ReDim kwdProsEkd(-1)
            End If
            Exit Sub
        End If

        If erzeuge_apy(False, ist_mauri_etaireia(kwdApyAfm)) Then

        End If
        If kwdApyKrat <> -1 Then
            MsgBox("Επιλέξτε το πελάτη που θα συμπεριληφθεί στην Απόδειξη (ολοκληρώστε κάνωντας κλικ στην 'Εκδοση')", MsgBoxStyle.Information, "winfo\nikEl.")
            init_mem_apy_felder()
            MemApyDwmTbx.Clear()
            TimologioChk.Checked = False
            init_ekpt_felder(0, 0, 0, 0)
            kwdApyKrat = -1
            'kwdApyDwm = -1

        End If



    End Sub
    'Private Function ist_mauri_etaireia(ByVal kwd As Integer)
    '    Dim istEikoniki As Boolean
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kwd", kwd)
    '        command.CommandText = "SELECT eikoniko FROM afm WHERE (kwd=?)" 'and (identifikation=?)
    '        myReader = command.ExecuteReader()
    '        ' Always call Read before accessing data.
    '        myReader.Read()
    '        Try
    '            istEikoniki = CType(myReader.Item(0), Integer)
    '        Catch ex As InvalidOperationException
    '            myReader.Close()
    '            connection.Close()
    '            Return False
    '        End Try
    '        ' always call Close when done reading.
    '        myReader.Close()
    '    End Using
    '    Return istEikoniki
    'End Function
    Private Function ist_mauri_etaireia(ByVal kwd As Integer) As Boolean
        Dim istEikoniki As Boolean
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection
            command.Parameters.AddWithValue("kwd", kwd)
            command.CommandText = "SELECT eikoniko FROM afm WHERE (kwd = @kwd)"
            myReader = command.ExecuteReader()
            ' Always call Read before accessing data.
            myReader.Read()
            Try
                istEikoniki = CType(myReader.Item(0), Boolean)
            Catch ex As InvalidOperationException
                myReader.Close()
                connection.Close()
                Return False
            End Try
            ' always call Close when done reading.
            myReader.Close()
        End Using
        Return istEikoniki
    End Function

    'Private Function get_kwd_etaireias_by_name(ByVal name As String)
    '    Dim kwd As Integer
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("epixirisi", name)
    '        command.CommandText = "SELECT kwd FROM afm WHERE (epixirisi=?)" 'and (identifikation=?)
    '        myReader = command.ExecuteReader()
    '        ' Always call Read before accessing data.
    '        myReader.Read()
    '        Try
    '            kwd = CType(myReader.Item(0), Integer)
    '        Catch ex As InvalidOperationException
    '            myReader.Close()
    '            connection.Close()
    '            Return False
    '        End Try
    '        ' always call Close when done reading.
    '        myReader.Close()
    '    End Using
    '    Return kwd
    'End Function
    Private Function get_kwd_etaireias_by_name(ByVal name As String) As Integer
        Dim kwd As Integer
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection
            command.Parameters.AddWithValue("epixirisi", name)
            command.CommandText = "SELECT kwd FROM afm WHERE (epixirisi = @epixirisi)"
            myReader = command.ExecuteReader()
            ' Always call Read before accessing data.
            myReader.Read()
            Try
                kwd = CType(myReader.Item(0), Integer)
            Catch ex As InvalidOperationException
                myReader.Close()
                connection.Close()
                Return -1
            End Try
            ' always call Close when done reading.
            myReader.Close()
        End Using
        Return kwd
    End Function

    Private Function erzeuge_apy(ByVal ekdosiOk As Boolean, ByVal mauro As Boolean) As Boolean
        Dim j, rows As Int16
        Dim imeres, ypnos, ypnosNeto, prwino, prwinoNeto, geuma, geumaNeto, deipno, deipnoNeto, extra, extraNeto, ypnosFpa, prwinoFpa, geumaFpa, deipnoFpa, extraFpa, timiImeras, dimForos, sinola, sumKratSinola, sumEkptKrat, sumSumFpa As Single
        Dim diarkeia, seira As String
        Dim aaApyParast, kwdNeouTimol As Integer
        Dim exoflithi As Boolean = False
        Dim commitOK As Boolean = False
        Dim arxi, telos As Date

        arxi = "1/1/" + etos.ToString
        telos = "31/12/" + etos.ToString
        diarkeia = ""
        'Me.EkdosiapyimerasTableAdapter.FillByImerominia(Me.DbhotelDataSet.ekdosiapyimeras, imeromErgasias)
        'If Me.DbhotelDataSet.ekdosiapyimeras.Count <> 0 Then
        '    If Me.DbhotelDataSet.ekdosiapyimeras(0).flag = 2 Then
        '        MsgBox("Διαδικασία κλεισίματος Ημέρας απο άλλον χρήστη !" & vbCrLf & "Η Εκδοση Τιμολογίου ακυρώθηκε !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '        Exit Sub
        '    End If
        'End If

        'imeres = timiImeras = ypnos = prwino = geuma = deipno = extra = ypnosFpa = prwinoFpa = geumaFpa = deipnoFpa = extraFpa = 0
        'If MemApyTrPlCbx.SelectedItem = "Μετρητοίς" Then 'edw apokleiw oti to timologio eksofleitai metritois ean exei yparksei prokatabolo i simetoxi
        '    If Me.DbhotelDataSet.kratiseis(0).prokataboli <> 0 OrElse Me.DbhotelDataSet.kratiseis(0).simetoxi <> 0 Then
        '        MsgBox("Δεν είναι δυνατή εξόφληση μετρητοίς με πρακατοβολή ή συμετοχή ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '        Exit Sub
        '    End If
        'End If

        If timolID = 20000 Then
            Randomize()
            ' Generate random value between 1 and 6.
            timolID = -CInt(Int((10000000 * Rnd()) + 1))
        End If

        If kwdApyKrat <> -1 Then
            'MsgBox("TIMES")
            Me.TimeskratisisTableAdapter.FillByKratisi(Me.DbhotelDataSet.timeskratisis, kwdApyKrat)

            'se peroptosi pou exoume perisoteres apo mia toyristikes periodous
            For j = 0 To Me.DbhotelDataSet.timeskratisis.Count - 1

                Me.DbhotelDataSet.ekt_apy_mem.Rows.Add()

                aaKratApy = aaKratApy + 1
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).aa = aaKratApy


                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).dwmatio = apyDwm 'Me.DbhotelDataSet.kratiseis(0).dwmatio
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).enilikes = apyEnil 'Me.DbhotelDataSet.kratiseis(0).enilikes
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).paidia = apyPaid ' Me.DbhotelDataSet.kratiseis(0).anzethnikotites - Me.DbhotelDataSet.kratiseis(0).enilikes
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).atoma = apyEnil + apyPaid 'Me.DbhotelDataSet.kratiseis(0).anzethnikotites
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).voucher = apyVoucher 'Me.DbhotelDataSet.kratiseis(0).voucher
                'If Me.DbhotelDataSet.enilikes.Count <> 0 Then
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).client = apyOnom 'Me.DbhotelDataSet.enilikes(0).onomateponimo
                'End If
                diarkeia = Me.DbhotelDataSet.timeskratisis(j).apo.Date
                diarkeia = diarkeia + "-" + Me.DbhotelDataSet.timeskratisis(j).mexri.Date
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).diarkeia_ekptosi = diarkeia

                If Me.DbhotelDataSet.timeskratisis(j).mexri.Year = Me.DbhotelDataSet.timeskratisis(j).apo.Year Then

                    If j = Me.DbhotelDataSet.timeskratisis.Count - 1 Then
                        imeres = Me.DbhotelDataSet.timeskratisis(j).mexri.DayOfYear - Me.DbhotelDataSet.timeskratisis(j).apo.DayOfYear
                    Else
                        imeres = Me.DbhotelDataSet.timeskratisis(j).mexri.DayOfYear - Me.DbhotelDataSet.timeskratisis(j).apo.DayOfYear + 1
                    End If


                Else
                    imeres = Me.DbhotelDataSet.timeskratisis(j).mexri.Subtract(Me.DbhotelDataSet.timeskratisis(j).apo).Days

                End If

                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).imeres_ekptposost = imeres.ToString("N1")
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).xrewsi = Me.get_xrewsi_by_kwd(Me.DbhotelDataSet.timeskratisis(j).xrewsi)


                'upologizw tis brutto times gia oli tin diarkeia diamonis 
                ypnos = (Me.DbhotelDataSet.timeskratisis(j).ypnos) * imeres
                prwino = (Me.DbhotelDataSet.timeskratisis(j).prwino) * imeres
                geuma = (Me.DbhotelDataSet.timeskratisis(j).geuma) * imeres
                deipno = (Me.DbhotelDataSet.timeskratisis(j).deipno) * imeres
                extra = (Me.DbhotelDataSet.timeskratisis(j).extra) * imeres

                'timiImeras = ypnos + prwino + geuma + deipno + extra 'brutto timi imeras
                timiImeras = Me.DbhotelDataSet.timeskratisis(j).ypnos + Me.DbhotelDataSet.timeskratisis(j).prwino + Me.DbhotelDataSet.timeskratisis(j).geuma + Me.DbhotelDataSet.timeskratisis(j).deipno + Me.DbhotelDataSet.timeskratisis(j).extra
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).preistag = timiImeras.ToString("N")

                'upologizw diadoxika tis netto times gia oli tin diarkeia diamonis
                'kathws kai to fpa autwn->STO DB timologiaanalysis apothikeuontai autes oi (neto kathares times)
                ypnosNeto = (ypnos / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100)))
                'ypnosNeto = (ypnos / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100))).ToString("N")
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos = ypnosNeto.ToString("N")
                ypnosFpa = (ypnosNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100)
                'ypnosFpa = (ypnosNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100).ToString("N")
                sumYpnos = sumYpnos + ypnosNeto

                prwinoNeto = (prwino / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)))
                'prwinoNeto = (prwino / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100))).ToString("N")
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).prwino = prwinoNeto.ToString("N")
                prwinoFpa = (prwinoNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)
                'prwinoFpa = (prwinoNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100).ToString("N")
                sumPrwino = sumPrwino + prwinoNeto

                geumaNeto = (geuma / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)))
                'geumaNeto = (geuma / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100))).ToString("N")
                geumaFpa = (geumaNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)
                'geumaFpa = (geumaNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100).ToString("N")
                sumGeumata = sumGeumata + geumaNeto

                deipnoNeto = (deipno / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)))
                'deipnoNeto = (deipno / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100))).ToString("N")
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).geuma_deipno = (geumaNeto + deipnoNeto).ToString("N")
                deipnoFpa = (deipnoNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)
                'deipnoFpa = (deipnoNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100).ToString("N")
                sumGeumata = sumGeumata + deipnoNeto

                extraNeto = (extra / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100)))
                'extraNeto = (extra / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100))).ToString("N")
                Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).extras = extraNeto.ToString("N")
                extraFpa = (extraNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100)
                'extraFpa = (extraNeto * Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100).ToString("N")

                sumExtra = sumExtra + extraNeto

                sumKratPosa = ypnosNeto + prwinoNeto + geumaNeto + deipnoNeto + extraNeto
                sumKratFpa = ypnosFpa + prwinoFpa + geumaFpa + deipnoFpa + extraFpa

                sinola = sumKratPosa + sumKratFpa 'bruto synolo
                sumKratSinola = sumKratSinola + sinola

                Dim ekptosiOK As Boolean

                If MemApyPosoTbx.Text <> 0 OrElse MemApyPosostoTbx.Text <> 0 OrElse MemApyImerFreeTbx.Text <> 0 OrElse MemApyFeeTbx.Text <> 0 Then
                    ekptosiOK = True
                Else
                    ekptosiOK = False
                End If

                'PROSOXI->STO DB TIMOLOGIOANALYSIS APOTHHKEUONTAI OI NETO TIMES GIA OLI TIHN DAIRKEIA PARAMONIS KATHWS KAI TO FPA (SYNOLO DIAMONIS)
                Me.TimologioanalysisTableAdapter.InsertTimologAnalysis(-1, imeres, ypnosNeto, ypnosFpa, prwinoNeto, prwinoFpa,
                geumaNeto, geumaFpa, deipnoNeto, deipnoFpa, extraNeto, extraFpa, 0, 0, sumKratPosa, sumKratFpa, sinola, Me.DbhotelDataSet.timeskratisis(j).xrewsi, Me.DbhotelDataSet.timeskratisis(j).apo,
                Me.DbhotelDataSet.timeskratisis(j).mexri, timiImeras, MemApyPosoTbx.Text, MemApyPosostoTbx.Text, MemApyImerFreeTbx.Text, MemApyFeeTbx.Text, apyVoucher, kwdApyKrat, ekptosiOK, timolID, aaKratApy, apyOnom)


                If j = Me.DbhotelDataSet.timeskratisis.Count - 1 Then
                    'Me.TimologiokratisiTableAdapter.InsertTimolKratisi(-1, kwdApyKrat)
                    Me.KratiseisTableAdapter.UpdateTimologioByKwdTimologio(2, kwdApyKrat, 0) '[setze status upo ekdosi =2
                End If
                'ΑΑΣΦΑΛΙΣΤΙΚΗ ΔΙΚΛΙΔΑ ΜΠΑΣ ΚΑΙ ΚΕΝΕΝΑΣ ΑΛΛΟΣ USER EXEI TIMOLOGISEI THN KRATISI
                'If rows <> 1 Then
                '    MsgBox("Η Διαδικασία δεν μπορεί να ολοκληρωθεί: Πιθανώς έχει εκδοθει ήδη ΑΠΥ για την Κράτηση", MsgBoxStyle.Critical, "winfo\nikEl.")
                '    Exit Sub
                'End If

                'edw ypologizw ekptoseis!!!!!!!!!!!!!!!!!
                If CType(MemApyPosostoTbx.Text, Single) <> 0 Then
                    Me.DbhotelDataSet.ekt_apy_mem.Rows.Add()
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).diarkeia_ekptosi = "Ποσοστ.Εκπτωσης"
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).imeres_ekptposost = MemApyPosostoTbx.Text
                    If ypnosNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos = (-MemApyPosostoTbx.Text * ypnosNeto / 100).ToString("N")
                        sumYpnos = sumYpnos - (MemApyPosostoTbx.Text * ypnosNeto / 100)
                        sumEkptKrat = sumEkptKrat + MemApyPosostoTbx.Text * ypnos / 100 ' athroisma ekptwsis ANA kratisi->gia enimerwsi kratisis DB ean alakse

                    End If
                    If prwinoNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).prwino = (-MemApyPosostoTbx.Text * prwinoNeto / 100).ToString("N")
                        sumPrwino = sumPrwino - (MemApyPosostoTbx.Text * prwinoNeto / 100)
                        sumEkptKrat = sumEkptKrat + (MemApyPosostoTbx.Text * prwino / 100) ' athroisma ekptwsis ANA kratisi->gia enimerwsi kratisis DB ean alakse
                        'sumPrwino = sumPrwino - (MemApyPosostoTbx.Text * prwinoNeto / 100).ToString("N")
                    End If
                    If geumaNeto <> 0 Or deipno <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).geuma_deipno = (-MemApyPosostoTbx.Text * (geumaNeto + deipnoNeto) / 100).ToString("N")
                        sumGeumata = sumGeumata - (MemApyPosostoTbx.Text * (geumaNeto + deipnoNeto) / 100)
                        sumEkptKrat = sumEkptKrat + (MemApyPosostoTbx.Text * (geuma + deipno) / 100)
                        'sumGeumata = sumGeumata - (MemApyPosostoTbx.Text * (geumaNeto + deipnoNeto) / 100).ToString("N")
                    End If
                    If extraNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).extras = (-MemApyPosostoTbx.Text * extraNeto / 100).ToString("N")
                        sumExtra = sumExtra - (MemApyPosostoTbx.Text * extraNeto / 100)
                        sumEkptKrat = sumEkptKrat + (MemApyPosostoTbx.Text * extra / 100) ' athroisma ekptwsis ANA kratisi->gia enimerwsi kratisis DB ean alakse
                        'sumExtra = sumExtra - (MemApyPosostoTbx.Text * extraNeto / 100).ToString("N")
                    End If

                ElseIf CType(MemApyPosoTbx.Text, Single) <> 0 AndAlso j = Me.DbhotelDataSet.timeskratisis.Count - 1 Then
                    Me.DbhotelDataSet.ekt_apy_mem.Rows.Add()
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).diarkeia_ekptosi = "Εκπτωση σε Ευρω"

                    'If ypnosNeto <> 0 Then
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos = (-MemApyPosoTbx.Text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100))).ToString("N")
                    sumYpnos = sumYpnos - (MemApyPosoTbx.Text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100)))
                    sumEkptKrat = sumEkptKrat + MemApyPosoTbx.Text ' athroisma ekptwsis ANA kratisi->gia enimerwsi kratisis DB ean alakse
                    'sumYpnos = sumYpnos - (MemApyPosoTbx.Text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100))).ToString("N")
                    'End If
                ElseIf CType(MemApyImerFreeTbx.Text, Single) <> 0 AndAlso j = Me.DbhotelDataSet.timeskratisis.Count - 1 Then
                    Dim d As Single
                    d = MemApyImerFreeTbx.Text
                    Me.DbhotelDataSet.ekt_apy_mem.Rows.Add()
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).diarkeia_ekptosi = "Ημερες Free"
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).imeres_ekptposost = d.ToString("N")
                    If ypnosNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos = (-ypnosNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                        sumYpnos = sumYpnos - (ypnosNeto / imeres * MemApyImerFreeTbx.Text)
                        sumEkptKrat = sumEkptKrat + (ypnos / imeres * MemApyImerFreeTbx.Text) ' athroisma ekptwsis ANA kratisi->gia enimerwsi kratisis DB ean alakse
                        'sumYpnos = sumYpnos - (ypnosNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                    End If
                    If prwinoNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).prwino = (-prwinoNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                        sumPrwino = sumPrwino - (prwinoNeto / imeres * MemApyImerFreeTbx.Text)
                        sumEkptKrat = sumEkptKrat + (prwino / imeres * MemApyImerFreeTbx.Text)

                        'sumPrwino = sumPrwino - (prwinoNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                    End If
                    If geumaNeto <> 0 Or deipnoNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).geuma_deipno = (-(geumaNeto + deipnoNeto) / imeres * MemApyImerFreeTbx.Text).ToString("N")
                        sumGeumata = sumGeumata - ((geumaNeto + deipnoNeto) / imeres * MemApyImerFreeTbx.Text)
                        sumEkptKrat = sumEkptKrat + ((geuma + deipno) / imeres * MemApyImerFreeTbx.Text)
                        'sumGeumata = sumGeumata - ((geumaNeto + deipnoNeto) / imeres * MemApyImerFreeTbx.Text).ToString("N")
                    End If
                    If extraNeto <> 0 Then
                        Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).extras = (-extraNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                        sumExtra = sumExtra - (extraNeto / imeres * MemApyImerFreeTbx.Text)
                        sumEkptKrat = sumEkptKrat + (extra / imeres * MemApyImerFreeTbx.Text)
                        'sumExtra = sumExtra - (extraNeto / imeres * MemApyImerFreeTbx.Text).ToString("N")
                    End If
                ElseIf CType(MemApyFeeTbx.Text, Single) <> 0 AndAlso j = Me.DbhotelDataSet.timeskratisis.Count - 1 Then
                    Me.DbhotelDataSet.ekt_apy_mem.Rows.Add()
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).diarkeia_ekptosi = "Cancelation Fee"
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).imeres_ekptposost = MemApyFeeTbx.Text
                    'If ypnosNeto <> 0 Then
                    Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos = (MemApyFeeTbx.Text * timiImeras / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100))).ToString("N")

                    sumYpnos = sumYpnos + Me.DbhotelDataSet.ekt_apy_mem(Me.DbhotelDataSet.ekt_apy_mem.Count - 1).ypnos
                    sumEkptKrat = sumEkptKrat - MemApyFeeTbx.Text * timiImeras
                    'End If
                End If

                sumSumPosa = sumYpnos + sumPrwino + sumGeumata + sumExtra  'athroisma (se periptosi synexeia ektiposis) twn katharwn poswn

            Next

            'epeleksa na ypologizw to fpa pou fainetai sto timologio sto telos wste na min yparxei apoklisi sto timologio pano
            'otan upologizw ta epi tois ekato tou fpa apo tis neto SUM times

            sumYpnosFpa = (sumYpnos * (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100)) '.ToString("N")
            sumPrwinoFpa = (sumPrwino * (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)) '.ToString("N")
            sumGeumataFpa = (sumGeumata * (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100)) '.ToString("N")
            sumExtraFpa = (sumExtra * (Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100)) '.ToString("N")


            'tsekarw ean mpikan ;h alaksan oi ekptwseis->enimerwsi tis Kratiseis Table evtl me NEES times ekptwsewn->aara kai nea synola (to synolo 
            'stis kratiseis SIMPERILAMBANEI kai thn ekptosi!
            If posostoTemp <> MemApyPosostoTbx.Text OrElse posoTemp <> MemApyPosoTbx.Text OrElse freeTemp <> MemApyImerFreeTbx.Text OrElse cfeeTemp <> MemApyFeeTbx.Text Then
                If MemApyPosostoTbx.Text = 0 AndAlso MemApyPosoTbx.Text = 0 AndAlso MemApyImerFreeTbx.Text = 0 AndAlso MemApyFeeTbx.Text = 0 Then
                    ekptosiKratOK = False
                Else
                    ekptosiKratOK = True
                End If
                'enimerwsi kratisews Table me tis nees ekptwseis kai to neo synolo (me tis ekptoseis)
                Me.KratiseisTableAdapter.UpdateEkptoseisByKwd(MemApyImerFreeTbx.Text, ekptosiKratOK, MemApyPosoTbx.Text, MemApyPosostoTbx.Text, MemApyFeeTbx.Text, (sumKratSinola - sumEkptKrat), kwdApyKrat)
                ' alaksan oi ekptwseis ;h nea ekptosi ->sumsynola parakoloutha to synolo twn kratisewn simperilambanomenis tis ekptosis
                sumSynola = sumSynola + (sumKratSinola - sumEkptKrat)
            Else ' den alaksan oi ekptwseis ->sinathroizw loipon ton sinliko poso tis kratisis (apo to synola stis kratiseis table) gia na min exw apoklisi sto Timologio 
                sumSynola = sumSynola + timPoso
            End If

        End If


        If ekdosiOk AndAlso Me.DbhotelDataSet.ekt_apy_mem.Count <> 0 Then
            Me.DbhotelDataSet.ekt_apy_sumkathposa.Rows.Add()
            Me.DbhotelDataSet.ekt_apy_sumkathposa(0).sum_kath_posa = sumSumPosa.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumkathposa(0).ypnos = sumYpnos.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumkathposa(0).prwino = sumPrwino.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumkathposa(0).geumata = sumGeumata.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumkathposa(0).extras = sumExtra.ToString("N")

            Me.DbhotelDataSet.ekt_apy_sumfpa.Rows.Add()


            Me.DbhotelDataSet.ekt_apy_sumfpa(0).ypnos = sumYpnosFpa.ToString("N")

            Me.DbhotelDataSet.ekt_apy_sumfpa(0).prwino = sumPrwinoFpa.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumfpa(0).geumata = sumGeumataFpa.ToString("N")
            Me.DbhotelDataSet.ekt_apy_sumfpa(0).extras = sumExtraFpa.ToString("N")

            'edw ekana DIORTHOSI _>ipirxe apoklisi anamesa to synolo tis kratisis kai to geniko sinolo tis APY->
            'ypologizw ta sum kathara posa alla to sumfpa to bgazw meta apo aferesi->sumsumfpa=suynola(apo kratiseis)- sumkathposa

            ''sumSumFpa = sumSumFpa + Me.DbhotelDataSet.ekt_apy_sumfpa(0).ypnos + Me.DbhotelDataSet.ekt_apy_sumfpa(0).prwino + Me.DbhotelDataSet.ekt_apy_sumfpa(0).geumata + Me.DbhotelDataSet.ekt_apy_sumfpa(0).extras


            Me.DbhotelDataSet.ekt_apy_diafora.Rows.Add()
            'MemApyLogarLbl.Text
            Me.ApyTableAdapter.FillByKwdiko(Me.DbhotelDataSet.apy, kwdApyApy)

            If TimologioChk.Checked Then
                Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΤΙΜΟΛΟΓΙΟ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
            Else
                Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΑΠΟΔΕΙΞΗ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
            End If

            Me.PraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.praktoreia, kwdApyPrakt)
            Dim city As String
            Dim postalCode As String
            If Me.DbhotelDataSet.apy.Count <> 0 Then
                Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.apy(0).eponimia
                If Me.DbhotelDataSet.praktoreia(0).individual AndAlso Me.DbhotelDataSet.praktoreia(0).kwd <> 1 Then
                    Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia = Me.DbhotelDataSet.apy(0).eponimia + " (via agency: " + Me.DbhotelDataSet.praktoreia(0).titlostimolog + ")"
                Else
                    Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia = Me.DbhotelDataSet.apy(0).eponimia
                End If
                Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.apy(0).dieuthinsi
                Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.apy(0).afm
                Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.apy(0).doy
                Try
                    city = Me.DbhotelDataSet.apy(0).city

                Catch ex As System.Data.StrongTypingException
                    city = ""

                End Try
                Try

                    postalCode = Me.DbhotelDataSet.apy(0).postalcode
                Catch ex As System.Data.StrongTypingException

                    postalCode = ""
                End Try
            Else

                Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.praktoreia(0).eponimia
                Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia = Me.DbhotelDataSet.praktoreia(0).titlostimolog
                Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.praktoreia(0).dieuthinsi
                Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.praktoreia(0).afm
                Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.praktoreia(0).doy


                Try
                    city = Me.DbhotelDataSet.praktoreia(0).fax

                Catch ex As System.Data.StrongTypingException
                    city = ""

                End Try
                Try

                    postalCode = Me.DbhotelDataSet.praktoreia(0).mpournouzia
                Catch ex As System.Data.StrongTypingException

                    postalCode = ""
                End Try
            End If
            Me.DbhotelDataSet.ekt_apy_diafora(0)._date = imeromErgasias
            'DOMISI ->64 bit english peta lathos
            Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros = (sumYpnos - sumYpnos / (1 + Me.DbhotelDataSet.etaireia(0).dimforos1 / 100)).ToString("N")
            'If simetKrat <> 0 Then
            '    Me.DbhotelDataSet.ekt_apy_diafora(0).simetoxi = simetKrat.ToString("N")
            'Else
            '    Me.DbhotelDataSet.ekt_apy_diafora(0).simetoxi = -1
            'End If
            Me.DbhotelDataSet.ekt_apy_diafora(0).simetoxi = -1
            If prokatKrat <> 0 Then
                Me.DbhotelDataSet.ekt_apy_diafora(0).prokataboli = prokatKrat.ToString("N")
            Else
                Me.DbhotelDataSet.ekt_apy_diafora(0).prokataboli = -1
            End If

            Me.DbhotelDataSet.ekt_apy_diafora(0).geniko_synolo = sumSynola.ToString("N")
            'edw ekana DIORTHOSI _>ipirxe apoklisi anamesa to synolo tis kratisis kai to geniko sinolo tis APY->
            'ypologizw ta sum kathara posa alla to sumfpa to bgazw meta apo aferesi->sumsumfpa=suynola(apo kratiseis)- sumkathposa
            sumSumFpa = (Me.DbhotelDataSet.ekt_apy_diafora(0).geniko_synolo - Me.DbhotelDataSet.ekt_apy_sumkathposa(0).sum_kath_posa).ToString("N")

            'If Math.Abs(sumSumFpa - (sumYpnosFpa + sumPrwinoFpa + sumGeumataFpa + sumExtraFpa)) > 0.1 Then
            '    MsgBox("FEHLER")
            'End If
            If (MemApyTrPlCbx.SelectedItem) = Nothing Then
                Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = "Επί Πιστώση"
            Else
                Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = MemApyTrPlCbx.SelectedItem
            End If

            If Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis.Equals("Επί Πιστώση") Then
                exoflithi = False
            Else
                exoflithi = True
            End If
            Me.DbhotelDataSet.ekt_apy_sumfpa(0).sum_fpa = sumSumFpa.ToString("N")
            If (prokatKrat <> 0 Or simetKrat <> 0) AndAlso Not exoflithi Then
                Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = (sumSynola - simetKrat - prokatKrat).ToString("N")
            Else
                Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = -1
            End If


            '  Using connection As New OleDb.OleDbConnection(connectionString)
            '      Dim counter As Int16
            '      Dim pliromi As String = ""
            '      Dim command As New OleDb.OleDbCommand()
            '      Dim transaction As OleDb.OleDbTransaction = Nothing
            '      Try
            '          connection.Open()
            '          transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

            '          ' Assign transaction object for a pending local transaction.
            '          command.Connection = connection
            '          command.Transaction = transaction

            '          'EDW ALLAGH LOGW TIMOLOGIWN APY!!!!!!!!!!!!!!!!!!!!!!
            '          'command.Parameters.AddWithValue("kwd", CType(Me.DbhotelDataSet.etaireia(0).aaapy, Integer))
            '          command.Parameters.AddWithValue("kwd", kwdApyParast)
            '          command.CommandText = "SELECT * FROM parastatika WHERE (kwd=?)" 'and (identifikation=?)
            '          Dim myReader As OleDb.OleDbDataReader
            '          myReader = command.ExecuteReader()
            '          ' Always call Read before accessing data.
            '          myReader.Read()
            '          aaApyParast = CType(myReader.Item("aritthmos"), Integer)
            '          Try
            '              seira = myReader.Item("seira")
            '          Catch ex As InvalidCastException
            '              seira = ""
            '          End Try

            '          ' always call Close when done reading.
            '          myReader.Close()
            '          command.Parameters.Clear()

            '          aaApyParast += 1

            '          'gia MyDATA domisi me tis poles etaireies
            '          command.Parameters.AddWithValue("kwd", kwdApyParast)
            '          command.CommandText = "SELECT afm.afm, afm.epixirisi, parastatika.tipos, afm.kwd FROM afm INNER JOIN parastatika ON afm.kwd=parastatika.etaireia WHERE (parastatika.kwd=?)" 'and (identifikation=?)

            '          myReader = command.ExecuteReader()
            '          ' Always call Read before accessing data.
            '          myReader.Read()
            '          Dim afmDomisi, epixirisiDomisi, tiposparDomisi, aadeUserId, apiKey, postalCodeEkd, cityEkd, branchEkd, countryEkd As String
            '          Dim afmKwd As Int32
            '          Try
            '              afmDomisi = myReader.Item(0)
            '              afmKwd = myReader.Item(3)
            '          Catch ex As InvalidCastException
            '              afmDomisi = ""
            '          End Try
            '          Try
            '              epixirisiDomisi = myReader.Item(1)
            '              tiposparDomisi = myReader.Item(2)
            '          Catch ex As InvalidCastException
            '              epixirisiDomisi = ""
            '              tiposparDomisi = ""
            '          End Try
            '          myReader.Close()
            '          command.Parameters.Clear()
            '          command.Parameters.AddWithValue("kwd", afmKwd)
            '          command.CommandText = "SELECT  mydata.aadeUserId, mydata.apiKey,branch,postalCode,city, country FROM afm  INNER JOIN mydata ON afm.kwd=mydata.afm WHERE (afm.kwd=?)"
            '          myReader = command.ExecuteReader()
            '          ' Always call Read before accessing data.
            '          myReader.Read()

            '          Try
            '              aadeUserId = myReader.Item(0)
            '              apiKey = myReader.Item(1)
            '              branchEkd = myReader.Item(2)
            '              postalCodeEkd = myReader.Item(3)
            '              cityEkd = myReader.Item(4)
            '              countryEkd = myReader.Item(5)
            '          Catch ex As Exception
            '              MsgBox("Cannot find myDATA credentilas!", MsgBoxStyle.Critical)
            '          End Try
            '          ' always call Close when done reading.
            '          myReader.Close()
            '          command.Parameters.Clear()
            '          'EDW ALLAGH LOGW TIMOLOGIWN APY!!!!!!!!!!!!!!!!!!!!!!
            '          'command.Parameters.AddWithValue("parastatiko", CType(Me.DbhotelDataSet.etaireia(0).aaapy, Integer))

            '          command.Parameters.AddWithValue("parastatiko", kwdApyParast)
            '          command.Parameters.AddWithValue("imerominia", imeromErgasias)
            '          command.Parameters.AddWithValue("seira", seira) ' anaxwrisi
            '          command.Parameters.AddWithValue("aa", aaApyParast)
            '          command.Parameters.AddWithValue("praktoreio", kwdApyPrakt)
            '          command.Parameters.AddWithValue("simbolaio", simbKrat) 'Me.DbhotelDataSet.kratiseis(0).dwmatio
            '          command.Parameters.AddWithValue("eponimia", Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia) 'Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia
            '          command.Parameters.AddWithValue("dieuthinsi", Me.DbhotelDataSet.ekt_apy_diafora(0).address)
            '          command.Parameters.AddWithValue("afm", Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt)
            '          command.Parameters.AddWithValue("doy", Me.DbhotelDataSet.ekt_apy_diafora(0).doy)
            '          command.Parameters.AddWithValue("sumkathposa", sumSumPosa)
            '          command.Parameters.AddWithValue("fpa", sumSumFpa)
            '          command.Parameters.AddWithValue("synola", sumSynola)
            '          command.Parameters.AddWithValue("prokataboli", prokatKrat)
            '          command.Parameters.AddWithValue("simetoxi", simetKrat)
            '          If Not exoflithi Then
            '              command.Parameters.AddWithValue("ypoloipon", Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon)
            '          Else
            '              command.Parameters.AddWithValue("ypoloipon", -1)
            '          End If

            '          If (MemApyTrPlCbx.SelectedItem) = Nothing Then
            '              pliromi = "Επί Πιστώση"
            '          Else
            '              pliromi = MemApyTrPlCbx.SelectedItem
            '          End If
            '          command.Parameters.AddWithValue("pliromi", pliromi)
            '          command.Parameters.AddWithValue("dimforos", Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros)

            '          command.Parameters.AddWithValue("exoflithi", exoflithi)

            '          command.Parameters.AddWithValue("mauro", mauro)
            '          command.Parameters.AddWithValue("identifikation", timolID)
            '          command.CommandText = "INSERT INTO timologia (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi," &
            '          "afm, doy, sumkathposa, fpa,  synola, prokataboli, simetoxi, ypoloipon, pliromi, dimforos, exoflithi, akyromeno, extra, memonomeno, mauro,identifikation) " &
            '          "VALUES (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi, afm, doy, sumkathposa, fpa,  synola, prokataboli, simetoxi, ypoloipon," &
            '          "pliromi, dimforos, exoflithi, false, false, true, mauro, identifikation)"
            '          command.ExecuteNonQuery()
            '          command.Parameters.Clear()


            '          command.Parameters.AddWithValue("parastatiko", kwdApyParast)
            '          command.Parameters.AddWithValue("imerominia", imeromErgasias)
            '          command.Parameters.AddWithValue("aa", aaApyParast)
            '          'command.Parameters.AddWithValue("identifikation", timolID)
            '          command.CommandText = "SELECT kwd FROM timologia where (parastatiko=?) and (imerominia=?) and (aa=?) and (akyromeno=false)" 'and (identifikation=?)

            '          myReader = command.ExecuteReader()
            '          ' Always call Read before accessing data.
            '          While myReader.Read()
            '              kwdNeouTimol = myReader.GetInt32(0)
            '              counter += 1
            '          End While
            '          ' always call Close when done reading.
            '          myReader.Close()
            '          command.Parameters.Clear()
            '          If counter <> 1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
            '              transaction.Rollback()
            '              rollback_timanalysis_transaction(connectionString)
            '              MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
            '              Return False
            '          End If



            '          command.Parameters.AddWithValue("timologio", kwdNeouTimol)
            '          command.Parameters.AddWithValue("identifikation", timolID)
            '          command.CommandText = "UPDATE timologioanalysis SET timologio=? WHERE (timologio=-1) and (identifikation=?)"
            '          command.ExecuteNonQuery()
            '          command.Parameters.Clear()


            '          For j = 0 To kwdProsEkd.Length - 1
            '              command.Parameters.AddWithValue("apy", aaApyParast)
            '              command.Parameters.AddWithValue("parastatiko", kwdApyParast)
            '              command.Parameters.AddWithValue("kwd", kwdProsEkd(j))
            '              command.CommandText = "UPDATE kratiseis SET timologio=1, apy=?, parastatiko=? where (kwd=?) and (timologio=2)"
            '              rows = command.ExecuteNonQuery()
            '              command.Parameters.Clear()
            '              If rows <> 1 Then
            '                  transaction.Rollback()
            '                  rollback_timanalysis_transaction(connectionString)
            '                  MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε: Πιθανώς έχει ήδη εκδοθεί Τιμολόγιο για την Κράτηση !", MsgBoxStyle.Critical, "winfo\nikEl.")
            '                  Return False
            '              End If


            '          Next

            '          command.Parameters.AddWithValue("aritthmos", aaApyParast)

            '          command.Parameters.AddWithValue("parastatiko", kwdApyParast)
            '          command.CommandText = "UPDATE parastatika SET aritthmos=? WHERE (kwd=?)"
            '          command.ExecuteNonQuery()
            '          command.Parameters.Clear()


            '          '  transaction.Commit()
            '          Dim tipos As String = "ΤΠΥ"
            '          Dim response, response1 As MsgBoxResult
            '          response = MsgBox("Ενημέρωση myData ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            '          If response = MsgBoxResult.Yes Then

            '              If (kwdApyParast = 5) Or (kwdApyParast = 10) Or (kwdApyParast = 14) Or (kwdApyParast = 18) Or (kwdApyParast = 22) Or (kwdApyParast = 26) Or (kwdApyParast = 30) Then
            '                  Dim AfmPrf As New afm_pruefung
            '                  If AfmPrf.ist_afm_ok(Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt) Then
            '                      tipos = "2.1"
            '                      'tipos = "ΤΠΥ"
            '                  Else
            '                      response1 = MsgBox("Εiσται σιγουροι για το ΑΦΜ (800...); Αποστολή ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            '                      If response1 = MsgBoxResult.Yes Then
            '                          tipos = "2.1"
            '                      Else
            '                          MsgBox("Η Διαδικασία έκδοσης της ΤΠΥ διεκόπηκε: ΑΦΜ παραλήπτη  !", MsgBoxStyle.Critical, "winfo\nikEl.")
            '                          Try
            '                              transaction.Rollback()
            '                              rollback_timanalysis_transaction(connectionString)
            '                              Return False
            '                          Catch
            '                              Return False
            '                          End Try
            '                      End If



            '                  End If



            '              ElseIf (kwdApyParast = 6) Or (kwdApyParast = 11) Or (kwdApyParast = 15) Or (kwdApyParast = 19) Or (kwdApyParast = 23) Or (kwdApyParast = 27) Or (kwdApyParast = 31) Then
            '                  tipos = "11.2"
            '                  'tipos = "ΑΠΥ"


            '              End If

            '              Dim sendInvoice = New SendInvoices(connectionString, aadeUserId, apiKey, epixirisiDomisi, tiposparDomisi, kwdNeouTimol, tipos, afmDomisi, countryEkd, branchEkd, postalCodeEkd, cityEkd, Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt, MemApyCountries.SelectedItem, MemApyBranch.Text, apyOnom, Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia, postalCode, city, seira,
            '                                 aaApyParast, imeromErgasias, pliromi, Nothing, Math.Round(sumSynola, 2), Math.Round(sumYpnos, 2), Math.Round(sumPrwino, 2), Math.Round(sumGeumata, 2), Math.Round(sumExtra, 2), Me.DbhotelDataSet.etaireia(0).fpatrofis1,
            'Me.DbhotelDataSet.etaireia(0).fpatrofis2, Me.DbhotelDataSet.etaireia(0).fpatrofis3, Me.DbhotelDataSet.etaireia(0).fpatrofis3) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
            '              Dim threadSendInvoice As Threading.Thread
            '              threadSendInvoice = sendInvoice.set_mode(0)
            '              threadSendInvoice = sendInvoice.send_invoice()
            '          End If

            '          transaction.Commit()

            '      Catch ex As Exception
            '          MsgBox(ex.Message)
            '          MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
            '          Try
            '              transaction.Rollback()
            '              rollback_timanalysis_transaction(connectionString)
            '              Return False
            '          Catch
            '              Return False
            '          End Try
            '      End Try


            '  End Using

            Using connection As New System.Data.SqlClient.SqlConnection(connectionString)
                Dim counter As Int16
                Dim pliromi As String = ""
                Dim command As New System.Data.SqlClient.SqlCommand()
                Dim transaction As System.Data.SqlClient.SqlTransaction = Nothing
                Try
                    connection.Open()
                    transaction = connection.BeginTransaction(System.Data.IsolationLevel.ReadCommitted)

                    ' Assign transaction object for a pending local transaction.
                    command.Connection = connection
                    command.Transaction = transaction

                    'EDW ALLAGH LOGW TIMOLOGIWN APY!!!!!!!!!!!!!!!!!!!!!!
                    'command.Parameters.AddWithValue("kwd", CType(Me.DbhotelDataSet.etaireia(0).aaapy, Integer))
                    command.Parameters.AddWithValue("kwd", kwdApyParast)
                    command.CommandText = "SELECT * FROM parastatika WHERE (kwd=@kwd)" 'and (identifikation=@identifikation)
                    Dim myReader As System.Data.SqlClient.SqlDataReader
                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    myReader.Read()
                    aaApyParast = CType(myReader.Item("aritthmos"), Integer)
                    Try
                        seira = myReader.Item("seira")
                    Catch ex As InvalidCastException
                        seira = ""
                    End Try

                    ' always call Close when done reading.
                    myReader.Close()
                    command.Parameters.Clear()

                    aaApyParast += 1

                    'gia MyDATA domisi me tis poles etaireies
                    command.Parameters.AddWithValue("kwd", kwdApyParast)
                    command.CommandText = "SELECT afm.afm, afm.epixirisi, parastatika.tipos, afm.kwd FROM afm INNER JOIN parastatika ON afm.kwd=parastatika.etaireia WHERE (parastatika.kwd=@kwd)" 'and (identifikation=@identifikation)

                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    myReader.Read()
                    Dim afmDomisi, epixirisiDomisi, tiposparDomisi, apiKey, postalCodeEkd, cityEkd, branchEkd, countryEkd, qrUrl As String
                    Dim aadeUserId As String = String.Empty
                    Dim afmKwd As Int32
                    Try
                        afmDomisi = myReader.Item(0)
                        afmKwd = myReader.Item(3)
                    Catch ex As InvalidCastException
                        afmDomisi = ""
                    End Try
                    Try
                        epixirisiDomisi = myReader.Item(1)
                        tiposparDomisi = myReader.Item(2)
                    Catch ex As InvalidCastException
                        epixirisiDomisi = ""
                        tiposparDomisi = ""
                    End Try
                    myReader.Close()
                    command.Parameters.Clear()
                    command.Parameters.AddWithValue("kwd", afmKwd)
                    command.CommandText = "SELECT mydata.aadeUserId, mydata.apiKey, branch, postalCode, city, country FROM afm INNER JOIN mydata ON afm.kwd=mydata.afm WHERE (afm.kwd=@kwd)"
                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    If myReader.HasRows AndAlso myReader.Read() Then
                        Try
                            aadeUserId = myReader.Item(0)
                            apiKey = myReader.Item(1)
                            branchEkd = myReader.Item(2)
                            postalCodeEkd = myReader.Item(3)
                            cityEkd = myReader.Item(4)
                            countryEkd = myReader.Item(5)
                        Catch ex As InvalidCastException
                            MsgBox("Cannot find myDATA credentilas!", MsgBoxStyle.Critical)
                        End Try
                    End If



                    myReader.Close()
                    command.Parameters.Clear()

                    'command.Parameters.AddWithValue("parastatiko", kwdApyParast)
                    'command.Parameters.AddWithValue("imerominia", imeromErgasias)
                    'command.Parameters.AddWithValue("seira", seira)
                    'command.Parameters.AddWithValue("aa", aaApyParast)
                    'command.Parameters.AddWithValue("praktoreio", kwdApyPrakt)
                    'command.Parameters.AddWithValue("simbolaio", simbKrat)
                    'command.Parameters.AddWithValue("eponimia", Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia)
                    'command.Parameters.AddWithValue("dieuthinsi", Me.DbhotelDataSet.ekt_apy_diafora(0).address)
                    'command.Parameters.AddWithValue("afm", Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt)
                    'command.Parameters.AddWithValue("doy", Me.DbhotelDataSet.ekt_apy_diafora(0).doy)
                    'command.Parameters.AddWithValue("sumkathposa", sumSumPosa)
                    'command.Parameters.AddWithValue("fpa", sumSumFpa)
                    'command.Parameters.AddWithValue("synola", sumSynola)
                    'command.Parameters.AddWithValue("prokataboli", prokatKrat)
                    'command.Parameters.AddWithValue("simetoxi", simetKrat)

                    'If Not exoflithi Then
                    '    command.Parameters.AddWithValue("ypoloipon", Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon)
                    'Else
                    '    command.Parameters.AddWithValue("ypoloipon", -1)
                    'End If

                    'pliromi = If(MemApyTrPlCbx.SelectedItem Is Nothing, "Επί Πιστώση", MemApyTrPlCbx.SelectedItem)

                    'command.Parameters.AddWithValue("pliromi", pliromi)
                    'command.Parameters.AddWithValue("dimforos", Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros)
                    'command.Parameters.AddWithValue("exoflithi", exoflithi)
                    'command.Parameters.AddWithValue("mauro", mauro)
                    'command.Parameters.AddWithValue("identifikation", timolID)

                    'command.CommandText = "INSERT INTO timologia (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi, afm, doy, sumkathposa, fpa, synola, prokataboli, simetoxi, ypoloipon, pliromi, dimforos, exoflithi, akyromeno, extra, memonomeno, mauro, identifikation) " &
                    '  "VALUES (@parastatiko, @imerominia, @seira, @aa, @praktoreio, @simbolaio, @eponimia, @dieuthinsi, @afm, @doy, @sumkathposa, @fpa, @synola, @prokataboli, @simetoxi, @ypoloipon, @pliromi, @dimforos, @exoflithi, 0, 0, 1, @mauro, @identifikation)"
                    'command.ExecuteNonQuery()

                    'command.Parameters.Clear()
                    command.Parameters.Add("@parastatiko", SqlDbType.Int).Value = kwdApyParast
                    command.Parameters.Add("@imerominia", SqlDbType.DateTime2).Value = imeromErgasias
                    command.Parameters.Add("@seira", SqlDbType.NVarChar, 20).Value = seira
                    command.Parameters.Add("@aa", SqlDbType.SmallInt).Value = aaApyParast
                    command.Parameters.Add("@praktoreio", SqlDbType.Int).Value = kwdApyPrakt
                    command.Parameters.Add("@simbolaio", SqlDbType.Int).Value = simbKrat
                    command.Parameters.Add("@eponimia", SqlDbType.NVarChar, 50).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia
                    command.Parameters.Add("@dieuthinsi", SqlDbType.NVarChar, 50).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).address
                    command.Parameters.Add("@afm", SqlDbType.NVarChar, 50).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt
                    command.Parameters.Add("@doy", SqlDbType.NVarChar, 50).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).doy
                    command.Parameters.Add("@sumkathposa", SqlDbType.Real).Value = sumSumPosa
                    command.Parameters.Add("@fpa", SqlDbType.Real).Value = sumSumFpa
                    command.Parameters.Add("@synola", SqlDbType.Real).Value = sumSynola
                    command.Parameters.Add("@prokataboli", SqlDbType.Real).Value = prokatKrat
                    command.Parameters.Add("@simetoxi", SqlDbType.Real).Value = simetKrat

                    If Not exoflithi Then
                        command.Parameters.Add("@ypoloipon", SqlDbType.Real).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon
                    Else
                        command.Parameters.Add("@ypoloipon", SqlDbType.Real).Value = -1
                    End If

                    pliromi = If(MemApyTrPlCbx.SelectedItem Is Nothing, "Επί Πιστώση", MemApyTrPlCbx.SelectedItem)

                    command.Parameters.Add("@pliromi", SqlDbType.NVarChar, 50).Value = pliromi
                    command.Parameters.Add("@dimforos", SqlDbType.Real).Value = Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
                    command.Parameters.Add("@exoflithi", SqlDbType.Bit).Value = exoflithi
                    command.Parameters.Add("@mauro", SqlDbType.Bit).Value = mauro
                    command.Parameters.Add("@identifikation", SqlDbType.Int).Value = timolID

                    command.CommandText = "INSERT INTO timologia (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi, afm, doy, sumkathposa, fpa, synola, prokataboli, simetoxi, ypoloipon, pliromi, dimforos, exoflithi, akyromeno, extra, memonomeno, mauro, identifikation) " &
                          "VALUES (@parastatiko, @imerominia, @seira, @aa, @praktoreio, @simbolaio, @eponimia, @dieuthinsi, @afm, @doy, @sumkathposa, @fpa, @synola, @prokataboli, @simetoxi, @ypoloipon, @pliromi, @dimforos, @exoflithi, 0, 0, 1, @mauro, @identifikation)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                    command.Parameters.AddWithValue("parastatiko", kwdApyParast)
                    command.Parameters.AddWithValue("imerominia", imeromErgasias)
                    command.Parameters.AddWithValue("aa", aaApyParast)
                    'command.Parameters.AddWithValue("identifikation", timolID)

                    command.CommandText = "SELECT kwd FROM timologia WHERE (parastatiko = @parastatiko) AND (imerominia = @imerominia) AND (aa = @aa) AND (akyromeno = 0)" 'and (identifikation=?)

                    myReader = command.ExecuteReader()

                    ' Always call Read before accessing data.
                    While myReader.Read()
                        kwdNeouTimol = myReader.GetInt32(0)
                        counter += 1
                    End While

                    ' Always call Close when done reading.
                    myReader.Close()
                    command.Parameters.Clear()
                    If counter <> 1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
                        transaction.Rollback()
                        rollback_timanalysis_transaction(connectionString)
                        MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If

                    command.Parameters.AddWithValue("timologio", kwdNeouTimol)
                    command.Parameters.AddWithValue("identifikation", timolID)
                    command.CommandText = "UPDATE timologioanalysis SET timologio = @timologio WHERE (timologio = -1) AND (identifikation = @identifikation)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                    For j = 0 To kwdProsEkd.Length - 1
                        command.Parameters.AddWithValue("apy", aaApyParast)
                        command.Parameters.AddWithValue("parastatiko", kwdApyParast)
                        command.Parameters.AddWithValue("kwd", kwdProsEkd(j))
                        command.CommandText = "UPDATE kratiseis SET timologio = 1, apy = @apy, parastatiko = @parastatiko WHERE (kwd = @kwd) AND (timologio = 2)"
                        rows = command.ExecuteNonQuery()
                        command.Parameters.Clear()
                        If rows <> 1 Then
                            transaction.Rollback()
                            rollback_timanalysis_transaction(connectionString)
                            MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε: Πιθανώς έχει ήδη εκδοθεί Τιμολόγιο για την Κράτηση!", MsgBoxStyle.Critical, "winfo\nikEl.")
                            Return False
                        End If
                    Next

                    command.Parameters.AddWithValue("aritthmos", aaApyParast)
                    command.Parameters.AddWithValue("parastatiko", kwdApyParast)
                    command.CommandText = "UPDATE parastatika SET aritthmos = @aritthmos WHERE (kwd = @parastatiko)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                    '  transaction.Commit()
                    Dim tipos As String = "ΤΠΥ"
                    Dim response, response1 As MsgBoxResult

                    If Not String.IsNullOrEmpty(aadeUserId) Then
                        response = MsgBox("Ενημέρωση myData ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                        If response = MsgBoxResult.Yes Then

                            If (kwdApyParast = 5) Or (kwdApyParast = 10) Or (kwdApyParast = 14) Or (kwdApyParast = 18) Or (kwdApyParast = 22) Or (kwdApyParast = 26) Or (kwdApyParast = 30) Or (kwdApyParast = 370951998) Then
                                Dim AfmPrf As New afm_pruefung
                                If AfmPrf.ist_afm_ok(Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt) Then
                                    tipos = "2.1"
                                    'tipos = "ΤΠΥ"
                                Else
                                    response1 = MsgBox("Εiσται σιγουροι για το ΑΦΜ (800...); Αποστολή ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                    If response1 = MsgBoxResult.Yes Then
                                        tipos = "2.1"
                                    Else
                                        MsgBox("Η Διαδικασία έκδοσης της ΤΠΥ διεκόπηκε: ΑΦΜ παραλήπτη  !", MsgBoxStyle.Critical, "winfo\nikEl.")
                                        Try
                                            transaction.Rollback()
                                            rollback_timanalysis_transaction(connectionString)
                                            Return False
                                        Catch
                                            Return False
                                        End Try
                                    End If



                                End If



                            ElseIf (kwdApyParast = 6) Or (kwdApyParast = 11) Or (kwdApyParast = 15) Or (kwdApyParast = 19) Or (kwdApyParast = 23) Or (kwdApyParast = 27) Or (kwdApyParast = 31) Or (kwdApyParast = 1733806379) Then
                                tipos = "11.2"
                                'tipos = "ΑΠΥ"


                            End If

                            Dim sendInvoice = New SendInvoices(connectionString, aadeUserId, apiKey, epixirisiDomisi, tiposparDomisi, kwdNeouTimol, tipos, afmDomisi, countryEkd, branchEkd, postalCodeEkd, cityEkd, Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt, MemApyCountries.SelectedItem, MemApyBranch.Text, apyOnom, Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia, postalCode, city, seira,
                                               aaApyParast, imeromErgasias, pliromi, Nothing, Math.Round(sumSynola, 2), Math.Round(sumYpnos, 2), Math.Round(sumPrwino, 2), Math.Round(sumGeumata, 2), Math.Round(sumExtra, 2), Me.DbhotelDataSet.etaireia(0).fpatrofis1,
              Me.DbhotelDataSet.etaireia(0).fpatrofis2, Me.DbhotelDataSet.etaireia(0).fpatrofis3, Me.DbhotelDataSet.etaireia(0).fpatrofis3) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
                            Dim threadSendInvoice As Threading.Thread
                            threadSendInvoice = sendInvoice.set_mode(0)
                            threadSendInvoice = sendInvoice.send_invoice()
                            Dim timeoutMilliseconds As Integer = 10000 ' Set your desired timeout in milliseconds (10 seconds in this example)
                            Dim startTime As DateTime = DateTime.Now

                            While threadSendInvoice.IsAlive
                                ' Your loop body here

                                ' Check if the timeout has been reached
                                Dim elapsedMilliseconds As Integer = CInt((DateTime.Now - startTime).TotalMilliseconds)
                                If elapsedMilliseconds >= timeoutMilliseconds Then
                                    ' Timeout reached, break out of the loop
                                    Exit While
                                End If

                                ' Optionally, you can add a small delay to reduce CPU usage
                                'System.Threading.Thread.Sleep(100) ' Sleep for 100 milliseconds (adjust as needed)
                            End While
                            qrUrl = ""
                            command.Parameters.AddWithValue("timologio", kwdNeouTimol)
                            command.CommandText = "SELECT qrcode FROM myinvoices WHERE (timologio=@timologio)"
                            myReader = command.ExecuteReader()
                            ' Always call Read before accessing data.
                            If myReader.HasRows AndAlso myReader.Read() Then
                                Try
                                    qrUrl = myReader.Item(0)
                                    'Dim encoder As New QRCodeEncoder()

                                    '' Set encoding properties
                                    'encoder.QRCodeEncodeMode = QRCodeEncoder.ENCODE_MODE.BYTE
                                    'encoder.QRCodeScale = 4
                                    'encoder.QRCodeVersion = 8
                                    'encoder.QRCodeErrorCorrect = QRCodeEncoder.ERROR_CORRECTION.L

                                    '' Encode the string as a QR code and get the Bitmap
                                    'Dim qrBitmap As Bitmap = encoder.Encode(qrUrl)

                                    '' Convert Bitmap to Byte array
                                    'Dim byteArray As Byte() = BitmapToByteArray(qrBitmap)

                                    Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode(qrUrl)

                                Catch ex As InvalidCastException
                                    MsgBox("No QRCode!", MsgBoxStyle.Critical)
                                End Try
                            End If

                            myReader.Close()
                            command.Parameters.Clear()

                            If Not String.IsNullOrEmpty(qrUrl) Then
                                command.Parameters.AddWithValue("qrcode", qrUrl)
                                command.Parameters.AddWithValue("timologio", kwdNeouTimol)

                                command.CommandText = "UPDATE timologia SET qrcode = @qrcode WHERE (kwd = @timologio)"
                                command.ExecuteNonQuery()
                                command.Parameters.Clear()
                            End If

                        End If
                    End If


                    transaction.Commit()

                Catch ex As Exception
                    'MsgBox(ex.Message)
                    Me.KratiseisTableAdapter.UpdateTimologioByKwdTimologio(0, kwdApyKrat, 2)
                    MsgBox("Η Διαδικασία έκδοσης της ΑΠΥ απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")

                    Try
                        transaction.Rollback()
                        rollback_timanalysis_transaction(connectionString)
                        Return False
                    Catch
                        Return False
                    End Try
                End Try


            End Using




            Me.DbhotelDataSet.ekt_apy_diafora(0).aa_apy = aaApyParast
            Me.DbhotelDataSet.ekt_apy_diafora(0).seira = seira


            If Not Me.DbhotelDataSet.ekt_apy_diafora(0).IsqrcodeNull() AndAlso Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode.Length > 0 Then
                ' The byte array is not null and not empty
                proepiskopisi_apy()
            Else
                ' The byte array is either null or empty
                Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode("Απώλεια Διασύνδεσης")
                proepiskopisi_apy()
            End If


            Dim epoiniTableadapter As New dbhotelDataSetTableAdapters.epinoikiasiTableAdapter
            epoiniTableadapter.FillByVila(Me.DbhotelDataSet.epinoikiasi, apyDwm)
            If sumSynola > 0 Then
                If Me.DbhotelDataSet.epinoikiasi.Count = 1 Then
                    Dim poso As Single
                    Dim memo As String

                    If Not Me.DbhotelDataSet.epinoikiasi(0).vila.Equals("MARU") And Not Me.DbhotelDataSet.epinoikiasi(0).vila.Equals("MHILL") Then

                        Dim promithprakt, pososto As Single


                        promithprakt = Me.PraktoreiaTableAdapter.GetPromithDomisiByKwd(kwdApyPrakt)


                        If kwdApyPrakt = 17 Or kwdApyPrakt = 43 Or kwdApyPrakt = 10 Or kwdApyPrakt = 25 Or kwdApyPrakt = 8 Or kwdApyPrakt = 18 Then
                            poso = sumSynola / (1 - promithprakt / 100)
                        ElseIf kwdApyPrakt = 2 Or kwdApyPrakt = 16 Or kwdApyPrakt = 4 Or kwdApyPrakt = 39 Or kwdApyPrakt = 1 Then
                            poso = sumSynola
                        Else
                            MsgBox(" Δεν έγινε ενημέρωση ιδιοκτήτη στο Maintance λόγω Πρακτορείο εκτός λίστας ", MsgBoxStyle.Exclamation)
                            Exit Function
                        End If

                        pososto = (Me.DbhotelDataSet.epinoikiasi(0).pososto - promithprakt)

                        poso = poso * pososto / 100


                        memo = "Βίλα " + apyDwm + " " + diarkeia + " Τιμολόγηση: " + sumSynola.ToString + " Domisi: " + (poso).ToString("N")
                        'memo = memo.Replace("/", "-")
                        Try
                            If enimerwsi_maintance(Me.DbhotelDataSet.epinoikiasi(0).kwdikos, sumSynola, poso, memo) Then
                                If Me.DbhotelDataSet.epinoikiasi(0).vila = "ARCH" Then
                                    enimerwsi_archontiko_alla_posa(Me.DbhotelDataSet.epinoikiasi(0).kwdikos, 60, 110)
                                End If
                                MsgBox(" Έγινε ενημέρωση ιδιοκτήτη στο Maintance " + poso.ToString("N") + " Ευρώ", MsgBoxStyle.Information)
                            End If
                        Catch ex As Exception
                            MsgBox(" Δεν έγινε ενημέρωση ιδιοκτήτη στο Maintance ", MsgBoxStyle.Exclamation)
                        End Try
                    Else ' EDW vila MARUPRIN_


                        If kwdApyPrakt = 24 Or kwdApyPrakt = 4 Or kwdApyPrakt = 16 Or kwdApyPrakt = 1 Then
                            poso = sumSynola * 15 / 100
                        ElseIf kwdApyPrakt = 10 Or kwdApyPrakt = 2 Or kwdApyPrakt = 43 Then
                            poso = sumSynola * 30 / 100
                        Else
                            MsgBox(" Δεν έγινε ενημέρωση ιδιοκτήτη στο Maintance λόγω Πρακτορείο εκτός λίστας ", MsgBoxStyle.Exclamation)
                            Exit Function
                        End If

                        memo = "Βίλα " + apyDwm + " " + diarkeia + " Τιμολόγηση: " + sumSynola.ToString + " Domisi: " + (poso).ToString("N")
                        'memo =memo.Replace("/", "-")
                        Try
                            If enimerwsi_maintance(Me.DbhotelDataSet.epinoikiasi(0).kwdikos, sumSynola, poso, memo) Then
                                MsgBox(" Έγινε ενημέρωση ιδιοκτήτη στο Maintance " + poso.ToString("N") + " Ευρώ", MsgBoxStyle.Information)
                            End If
                        Catch ex As Exception
                            MsgBox(" Δεν έγινε ενημέρωση ιδιοκτήτη στο Maintance ", MsgBoxStyle.Exclamation)
                        End Try
                    End If
                End If
            End If

            Return True

        End If

        Return False
    End Function
    Function create_qrcode(ByVal url) As Byte()
        Dim encoder As New QRCodeEncoder()

        ' Set encoding properties
        encoder.QRCodeEncodeMode = QRCodeEncoder.ENCODE_MODE.BYTE
        encoder.QRCodeScale = 4
        encoder.QRCodeVersion = 8
        encoder.QRCodeErrorCorrect = QRCodeEncoder.ERROR_CORRECTION.L

        ' Encode the string as a QR code and get the Bitmap
        Dim qrBitmap As Bitmap = encoder.Encode(url)

        ' Convert Bitmap to Byte array
        Return BitmapToByteArray(qrBitmap)
    End Function
    Function BitmapToByteArray(bitmap As Bitmap) As Byte()
        Using stream As New MemoryStream()
            ' Save the Bitmap to the MemoryStream with the desired format (e.g., PNG)
            bitmap.Save(stream, Imaging.ImageFormat.Png)

            ' Convert the MemoryStream to a Byte array
            Return stream.ToArray()
        End Using
    End Function
    'Private Function enimerwsi_maintance(ByVal kwdikos As Integer, ByVal posotimol As Single, ByVal simfonia As Single, ByVal memo As String) As Boolean
    '    Dim istOK As Boolean = True
    '    Dim connString As String = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + Me.DbhotelDataSet.etaireia(0).xenodoxeio
    '    Using connection As New OleDb.OleDbConnection(connString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Try
    '            connection.Open()
    '            command.Connection = connection
    '            command.Parameters.AddWithValue("CustomerID", kwdikos)
    '            command.Parameters.AddWithValue("ΠΟΣΟΝ", posotimol)
    '            command.Parameters.AddWithValue("ΗΜΝΙΑ", imeromErgasias)
    '            command.Parameters.AddWithValue("ΣΥΜΦΩΝΙΑ", simfonia)
    '            command.Parameters.AddWithValue("ΜΕΜΟ", memo)
    '            command.CommandText = "INSERT INTO ΠΛΗΡΩΜΕΣ (CustomerID,ΠΟΣΟΝ,[ΗΜ/ΝΙΑ],ΣΥΜΦΩΝΙΑ,ΜΕΜΟ) VALUES (CustomerID,ΠΟΣΟΝ,ΗΜΝΙΑ,ΣΥΜΦΩΝΙΑ, ΜΕΜΟ)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '        Catch ex As Exception
    '            MessageBox.Show(ex.ToString)
    '            istOK = False
    '        End Try
    '    End Using
    '    Return istOK
    'End Function
    Private Function enimerwsi_maintance(ByVal kwdikos As Integer, ByVal posotimol As Single, ByVal simfonia As Single, ByVal memo As String) As Boolean
        Dim istOK As Boolean = True
        'Dim connString As String = "Data Source=<server>;Initial Catalog=<database>;User ID=<username>;Password=<password>"
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Try
                connection.Open()
                command.Connection = connection
                command.Parameters.AddWithValue("@CustomerID", kwdikos)
                command.Parameters.AddWithValue("@ΠΟΣΟΝ", posotimol)
                command.Parameters.AddWithValue("@ΗΜΝΙΑ", DateTime.Now) ' Replace with the desired value for ΗΜ/ΝΙΑ
                command.Parameters.AddWithValue("@ΣΥΜΦΩΝΙΑ", simfonia)
                command.Parameters.AddWithValue("@ΜΕΜΟ", memo)
                command.CommandText = "INSERT INTO pliromes (CustomerID, ΠΟΣΟΝ, ΗΜΝΙΑ, ΣΥΜΦΩΝΙΑ, ΜΕΜΟ) VALUES (@CustomerID, @ΠΟΣΟΝ, @ΗΜΝΙΑ, @ΣΥΜΦΩΝΙΑ, @ΜΕΜΟ)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()
            Catch ex As Exception
                MessageBox.Show(ex.ToString())
                istOK = False
            End Try
        End Using
        Return istOK
    End Function


    'Private Sub enimerwsi_archontiko_alla_posa(ByVal kwdikos As Integer, ByVal poso1 As Single, ByVal poso2 As Single)
    '    '  Dim istOK As Boolean = True
    '    Dim memo As String
    '    Dim connString As String = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" + Me.DbhotelDataSet.etaireia(0).xenodoxeio
    '    Using connection As New OleDb.OleDbConnection(connString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Try
    '            connection.Open()
    '            command.Connection = connection
    '            memo = "Welcome Package"

    '            command.Parameters.AddWithValue("CustomerID", kwdikos)
    '            command.Parameters.AddWithValue("ΣΥΜΦΩΝΙΑ", poso1)
    '            command.Parameters.AddWithValue("ΗΜΝΙΑ", imeromErgasias)
    '            command.Parameters.AddWithValue("ΜΕΜΟ", memo)
    '            command.CommandText = "INSERT INTO ΠΛΗΡΩΜΕΣ (CustomerID,ΣΥΜΦΩΝΙΑ,[ΗΜ/ΝΙΑ],ΜΕΜΟ) VALUES (CustomerID,ΣΥΜΦΩΝΙΑ,ΗΜΝΙΑ,ΜΕΜΟ)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            memo = "Cleaning Services"

    '            command.Parameters.AddWithValue("CustomerID", kwdikos)
    '            command.Parameters.AddWithValue("ΣΥΜΦΩΝΙΑ", poso2)
    '            command.Parameters.AddWithValue("ΗΜΝΙΑ", imeromErgasias)
    '            command.Parameters.AddWithValue("ΜΕΜΟ", memo)
    '            command.CommandText = "INSERT INTO ΠΛΗΡΩΜΕΣ (CustomerID,ΣΥΜΦΩΝΙΑ,[ΗΜ/ΝΙΑ], ΜΕΜΟ) VALUES (CustomerID,ΣΥΜΦΩΝΙΑ,ΗΜΝΙΑ,ΜΕΜΟ)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '        Catch ex As Exception
    '            MessageBox.Show(ex.ToString)
    '            '    istOK = False
    '        End Try
    '    End Using
    '    '  Return istOK
    'End Sub
    Private Sub enimerwsi_archontiko_alla_posa(ByVal kwdikos As Integer, ByVal poso1 As Single, ByVal poso2 As Single)
        ' Dim istOK As Boolean = True
        Dim memo As String

        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Try
                connection.Open()
                command.Connection = connection
                memo = "Welcome Package"

                command.Parameters.AddWithValue("@CustomerID", kwdikos)
                command.Parameters.AddWithValue("@ΣΥΜΦΩΝΙΑ", poso1)
                command.Parameters.AddWithValue("@ΗΜΝΙΑ", DateTime.Now) ' Replace with the desired value for ΗΜ/ΝΙΑ
                command.Parameters.AddWithValue("@ΜΕΜΟ", memo)
                command.CommandText = "INSERT INTO pliromes (CustomerID, ΣΥΜΦΩΝΙΑ,ΗΜΝΙΑ, ΜΕΜΟ) VALUES (@CustomerID, @ΣΥΜΦΩΝΙΑ, @ΗΜΝΙΑ, @ΜΕΜΟ)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                memo = "Cleaning Services"

                command.Parameters.AddWithValue("@CustomerID", kwdikos)
                command.Parameters.AddWithValue("@ΣΥΜΦΩΝΙΑ", poso2)
                command.Parameters.AddWithValue("@ΗΜΝΙΑ", DateTime.Now) ' Replace with the desired value for ΗΜ/ΝΙΑ
                command.Parameters.AddWithValue("@ΜΕΜΟ", memo)
                command.CommandText = "INSERT INTO pliromes (CustomerID, ΣΥΜΦΩΝΙΑ, ΗΜΝΙΑ, ΜΕΜΟ) VALUES (@CustomerID, @ΣΥΜΦΩΝΙΑ, @ΗΜΝΙΑ, @ΜΕΜΟ)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()
            Catch ex As Exception
                MessageBox.Show(ex.ToString)
                ' istOK = False
            End Try
        End Using
        ' Return istOK
    End Sub

    'Private Sub rollback_timanalysis_transaction(ByVal connectionstring As String)

    '    Using connection As New OleDb.OleDbConnection(connectionstring)
    '        Dim j As Int16
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim transaction As OleDb.OleDbTransaction = Nothing
    '        Try
    '            connection.Open()
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection
    '            command.Transaction = transaction

    '            command.Parameters.Clear()
    '            command.Parameters.AddWithValue("identifikation", timolID)
    '            command.CommandText = "DELETE FROM timologioanalysis where (timologio=-1) and (identifikation=?)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '            For j = 0 To kwdProsEkd.Length - 1
    '                command.Parameters.AddWithValue("kwd", kwdProsEkd(j))
    '                command.CommandText = "UPDATE kratiseis SET timologio=0 where (kwd=?) and (timologio=2)"
    '                command.ExecuteNonQuery()
    '                command.Parameters.Clear()
    '                transaction.Commit()
    '            Next

    '        Catch ex As Exception
    '            transaction.Rollback()
    '            'MsgBox("H ΑΠΥ δεν πορεί να εκδοθεί !", MsgBoxStyle.Information, "winfo\nikEl.")
    '        End Try
    '    End Using
    'End Sub
    Private Sub rollback_timanalysis_transaction(ByVal connectionString As String)
        Using connection As New SqlConnection(connectionString)
            Dim j As Int16
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.Clear()
                command.Parameters.AddWithValue("identifikation", timolID)
                command.CommandText = "DELETE FROM timologioanalysis WHERE (timologio=-1) AND (identifikation=@identifikation)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                For j = 0 To kwdProsEkd.Length - 1
                    command.Parameters.AddWithValue("kwd", kwdProsEkd(j))
                    command.CommandText = "UPDATE kratiseis SET timologio=0 WHERE (kwd=@kwd) AND (timologio=2)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()
                    transaction.Commit()
                Next

            Catch ex As Exception
                transaction.Rollback()
                'MsgBox("H ΑΠΥ δεν πορεί να εκδοθεί !", MsgBoxStyle.Information, "winfo\nikEl.")
            End Try
        End Using
    End Sub

    Public Sub Wait(ByVal seconds As Single)

        Dim newDate As Date

        newDate = Now.AddSeconds(seconds)

        While Now.Ticks <= newDate.Ticks

            Application.DoEvents()

        End While

    End Sub
    Private Function check_kratiseis_ob_nicht_mittlerweile_timolog(ByVal praktoreio As Integer) As Boolean
        Dim j, i As Int16

        Me.TimologioanalysisTableAdapter.FiillJoinKratiseiskwdByPraktImerominia(Me.DbhotelDataSet.timologioanalysis, praktoreio, imeromErgasias)

        For j = 0 To kwdProsEkd.Length - 1
            For i = 0 To Me.DbhotelDataSet.timologioanalysis.Count - 1
                If kwdProsEkd(j) = Me.DbhotelDataSet.timologioanalysis(i).kratisi Then
                    Return False
                End If
            Next
        Next
        Return True
    End Function
    Private Sub delete_timologia_von_systemabsturz()
        'Se periptwsi Absturz to poio pithano einai na exoun kataxwrithei ta timologiaanalysis (synexeia) kai oxi to timologio
        '-> kanw delete ta timologianalysis pou den exoun Verweis auf timologio
        Me.TimologioanalysisTableAdapter.DeleteTimolAnalysisByMinusEins(-1)
        '>sun tois alois kanw Update tis kratiseis me upo ekdosi timogio
        Me.KratiseisTableAdapter.UpdateTimologioByTimologio(0, 2)
        'se periptwsi pou exei kataxwrithei kai to timologio tote YPARXEI problhma to opoio LYnetai ma sql server 2005 und trnsactionen (transaction scope???)
    End Sub
    Private Function berechne_ekptosi_vom_synolo_kratisis(ByVal timiImeras As Single, ByVal synolo As Single, ByVal poso As Single, ByVal pososto As Single, ByVal free As Single, ByVal fee As Single) As Single
        If pososto <> 0 Then
            Return (synolo * pososto / 100)

        ElseIf poso <> 0 Then

            Return poso

        ElseIf free <> 0 Then

            Return (free * timiImeras)

        ElseIf fee <> 0 Then
            Return -(fee * timiImeras)
        End If
        Return 0
    End Function
    Private Sub add_kwdiko_kratisis(ByVal kwdikos As Integer)
        Dim l As Int16
        l = kwdProsEkd.Length
        ReDim Preserve kwdProsEkd(l)

        kwdProsEkd(kwdProsEkd.Length - 1) = kwdikos
    End Sub
    Private Function exist_schon_kwd_kratisis(ByVal kwdikos As Integer) As Boolean
        Dim j As Integer

        For j = 0 To kwdProsEkd.Length - 1
            If kwdProsEkd(j) = kwdikos Then
                Return True
            End If
        Next
        Return False
    End Function
    Private Sub proepiskopisi_apy()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New ApyMemDomisi()
        'Dim ektiposi As New ApyMem()
        Dim adaptAfm As New dbhotelDataSetTableAdapters.afmTableAdapter
        adaptAfm.FillByKwd(Me.DbhotelDataSet.afm, kwdApyAfm)
        If Me.DbhotelDataSet.afm.Count = 1 Then
            ektiposi.SetDataSource(DbhotelDataSet)
            CrystalReportViewer1.ReportSource = ektiposi
            CrystalReportViewer1.DisplayGroupTree = False
            'CrystalReportViewer1.DisplayGroupTree = False
            Form1.Controls.Add(CrystalReportViewer1)
            CrystalReportViewer1.Dock = DockStyle.Fill
            CrystalReportViewer1.Visible = True

            Form1.ShowDialog()

            ektiposi.Close()
            ektiposi.Dispose()
            'Else
            '    ektiposi.SetDataSource(DbhotelDataSet)
            '    CrystalReportViewer1.ReportSource = ektiposi
            '    CrystalReportViewer1.DisplayGroupTree = False
            '    Form1.Controls.Add(CrystalReportViewer1)
            '    CrystalReportViewer1.Dock = DockStyle.Fill
            '    CrystalReportViewer1.Visible = True

            '    Form1.ShowDialog()

            '    ektiposi.Close()
            '    ektiposi.Dispose()
        End If
        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False

    End Sub
    Private Sub init_mem_apy_felder()
        ParastΑpyCbx.SelectedIndex = -1

        'Dim aaApy As Integer
        PelatisLbl.Text = ""
        MemApyAfixiLbl.Text = ""
        MemApyAnaxLbl.Text = ""
        MemApyEnilLbl.Text = ""
        MemApyOnomLbl.Text = ""

        MemApyIlik1Lbl.Text = ""
        MemApyIlik2Lbl.Text = ""
        MemApyIlik3Lbl.Text = ""

        MemApyCot1Lbl.Text = ""
        MemApyCot2Lbl.Text = ""
        MemApyCot3Lbl.Text = ""
        MemApyEthnAr1Lbl.Text = ""
        MemApyEthnAr2Lbl.Text = ""

        MemApyEthn1Lbl.Text = ""
        MemApyEthn2Lbl.Text = ""

        MemApyLogarLbl.Text = ""
        MemApyImerLbl.Text = ""
        MemApyProkatLbl.Text = ""
        'If TimologioChk.Checked Then
        '    aaApy = Me.ParastatikaTableAdapter.GetArxikoAAParastByKwdiko(Me.DbhotelDataSet.etaireia(0).timolkwd)
        '    MemApyArApyLbl.Text = aaApy + 1
        'Else
        '    aaApy = Me.ParastatikaTableAdapter.GetArxikoAAParastByKwdiko(Me.DbhotelDataSet.etaireia(0).apykwd)
        '    MemApyArApyLbl.Text = aaApy + 1
        'End If


        apyDwm = ""
        apyEnil = 0
        apyPaid = 0
        apyVoucher = ""
        apyOnom = ""
        'MemApySynexBtn.Enabled = True
        blinkLbl2.Text = ""
        myTimer2.Stop()
    End Sub
    Private Sub fuehle_parast_apy_cbx()
        Dim j As Int16
        ParastΑpyCbx.Items.Clear()
        '   Dim afmadapter As New dbhotelDataSetTableAdapters.afmTableAdapter
        ' afmadapter.FillByEikoniko(Me.DbhotelDataSet.afm, True)
        For j = 0 To Me.DbhotelDataSet.afm.Count
            If j = 0 Then
                ParastΑpyCbx.Items.Add("<Εταιρεία>")
            Else
                ParastΑpyCbx.Items.Add(Me.DbhotelDataSet.afm(j - 1).epixirisi)
            End If

        Next
    End Sub
    Private Sub ParastApyCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ParastΑpyCbx.SelectedIndexChanged
        ' MsgBox(Me.DbhotelDataSet.afm.Count)
        If sender.selectedIndex < 1 Then
            kwdApyAfm = -1
        Else
            '    MsgBox((sender.SelectedItem.ToString))
            kwdApyAfm = get_kwd_etaireias_by_name(sender.SelectedItem.ToString)

        End If

    End Sub
    Private Sub clear_dataset_ekt()
        Me.DbhotelDataSet.ekt_apy_mem.Clear()
        Me.DbhotelDataSet.ekt_apy_sumfpa.Clear()
        Me.DbhotelDataSet.ekt_apy_diafora.Clear()
        Me.DbhotelDataSet.ekt_apy_sumkathposa.Clear()

    End Sub
    Private Sub init_ekpt_felder(ByVal index1 As Byte, ByVal index2 As Byte, ByVal index3 As Byte, ByVal index4 As Byte)
        Dim s As Single = 0
        If index1 = 0 Then
            MemApyPosostoTbx.Text = s.ToString("N")
        End If
        If index2 = 0 Then
            MemApyPosoTbx.Text = s.ToString("N")
        End If
        If index3 = 0 Then
            MemApyImerFreeTbx.Text = s.ToString("N1")
        End If
        If index4 = 0 Then
            MemApyFeeTbx.Text = s.ToString("N1")
        End If


    End Sub
    Private Sub trop_pliromis_cbox_fuelle()
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.pistwtikes.Count + 1
            If j = 0 Then
                MemApyTrPlCbx.Items.Add("Επί Πιστώση")
            ElseIf j = 1 Then
                MemApyTrPlCbx.Items.Add("Μετρητοίς")
            Else
                MemApyTrPlCbx.Items.Add(Me.DbhotelDataSet.pistwtikes(j - 2).karta)

            End If
        Next
    End Sub
    Private Sub MemApyPosostoTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyPosostoTbx.Leave
        Dim zahl As Single

        Try
            zahl = Math.Abs(CType(sender.text, Single)).ToString("F")
            If zahl > 100 Then
                zahl = 100
                sender.text = zahl.ToString("F")
                Exit Sub
            End If
            sender.text = zahl.ToString("F")
            If zahl <> 0 Then
                init_ekpt_felder(1, 0, 0, 0)
            End If

        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("F")
        End Try
    End Sub
    Private Sub MemApyPosoTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyPosoTbx.Leave
        Dim zahl As Single

        Try
            'zahl = Math.Abs(CType(sender.text, Single)).ToString("F")
            zahl = CType(sender.text, Single).ToString("F")
            Try
                If zahl > Me.DbhotelDataSet.kratiseis(0).synolo Then
                    MsgBox("Πολύ μεγάλο ποσό για έκπτωση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    zahl = 0
                    sender.text = zahl.ToString("F")
                    Exit Sub
                End If
                sender.text = zahl.ToString("F")
                If zahl <> 0 Then
                    init_ekpt_felder(0, 1, 0, 0)
                End If

            Catch ex As IndexOutOfRangeException
                zahl = 0
                sender.text = zahl.ToString("F")
            End Try

        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("F")
        End Try
    End Sub
    Private Sub MemApyImerFreeTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyImerFreeTbx.Leave
        Dim zahl As Single

        Try
            zahl = Math.Abs(CType(sender.text, Single)).ToString("N1")
            If zahl > MemApyImerLbl.Text Then
                MsgBox("Πολλές Ημέρες για έκπτωση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                zahl = 0
                sender.text = zahl
                Exit Sub
            Else
                If zahl <> 0 Then
                    init_ekpt_felder(0, 0, 1, 0)
                End If
            End If
            sender.text = zahl.ToString("N1")
        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("N1")
        End Try
    End Sub
    Private Sub MemApyFeeTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyFeeTbx.Leave
        Dim zahl As Single

        Try
            zahl = Math.Abs(CType(sender.text, Single)).ToString("N1")
            If zahl > MemApyImerLbl.Text + 10 Then
                zahl = 0
                sender.text = zahl
                Exit Sub
            Else
                sender.text = zahl.ToString("N1")
                If zahl <> 0 Then
                    init_ekpt_felder(0, 0, 0, 1)
                End If

            End If

        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("N1")
        End Try
    End Sub
    Private Sub MemApyTrPlCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyTrPlCbx.TextUpdate
        MsgBox("Δεν επιτρέπεται αλλαγή (Γιά εισαγωγή νέας πιστωτικής κάρτας ανατρέξτε στους Παράμετρους της Εφαρμογής) !", MsgBoxStyle.Information, "winfo\nikEl.")
        MemApyTrPlCbx.SelectedIndex = -1
    End Sub

    Private Sub MemApyEtairiaBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyEtairiaBtn.Click
        Dim form As New ApyFrm(kwdApyKrat)
        form.StartPosition = FormStartPosition.CenterParent
        Try
            form.ShowDialog()
            form.Dispose()
            Try
                kwdApyApy = Me.ApyTableAdapter.GetKwdApyByKratisi(kwdApyKrat)
            Catch ex As InvalidOperationException

            End Try

            Me.ApyTableAdapter.DeleteApyByKratisi(-1)
        Catch ex As InvalidOperationException
        End Try
    End Sub

    Private Sub MemApyFeeTbx_selectall(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MemApyFeeTbx.Click, MemApyImerFreeTbx.Click, MemApyPosoTbx.Click, MemApyPosostoTbx.Click
        sender.SelectAll()

    End Sub
    Private Sub init_globale_var()
        sumYpnos = 0
        sumYpnosFpa = 0
        sumPrwino = 0
        sumPrwinoFpa = 0
        sumGeumata = 0
        sumGeumataFpa = 0
        sumExtra = 0
        sumExtraFpa = 0
        sumExtraFpa = 0
        sumSumPosa = 0
        'sumSumFpa = 0
        sumSynola = 0
        sumKratPosa = 0
        sumKratFpa = 0
        simetKrat = 0
        prokatKrat = 0
        simbKrat = 0
    End Sub
    '**********************EKDOSI EXTRA  PARASTATIKWN***************************EKDOSI EXTRA  PARASTATIKWN*****EKDOSI EXTRA  PARASTATIKWN********************
    'EDW MPOREI KANEIS NA DWSEI-FORTWSEI ENA TIMOLOGIO GIA PRAKTOREIO->PROSOXH STA A/A MPOREI KANEIS NA YPERPIDISEI A/A ETSI WSTE NA MEINEI KENO 
    'ENDIAMESA->(HANDHABEN->RWTA MANIKI)

    Private Sub ekdosi_extra_parastatikwn()
        Dim afmadapter As New dbhotelDataSet1TableAdapters.afmTableAdapter

        afmadapter.Fill(Me.DbhotelDataSet1.afm)
        fuehle_parast_cbx()
        'imeromErgasias = imeromErgasias.AddDays(3)
        statusParast = Nothing
        clear_dataset_ekt()
        'EkdosiParastSynolaLbl.Size = New Point(85, 22)
        arxiEtous = "1/1/" + etos.ToString
        telosEtous = "31/12/" + etos.ToString

        EkdosiParastPck.MaxDate = telosEtous
        EkdosiParastPck.Value = imeromErgasias
        EkdosiParastPck.Value = imeromErgasias

        EtikLbl.Text = "ΕΚΔΟΣΗ EXTRA  ΠΑΡΑΣΤΑΤΙΚΩΝ"
        EtikLbl.Location = New Point(EispraxeisKataxPnl.Width / 5, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        EkdosiParastPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.EkdosiParastPnl.Size = New Point(830, ZentralPnl.Height)
        'trop_pliromis_parast_cbox_fuelle()
        'EkdosiParastParastCbx.Items.Clear()
        CountriesExtCbx.SelectedIndex = 0
        EkdosiParastTrPliromCbx.Items.Clear()
        trop_pliromis_parast_cbox_fuelle()
        'init_cbxoen()
        kwdParastAfm = -1
        init_parast_felder(True)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        Me.ZentralPnl.Controls.Add(EkdosiParastPnl)

        'EkdosiParastSynolaTbx.ReadOnly = True
        'EkdosiParastSynolaTbx.Text = "123"
    End Sub
    Private Sub EkdosiParastParastCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastParastCbx.SelectedIndexChanged

        If sender.selectedindex <> -1 Then
            If parastParastKwd <> Nothing Then
                init_parast_felder(False)
            End If

            'sTO parastcboxKwd einai apothikeuemenoi oi Kwdikoi twn typwn parastatikwn (APY B seira kai Pistotiko Timologio) 
            parastParastKwd = parastCboxKwd(sender.selectedindex)
            Try
                'edw arxika kanw laden ton arithmo apo to table Parastaika->ACHTUNG->prin tin apothikeusi NOCHMAL abfragen 
                'gia to aktuelle AA apo table TIMOLOGIA
                Me.ParastatikaTableAdapter.FillByKwd(Me.DbhotelDataSet.parastatika, parastParastKwd)
                'aaParast = Me.ParastatikaTableAdapter.GetArxikoAAParastByKwdiko()
                aaParast = Me.DbhotelDataSet.parastatika(0).aritthmos1 + 1
                EkdosiParastAATbx.Text = aaParast

            Catch ex As InvalidOperationException
                If parastParastKwd = 5 Then
                    aaParast = Me.DbhotelDataSet.etaireia(0).aabapy
                ElseIf parastParastKwd = 2 Then
                    aaParast = Me.DbhotelDataSet.etaireia(0).aagramatio
                End If
            End Try
        End If



    End Sub
    Private Sub EkdosiParastPraktTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastPraktTbx.Enter, EkdosiParastPraktTbx.Click
        Dim PraktForm As New SimbolaiaFrm()
        Dim kwdikos As Integer

        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        kwdikos = PraktForm.return_praktoreio_kwdikos

        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If praktParastKwd = Nothing Then
                EkdosiParastPraktTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
                Exit Sub
            End If
        Else
            praktParastKwd = kwdikos
            EkdosiParastPraktTbx.Text = PraktForm.return_praktoreio
        End If
        'Me.SimbolaiaTabl
    End Sub
    Private Sub EkdosiParastAATbx_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastAATbx.Click

        sender.SelectAll()
    End Sub
    Private Sub EkdosiParastAATbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastAATbx.Leave
        Try
            'EkdosiParastAATbx.Text = Math.Abs(CType(sender.text, Int16))
            'If parastParastKwd = 5 AndAlso sender.text < Me.DbhotelDataSet.etaireia(0).aabapy Then
            '    MsgBox(" AA Τιμολόγιου δεν μπορεί να είναι μικρότερο απο το αρχικό ετους ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            '    EkdosiParastAATbx.Text = aaParast
            '    Exit Sub
            'ElseIf parastParastKwd = 2 AndAlso sender.text < Me.DbhotelDataSet.etaireia(0).aagramatio Then
            '    MsgBox(" AA Τιμολόγιου δεν μπορεί να είναι μικρότερο απο το αρχικό ετους ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            '    EkdosiParastAATbx.Text = aaParast
            '    Exit Sub
            'End If
            If Math.Abs(CType(sender.text, Int16)) < 1 Then
                MsgBox(" AA Τιμολόγιου δεν μπορεί να είναι μικρότερο απο το αρχικό ετους ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                EkdosiParastAATbx.Text = aaParast
                Exit Sub
            End If
            aaParast = EkdosiParastAATbx.Text
        Catch ex As InvalidCastException
            sender.text = aaParast
        End Try

    End Sub

    Private Sub EkdosiParastParastFindeBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastParastFindeBtn.Click
        If Not EkdosiParastAATbx.Text.Equals("") Then
            Me.TimologiaTableAdapter.FillByParImeromAAExtra(Me.DbhotelDataSet.timologia, parastParastKwd, EkdosiParastPck.Value.Date, EkdosiParastAATbx.Text, False, True)
            If Me.DbhotelDataSet.timologia.Count = 1 Then
                Me.TimologioanalysisTableAdapter.FillByTimologio(Me.DbhotelDataSet.timologioanalysis, Me.DbhotelDataSet.timologia(0).kwd)
                fortosi_timologiou()
            End If

        End If

    End Sub
    Private Sub fortosi_timologiou()


        EkdosiParastPraktTbx.Text = Me.get_praktoreio_by_kwdiko(Me.DbhotelDataSet.timologia(0).praktoreio)
        praktParastKwd = Me.DbhotelDataSet.timologia(0).praktoreio
        Me.PraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.praktoreia, praktParastKwd)
        EkdosiParastYpnosTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).ypnos).ToString("N")
        aktWerte(0) = (Me.DbhotelDataSet.timologioanalysis(0).ypnos).ToString("N") 'gia na parakolouthisw ean alaksei to wert gia thn ifairesi

        EkdosiParastYpnosFpaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).ypnosfpa).ToString("N")

        EkdosiParastPrwinoTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).prwino).ToString("N")
        aktWerte(1) = (Me.DbhotelDataSet.timologioanalysis(0).prwino).ToString("N")
        EkdosiParastPrwinoFpaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).prwinofpa).ToString("N")

        EkdosiParastGeumaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).geuma).ToString("N")
        aktWerte(2) = (Me.DbhotelDataSet.timologioanalysis(0).geuma).ToString("N")
        EkdosiParastGeumaFpaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).geumafpa).ToString("N")

        EkdosiParastDeipnoTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).deipno).ToString("N")
        aktWerte(3) = (Me.DbhotelDataSet.timologioanalysis(0).deipno).ToString("N")
        EkdosiParastDeipnoFpaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).deipnofpa).ToString("N")

        EkdosiParastAllTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).allinclusiv).ToString("N")
        aktWerte(4) = (Me.DbhotelDataSet.timologioanalysis(0).allinclusiv).ToString("N")
        EkdosiParastAllFpaTbx.Text = (Me.DbhotelDataSet.timologioanalysis(0).allinclusivfpa).ToString("N")

        EkdosiParastSynolaTbx.Text = (Me.DbhotelDataSet.timologia(0).synola).ToString("N")

        EkdosiParastProkatabTbx.Text = (Me.DbhotelDataSet.timologia(0).prokataboli).ToString("N")

        EkdosiParastParastAitTbx.Text = Me.DbhotelDataSet.timologia(0).aitiologia

        EkdosiParastTrPliromCbx.SelectedIndex = get_index_tropos_pliromis_cbox(Me.DbhotelDataSet.timologia(0).pliromi)
        statusParast = 2 'Status= Update

    End Sub

    Private Sub EkdosiParastYpnosTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastYpnosTbx.Leave, EkdosiParastPrwinoTbx.Leave,
       EkdosiParastGeumaTbx.Leave, EkdosiParastDeipnoTbx.Leave, EkdosiParastAllTbx.Leave, EkdosiParastProkatabTbx.Leave
        Dim s, d As Single
        Dim find() As Control


        Try
            If CType(sender.text, Single) Then
                s = CType(sender.text, Single)
                sender.text = s.ToString("N")
                If sender.name.Equals("EkdosiParastYpnosTbx") And s <> aktWerte(0) Then
                    find = EkdosiParast2Pnl.Controls.Find("EkdosiParastYpnosFpaTbx", False)

                    If Not EkdosiParastYpnosChk.Checked Then
                        find(0).Text = (s.ToString("N") * (Me.DbhotelDataSet.etaireia(0).fpatrofis1) / 100).ToString("N")
                    Else
                        d = sender.text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis1 / 100))
                        sender.text = d.ToString("N")
                        aktWerte(0) = d.ToString("N")
                        find(0).Text = (s - d).ToString("N")
                    End If

                ElseIf sender.name.Equals("EkdosiParastPrwinoTbx") And s <> aktWerte(1) Then
                    find = EkdosiParast2Pnl.Controls.Find("EkdosiParastPrwinoFpaTbx", False)

                    If Not EkdosiParastYpnosChk.Checked Then
                        find(0).Text = (s.ToString("N") * (Me.DbhotelDataSet.etaireia(0).fpatrofis2) / 100).ToString("N")
                    Else
                        d = sender.text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis2 / 100))
                        sender.text = d.ToString("N")
                        aktWerte(1) = d.ToString("N")
                        find(0).Text = (s - d).ToString("N")
                    End If
                ElseIf sender.name.Equals("EkdosiParastGeumaTbx") And s <> aktWerte(2) Then
                    find = EkdosiParast2Pnl.Controls.Find("EkdosiParastGeumaFpaTbx", False)

                    If Not EkdosiParastYpnosChk.Checked Then
                        find(0).Text = (s.ToString("N") * (Me.DbhotelDataSet.etaireia(0).fpatmima4) / 100).ToString("N")
                    Else
                        d = sender.text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatmima4 / 100))
                        sender.text = d.ToString("N")
                        aktWerte(2) = d.ToString("N")
                        find(0).Text = (s - d).ToString("N")
                    End If

                ElseIf sender.name.Equals("EkdosiParastDeipnoTbx") And s <> aktWerte(3) Then
                    find = EkdosiParast2Pnl.Controls.Find("EkdosiParastDeipnoFpaTbx", False)

                    If Not EkdosiParastYpnosChk.Checked Then
                        find(0).Text = (s.ToString("N") * (Me.DbhotelDataSet.etaireia(0).fpatrofis3) / 100).ToString("N")
                    Else
                        d = sender.text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100))
                        sender.text = d.ToString("N")
                        aktWerte(3) = d.ToString("N")
                        find(0).Text = (s - d).ToString("N")
                    End If
                ElseIf sender.name.Equals("EkdosiParastAllTbx") And s <> aktWerte(4) Then
                    find = EkdosiParast2Pnl.Controls.Find("EkdosiParastAllFpaTbx", False)

                    If Not EkdosiParastYpnosChk.Checked Then
                        find(0).Text = (s.ToString("N") * (Me.DbhotelDataSet.etaireia(0).fpatrofis3) / 100).ToString("N")
                    Else
                        d = sender.text / (1 + (Me.DbhotelDataSet.etaireia(0).fpatrofis3 / 100))
                        sender.text = d.ToString("N")
                        aktWerte(4) = d.ToString("N")
                        find(0).Text = (s - d).ToString("N")
                    End If
                End If



            End If
        Catch ex As InvalidCastException
            s = 0
            sender.text = s.ToString("N")
            EkdosiParastYpnosTbx_TextChanged(sender, e)
        End Try
        s = berechne_synolo()
        EkdosiParastSynolaTbx.Text = s.ToString("N")
    End Sub
    Private Sub EkdosiParastYpnosFpaTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastYpnosTbx.Leave, EkdosiParastPrwinoTbx.Leave,
       EkdosiParastGeumaTbx.Leave, EkdosiParastDeipnoTbx.Leave, EkdosiParastAllTbx.Leave, EkdosiParastProkatabTbx.Leave, EkdosiParastYpnosFpaTbx.Leave, EkdosiParastPrwinoFpaTbx.Leave,
       EkdosiParastGeumaFpaTbx.Leave, EkdosiParastDeipnoFpaTbx.Leave, EkdosiParastAllFpaTbx.Leave, EkdosiParastProkatabTbx.Leave
        Dim s As Single
        Try
            If CType(sender.text, Single) >= 0 Then
                s = CType(sender.text, Single)
                sender.text = s.ToString("N")
            End If
        Catch ex As InvalidCastException
            s = 0
            sender.text = s.ToString("N")
            EkdosiParastYpnosFpaTbx_TextChanged(sender, e)
        End Try
        s = berechne_synolo()
        EkdosiParastSynolaTbx.Text = s.ToString("N")
    End Sub
    Private Sub EkdosiParastYpnosTbx_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastYpnosTbx.Click, EkdosiParastPrwinoTbx.Click,
      EkdosiParastGeumaTbx.Click, EkdosiParastDeipnoTbx.Click, EkdosiParastAllTbx.Click, EkdosiParastProkatabTbx.Click, EkdosiParastYpnosFpaTbx.Click, EkdosiParastPrwinoFpaTbx.Click,
       EkdosiParastGeumaFpaTbx.Click, EkdosiParastDeipnoFpaTbx.Click, EkdosiParastAllFpaTbx.Click, EkdosiParastProkatabTbx.Click

        sender.SelectAll()
    End Sub
    'Private Sub EkdosiParastYpnosTbx_Keypress(ByVal sender As System.Object, ByVal e As KeyPressEventArgs) Handles DwmTbx.

    '    sender.text.toUpper()

    'End Sub
    Private Function berechne_synolo() As Single
        Dim s, ypnos, ypnosFpa, prwino, prwinoFpa, geuma, geumaFpa, deipno, deipnoFpa, allinc, allincFpa As Single
        Dim find() As Control
        ypnos = ypnosFpa = prwino = prwinoFpa = geuma = geumaFpa = deipno = deipnoFpa = allinc = allincFpa = 0

        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastYpnosTbx", False)
        ypnos = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastYpnosFpaTbx", False)
        ypnosFpa = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastPrwinoTbx", False)
        prwino = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastPrwinoFpaTbx", False)
        prwinoFpa = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastGeumaTbx", False)
        geuma = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastGeumaFpaTbx", False)
        geumaFpa = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastDeipnoTbx", False)
        deipno = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastDeipnoFpaTbx", False)
        deipnoFpa = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastAllTbx", False)
        allinc = find(0).Text
        find = EkdosiParast2Pnl.Controls.Find("EkdosiParastAllFpaTbx", False)
        allincFpa = find(0).Text

        synolKathPosa = (ypnos + prwino + geuma + deipno + allinc)
        synolFpa = (ypnosFpa + prwinoFpa + geumaFpa + deipnoFpa + allincFpa)
        s = synolKathPosa + synolFpa
        Return s
    End Function
    Private Sub Midenismos_Extra_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastMidenismosBtn.Click
        If statusParast = 2 Then
            If IsDBNull(Me.DbhotelDataSet.timologia(0).Item("qrcode")) OrElse Me.DbhotelDataSet.timologia(0).qrcode.Length = 0 Then
                Dim s As Single = 0
                EkdosiParastYpnosTbx.Text = s.ToString("N")
                EkdosiParastPrwinoTbx.Text = s.ToString("N")
                EkdosiParastGeumaTbx.Text = s.ToString("N")
                EkdosiParastDeipnoTbx.Text = s.ToString("N")
                EkdosiParastAllTbx.Text = s.ToString("N")
                EkdosiParastYpnosFpaTbx.Text = s.ToString("N")
                EkdosiParastPrwinoFpaTbx.Text = s.ToString("N")
                EkdosiParastGeumaFpaTbx.Text = s.ToString("N")
                EkdosiParastDeipnoFpaTbx.Text = s.ToString("N")
                EkdosiParastAllFpaTbx.Text = s.ToString("N")
                EkdosiParastSynolaTbx.Text = s.ToString("N")
                EkdosiParastProkatabTbx.Text = s.ToString("N")

                If ekdosi_extra_parastatikou() Then
                    init_parast_felder(True)
                    MsgBox(" Τα ποσά μηδενίστηκαν ! ", MsgBoxStyle.Information, "winfo\nikEl.")
                Else
                    MsgBox(" Δεν μηδενίστηκαν τα ποσά ! ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If
            Else
                MsgBox(" Δεν υφίσταται αυτή η επιλογή για παραστατικά που εχουν διαβιβασθεί στα MyData ! ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End If
        End If
    End Sub
    Private Sub Proepiskopisi_Extra_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastKataxBtn.Click
        If statusParast = 2 Then
            Try
                Me.DbhotelDataSet.ekt_apy_sumkathposa.Clear()
                Me.DbhotelDataSet.ekt_apy_sumfpa.Clear()
                Me.DbhotelDataSet.ekt_apy_diafora.Clear()
                Me.DbhotelDataSet.ekt_apy_diafora.Rows.Add()
                Me.DbhotelDataSet.ekt_apy_sumkathposa.Rows.Add()
                Me.DbhotelDataSet.ekt_apy_sumkathposa(0).sum_kath_posa = Me.DbhotelDataSet.timologioanalysis(0).sumkathposa.ToString("N") 'sumSumPosa.ToString("N")
                Me.DbhotelDataSet.ekt_apy_sumkathposa(0).ypnos = Me.DbhotelDataSet.timologioanalysis(0).ypnos.ToString("N") ' EkdosiParastYpnosTbx.Text
                Me.DbhotelDataSet.ekt_apy_sumkathposa(0).prwino = Me.DbhotelDataSet.timologioanalysis(0).prwino.ToString("N") 'EkdosiParastPrwinoTbx.Text
                Me.DbhotelDataSet.ekt_apy_sumkathposa(0).geumata = Me.DbhotelDataSet.timologioanalysis(0).geuma.ToString("N") ' EkdosiParastGeumaTbx.Text ' (CType(EkdosiParastGeumaTbx.Text, Single) + CType(EkdosiParastDeipnoTbx.Text, Single)).ToString("N")
                Me.DbhotelDataSet.ekt_apy_sumkathposa(0).extras = Me.DbhotelDataSet.timologioanalysis(0).deipno.ToString("N") 'EkdosiParastDeipnoTbx.Text

                Me.DbhotelDataSet.ekt_apy_sumfpa.Rows.Add()

                Me.DbhotelDataSet.ekt_apy_sumfpa(0).ypnos = Me.DbhotelDataSet.timologioanalysis(0).ypnosfpa.ToString("N") 'EkdosiParastYpnosFpaTbx.Text
                Me.DbhotelDataSet.ekt_apy_sumfpa(0).prwino = Me.DbhotelDataSet.timologioanalysis(0).prwinofpa.ToString("N") 'EkdosiParastPrwinoFpaTbx.Text
                Me.DbhotelDataSet.ekt_apy_sumfpa(0).geumata = Me.DbhotelDataSet.timologioanalysis(0).geumafpa.ToString("N") 'EkdosiParastGeumaFpaTbx.Text '(CType(EkdosiParastGeumaFpaTbx.Text, Single) + CType(EkdosiParastDeipnoFpaTbx.Text, Single)).ToString("N")
                Me.DbhotelDataSet.ekt_apy_sumfpa(0).extras = Me.DbhotelDataSet.timologioanalysis(0).deipnofpa.ToString("N") 'EkdosiParastDeipnoFpaTbx.Text

                If IsDBNull(Me.DbhotelDataSet.timologia(0).Item("qrcode")) OrElse Me.DbhotelDataSet.timologia(0).qrcode.Length = 0 Then
                    Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode("Απώλεια Διασύνδεσης")
                Else
                    Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode(Me.DbhotelDataSet.timologia(0).qrcode)
                End If

                'Me.DbhotelDataSet.ekt_apy_diafora.Rows.Add()
                'If IsDBNull(Me.DbhotelDataSet.ekt_apy_diafora(0).Item("qrcode")) OrElse Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode.Length = 0 Then
                '    Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode("Απώλεια Διασύνδεσης")
                'End If
                If Me.DbhotelDataSet.praktoreia(0).individual AndAlso (Me.DbhotelDataSet.apy.Count = 1) Then
                    Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.apy(0).eponimia
                    Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.apy(0).dieuthinsi
                    Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.apy(0).afm
                    Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.apy(0).doy

                Else
                    Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.praktoreia(0).titlostimolog
                    Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.praktoreia(0).dieuthinsi
                    Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.praktoreia(0).afm
                    Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.praktoreia(0).doy
                End If

                'Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.praktoreia(0).titlostimolog
                'Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.praktoreia(0).dieuthinsi
                'Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.praktoreia(0).afm
                'Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.praktoreia(0).doy

                Me.DbhotelDataSet.ekt_apy_diafora(0)._date = EkdosiParastPck.Value

                Me.DbhotelDataSet.ekt_apy_diafora(0).prokataboli = EkdosiParastProkatabTbx.Text


                Me.DbhotelDataSet.ekt_apy_diafora(0).geniko_synolo = EkdosiParastSynolaTbx.Text



                'edw pairnw ton aktuelle aa apo table parastatika(->stin etaireia exw apothikeusei ton DB kwd tou APY sta Parastatika Table)

                Me.DbhotelDataSet.ekt_apy_diafora(0).aa_apy = aaParast
                Me.DbhotelDataSet.ekt_apy_diafora(0).seira = Me.DbhotelDataSet.parastatika(0).seira
                Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros = EkdosiParastParastAitTbx.Text
                If (EkdosiParastTrPliromCbx.SelectedItem) = Nothing OrElse (EkdosiParastTrPliromCbx.SelectedItem) = "Επί Πιστώση" Then
                    Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = "Επί Πιστώση"
                    Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = (EkdosiParastSynolaTbx.Text - EkdosiParastProkatabTbx.Text).ToString("N")
                Else

                    Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = EkdosiParastTrPliromCbx.SelectedItem
                    Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = "0,00"
                End If

                Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia = EkdosiParastParastAitTbx.Text



                'If ist_pistotiko(parastParastKwd) Then
                '    preopisk_extra_pistotiko()
                'Else
                '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = Me.DbhotelDataSet.parastatika(0).tipos
                '    preopisk_extra_parastat()
                'End If
                'If parastParastKwd = 2 Then
                '    preopisk_extra_pistotiko()
                'ElseIf parastParastKwd = Me.DbhotelDataSet.etaireia(0).timolkwd Then
                '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΤΙΜΟΛΟΓΙΟ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
                '    preopisk_extra_parastat()
                'Else
                '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΑΠΟΔΕΙΞΗ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
                '    preopisk_extra_parastat()
                'End If
                Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = Me.DbhotelDataSet.parastatika(0).tipos
                preopisk_extra_parastat()
                init_parast_felder(True)

            Catch ex As Exception
                MsgBox(" H καταχώριση απέτυχε ! ", MsgBoxStyle.Critical, "winfo\nikEl.")
            End Try

        End If

    End Sub
    Private Sub ArkratExtrTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ArkratExtrTbx.Leave
        Dim zahl As Int16
        If Not sender.text.Equals("") Then
            Try
                zahl = CType(sender.text, Int16)
                Me.ApyTableAdapter.FillApyByEtosArkrat(Me.DbhotelDataSet.apy, etos, zahl)
                If Me.DbhotelDataSet.apy.Count = 1 Then

                    MsgBox(Me.DbhotelDataSet.apy(0).eponimia)
                Else
                    sender.text = ""
                End If
            Catch ex As InvalidCastException
                sender.text = ""
            End Try
        Else
            Me.DbhotelDataSet.apy.Clear()
        End If

    End Sub
    Private Sub EkdosiParastKataxwrisiNeouBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastEktBtn.Click
        If statusParast = 1 Then
            Try
                Me.DbhotelDataSet.ekt_apy_sumkathposa.Clear()
                Me.DbhotelDataSet.ekt_apy_sumfpa.Clear()
                Me.DbhotelDataSet.ekt_apy_diafora.Clear()
                Me.DbhotelDataSet.ekt_apy_diafora.Rows.Add()
                If ekdosi_extra_parastatikou() Then
                    Me.DbhotelDataSet.ekt_apy_sumkathposa.Rows.Add()
                    Me.DbhotelDataSet.ekt_apy_sumkathposa(0).sum_kath_posa = sumSumPosa.ToString("N")
                    Me.DbhotelDataSet.ekt_apy_sumkathposa(0).ypnos = EkdosiParastYpnosTbx.Text
                    Me.DbhotelDataSet.ekt_apy_sumkathposa(0).prwino = EkdosiParastPrwinoTbx.Text
                    Me.DbhotelDataSet.ekt_apy_sumkathposa(0).geumata = EkdosiParastGeumaTbx.Text ' (CType(EkdosiParastGeumaTbx.Text, Single) + CType(EkdosiParastDeipnoTbx.Text, Single)).ToString("N")
                    Me.DbhotelDataSet.ekt_apy_sumkathposa(0).extras = EkdosiParastDeipnoTbx.Text

                    Me.DbhotelDataSet.ekt_apy_sumfpa.Rows.Add()

                    Me.DbhotelDataSet.ekt_apy_sumfpa(0).ypnos = EkdosiParastYpnosFpaTbx.Text
                    Me.DbhotelDataSet.ekt_apy_sumfpa(0).prwino = EkdosiParastPrwinoFpaTbx.Text
                    Me.DbhotelDataSet.ekt_apy_sumfpa(0).geumata = EkdosiParastGeumaFpaTbx.Text '(CType(EkdosiParastGeumaFpaTbx.Text, Single) + CType(EkdosiParastDeipnoFpaTbx.Text, Single)).ToString("N")
                    Me.DbhotelDataSet.ekt_apy_sumfpa(0).extras = EkdosiParastDeipnoFpaTbx.Text


                    'Me.DbhotelDataSet.ekt_apy_diafora.Rows.Add()
                    If IsDBNull(Me.DbhotelDataSet.ekt_apy_diafora(0).Item("qrcode")) OrElse Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode.Length = 0 Then
                        Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode("Απώλεια Διασύνδεσης")
                    End If
                    If Me.DbhotelDataSet.praktoreia(0).individual AndAlso (Me.DbhotelDataSet.apy.Count = 1) Then
                        Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.apy(0).eponimia
                        Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.apy(0).dieuthinsi
                        Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.apy(0).afm
                        Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.apy(0).doy

                    Else
                        Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.praktoreia(0).titlostimolog
                        Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.praktoreia(0).dieuthinsi
                        Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.praktoreia(0).afm
                        Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.praktoreia(0).doy
                    End If

                    'Me.DbhotelDataSet.ekt_apy_diafora(0).eponimia = Me.DbhotelDataSet.praktoreia(0).titlostimolog
                    'Me.DbhotelDataSet.ekt_apy_diafora(0).address = Me.DbhotelDataSet.praktoreia(0).dieuthinsi
                    'Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt = Me.DbhotelDataSet.praktoreia(0).afm
                    'Me.DbhotelDataSet.ekt_apy_diafora(0).doy = Me.DbhotelDataSet.praktoreia(0).doy

                    Me.DbhotelDataSet.ekt_apy_diafora(0)._date = EkdosiParastPck.Value

                    Me.DbhotelDataSet.ekt_apy_diafora(0).prokataboli = EkdosiParastProkatabTbx.Text


                    Me.DbhotelDataSet.ekt_apy_diafora(0).geniko_synolo = EkdosiParastSynolaTbx.Text



                    'edw pairnw ton aktuelle aa apo table parastatika(->stin etaireia exw apothikeusei ton DB kwd tou APY sta Parastatika Table)

                    Me.DbhotelDataSet.ekt_apy_diafora(0).aa_apy = aaParast
                    Me.DbhotelDataSet.ekt_apy_diafora(0).seira = Me.DbhotelDataSet.parastatika(0).seira
                    Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros = EkdosiParastParastAitTbx.Text
                    If (EkdosiParastTrPliromCbx.SelectedItem) = Nothing OrElse (EkdosiParastTrPliromCbx.SelectedItem) = "Επί Πιστώση" Then
                        Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = "Επί Πιστώση"
                        Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = (EkdosiParastSynolaTbx.Text - EkdosiParastProkatabTbx.Text).ToString("N")
                    Else

                        Me.DbhotelDataSet.ekt_apy_diafora(0).tropos_pliromis = EkdosiParastTrPliromCbx.SelectedItem
                        Me.DbhotelDataSet.ekt_apy_diafora(0).ypoloipon = "0,00"
                    End If

                    Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia = EkdosiParastParastAitTbx.Text



                    'If ist_pistotiko(parastParastKwd) Then
                    '    preopisk_extra_pistotiko()
                    'Else
                    '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = Me.DbhotelDataSet.parastatika(0).tipos
                    '    preopisk_extra_parastat()
                    'End If
                    'If parastParastKwd = 2 Then
                    '    preopisk_extra_pistotiko()
                    'ElseIf parastParastKwd = Me.DbhotelDataSet.etaireia(0).timolkwd Then
                    '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΤΙΜΟΛΟΓΙΟ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
                    '    preopisk_extra_parastat()
                    'Else
                    '    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = "ΑΠΟΔΕΙΞΗ ΠΑΡΟΧΗΣ ΥΠΗΡΕΣΙΩΝ"
                    '    preopisk_extra_parastat()
                    'End If
                    Me.DbhotelDataSet.ekt_apy_diafora(0).titlos = Me.DbhotelDataSet.parastatika(0).tipos
                    preopisk_extra_parastat()
                    init_parast_felder(True)

                    'MsgBox(" Επιτυχής καταχώριση ! ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If
            Catch ex As Exception
                MsgBox(ex.Message)
                MsgBox(" H καταχώριση - έκδοση απέτυχε ! ", MsgBoxStyle.Critical, "winfo\nikEl.")
            End Try
        Else
            MsgBox(" Δεν υφίσταται αυτή η επιλογή! ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If


    End Sub

    Private Sub preopisk_extra_parastat()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New ExtraParastatikaDomisi()
        Dim afmadapter As New dbhotelDataSetTableAdapters.afmTableAdapter

        afmadapter.FillByKwd(Me.DbhotelDataSet.afm, kwdParastAfm)
        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        afmadapter.Fill(Me.DbhotelDataSet.afm)
    End Sub
    Private Sub preopisk_extra_pistotiko()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New ExtraParastPistotiko()
        Dim afmadapter As New dbhotelDataSetTableAdapters.afmTableAdapter

        afmadapter.FillByKwd(Me.DbhotelDataSet.afm, kwdParastAfm)
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
    End Sub
    Private Function ekdosi_extra_parastatikou() As Boolean
        Dim seira As String
        Dim exoflithi As Boolean = False
        Dim akyro As Boolean = False
        Dim kwdTimolog As Integer = -1
        Dim ypoloipon As Single = 0
        'Dim response As MsgBoxResult
        Dim aktAAParast As Integer
        Dim timID, aaMax As Int16
        Dim response As MsgBoxResult
        Try
            seira = Me.DbhotelDataSet.parastatika(0).seira
            'seira = Me.ParastatikaTableAdapter.GetSeiraParastByKwd(parastParastKwd)
        Catch ex As InvalidOperationException
            seira = Nothing
        End Try

        Try
            ypoloipon = EkdosiParastSynolaTbx.Text - EkdosiParastProkatabTbx.Text
        Catch ex As InvalidCastException
            ypoloipon = 0
        End Try
        'If EkdosiParastTrPliromCbx.SelectedIndex <> -1 AndAlso EkdosiParastTrPliromCbx.SelectedItem.Equals("Μετρητοίς") Then
        '    exoflithi = True
        'Else
        '    exoflithi = False
        'End If
        If EkdosiParastTrPliromCbx.SelectedIndex <> -1 Then
            If EkdosiParastTrPliromCbx.SelectedItem.Equals("Επί Πιστώση") Then
                exoflithi = False
            Else
                exoflithi = True
            End If
        Else
            exoflithi = False
        End If

        If statusParast = 1 Then 'Insert neo Timologio

            If timID = 20000 Then
                Randomize()
                timID = -CInt(Int((10000 * Rnd()) + 1))
            End If

            Try
                'kanw Abfrage to megalytero kataxwrimeno aa sto Table timologia giato enlogw eidos parastatikou
                aktAAParast = Me.TimologiaTableAdapter.GetMaxAAByParastatikoEtos(parastParastKwd, arxiEtous, telosEtous, False)
                aktAAParast = aktAAParast + 1

                If aktAAParast <> aaParast Then
                    response = MsgBox("Ο Α/Α " + aaParast.ToString + " ενδέχεται να δημιουργήσει κενό στην συνεχόμενη αρίθμηση Τιμολογίων ! " & vbCrLf & "Να αντικατασταθεί με τον σωστό Αύξωντα Αριθμό ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                    If response = MsgBoxResult.Yes Then
                        aaParast = aktAAParast
                    End If
                End If
            Catch ex As InvalidOperationException
            End Try

            If EkdosiParastPck.Value.Date <> imeromErgasias Then
                response = MsgBox("ΠΡΟΣΟΧΗ: Η Ημερομηνία (διαφορετική απο την σημερινή) θα δημιουργήσει κενό στην συνεχόμενη Αρίθμηση Τιμολογίων ! Διακοπή έκδοσης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                If response = MsgBoxResult.Yes Then
                    Return False
                End If
            End If

            If aaParast <> Nothing And parastParastKwd <> Nothing And praktParastKwd <> Nothing And CType(EkdosiParastSynolaTbx.Text, Single) <> 0 Then 'And EkdosiParastPck.Value.Date >= minParastDate

                If Me.TimologiaTableAdapter.ExistAAByAAPaarastEtosAkyromeno(aaParast, parastParastKwd, arxiEtous, telosEtous, False) Then
                    MsgBox(" Υπάρχει ήδη καταχωρημένο Τιμολόγιο με ΑΑ " + aaParast.ToString, MsgBoxStyle.Critical, "winfo\nikEl.")
                    Return False
                End If
                Me.PraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.praktoreia, praktParastKwd)
                Try
                    kwdTimolog = insert_extra_parast_transaction(connectionString, aaParast, seira, synolKathPosa, synolFpa, exoflithi, ypoloipon)

                Catch ex As Exception
                    MsgBox("Η Διαδικασία έκδοσης της Παραστατικού απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Return False
                End Try

                If kwdTimolog = -1 Then
                    Return False
                Else
                    Me.TimologioanalysisTableAdapter.InsertTimologAnalysis(kwdTimolog, 0, EkdosiParastYpnosTbx.Text, EkdosiParastYpnosFpaTbx.Text,
                                                  EkdosiParastPrwinoTbx.Text, EkdosiParastPrwinoFpaTbx.Text, EkdosiParastGeumaTbx.Text, EkdosiParastGeumaFpaTbx.Text,
                                                  EkdosiParastDeipnoTbx.Text, EkdosiParastDeipnoFpaTbx.Text, 0, 0, EkdosiParastAllTbx.Text, EkdosiParastAllFpaTbx.Text, synolKathPosa, synolFpa, EkdosiParastSynolaTbx.Text, Nothing, Nothing, Nothing, 0, 0, 0, 0, 0, Nothing, -1, False, timID, 1, Nothing)


                End If

            Else
                MsgBox(" Ελέγξτε τα στοιχεία του Τιμολογίου ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                Return False
            End If
        ElseIf statusParast = 2 Then 'Update =->uparxin timlogio!
            If aaParast <> Nothing And parastParastKwd <> Nothing And praktParastKwd <> Nothing Then 'And EkdosiParastPck.Value.Date >= imeromErgasias
                If aaParast <> Me.DbhotelDataSet.timologia(0).aa Then 'user alakse to aa
                    If Me.TimologiaTableAdapter.ExistAAByAAPaarastEtosAkyromeno(aaParast, parastParastKwd, arxiEtous, telosEtous, False) Then
                        MsgBox(" Υπάρχει ήδη καταχωρημένο Τιμολόγιο με ΑΑ " + aaParast.ToString, MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If
                End If
                If EkdosiParastSynolaTbx.Text = 0 Then 'user midenise tis times ->AKYROSI timologioy!
                    Try
                        aaMax = Me.TimologiaTableAdapter.GetMaxAAByParastatikoEtos(parastParastKwd, arxiEtous, telosEtous, False)
                        If aaParast = aaMax Then 'ean einai to teleutaio kataxwrimeno tote OK gia diagrafi _>alliws den gunetai Diagrafi-> apla MHDENIKO TIMOLOGIO
                            akyro = True
                        End If
                    Catch ex As InvalidOperationException
                        MsgBox(" Ελέγξτε τα στοιχεία του Τιμολογίου ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        Return False
                    End Try

                End If
                berechne_synolo()
                Me.TimologioanalysisTableAdapter.UpdateTimologAnalysis(Me.DbhotelDataSet.timologioanalysis(0).timologio, 0, EkdosiParastYpnosTbx.Text, EkdosiParastYpnosFpaTbx.Text,
                            EkdosiParastPrwinoTbx.Text, EkdosiParastPrwinoFpaTbx.Text, EkdosiParastGeumaTbx.Text, EkdosiParastGeumaFpaTbx.Text,
                            EkdosiParastDeipnoTbx.Text, EkdosiParastDeipnoFpaTbx.Text, 0, 0, EkdosiParastAllTbx.Text, EkdosiParastAllFpaTbx.Text, synolKathPosa, synolFpa, EkdosiParastSynolaTbx.Text, 0, Nothing, Nothing, 0, 0, 0, 0, 0, Nothing, Me.DbhotelDataSet.timologioanalysis(0).kwd)


                'If aaMax <> 0 AndAlso aaParast <> Me.DbhotelDataSet.timologia(0).aa Then 'o user alakes to aa->kanw abfragen (ean den to exw kanei idi)
                'gia to megelutero AA sto DB  
                Try
                    aaMax = Me.TimologiaTableAdapter.GetMaxAAByParastatikoEtos(parastParastKwd, arxiEtous, telosEtous, False)
                Catch ex As Exception
                End Try
                'End If

                Me.TimologiaTableAdapter.UpdateTimologio(parastParastKwd, EkdosiParastPck.Value.Date, seira, aaParast, praktParastKwd, EkdosiParastParastAitTbx.Text, synolFpa,
                                                                                EkdosiParastSynolaTbx.Text, EkdosiParastProkatabTbx.Text, EkdosiParastTrPliromCbx.SelectedItem, synolKathPosa, akyro, exoflithi, 0, ypoloipon, Me.DbhotelDataSet.praktoreia(0).afm, Me.DbhotelDataSet.praktoreia(0).dieuthinsi, Me.DbhotelDataSet.praktoreia(0).doy, Nothing, Me.DbhotelDataSet.praktoreia(0).titlostimolog, 0, False, Me.DbhotelDataSet.timologia(0).kwd)
                If aaParast > aaMax And Not akyro Then ' ean to neo aa einai megalutero apo to max stin DB->enimerwsi tou TBLE parastatika pou exei to trexon AA gia to eidos tou Parastatikou
                    Me.ParastatikaTableAdapter.SetaaAPYByKwd(aaParast, parastParastKwd)
                End If
                If akyro Then 'ean o user to midenise->enimerwse
                    Try
                        aaMax = Me.TimologiaTableAdapter.GetMaxAAByParastatikoEtos(parastParastKwd, arxiEtous, telosEtous, False)
                    Catch ex As Exception ' den Yparxei KANENA katwxwrimieno parstatiko->apo DB etaireia to arxiko etous !!!
                        If parastParastKwd = 5 Then
                            aaMax = Me.DbhotelDataSet.etaireia(0).aabapy - 1
                        ElseIf parastParastKwd = 2 Then
                            aaMax = Me.DbhotelDataSet.etaireia(0).aagramatio - 1
                        End If

                    End Try
                    Me.ParastatikaTableAdapter.SetaaAPYByKwd(aaMax, parastParastKwd)
                End If

                Me.XrewseispraktoreiaTableAdapter.DeleteByTimologio(Me.DbhotelDataSet.timologia(0).kwd)
                'init_parast_felder(True)
                'Else
                '    MsgBox(" Μη επιτρεπτή Αλλαγή ΑΑ Τιμολογίου! Εισάγετε " + Me.DbhotelDataSet.timologia(0).aa.ToString, MsgBoxStyle.Exclamation, "winfo\nikEl.")
                '    EkdosiParastAATbx.Focus()
                '    Return False


            Else
                MsgBox(" Ελέγξτε τα στοιχεία του Τιμολογίου ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                Return False
            End If

        End If
        Return True
    End Function


    Private Function insert_extra_parast_transaction(ByVal connectionstring As String, ByVal aaParast As Integer, ByVal seira As String, ByVal synolKathPosa As Single, ByVal synolFpa As Single, ByVal exoflithi As Boolean, ByVal ypoloipon As Single) As Integer
        Using connection As New SqlConnection(connectionstring)
            Dim kwdNeouTimol As Integer
            Dim counter, rows As Int16
            Dim pliromi As String = Nothing
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.AddWithValue("@parastatiko", CType(parastParastKwd, Integer))
                command.Parameters.AddWithValue("@imerominia", EkdosiParastPck.Value.Date)
                If seira Is Nothing Then
                    command.Parameters.AddWithValue("@seira", "") ' anaxwrisi
                Else
                    command.Parameters.AddWithValue("@seira", seira) ' anaxwrisi
                End If

                command.Parameters.AddWithValue("@aa", aaParast)
                command.Parameters.AddWithValue("@praktoreio", praktParastKwd)
                Dim vatnumberLpt As String = ""
                'command.Parameters.AddWithValue("simbolaio", simbKrat) 'Me.DbhotelDataSet.kratiseis(0).dwmatio
                'mydata
                Dim postalCode As String
                Dim city As String
                Dim eponimLpt As String
                If Me.DbhotelDataSet.praktoreia(0).individual AndAlso (Me.DbhotelDataSet.apy.Count = 1) Then
                    command.Parameters.AddWithValue("@eponimia", Me.DbhotelDataSet.apy(0).eponimia)
                    Dim AfmPrf As New afm_pruefung
                    If AfmPrf.ist_afm_ok(Me.DbhotelDataSet.apy(0).afm) Then
                        Try
                            eponimLpt = Me.DbhotelDataSet.apy(0).eponimia

                        Catch ex As System.Data.StrongTypingException
                            eponimLpt = ""

                        End Try
                        command.Parameters.AddWithValue("@dieuthinsi", Me.DbhotelDataSet.apy(0).dieuthinsi)
                        command.Parameters.AddWithValue("@afm", Me.DbhotelDataSet.apy(0).afm)
                        vatnumberLpt = Me.DbhotelDataSet.apy(0).afm
                        command.Parameters.AddWithValue("@doy", Me.DbhotelDataSet.apy(0).doy)
                        postalCode = Me.DbhotelDataSet.apy(0).postalcode
                        Try
                            city = Me.DbhotelDataSet.apy(0).city

                        Catch ex As System.Data.StrongTypingException
                            city = ""

                        End Try
                    Else
                        MsgBox("Η Διαδικασία έκδοσης της ΤΠΥ διεκόπηκε: ΑΦΜ παραλήπτη  !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Try
                            transaction.Rollback()
                            '     rollback_timanalysis_transaction(connectionstring)
                            Return False
                        Catch
                            Return False
                        End Try

                    End If


                Else
                    command.Parameters.AddWithValue("@eponimia", Me.DbhotelDataSet.praktoreia(0).eponimia)
                    Try
                        eponimLpt = Me.DbhotelDataSet.praktoreia(0).eponimia

                    Catch ex As System.Data.StrongTypingException
                        eponimLpt = ""

                    End Try
                    command.Parameters.AddWithValue("@dieuthinsi", Me.DbhotelDataSet.praktoreia(0).dieuthinsi)
                    command.Parameters.AddWithValue("@afm", Me.DbhotelDataSet.praktoreia(0).afm)
                    vatnumberLpt = Me.DbhotelDataSet.praktoreia(0).afm
                    command.Parameters.AddWithValue("@doy", Me.DbhotelDataSet.praktoreia(0).doy)
                    'mydata
                    postalCode = Me.DbhotelDataSet.praktoreia(0).mpournouzia
                    Try
                        city = Me.DbhotelDataSet.praktoreia(0).fax

                    Catch ex As System.Data.StrongTypingException
                        city = ""

                    End Try
                End If

                command.Parameters.AddWithValue("@aitiologia", EkdosiParastParastAitTbx.Text)
                command.Parameters.AddWithValue("@sumkathposa", synolKathPosa)

                command.Parameters.AddWithValue("@fpa", synolFpa)
                command.Parameters.AddWithValue("@synola", CType(EkdosiParastSynolaTbx.Text, Single))
                command.Parameters.AddWithValue("@prokataboli", prokatKrat)
                command.Parameters.AddWithValue("@simetoxi", simetKrat)
                command.Parameters.AddWithValue("@ypoloipon", ypoloipon)
                If (EkdosiParastTrPliromCbx.SelectedItem) = Nothing Then
                    pliromi = "Επί Πιστώση"
                Else
                    pliromi = EkdosiParastTrPliromCbx.SelectedItem
                End If
                command.Parameters.AddWithValue("@pliromi", pliromi)

                command.Parameters.AddWithValue("@exoflithi", exoflithi)

                command.Parameters.AddWithValue("@identifikation", timolID)
                'command.CommandText = "INSERT INTO timologia (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi," &
                '"afm, doy, aitiologia, sumkathposa, fpa,  synola, prokataboli, simetoxi, ypoloipon, pliromi, exoflithi, akyromeno, extra, memonomeno, mauro,identifikation) " &
                '"VALUES (parastatiko, imerominia, seira, aa, praktoreio, -1, eponimia, dieuthinsi, afm, doy, aitiologia, sumkathposa, fpa,  synola, prokataboli, simetoxi, ypoloipon," &
                '" pliromi,  exoflithi, false, true, false, false, identifikation)"
                'command.ExecuteNonQuery()
                'command.Parameters.Clear()
                command.CommandText = "INSERT INTO timologia (parastatiko, imerominia, seira, aa, praktoreio, simbolaio, eponimia, dieuthinsi," &
            "afm, doy, aitiologia, sumkathposa, fpa,  synola, prokataboli, simetoxi, ypoloipon, pliromi, exoflithi, akyromeno, extra, memonomeno, mauro,identifikation) " &
            "VALUES (@parastatiko, @imerominia, @seira, @aa, @praktoreio, -1, @eponimia, @dieuthinsi, @afm, @doy, @aitiologia, @sumkathposa, @fpa,  @synola, @prokataboli, @simetoxi, @ypoloipon," &
            " @pliromi,  @exoflithi, 0, 1, 0, 0, @identifikation)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                'Me.ParastatikaTableAdapter.UpdateAAByKwd(aaParast, parastParastKwd) 'Enimerwsi tou aktuelle aa sto table parastatika   

                command.Parameters.AddWithValue("@aritthmos", aaParast)
                command.Parameters.AddWithValue("@kwd", CType(parastParastKwd, Integer))
                command.CommandText = "UPDATE parastatika SET aritthmos=@aritthmos WHERE (kwd=@kwd)"
                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@parastatiko", CType(parastParastKwd, Integer))
                command.Parameters.AddWithValue("@imerominia", EkdosiParastPck.Value.Date)
                command.Parameters.AddWithValue("@aa", aaParast)
                'command.Parameters.AddWithValue("@identifikation", timolID)
                command.CommandText = "SELECT kwd FROM timologia WHERE (parastatiko=@parastatiko) AND (imerominia=@imerominia) AND (aa=@aa) AND (akyromeno=0)" 'and (identifikation=@identifikation)
                Dim myReader As SqlDataReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                While myReader.Read()
                    kwdNeouTimol = myReader.GetInt32(0)
                    counter += 1
                End While
                ' always call Close when done reading.
                myReader.Close()
                command.Parameters.Clear()


                If counter <> 1 And rows <> 0 Then ' paei na pei oti brethikan parapanw timologia me ton idio aa
                    transaction.Rollback()
                    'rollback_timanalysis_transaction(connectionstring)
                    MsgBox("Η Διαδικασία έκδοσης της Παραστατικού απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Return -1
                Else
                    transaction.Commit()
                End If
                'mydata 
                Dim tipos As String = "ΤΠΥ"
                Dim response, response1 As MsgBoxResult
                response = MsgBox("Ενημέρωση myData ;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                If response = MsgBoxResult.Yes Then


                    command.Parameters.AddWithValue("@kwd", parastParastKwd)
                    command.CommandText = "SELECT afm.afm, afm.epixirisi, parastatika.tipos, afm.kwd FROM afm INNER JOIN parastatika ON afm.kwd=parastatika.etaireia WHERE (parastatika.kwd=@kwd)" 'and (identifikation=?)
                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    myReader.Read()
                    Dim afmDomisi, epixirisiDomisi, tiposparDomisi, aadeUserId, apiKey, postalCodeEkd, cityEkd, branchEkd, countryEkd As String
                    Dim afmKwd As Int32
                    Try
                        afmDomisi = myReader.Item(0)
                        afmKwd = myReader.Item(3)
                    Catch ex As InvalidCastException
                        afmDomisi = ""
                    End Try
                    Try
                        epixirisiDomisi = myReader.Item(1)
                        tiposparDomisi = myReader.Item(2)
                    Catch ex As InvalidCastException
                        epixirisiDomisi = ""
                        tiposparDomisi = ""
                    End Try
                    myReader.Close()
                    command.Parameters.Clear()
                    command.Parameters.AddWithValue("@kwd", afmKwd)
                    command.CommandText = "SELECT  mydata.aadeUserId, mydata.apiKey,branch,postalCode,city, country FROM afm  INNER JOIN mydata ON afm.kwd=mydata.afm WHERE (afm.kwd=@kwd)"
                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    myReader.Read()

                    Try
                        aadeUserId = myReader.Item(0)
                        apiKey = myReader.Item(1)
                        branchEkd = myReader.Item(2)
                        postalCodeEkd = myReader.Item(3)
                        cityEkd = myReader.Item(4)
                        countryEkd = myReader.Item(5)
                    Catch ex As Exception
                        MsgBox("Cannot find myDATA credentilas!", MsgBoxStyle.Critical)
                    End Try
                    ' always call Close when done reading.
                    myReader.Close()
                    command.Parameters.Clear()
                    Try

                        If (parastParastKwd = 5) Or (parastParastKwd = 10) Or (parastParastKwd = 14) Or (parastParastKwd = 18) Or (parastParastKwd = 22) Or (parastParastKwd = 26) Or (parastParastKwd = 30) Or (parastParastKwd = 370951998) Then
                            tipos = "2.1"



                        ElseIf (parastParastKwd = 6) Or (parastParastKwd = 11) Or (parastParastKwd = 15) Or (parastParastKwd = 19) Or (parastParastKwd = 23) Or (parastParastKwd = 27) Or (parastParastKwd = 31) Or (parastParastKwd = 1733806379) Then

                            'tipos = "ΑΠΥ"
                            tipos = "11.2"

                        ElseIf (parastParastKwd = 2) Or (parastParastKwd = 7) Or (parastParastKwd = 12) Or (parastParastKwd = 16) Or (parastParastKwd = 20) Or (parastParastKwd = 24) Or (parastParastKwd = 28) Or (parastParastKwd = -1125450096) Then
                            tipos = "5.2"
                        ElseIf (parastParastKwd = 3) Or (parastParastKwd = 8) Or (parastParastKwd = 13) Or (parastParastKwd = 17) Or (parastParastKwd = 21) Or (parastParastKwd = 24) Or (parastParastKwd = 29) Or (parastParastKwd = 704913233) Then
                            'tipos = "ΠΑ"
                            tipos = "11.4"
                        End If
                        Dim sendInvoice = New SendInvoices(connectionstring, aadeUserId, apiKey, epixirisiDomisi, tiposparDomisi, kwdNeouTimol, tipos, afmDomisi, countryEkd, branchEkd, postalCodeEkd, cityEkd, vatnumberLpt, CountriesExtCbx.SelectedItem, BranchExtrTbx.Text, eponimLpt, EkdosiParastParastAitTbx.Text, postalCode, city, seira,
                                            aaParast, EkdosiParastPck.Value.Date, pliromi, Nothing, Math.Round(synolKathPosa, 2), EkdosiParastYpnosTbx.Text, EkdosiParastPrwinoTbx.Text, EkdosiParastGeumaTbx.Text, EkdosiParastDeipnoTbx.Text, Me.DbhotelDataSet.etaireia(0).fpatrofis1,
          Me.DbhotelDataSet.etaireia(0).fpatrofis2, Me.DbhotelDataSet.etaireia(0).fpatrofis3, Me.DbhotelDataSet.etaireia(0).fpatrofis3) ', Me.DbhotelDataSet.ekt_apy_diafora(0).dim_foros
                        Dim threadSendInvoice As Threading.Thread
                        threadSendInvoice = sendInvoice.set_mode(0)
                        threadSendInvoice = sendInvoice.send_invoice()
                        Dim timeoutMilliseconds As Integer = 10000 ' Set your desired timeout in milliseconds (10 seconds in this example)
                        Dim startTime As DateTime = DateTime.Now

                        While threadSendInvoice.IsAlive
                            ' Your loop body here

                            ' Check if the timeout has been reached
                            Dim elapsedMilliseconds As Integer = CInt((DateTime.Now - startTime).TotalMilliseconds)
                            If elapsedMilliseconds >= timeoutMilliseconds Then
                                ' Timeout reached, break out of the loop
                                Exit While
                            End If

                            ' Optionally, you can add a small delay to reduce CPU usage
                            'System.Threading.Thread.Sleep(100) ' Sleep for 100 milliseconds (adjust as needed)
                        End While
                        Dim qrUrl As String = ""
                        command.Parameters.AddWithValue("timologio", kwdNeouTimol)
                        command.CommandText = "SELECT qrcode FROM myinvoices WHERE (timologio=@timologio)"
                        myReader = command.ExecuteReader()
                        ' Always call Read before accessing data.
                        If myReader.HasRows AndAlso myReader.Read() Then
                            Try
                                qrUrl = myReader.Item(0)
                                'Dim encoder As New QRCodeEncoder()

                                '' Set encoding properties
                                'encoder.QRCodeEncodeMode = QRCodeEncoder.ENCODE_MODE.BYTE
                                'encoder.QRCodeScale = 4
                                'encoder.QRCodeVersion = 8
                                'encoder.QRCodeErrorCorrect = QRCodeEncoder.ERROR_CORRECTION.L

                                '' Encode the string as a QR code and get the Bitmap
                                'Dim qrBitmap As Bitmap = encoder.Encode(qrUrl)

                                '' Convert Bitmap to Byte array
                                'Dim byteArray As Byte() = BitmapToByteArray(qrBitmap)

                                Me.DbhotelDataSet.ekt_apy_diafora(0).qrcode = create_qrcode(qrUrl)

                            Catch ex As InvalidCastException
                                MsgBox("No QRCode!", MsgBoxStyle.Critical)
                            End Try
                        End If

                        myReader.Close()
                        command.Parameters.Clear()
                        If Not String.IsNullOrEmpty(qrUrl) Then
                            command.Parameters.AddWithValue("qrcode", qrUrl)
                            command.Parameters.AddWithValue("timologio", kwdNeouTimol)

                            command.CommandText = "UPDATE timologia SET qrcode = @qrcode WHERE (kwd = @timologio)"
                            command.ExecuteNonQuery()
                            command.Parameters.Clear()
                        End If


                    Catch ex As Exception
                        transaction.Rollback()

                        Return False
                    End Try



                    'Me.DbhotelDataSet.ekt_apy_diafora(0).afm_adt  city

                    '       MsgBox(Me.DbhotelDataSet.ekt_apy_diafora(0).aitiologia)

                End If
                Return kwdNeouTimol
            Catch ex As Exception
                MsgBox("Η Διαδικασία έκδοσης της Παραστατικού απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch ex1 As Exception
                    Return -1
                End Try

            End Try

        End Using

    End Function

    Private Sub trop_pliromis_parast_cbox_fuelle()
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.pistwtikes.Count + 1
            If j = 0 Then
                EkdosiParastTrPliromCbx.Items.Add("Επί Πιστώση")
            ElseIf j = 1 Then
                EkdosiParastTrPliromCbx.Items.Add("Μετρητοίς")
            Else
                EkdosiParastTrPliromCbx.Items.Add(Me.DbhotelDataSet.pistwtikes(j - 2).karta)

            End If
        Next
    End Sub
    Private Sub EkdosiParastNeoBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastNeoBtn.Click
        init_parast_felder(True)
    End Sub
    Private Sub ParastCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ParastCbx.SelectedIndexChanged
        If sender.selectedIndex < 1 Then
            kwdParastAfm = -1
        Else
            kwdParastAfm = Me.DbhotelDataSet1.afm(sender.selectedINdex - 1).kwd
        End If

        init_cbxoen()
    End Sub
    Private Sub fuehle_parast_cbx()
        Dim j As Int16
        ParastCbx.Items.Clear()

        For j = 0 To Me.DbhotelDataSet1.afm.Count
            If j = 0 Then
                ParastCbx.Items.Add("<Εταιρεία>")
            Else
                ParastCbx.Items.Add(Me.DbhotelDataSet1.afm(j - 1)._alias)
            End If

        Next
    End Sub
    Private Sub init_cbxoen()
        Dim j As Int16
        aaParast = Nothing
        EkdosiParastAATbx.Clear()
        Me.ParastatikaTableAdapter.FillParastByAfm(Me.DbhotelDataSet.parastatika, kwdParastAfm)
        Me.EkdosiParastParastCbx.SelectedIndex = -1
        Me.EkdosiParastParastCbx.Items.Clear()
        ReDim parastCboxKwd(Me.DbhotelDataSet.parastatika.Count - 1)
        For j = 0 To Me.DbhotelDataSet.parastatika.Count - 1
            Me.EkdosiParastParastCbx.Items.Add(Me.DbhotelDataSet.parastatika(j).tipos + " Σειρά " + Me.DbhotelDataSet.parastatika(j).seira)
            parastCboxKwd(j) = Me.DbhotelDataSet.parastatika(j).kwd
        Next
        'For j = 0 To Me.DbhotelDataSet.pistwtikes.Count + 1
        '    If j = 0 Then
        '        EkdosiParastTrPliromCbx.Items.Add("Επί Πιστώση")
        '    ElseIf j = 1 Then
        '        EkdosiParastTrPliromCbx.Items.Add("Μετρητοίς")
        '    Else
        '        EkdosiParastTrPliromCbx.Items.Add(Me.DbhotelDataSet.pistwtikes(j - 2).karta)

        '    End If
        'Next
        'EkdosiParastTrPliromCbx
    End Sub
    Private Sub init_parast_felder(ByVal initIndex As Boolean)
        Dim s As Single = 0

        statusParast = 1 'Insert
        If initIndex Then
            ParastCbx.SelectedIndex = -1
            EkdosiParastParastCbx.SelectedIndex = -1
            kwdParastAfm = -1
            Me.DbhotelDataSet.apy.Clear()
        End If

        EkdosiParastAATbx.Clear()
        EkdosiParastPraktTbx.Clear()
        ArkratExtrTbx.Clear()
        parastParastKwd = Nothing
        EkdosiParastAATbx.Clear()
        aaParast = Nothing
        EkdosiParastParastAitTbx.Clear()
        'MsgBox(minParastDate)

        EkdosiParastPck.Value = imeromErgasias

        EkdosiParastYpnosTbx.Text = s.ToString("N")
        EkdosiParastPrwinoTbx.Text = s.ToString("N")
        EkdosiParastGeumaTbx.Text = s.ToString("N")
        EkdosiParastDeipnoTbx.Text = s.ToString("N")
        EkdosiParastAllTbx.Text = s.ToString("N")
        EkdosiParastYpnosFpaTbx.Text = s.ToString("N")
        EkdosiParastPrwinoFpaTbx.Text = s.ToString("N")
        EkdosiParastGeumaFpaTbx.Text = s.ToString("N")
        EkdosiParastDeipnoFpaTbx.Text = s.ToString("N")
        EkdosiParastAllFpaTbx.Text = s.ToString("N")
        EkdosiParastSynolaTbx.Text = s.ToString("N")
        EkdosiParastProkatabTbx.Text = s.ToString("N")
        EkdosiParastTrPliromCbx.SelectedIndex = -1

    End Sub

    Private Sub EkdosiParastTrPliromCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkdosiParastTrPliromCbx.TextUpdate
        MsgBox("Δεν επιτρέπεται αλλαγή (Γιά εισαγωγή νέας πιστωτικής κάρτας ανατρέξτε στους Παράμετρους της Εφαρμογής) !", MsgBoxStyle.Information, "winfo\nikEl.")
        EkdosiParastTrPliromCbx.SelectedIndex = -1
    End Sub

    Private Function get_index_tropos_pliromis_cbox(ByVal pliromi As String) As Int16
        Dim i As Int16

        For i = 0 To EkdosiParastTrPliromCbx.Items.Count - 1
            If EkdosiParastTrPliromCbx.Items(i).ToString = pliromi Then
                Return i
            End If
        Next
        Return -1
    End Function

    '**********************STATUS DWMATIWN GIA PROISTAMENI***********************STATUS DWMATIWN GIA PROISTAMENI********STATUS DWMATIWN GIA PROISTAMENI**********************************
    ' ektuponei katastasi OLWN dwmatiwn me plirofories atoma-paidia-cot (kounia) ->Episis Atoma pou kanoun IN=Afixi OUT=anaxwrisi Kathws
    'akoma ektipwnei Sentonia-Petsetes analoga me tin Simfonia me to Praktoreio
    Private Sub pinakas_status_dwmatiwn()

        PinakasDwmPck.Value = imeromErgasias
        EtikLbl.Text = "ΗΜΕΡΗΣΙΑ ΚΙΝΗΣΗ ΔΩΜΑΤΙΩΝ"
        EtikLbl.Location = New Point(PinakasDwmPnl.Width / 4, 25)

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        PinakasDwmPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.PinakasDwmPnl.Size = New Point(830, ZentralPnl.Height)

        init_pinakas_dwmatia_dataset()

        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        Me.ZentralPnl.Controls.Add(PinakasDwmPnl)
    End Sub
    Private Sub init_pinakas_dwmatia_dataset()
        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Clear()
    End Sub
    Private Sub PinakasDwmPck_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PinakasDwmPck.ValueChanged
        init_pinakas_dwmatia_dataset()
    End Sub
    Private Sub PinakasDwmBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PinakasDwmBtn.Click
        Dim j, i, counter, paidia, enilikes, imerPets, imerSent, indiz1, indiz2 As Int16 ' cot,
        Dim index() As Int16
        'Dim maxAfix, maxAnax As Date
        Dim dwmatia() As String
        Dim zimmerApo, zimmerEws, xrewsi, diarkiaDiam, cot As String

        Try
            Me.Cursor = Cursors.WaitCursor
            ReDim dwmatia(-1)
            Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Clear()

            If PinakasDwm1Tbx.Text.Equals("") Then
                zimmerApo = Me.DwmatiaTableAdapter1.GetMinArDwmatiouXenod(13, 25)
            Else
                zimmerApo = PinakasDwm1Tbx.Text
            End If
            If PinakasDwm2Tbx.Text.Equals("") Then
                zimmerEws = Me.DwmatiaTableAdapter1.GetMaxArDwmatiouXenod(13, 25)
            Else
                zimmerEws = PinakasDwm2Tbx.Text
            End If
            If zimmerApo <= zimmerEws Then
                Me.DwmatiaTableAdapter1.DwmatiaApoEwsXenod(Me.DbhotelDataSet1.dwmatia, zimmerApo, zimmerEws, 13, 25)
            Else
                Me.DwmatiaTableAdapter1.FillOhneOvBookXenod(Me.DbhotelDataSet1.dwmatia, 13, 25)
            End If

            'LIsta me OLA ta Dwmatia (fusika ohne OverBook) 
            For j = 0 To Me.DbhotelDataSet1.dwmatia.Count - 1
                ReDim Preserve dwmatia(j)
                dwmatia(j) = Me.DbhotelDataSet1.dwmatia(j).arithmos
            Next

            'Join anfrage sta Tabble Kratiseis X timeskratiseisX PraktoreioX paidia gia infos opws xrewsi, Cot ktl.
            'resultiert 1 X 1 X 1 X N (giati timeskratiseis MONO 1 tupel logw apo mexri, paidia OMWS N-tupel)->normalize!!!!!!!!
            If (PinakasDwm2Rdb.Checked) Then 'kai ATSEKARISTES AFIXEIS  mazi
                'Me.KratiseisTableAdapter.FillByAfAnaxCheckInOutDwm(Me.DbhotelDataSet.kratiseis, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, False, False, zimmerApo, zimmerEws)
                Me.KatastasiapyTableAdapter1.FillKatastasiProistamenismekaiAfix(Me.DbhotelDataSet1.katastasiapy, PinakasDwmPck.Value.Date, PinakasDwmPck.Value.Date, zimmerApo, zimmerEws, "OV-BOOK", 13, 25)
            Else 'mono osoi exoun kanei Checkin!
                'Me.KratiseisTableAdapter.FillByAfAnaxCheckInOutDwm(Me.DbhotelDataSet.kratiseis, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, True, True, zimmerApo, zimmerEws)
                Me.KatastasiapyTableAdapter1.FillKatastasiProistamenisChkIn(Me.DbhotelDataSet1.katastasiapy, PinakasDwmPck.Value.Date, PinakasDwmPck.Value.Date, True, zimmerApo, zimmerEws, "OV-BOOK", 13, 25)
            End If

            'epeidi exw logw twn paidiwn N tupel ana Kratisi->kanw Remove Ola ta tupel PLIN to prwto kai sunama metaferw tis Plirofories gia COT sto PRWTO TUPEL!!!!!!!!
            normalize_katastasi_1()

            counter = 1
            Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Rows.Add()

            'gia KATHE uparxon dwmatio tou Hotel
            For j = 0 To dwmatia.Length - 1
                'briskw ta indexen sto Dataset pou aforoun to Dwmatio ->Achtung: mporoun na einai PLEON tou enos logw DoppelStay !!
                index = get_dwmatio_dataset1_index(dwmatia(j))
                cot = ""
                If index.Length <> 0 Then 'length=0 ->dwmatio Keno, length=1 Dwmatio 1mal vergeben, length>1 dwmatio vielmal vergeben!
                    'ean einai Vergeben 
                    paidia = 0
                    enilikes = 0
                    'cot = 0

                    imerPets = 15
                    imerSent = 15

                    For i = 0 To index.Length - 1
                        If index.Length > 1 Then 'doppel Vergeben ->diarkeia apo thn pio PROSFATH kratisi
                            indiz1 = max_afixi1(index)
                            indiz2 = max_anaxwrisi1(index)
                            diarkiaDiam = afix_anax(Me.DbhotelDataSet1.katastasiapy(indiz1).afixi.Date, Me.DbhotelDataSet1.katastasiapy(indiz2).anaxwrisi.Date)
                        Else
                            indiz1 = index(i)
                            diarkiaDiam = afix_anax(Me.DbhotelDataSet1.katastasiapy(indiz1).afixi.Date, Me.DbhotelDataSet1.katastasiapy(indiz1).anaxwrisi)
                        End If

                        enilikes = Me.DbhotelDataSet1.katastasiapy(index(i)).enilikes

                        paidia = Me.DbhotelDataSet1.katastasiapy(index(i)).paidia
                        xrewsi = Me.DbhotelDataSet1.katastasiapy(index(i)).xrewsi
                        Try
                            cot = Me.DbhotelDataSet1.katastasiapy(index(i)).cot
                        Catch ex As Exception

                        End Try

                        'Try
                        '    If Not Me.DbhotelDataSet.katastasiapy(index(i)).cot.Equals("") Then
                        '        If CType(Me.DbhotelDataSet.katastasiapy(index(i)).cot, Int16) > 0 Then 'cot Arithmos->pithanws periexei plirofories kai apo ta metepeita paidia pou ekana remove->siehe normalize_katastasi OBEN!
                        '            cot = cot + CType(Me.DbhotelDataSet.katastasiapy(index(i)).cot, Int16)
                        '        Else
                        '            cot = cot + 1
                        '        End If

                        '    End If
                        'Catch ex As Exception
                        '    cot = 0
                        'End Try


                        imerPets = Me.DbhotelDataSet1.katastasiapy(index(i)).petsetes
                        If imerPets = 0 Then
                            imerPets = 15
                        End If
                        imerSent = Me.DbhotelDataSet1.katastasiapy(index(i)).sentonia
                        If imerSent = 0 Then
                            imerSent = 15
                        End If

                        'twra kanw plazieren sto DATSET tis ektiposi (counter=4-> 4 dwmmatia ana seira ektiposis sto CReport)
                        If Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date = PinakasDwmPck.Value.Date Then
                            If counter = 1 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio1 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 = "IN"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1.Equals("OUT") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn1 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn1 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot1 + cot

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies1 = diarkiaDiam
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = xrewsi
                                End If
                            ElseIf counter = 2 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio2 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "IN"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2.Equals("OUT") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn2 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn2 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot2 + cot
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes2 = "Π"
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia2 = "Σ"

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies2 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = xrewsi
                                End If
                            ElseIf counter = 3 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio3 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "IN"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3.Equals("OUT") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn3 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn3 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot3 + cot
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes3 = "Π"
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia3 = "Σ"

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies3 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = xrewsi
                                End If
                            ElseIf counter = 4 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio4 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "IN"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4.Equals("OUT") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn4 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn4 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot4 + cot
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes4 = "Π"
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia4 = "Σ"

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies4 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = xrewsi
                                End If
                            End If
                        ElseIf Me.DbhotelDataSet1.katastasiapy(index(i)).anaxwrisi.Date = PinakasDwmPck.Value.Date Then 'ANXWRISI

                            If counter = 1 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio1 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 = "OUT"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1.Equals("IN") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout1 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut1 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut1 + paidia
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies1 = diarkiaDiam
                                End If
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = xrewsi
                                End If
                            ElseIf counter = 2 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio2 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "OUT"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2.Equals("IN") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut2 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut2 + paidia
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies2 = diarkiaDiam
                                End If
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = xrewsi
                                End If
                            ElseIf counter = 3 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio3 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "OUT"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3.Equals("IN") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut3 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut3 + paidia
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies3 = diarkiaDiam
                                End If
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = xrewsi
                                End If
                            ElseIf counter = 4 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio4 = dwmatia(j)
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "OUT"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4.Equals("IN") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "IN-OUT"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesOut4 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaOut4 + paidia
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                'Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies4 = diarkiaDiam
                                End If
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = xrewsi
                                End If
                            End If
                        Else 'ENDIAMESA
                            If counter = 1 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio1 = dwmatia(j)

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn1 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn1 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot1 + cot
                                'If ist_petsetes_sentonia(imerPets, PinakasDwmPck.Value.Date, Me.DbhotelDataSet.kratiseis(i).afixi) Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                'End If
                                'If ist_petsetes_sentonia(imerSent, PinakasDwmPck.Value.Date, Me.DbhotelDataSet.kratiseis(i).afixi) Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                'End If
                                If ist_petsetes_sentonia(imerPets, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(indiz1).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes1 = "Π"
                                End If
                                If ist_petsetes_sentonia(imerSent, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(indiz1).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia1 = "Σ"
                                End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies1 = diarkiaDiam
                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel1 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi1 = xrewsi
                                End If
                            ElseIf counter = 2 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio2 = dwmatia(j)
                                'If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 Is Nothing Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "IN"
                                'ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2.Equals("OUT") Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout2 = "IN-OUT"
                                'End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn2 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn2 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot2 + cot
                                If ist_petsetes_sentonia(imerPets, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes2 = "Π"
                                End If
                                If ist_petsetes_sentonia(imerSent, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia2 = "Σ"
                                End If

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies2 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel2 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi2 = xrewsi
                                End If
                            ElseIf counter = 3 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio3 = dwmatia(j)
                                'If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 Is Nothing Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "IN"
                                'ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3.Equals("OUT") Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout3 = "IN-OUT"
                                'End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn3 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn3 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot3 + cot
                                If ist_petsetes_sentonia(imerPets, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes3 = "Π"
                                End If
                                If ist_petsetes_sentonia(imerSent, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia3 = "Σ"
                                End If

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies3 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel3 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi3 = xrewsi
                                End If
                            ElseIf counter = 4 Then
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio4 = dwmatia(j)
                                'If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 Is Nothing Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "IN"
                                'ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4.Equals("OUT") Then
                                '    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).inout4 = "IN-OUT"
                                'End If
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).enilikesIn4 + enilikes
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).paidiaIn4 + paidia
                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).cot4 + cot
                                If ist_petsetes_sentonia(imerPets, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).petsetes4 = "Π"
                                End If
                                If ist_petsetes_sentonia(imerSent, PinakasDwmPck.Value.Date, Me.DbhotelDataSet1.katastasiapy(index(i)).afixi.Date) Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).sentonia4 = "Σ"
                                End If

                                Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies4 = diarkiaDiam

                                If Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "-"
                                ElseIf Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4.Equals("-") Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).doppel4 = "D"
                                End If
                                If Not Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 Is Nothing Then
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 + "-" + xrewsi
                                Else
                                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).xrewsi4 = xrewsi
                                End If
                            End If
                        End If
                    Next
                Else 'dwmatio EIANI ADEIO!!!!!!!!!!!!->keno KAESTCHEN!
                    If counter = 1 Then
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio1 = dwmatia(j)
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies1 = "/   -   / "
                    ElseIf counter = 2 Then
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio2 = dwmatia(j)
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies2 = "/   -   / "
                    ElseIf counter = 3 Then
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio3 = dwmatia(j)
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies3 = "/   -   / "
                    ElseIf counter = 4 Then
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).dwmatio4 = dwmatia(j)
                        Me.DbhotelDataSet.ekt_pinakas_dwmatiwn(Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Count - 1).imerominies4 = "/   -   / "
                    End If
                End If
                If counter <> 4 Then
                    counter = counter + 1
                Else
                    counter = 1 'alakse row ektiposis
                    Me.DbhotelDataSet.ekt_pinakas_dwmatiwn.Rows.Add()

                End If
            Next
            zeige_proep_pinakas_dwmatiwn()
            Me.Cursor = Cursors.Default
        Catch ex As Exception
            Me.Cursor = Cursors.Default
        End Try

    End Sub
    'edw kanw remove sto Dataset OLA ta tupel Mias Kratisis ektos tou Prwtou!
    'Private Sub normalize_katastasi()
    '    'Dim j As Int16
    '    Dim startindex, countIndex As Int16

    '    startindex = 0 'apo pio entrag sto dataset

    '    Do Until startindex > Me.DbhotelDataSet1.katastasiapy.Count - 1
    '        countIndex = 1 'posa eintraege 

    '        If startindex < Me.DbhotelDataSet1.katastasiapy.Count - 1 Then
    '            'i katastasi apy einai Sortiert kaata kwd kratisis!
    '            While Me.DbhotelDataSet1.katastasiapy(startindex).kwd = Me.DbhotelDataSet1.katastasiapy(startindex + countIndex).kwd
    '                countIndex += 1
    '                If startindex + countIndex > Me.DbhotelDataSet1.katastasiapy.Count - 1 Then
    '                    Exit While
    '                End If
    '            End While

    '            'ean uparxei kai allo Tupel gia mia kratisi kanto Remove kai metafere ta Cot sto Prwto Tupel
    '            If countIndex <> 1 Then 'ena MONO ena tupel (diladi hoechstens 1 Paidi stin Kratisi)->nichts tun!!!
    '                remake_dataset_1(startindex, countIndex)
    '            End If
    '            'Prosoxi ->Logw remove tote ta Tupel Ligosteuoun (Me.DbhotelDataSet.katastasiapy.Count)->ta metepeita metaferwntai AYTOMATA
    '            'countIndex pros ta pisw->ARA +1 kai OXI +countindex wie sonst
    '            startindex = startindex + 1
    '        Else 'teleutaio i prwto  record->(macht fehler bei while abfrage)
    '            If countIndex <> 1 Then
    '                'MsgBox(Me.DbhotelDataSet.katastasiapy(startindex).dwmatio)
    '                remake_dataset_1(startindex, countIndex)
    '            End If

    '            Exit Do
    '        End If
    '    Loop
    'End Sub
    Private Sub normalize_katastasi_1()
        'Dim j As Int16
        Dim startindex, countIndex As Int16

        startindex = 0 'apo pio entrag sto dataset

        Do Until startindex > Me.DbhotelDataSet1.katastasiapy.Count - 1
            countIndex = 1 'posa eintraege 

            If startindex < Me.DbhotelDataSet1.katastasiapy.Count - 1 Then
                'i katastasi apy einai Sortiert kaata kwd kratisis!
                While Me.DbhotelDataSet1.katastasiapy(startindex).kwd = Me.DbhotelDataSet1.katastasiapy(startindex + countIndex).kwd
                    countIndex += 1
                    If startindex + countIndex > Me.DbhotelDataSet1.katastasiapy.Count - 1 Then
                        Exit While
                    End If
                End While

                'ean uparxei kai allo Tupel gia mia kratisi kanto Remove kai metafere ta Cot sto Prwto Tupel
                If countIndex <> 1 Then 'ena MONO ena tupel (diladi hoechstens 1 Paidi stin Kratisi)->nichts tun!!!
                    remake_dataset_1(startindex, countIndex)
                End If
                'Prosoxi ->Logw remove tote ta Tupel Ligosteuoun (Me.DbhotelDataSet.katastasiapy.Count)->ta metepeita metaferwntai AYTOMATA
                'countIndex pros ta pisw->ARA +1 kai OXI +countindex wie sonst
                startindex = startindex + 1
            Else 'teleutaio i prwto  record->(macht fehler bei while abfrage)
                If countIndex <> 1 Then
                    'MsgBox(Me.DbhotelDataSet.katastasiapy(startindex).dwmatio)
                    remake_dataset_1(startindex, countIndex)
                End If

                Exit Do
            End If
        Loop
    End Sub
    'Private Sub remake_dataset(ByVal startIndex As Int16, ByVal countIndex As Int16)
    '    Dim j, index As Int16
    '    Dim cot As String
    '    cot = ""
    '    j = 2 'ksekina an sbineis apo to 2 Tupel!!! 
    '    'Prosoxi ->Logw remove tote ta Tupel Ligosteuoun (Me.DbhotelDataSet.katastasiapy.Count)->ta metepeita metaferwntai AYTOMATA pros ta pisw
    '    index = startIndex + 1 '->ara sbinetai PANTA h 2 tHESI (ANEKSARTITA POSA COUNTiNDEX EXW!)
    '    While j <= countIndex
    '        Try
    '            If Not Me.DbhotelDataSet.katastasiapy(index).cot Is Nothing Then
    '                If Not Me.DbhotelDataSet.katastasiapy(index).cot.Equals("") Then
    '                    cot = Me.DbhotelDataSet.katastasiapy(index).cot + " " + cot ' mazeuw ta cot apot ta tupel pou kne remove gia na ta metaferw (katw) sto 1 (athikto) Tupel
    '                End If
    '            End If
    '        Catch ex As StrongTypingException

    '        End Try

    '        Me.DbhotelDataSet.katastasiapy.Rows.RemoveAt(index)
    '        j += 1
    '    End While
    '    'ta metaferw twra sto 1 (athikto) Tupel (stin thesi Startindex)
    '    Try
    '        If Not Me.DbhotelDataSet.katastasiapy(startIndex).cot Is Nothing Then
    '            If Not Me.DbhotelDataSet.katastasiapy(startIndex).cot.Equals("") Then
    '                Me.DbhotelDataSet.katastasiapy(startIndex).cot = Me.DbhotelDataSet.katastasiapy(startIndex).cot + " " + cot
    '            End If
    '        End If
    '    Catch ex As Exception
    '        Me.DbhotelDataSet.katastasiapy(startIndex).cot = cot
    '    End Try

    'End Sub
    Private Sub remake_dataset_1(ByVal startIndex As Int16, ByVal countIndex As Int16)
        Dim j, index As Int16
        Dim cot As String
        cot = ""
        j = 2 'ksekina an sbineis apo to 2 Tupel!!! 
        'Prosoxi ->Logw remove tote ta Tupel Ligosteuoun (Me.DbhotelDataSet.katastasiapy.Count)->ta metepeita metaferwntai AYTOMATA pros ta pisw
        index = startIndex + 1 '->ara sbinetai PANTA h 2 tHESI (ANEKSARTITA POSA COUNTiNDEX EXW!)
        While j <= countIndex
            Try
                If Not Me.DbhotelDataSet1.katastasiapy(index).cot Is Nothing Then
                    If Not Me.DbhotelDataSet1.katastasiapy(index).cot.Equals("") Then
                        cot = Me.DbhotelDataSet1.katastasiapy(index).cot + " " + cot ' mazeuw ta cot apot ta tupel pou kne remove gia na ta metaferw (katw) sto 1 (athikto) Tupel
                    End If
                End If
            Catch ex As StrongTypingException

            End Try

            Me.DbhotelDataSet1.katastasiapy.Rows.RemoveAt(index)
            j += 1
        End While
        'ta metaferw twra sto 1 (athikto) Tupel (stin thesi Startindex)
        Try
            If Not Me.DbhotelDataSet1.katastasiapy(startIndex).cot Is Nothing Then
                If Not Me.DbhotelDataSet1.katastasiapy(startIndex).cot.Equals("") Then
                    Me.DbhotelDataSet1.katastasiapy(startIndex).cot = Me.DbhotelDataSet1.katastasiapy(startIndex).cot + " " + cot
                End If
            End If
        Catch ex As Exception
            Me.DbhotelDataSet1.katastasiapy(startIndex).cot = cot
        End Try

    End Sub
    'Private Function get_dwmatio_dataset_index(ByVal dwmatio As String) As Int16()
    '    Dim index() As Int16
    '    Dim j As Int16
    '    ReDim index(-1)

    '    For j = 0 To Me.DbhotelDataSet.katastasiapy.Count - 1
    '        If Me.DbhotelDataSet.katastasiapy(j).dwmatio.Equals(dwmatio) Then
    '            ReDim Preserve index(index.Length)
    '            index(index.Length - 1) = j
    '        End If
    '    Next
    '    Return index

    'End Function
    Private Function get_dwmatio_dataset1_index(ByVal dwmatio As String) As Int16()
        Dim index() As Int16
        Dim j As Int16
        ReDim index(-1)

        For j = 0 To Me.DbhotelDataSet1.katastasiapy.Count - 1
            If Me.DbhotelDataSet1.katastasiapy(j).dwmatio.Equals(dwmatio) Then
                ReDim Preserve index(index.Length)
                index(index.Length - 1) = j
            End If
        Next
        Return index

    End Function
    Private Sub zeige_proep_pinakas_dwmatiwn()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New PinakasDwmProistamenis()

        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = PinakasDwmPck.Value.Date


        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        'CrystalReportViewer1.DisplayGroupTree = False
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
    End Sub
    Private Function ist_petsetes_sentonia(ByVal imeres As Int16, ByVal date1 As Date, ByVal date2 As Date) As Boolean
        If (date1.Date.DayOfYear - date2.Date.DayOfYear) Mod imeres = 0 Then
            Return True
        Else
            Return False
        End If

    End Function
    Private Function afix_anax(ByVal date1 As Date, ByVal date2 As Date) As String
        Dim s As String

        's = date1.ToString.Substring(0, date1.Date.ToString.Length - 4) + "-" + date2.Date.ToString.Substring(0, date2.Date.ToString.Length - 4)
        s = date1.Day.ToString + "/" + date1.Month.ToString + "-" + date2.Day.ToString + "/" + date2.Month.ToString
        'MsgBox(s)
        Return s

    End Function
    'Private Function max_anaxwrisi(ByVal index() As Int16) As Int16
    '    Dim j, indiz As Int16
    '    Dim date1 As Date = #1/1/1900#
    '    For j = 0 To index.Length - 1
    '        If date1 < Me.DbhotelDataSet.katastasiapy(index(j)).anaxwrisi.Date Then
    '            date1 = Me.DbhotelDataSet.katastasiapy(index(j)).anaxwrisi.Date
    '            indiz = j
    '        End If
    '    Next
    '    Return indiz
    'End Function
    Private Function max_anaxwrisi1(ByVal index() As Int16) As Int16
        Dim j, indiz As Int16
        Dim date1 As Date = #1/1/1900#
        For j = 0 To index.Length - 1
            If date1 < Me.DbhotelDataSet1.katastasiapy(index(j)).anaxwrisi.Date Then
                date1 = Me.DbhotelDataSet1.katastasiapy(index(j)).anaxwrisi.Date
                indiz = j
            End If
        Next
        Return indiz
    End Function
    'Private Function max_afixi(ByVal index() As Int16) As Int16
    '    Dim j, indiz As Int16
    '    Dim date1 As Date = #1/1/1900#
    '    For j = 0 To index.Length - 1 'Me.DbhotelDataSet.kratiseis.Count - 1
    '        If date1 < Me.DbhotelDataSet.katastasiapy(index(j)).afixi.Date Then
    '            date1 = Me.DbhotelDataSet.katastasiapy(index(j)).afixi.Date
    '            indiz = j
    '        End If
    '    Next
    '    Return indiz
    'End Function
    Private Function max_afixi1(ByVal index() As Int16) As Int16
        Dim j, indiz As Int16
        Dim date1 As Date = #1/1/1900#
        For j = 0 To index.Length - 1 'Me.DbhotelDataSet.kratiseis.Count - 1
            If date1 < Me.DbhotelDataSet1.katastasiapy(index(j)).afixi.Date Then
                date1 = Me.DbhotelDataSet1.katastasiapy(index(j)).afixi.Date
                indiz = j
            End If
        Next
        Return indiz
    End Function

    '*************************KATASTASI ESTIATORIOU******************KATASTASI ESTIATORIOU***************************KATASTASI ESTIATORIOU***********
    'emfanizei dwmtio-enilikes-paidia-mia ilikia (min)  paidiou-kai atoma  xrewsis
    Private Sub katast_prwinwn_oldtown()
        Me.DbhotelDataSet.kratiseis.Clear()
        Me.DbhotelDataSet.timeskratisis.Clear()
        Me.DbhotelDataSet.paidia.Clear()


        EstiatKatastPck.Value = imeromErgasias
        EtikLbl.Text = "ΚΑΤΑΣΤΑΣΗ ΠΡΩΪΝΩΝ OLD TOWN"
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        EstiatKatastPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.EstiatKatastPnl.Size = New Point(830, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(EstiatKatastPnl)
        prwinoflag = 1
    End Sub
    Private Sub katast_prwinwn_thalasses()
        Me.DbhotelDataSet.kratiseis.Clear()
        Me.DbhotelDataSet.timeskratisis.Clear()
        Me.DbhotelDataSet.paidia.Clear()


        EstiatKatastPck.Value = imeromErgasias
        EtikLbl.Text = "ΚΑΤΑΣΤΑΣΗ ΠΡΩΪΝΩΝ THALASSES"
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        EstiatKatastPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        Me.EstiatKatastPnl.Size = New Point(830, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(EstiatKatastPnl)
        prwinoflag = 2
    End Sub
    Private Sub EstiatKatastDwmApoTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim count As Integer
        If Not sender.text.Equals("") Then
            count = Me.DwmatiaTableAdapter.ExistArDwmatiou(sender.text)

            If count = 0 And Not sender.text.Equals("OV-BOOK") Then
                MsgBox("Δεν υπάρχει Δωμάτιο μ'αυτόν τον Αριθμό !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                sender.clear()
            End If
        End If
    End Sub
    Private Sub EstiatKatastProepBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EstiatKatastProepBtn.Click

        Dim j, counter, sumEnil, sumPaid, sumRR, sumBB, sumHB, sumFB, sumAI As Int16 'paidia, atoma,
        'Dim zimmerApo, zimmerEws As String
        Dim kwdTemp = -1
        Try
            Me.Cursor = Cursors.WaitCursor
            Me.DbhotelDataSet.ekt_estiatorio.Clear()
            Me.DbhotelDataSet.ekt_estiatorio_sum.Clear()

            'If EstiatKatastDwmApoTbx.Text.Equals("") Then
            '    'zimmerApo = Me.DwmatiaTableAdapter.GetMinArDwmatiou()
            '    zimmerApo = ""
            'Else
            '    zimmerApo = EstiatKatastDwmApoTbx.Text
            'End If
            'If EstiatKatastDwmMexriTbx.Text.Equals("") Then
            '    zimmerEws = Me.DwmatiaTableAdapter.GetMaxArDwmatiou()
            'Else
            '    zimmerEws = EstiatKatastDwmMexriTbx.Text
            'End If


            If (EstiatKatast2Rdb.Checked) Then 'kai afixeis mazi
                'Me.KratiseisTableAdapter.FillByAfAnaxCheckInOutDwm(Me.DbhotelDataSet.kratiseis, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, False, False, zimmerApo, zimmerEws)
                If prwinoflag = 1 Then
                    Me.KatastasiapyTableAdapter.FillkatastasiEstiatorioumeAfixeisTipoikwd(Me.DbhotelDataSet.katastasiapy, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, 13, 25)
                ElseIf prwinoflag = 2 Then
                    Me.KatastasiapyTableAdapter.FillkatastasiEstiatorioumeAfixeisTipoikwd(Me.DbhotelDataSet.katastasiapy, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, 10, 10)
                End If


            Else 'mono osoi menoun mesa
                'Me.KratiseisTableAdapter.FillByAfAnaxCheckInOutDwm(Me.DbhotelDataSet.kratiseis, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, True, True, zimmerApo, zimmerEws)
                If prwinoflag = 1 Then
                    Me.KatastasiapyTableAdapter.FillKatastasiEstiatoriouTipoiAf(Me.DbhotelDataSet.katastasiapy, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, 13, 25)
                ElseIf prwinoflag = 2 Then
                    Me.KatastasiapyTableAdapter.FillKatastasiEstiatoriouTipoiAf(Me.DbhotelDataSet.katastasiapy, EstiatKatastPck.Value, EstiatKatastPck.Value.Date, EstiatKatastPck.Value.Date, 10, 10)
                End If

            End If
            counter = 1 ' to counter xreiazetai gia tin ektiposi ->3 dwmatia  ana grammi 


            For j = 0 To Me.DbhotelDataSet.katastasiapy.Count - 1
                If kwdTemp <> Me.DbhotelDataSet.katastasiapy(j).kwd Then
                    kwdTemp = Me.DbhotelDataSet.katastasiapy(j).kwd
                    sumEnil = sumEnil + Me.DbhotelDataSet.katastasiapy(j).enilikes
                    sumPaid = sumPaid + Me.DbhotelDataSet.katastasiapy(j).paidia

                    If counter = 1 Then
                        Me.DbhotelDataSet.ekt_estiatorio.Rows.Add()
                    End If

                    If counter = 1 Then

                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).dwmatio1 = Me.DbhotelDataSet.katastasiapy(j).dwmatio
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).enilikes1 = Me.DbhotelDataSet.katastasiapy(j).enilikes
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).paidia1 = Me.DbhotelDataSet.katastasiapy(j).paidia
                        Try
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ilikia1 = Me.DbhotelDataSet.katastasiapy(j).ilikia
                        Catch ex As StrongTypingException
                        End Try

                        If Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("RR") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).rr1 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumRR = sumRR + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("BB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).bb1 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumBB = sumBB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("HB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).hb1 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumHB = sumHB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("FB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).fb1 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumFB = sumFB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("AI") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ai1 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumAI = sumAI + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        End If
                    ElseIf counter = 2 Then
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).dwmatio2 = Me.DbhotelDataSet.katastasiapy(j).dwmatio
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).enilikes2 = Me.DbhotelDataSet.katastasiapy(j).enilikes
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).paidia2 = Me.DbhotelDataSet.katastasiapy(j).paidia
                        Try
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ilikia2 = Me.DbhotelDataSet.katastasiapy(j).ilikia
                        Catch ex As StrongTypingException
                        End Try

                        If Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("RR") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).rr2 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumRR = sumRR + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("BB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).bb2 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumBB = sumBB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("HB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).hb2 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumHB = sumHB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("FB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).fb2 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumFB = sumFB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("AI") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ai2 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumAI = sumAI + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        End If
                    ElseIf counter = 3 Then
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).dwmatio3 = Me.DbhotelDataSet.katastasiapy(j).dwmatio
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).enilikes3 = Me.DbhotelDataSet.katastasiapy(j).enilikes
                        Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).paidia3 = Me.DbhotelDataSet.katastasiapy(j).paidia
                        Try
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ilikia3 = Me.DbhotelDataSet.katastasiapy(j).ilikia
                        Catch ex As StrongTypingException
                        End Try
                        If Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("RR") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).rr3 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumRR = sumRR + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("BB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).bb3 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumBB = sumBB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("HB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).hb3 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumHB = sumHB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("FB") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).fb3 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumFB = sumFB + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                        ElseIf Me.DbhotelDataSet.katastasiapy(j).xrewsi.Equals("AI") Then
                            Me.DbhotelDataSet.ekt_estiatorio(Me.DbhotelDataSet.ekt_estiatorio.Count - 1).ai3 = Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia
                            sumAI = sumAI + Me.DbhotelDataSet.katastasiapy(j).enilikes + Me.DbhotelDataSet.katastasiapy(j).paidia

                        End If

                    End If
                    If counter <> 3 Then
                        counter += 1
                    Else
                        counter = 1
                    End If
                End If


            Next

            Me.DbhotelDataSet.ekt_estiatorio_sum.Rows.Add()
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).enilikes = sumEnil
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).paidia = sumPaid
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).syn_rr = sumRR
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).syn_bb = sumBB
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).syn_hb = sumHB
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).syn_fb = sumFB
            Me.DbhotelDataSet.ekt_estiatorio_sum(0).syn_ai = sumAI
            zeige_proep_katast_estiatiriou()
            Me.Cursor = Cursors.Default
        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)

        End Try

    End Sub

    Private Sub zeige_proep_katast_estiatiriou()
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New KatastasiEstiatoriou()

        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = EstiatKatastPck.Value.Date

        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
    End Sub
    '*************************LISTA PRAKTOREIWN******************LISTA PRAKTOREIWN**************************LISTA PRAKTOREIWN**********
    'deixnei to MEGALYTERO apo Bookpos-Kratiseis ana imerominia!!!!!!!!!!!! 
    Private Sub lista_prktoreiwn()
        Me.DbhotelDataSet.bookingpos.Clear()
        Me.DbhotelDataSet.kratiseis.Clear()
        Me.DbhotelDataSet.simbolaia.Clear()



        PraktXenod2Pnl.Controls.Clear()
        PraktXenodPck.Value = imeromErgasias

        EtikLbl.Text = "ΣΥΓΚΡΙΣΗ ΠΛΗΡΟΤΗΤΑΣ ΠΡΑΚΤΟΡΕΙΩΝ ΞΕΝΟΔΟΧΕΙΟΥ"
        EtikLbl.Location = New Point(PraktXenodPnl.Width / 8, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        PraktXenodPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        'Me.SimbolaiaTableAdapter.FillByEtos(Me.DbhotelDataSet.simbolaia, etos)
        Me.PraktXenodPnl.Size = New Point(830, ZentralPnl.Height)
        'ola ta simbolia etous


        Me.ZentralPnl.Controls.Add(PraktXenodPnl)

    End Sub
    Private Sub PraktXenodEmfBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktXenodEmfBtn.Click
        Dim datumBookPos(,), datumPraktKrat(,) As Integer
        Dim doubleDwmCounter() As Int16 'ana Stelle o arithmos twn Double-dwmatiwn->emfanizetai sto telaiutaio Panel 
        Dim arithDoubDwm() As String 'Ola ta dwmatia pou einai katilimena gia tin betrachtende periodo
        ReDim datumBookPos(-1, -1)
        ReDim datumPraktKrat(-1, -1)
        ReDim doubleDwmCounter(-1)
        ReDim arithDoubDwm(-1)


        lista_prakt_plirotita(16, datumBookPos, datumPraktKrat, doubleDwmCounter, arithDoubDwm, False) 'D.H lAENGE (THESEIS) 17

    End Sub
    Private Sub PraktXenodPck_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktXenodPck.ValueChanged
        PraktXenod3Pnl.Controls.Clear()
        PraktXenod2Pnl.Controls.Clear()
        PraktXenod4Pnl.Controls.Clear()

    End Sub
    Private Sub PraktXenod1Rdb_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktXenod1Rdb.CheckedChanged, PraktXenod2Rdb.CheckedChanged, PraktXenod3Rdb.CheckedChanged
        PraktXenod3Pnl.Controls.Clear()
        PraktXenod2Pnl.Controls.Clear()
        PraktXenod4Pnl.Controls.Clear()
    End Sub
    Private Sub lista_prakt_plirotita(ByVal plithosImerwn As Int16, ByVal datumBookPos(,) As Integer, ByVal datumPraktKrat(,) As Integer, ByVal doubleDwmCounter() As Int16, ByVal arithDoubDwm() As String, ByVal ektiposiOK As Boolean)

        Dim j, i, startIndex, countIndex As Int16
        Try
            Me.Cursor = Cursors.WaitCursor
            ' katarxin OLA ta simbolaia etous laden 
            Me.SimbolaiaTableAdapter.FillByEtos(Me.DbhotelDataSet.simbolaia, etos)

            ' i Datastructure datumBookPos exie tin morfi ( simbolaia,imeres), wobei panta an Stellle y=0 diladi (x,0) einai apothikeumenos o kwd toy simbolaiou (X,0)=kwd (x,1)=bookposAnzalh an erster Tag usw.  
            ReDim datumBookPos(Me.DbhotelDataSet.simbolaia.Count - 1, plithosImerwn)
            'to idio
            ReDim datumPraktKrat(Me.DbhotelDataSet.simbolaia.Count - 1, plithosImerwn)
            ReDim doubleDwmCounter(plithosImerwn - 1)
            ReDim arithDoubDwm(-1)

            'oi aNnfragen einai sortiert kata kwdiko simbolaiou gia na kanei unterstuetzen tin while-schleife danach 
            If PraktXenod1Rdb.Checked Then
                Me.BookingposTableAdapter.FillByApoMexrGuar(Me.DbhotelDataSet.bookingpos, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date, False)
                Me.KratiseisTableAdapter.FillSimbByAfAnGuarantie(Me.DbhotelDataSet.kratiseis, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date, False)

            ElseIf PraktXenod2Rdb.Checked Then
                Me.BookingposTableAdapter.FillByApoMexrGuar(Me.DbhotelDataSet.bookingpos, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date, True)
                Me.KratiseisTableAdapter.FillSimbByAfAnGuarantie(Me.DbhotelDataSet.kratiseis, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date, True)
            Else
                Me.KratiseisTableAdapter.FillSimbByAfixAnax(Me.DbhotelDataSet.kratiseis, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date)
                Me.BookingposTableAdapter.FillByApMexr(Me.DbhotelDataSet.bookingpos, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date)
            End If

            For i = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
                'epeidi exw kanei laden OLA ta simbolaia etous ->finde poia 'paizoun' gia to ZeitInterval (->gia na min exw midenika Rows sto panel)
                'ean einai to simbolaio aktuel diladi exei bookkpostition ;h kratiseis tote kane insert an stelle (I,0) TON KWDIKO  SIMBOLAIOU ->ALLIWS BLEIBT 0 kai den fainetai sto panel meta!
                If ist_simbolaio_vorhanden(Me.DbhotelDataSet.simbolaia(i).kwd) Then
                    datumBookPos(i, 0) = Me.DbhotelDataSet.simbolaia(i).kwd
                    datumPraktKrat(i, 0) = Me.DbhotelDataSet.simbolaia(i).kwd
                End If

            Next
            startIndex = 0 'apo pio entrag sto dataset

            Do Until startIndex > Me.DbhotelDataSet.bookingpos.Count - 1
                countIndex = 1 'posa eintraege 

                If startIndex < Me.DbhotelDataSet.bookingpos.Count - 1 Then
                    While Me.DbhotelDataSet.bookingpos(startIndex).simbolaio = Me.DbhotelDataSet.bookingpos(startIndex + countIndex).simbolaio
                        countIndex += 1
                        If startIndex + countIndex > Me.DbhotelDataSet.bookingpos.Count - 1 Then
                            Exit While
                        End If
                    End While
                    'finde thesi simbolaiou in Array 
                    j = find_stelle_simb_in_array(datumBookPos, Me.DbhotelDataSet.bookingpos(startIndex).simbolaio)
                    'plaziere werte bookpos ana imera gia kathe mera 
                    fuehle_datum_bookPos(datumBookPos, j, Me.DbhotelDataSet.bookingpos(startIndex).simbolaio, plithosImerwn, startIndex, countIndex)

                    startIndex = startIndex + countIndex
                Else 'teleutaio i prwto  record->(macht fehler bei while abfrage)
                    j = find_stelle_simb_in_array(datumBookPos, Me.DbhotelDataSet.bookingpos(startIndex).simbolaio)
                    fuehle_datum_bookPos(datumBookPos, j, Me.DbhotelDataSet.bookingpos(startIndex).simbolaio, plithosImerwn, startIndex, countIndex)
                    Exit Do
                End If
            Loop

            startIndex = 0 'apo pio entrag sto dataset

            Do Until startIndex > Me.DbhotelDataSet.kratiseis.Count - 1
                countIndex = 1 'posa eintraege 

                If startIndex < Me.DbhotelDataSet.kratiseis.Count - 1 Then
                    While Me.DbhotelDataSet.kratiseis(startIndex).simbolaio = Me.DbhotelDataSet.kratiseis(startIndex + countIndex).simbolaio
                        countIndex += 1
                        If startIndex + countIndex > Me.DbhotelDataSet.kratiseis.Count - 1 Then
                            Exit While
                        End If
                    End While
                    j = find_stelle_simb_in_array(datumPraktKrat, Me.DbhotelDataSet.kratiseis(startIndex).simbolaio)
                    fuehle_datum_prakt_krat(datumPraktKrat, j, Me.DbhotelDataSet.kratiseis(startIndex).simbolaio, plithosImerwn, arithDoubDwm, startIndex, countIndex)

                    startIndex = startIndex + countIndex
                Else 'teleutaio i prwto  record->(macht fehler bei while abfrage)
                    j = find_stelle_simb_in_array(datumPraktKrat, Me.DbhotelDataSet.kratiseis(startIndex).simbolaio)
                    fuehle_datum_prakt_krat(datumPraktKrat, j, Me.DbhotelDataSet.kratiseis(startIndex).simbolaio, plithosImerwn, arithDoubDwm, startIndex, countIndex)
                    Exit Do
                End If
            Loop
            'Next

            pruefe_double_dwmatia(arithDoubDwm, doubleDwmCounter, plithosImerwn)
            If ektiposiOK Then
                ekt_prakt_xenod_werte(PraktXenodPck.Value.Date, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), datumBookPos, datumPraktKrat, Me.DbhotelDataSet.simbolaia.Count - 1, plithosImerwn, doubleDwmCounter)
            Else
                male_lista_prakt_panel(PraktXenodPck.Value.Date, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), datumBookPos, datumPraktKrat, Me.DbhotelDataSet.simbolaia.Count - 1, plithosImerwn, doubleDwmCounter)
            End If


        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)

        End Try
        Me.Cursor = Cursors.Default



    End Sub
    Private Function find_stelle_simb_in_array(ByVal array(,) As Integer, ByVal simb As Integer) As Int16
        Dim j As Int16
        'o kwdikos einai an stelle (j,0) apothikeumenos
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            If array(j, 0) = simb Then
                Return j
            End If
        Next
        Return -1

    End Function
    'bres an to simbolaio exei bookpos h kratiseis gia to Zeitinterval pou kanw betrachten!
    Private Function ist_simbolaio_vorhanden(ByVal kwdikos As Integer) As Boolean
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.kratiseis.Count - 1
            If Me.DbhotelDataSet.kratiseis(j).simbolaio = kwdikos Then
                Return True
            End If
        Next
        For j = 0 To Me.DbhotelDataSet.bookingpos.Count - 1
            If Me.DbhotelDataSet.bookingpos(j).simbolaio = kwdikos Then
                Return True
            End If
        Next

        Return False
    End Function


    Private Sub fuehle_datum_bookPos(ByRef datumBookPos(,) As Integer, ByVal ind As Int16, ByVal simb As Integer, ByVal imeres As Int16, ByVal startindex As Int16, ByVal countIndex As Int16)
        Dim j, index1, index2, k As Int16

        For j = startindex To (startindex + countIndex - 1)

            If Me.DbhotelDataSet.bookingpos(j).apo.Date <= PraktXenodPck.Value.Date Then
                index1 = 1
            Else
                index1 = Me.DbhotelDataSet.bookingpos(j).apo.DayOfYear - PraktXenodPck.Value.Date.DayOfYear + 1
            End If
            If Me.DbhotelDataSet.bookingpos(j).mexri.Date >= PraktXenodPck.Value.Date.AddDays(imeres - 1) Then
                index2 = imeres
            Else
                index2 = Me.DbhotelDataSet.bookingpos(j).mexri.DayOfYear - PraktXenodPck.Value.Date.DayOfYear + 1
            End If
            datumBookPos(ind, 0) = simb
            For k = index1 To index2
                datumBookPos(ind, k) = datumBookPos(ind, k) + Me.DbhotelDataSet.bookingpos(j).anzahl
            Next
        Next
    End Sub
    'Dim doubleDwmCounter() As Int16
    'Dim arithDoubDwm() As String
    Private Sub fuehle_datum_prakt_krat(ByRef datumPrKrat(,) As Integer, ByVal ind As Int16, ByVal simb As Integer, ByVal imeres As Int16, ByRef arithDoubDwm() As String, ByVal startindex As Int16, ByVal countIndex As Int16)
        Dim j, index1, index2, k As Int16

        For j = startindex To (startindex + countIndex - 1)

            If Me.DbhotelDataSet.kratiseis(j).afixi.Date <= PraktXenodPck.Value.Date Then
                index1 = 1
            Else
                index1 = Me.DbhotelDataSet.kratiseis(j).afixi.DayOfYear - PraktXenodPck.Value.Date.DayOfYear + 1
            End If
            If Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= PraktXenodPck.Value.Date.AddDays(imeres - 1) Then
                index2 = imeres
            Else
                index2 = Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - PraktXenodPck.Value.Date.DayOfYear + 1
            End If
            datumPrKrat(ind, 0) = simb
            For k = index1 To index2
                datumPrKrat(ind, k) = datumPrKrat(ind, k) + 1
            Next
            'enimerwse tin lIsta me ta katilimena Dwmatia 
            If Not Me.DbhotelDataSet.kratiseis(j).dwmatio Is Nothing Then
                If Not Me.DbhotelDataSet.kratiseis(j).dwmatio.Equals("") Or Not Me.DbhotelDataSet.kratiseis(j).dwmatio.Equals("OV-BOOK") Then
                    If Not exist_dwm_in_liste(Me.DbhotelDataSet.kratiseis(j).dwmatio, arithDoubDwm) Then
                        ReDim Preserve arithDoubDwm(arithDoubDwm.Length)
                        arithDoubDwm(arithDoubDwm.Length - 1) = Me.DbhotelDataSet.kratiseis(j).dwmatio
                    End If
                End If
            End If
        Next



    End Sub
    Private Sub pruefe_double_dwmatia(ByVal arithDoubDwm() As String, ByRef doubleDwmCounter() As Int16, ByVal plithosImerwn As Int16)
        Dim j As Int16
        Dim einzelnDwmCounter() As Int16


        For j = 0 To arithDoubDwm.Length - 1
            ReDim einzelnDwmCounter(plithosImerwn - 1)
            'Me.DbhotelDataSet.kratiseis.Clear()
            'Me.KratiseisTableAdapter.FillByDwmAfAnax(Me.DbhotelDataSet.kratiseis, arithDoubDwm(j), PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), PraktXenodPck.Value.Date)
            fuehle_double_counter(einzelnDwmCounter, arithDoubDwm(j), plithosImerwn)
            aktualisieren_(einzelnDwmCounter, doubleDwmCounter)
        Next


    End Sub
    Private Sub fuehle_double_counter(ByRef doubleDwmCounter() As Int16, ByVal arDwm As String, ByVal plithosImerwn As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.kratiseis.Count - 1
            If Me.DbhotelDataSet.kratiseis(j).dwmatio.Equals(arDwm) Then
                If Me.DbhotelDataSet.kratiseis(j).afixi.Date <= PraktXenodPck.Value.Date Then
                    index1 = 0
                Else
                    index1 = Me.DbhotelDataSet.kratiseis(j).afixi.DayOfYear - PraktXenodPck.Value.Date.DayOfYear
                End If
                If Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= PraktXenodPck.Value.Date.AddDays(plithosImerwn) Then
                    index2 = plithosImerwn - 1
                Else
                    index2 = Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - PraktXenodPck.Value.Date.DayOfYear
                End If

                For k = index1 To index2
                    doubleDwmCounter(k) = doubleDwmCounter(k) + 1
                Next
            End If

        Next

    End Sub
    Private Sub male_lista_prakt_panel(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datumBookPos(,) As Integer, ByVal datumPraktKrat(,) As Integer, ByVal laengeX As Int16, ByVal laengeY As Int16, ByVal doubleDwmCounter() As Int16)
        Dim i, j, ipos As Int16
        Dim tageCount As Integer
        Dim locx, locy, stepx, stepy As Int16
        Dim sumPlirot() As Int16

        ReDim sumPlirot(doubleDwmCounter.Length - 1)

        locx = 152
        locy = 70
        stepx = 42
        stepy = 50
        ipos = -1


        tageCount = telosIm.DayOfYear - arxiIm.DayOfYear

        For i = 0 To tageCount
            Dim ImeroLbl As New Label
            ImeroLbl.TextAlign = ContentAlignment.MiddleRight
            ImeroLbl.Size = New Point(35, 30)

            Me.PraktXenod3Pnl.Controls.Add(ImeroLbl)
            ImeroLbl.Location = New Point(locx + (i - 1) * stepx, 10) '(locx + (i - 1) * stepx, locy)
            ImeroLbl.Text = arxiIm.Date.AddDays(i).Day.ToString
            ImeroLbl.ForeColor = Color.Blue
            'Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = arxiIm.Date.AddDays(i).Day.ToString
        Next
        locx = 26
        locy = 10
        For i = 0 To laengeX
            For j = 0 To laengeY
                Dim BookLbl As New Label
                If datumBookPos(i, 0) <> 0 Or datumPraktKrat(i, 0) <> 0 Then 'mono ean uparxei simbolaio kane malen 
                    If j = 0 Then
                        ipos += 1
                        BookLbl.Size = New Point(120, 50)
                        If datumBookPos(i, 0) <> 0 Then
                            BookLbl.Text = get_praktoreio_eponimia_by_kwdiko(get_kwd_praktoreiou_by_simbol_kwd(datumBookPos(i, j))) 'Me.SimbolaiaTableAdapter.GetPraktkwdByKwd(datumBookPos(i, j))
                            BookLbl.Text = BookLbl.Text + get_aa_simbolaiou_by_kwd(datumBookPos(i, j)).ToString
                        Else
                            BookLbl.Text = get_praktoreio_eponimia_by_kwdiko(get_kwd_praktoreiou_by_simbol_kwd(datumPraktKrat(i, j))) 'Me.SimbolaiaTableAdapter.GetPraktkwdByKwd(datumBookPos(i, j))
                            BookLbl.Text = BookLbl.Text + get_aa_simbolaiou_by_kwd(datumPraktKrat(i, j)).ToString
                        End If


                        BookLbl.TextAlign = ContentAlignment.MiddleCenter
                        BookLbl.Location = New Point(locx + 16 + (j - 1) * stepx, 1 + (ipos) * stepy)
                        BookLbl.ForeColor = Color.Blue

                    Else
                        BookLbl.Size = New Point(35, 30)
                        If datumBookPos(i, j) >= datumPraktKrat(i, j) Then
                            BookLbl.Text = datumBookPos(i, j)
                            sumPlirot(j - 1) = sumPlirot(j - 1) + datumBookPos(i, j)
                        Else
                            BookLbl.Text = datumPraktKrat(i, j)
                            sumPlirot(j - 1) = sumPlirot(j - 1) + datumPraktKrat(i, j)
                        End If
                        BookLbl.TextAlign = ContentAlignment.MiddleRight
                        BookLbl.Location = New Point(locx + 85 + (j - 1) * stepx, 10 + (ipos) * stepy)
                    End If
                    Me.PraktXenod2Pnl.Controls.Add(BookLbl)
                End If


            Next
        Next
        Dim DoublLbl, SumPlirotTxtLbl As New Label
        DoublLbl.Size = New Point(100, 30)
        DoublLbl.Text = "Δωμ. Double"
        DoublLbl.Location = New Point(2, 5)
        Me.PraktXenod4Pnl.Controls.Add(DoublLbl)
        For j = 0 To doubleDwmCounter.Length - 1
            If doubleDwmCounter(j) > 0 Then
                Dim DoubleCount As New Label
                DoubleCount.Size = New Point(35, 30)
                DoubleCount.TextAlign = ContentAlignment.MiddleRight
                DoubleCount.Location = New Point(locx + 85 + j * stepx, 5)
                DoubleCount.Text = doubleDwmCounter(j)
                sumPlirot(j) = sumPlirot(j) - doubleDwmCounter(j)
                Me.PraktXenod4Pnl.Controls.Add(DoubleCount)
            End If
        Next
        SumPlirotTxtLbl.Size = New Point(100, 80)
        SumPlirotTxtLbl.Text = "Σύνολο Ξενοδοχ."
        SumPlirotTxtLbl.Location = New Point(2, 40)
        Me.PraktXenod4Pnl.Controls.Add(SumPlirotTxtLbl)
        For j = 0 To sumPlirot.Length - 1
            Dim SumPlirotLbl As New Label
            SumPlirotLbl.Size = New Point(35, 30)
            SumPlirotLbl.Text = sumPlirot(j)
            SumPlirotLbl.TextAlign = ContentAlignment.MiddleRight
            SumPlirotLbl.Location = New Point(locx + 85 + j * stepx, 40)

            Me.PraktXenod4Pnl.Controls.Add(SumPlirotLbl)
        Next


    End Sub
    Private Sub PraktXenodEktBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktXenodEktBtn.Click
        Dim i, plithosImerwn As Int16
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New StatusPraktXenod()
        Dim datumBookPos(,), datumPraktKrat(,) As Integer
        Dim doubleDwmCounter() As Int16
        'Dim plithosImerwn As Int16
        Dim arithDoubDwm() As String
        ReDim datumBookPos(-1, -1)
        ReDim datumPraktKrat(-1, -1)
        ReDim doubleDwmCounter(-1)
        ReDim arithDoubDwm(-1)

        plithosImerwn = PraktXenodPlithImerEkt.Text


        Me.DbhotelDataSet.ekt_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_imeres_status_dwm1.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm1.Rows.Add()
        'plithosImerwn = PraktXenodPlithImerEkt.Text - 1
        For i = 0 To PraktXenodPlithImerEkt.Text - 1
            Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = PraktXenodPck.Value.Date.AddDays(i).Day
            Me.DbhotelDataSet.ekt_imeres_status_dwm1(0).Item(i) = welche_tag_der_woche(PraktXenodPck.Value.Date.AddDays(i).DayOfWeek)
        Next
        lista_prakt_plirotita(plithosImerwn, datumBookPos, datumPraktKrat, doubleDwmCounter, arithDoubDwm, True)
        'ekt_prakt_xenod_werte(PraktXenodPck.Value.Date, PraktXenodPck.Value.Date.AddDays(plithosImerwn - 1), datumBookPos, datumPraktKrat, Me.DbhotelDataSet.simbolaia.Count - 1, plithosImerwn, doubleDwmCounter)

        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = PraktXenodPck.Value.Date
        If PraktXenod1Rdb.Checked Then
            Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = "(ALLOTMENT)"
        ElseIf PraktXenod2Rdb.Checked Then
            Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = "(GUARANTEE)"
        Else
            Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = "(ΣΥΝΟΛΙΚΑ)"
        End If

        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        'sender.Enabled = True
    End Sub
    Private Sub ekt_prakt_xenod_werte(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datumBookPos(,) As Integer, ByVal datumPraktKrat(,) As Integer, ByVal laengeX As Int16, ByVal laengeY As Int16, ByVal doubleDwmCounter() As Int16)
        Dim i, j As Int16
        Dim sumRow As String = 0
        'Dim tageCount As Integer
        Dim sumPlirot() As Int16

        ReDim sumPlirot(doubleDwmCounter.Length - 1)
        'tageCount = telosIm.DayOfYear - arxiIm.DayOfYear
        For i = 0 To laengeX
            Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
            For j = 0 To laengeY
                If datumBookPos(i, 0) Or datumPraktKrat(i, 0) <> 0 Then

                    If j = 0 Then
                        'Try
                        If datumBookPos(i, 0) <> 0 Then
                            Me.DbhotelDataSet.ekt_status_dwm(i).Item(j) = get_praktoreio_eponimia_by_kwdiko(get_kwd_praktoreiou_by_simbol_kwd(datumBookPos(i, j))) + get_aa_simbolaiou_by_kwd(datumBookPos(i, j)).ToString
                        Else
                            Me.DbhotelDataSet.ekt_status_dwm(i).Item(j) = get_praktoreio_eponimia_by_kwdiko(get_kwd_praktoreiou_by_simbol_kwd(datumPraktKrat(i, j))) + get_aa_simbolaiou_by_kwd(datumPraktKrat(i, j)).ToString
                        End If

                        'Catch ex As InvalidOperationException
                        '    Try
                        '        Me.DbhotelDataSet.ekt_status_dwm(i).Item(j) = get_praktoreio_eponimia_by_kwdiko(get_kwd_praktoreiou_by_simbol_kwd(datumBookPos(i, j)))

                        '    Catch ex1 As InvalidOperationException
                        '        Exit For
                        '    End Try
                        'End Try
                    Else
                        If datumBookPos(i, j) >= datumPraktKrat(i, j) Then
                            Me.DbhotelDataSet.ekt_status_dwm(i).Item(j) = datumBookPos(i, j)
                            sumPlirot(j - 1) = sumPlirot(j - 1) + datumBookPos(i, j)
                            sumRow = sumRow + datumBookPos(i, j)
                        Else
                            Me.DbhotelDataSet.ekt_status_dwm(i).Item(j) = datumPraktKrat(i, j)
                            sumPlirot(j - 1) = sumPlirot(j - 1) + datumPraktKrat(i, j)
                            sumRow = sumRow + datumPraktKrat(i, j)
                        End If
                    End If


                End If
            Next
            Me.DbhotelDataSet.ekt_status_dwm(i).sum = "Αθροισμα " + Me.DbhotelDataSet.ekt_status_dwm(i).Item(0) + ":" + sumRow
            sumRow = 0
        Next

        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()


        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Δωμ. Double"

        For j = 0 To doubleDwmCounter.Length - 1

            If doubleDwmCounter(j) > 0 Then
                Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(j + 1) = doubleDwmCounter(j)
                sumPlirot(j) = sumPlirot(j) - doubleDwmCounter(j)
            End If
        Next
        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Σύνολο Ξενοδοχ."
        For j = 0 To sumPlirot.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(j + 1) = sumPlirot(j)
        Next


    End Sub
    Private Sub PraktXenodPlithImerEkt_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktXenodPlithImerEkt.Leave
        Try
            sender.text = Math.Abs(CType(sender.text, Int16))
            If sender.text <= 31 And sender.text > 0 Then
                zeigerDwm1 = -1
                zeigerDwm2 = -1
            Else
                sender.text = 31
            End If

        Catch ex As InvalidCastException
            MsgBox("Δώστε Αριθμό !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.text = "31"
        End Try
    End Sub


    Private Sub aktualisieren_(ByVal einzelnDwmCounter() As Int16, ByRef doubleDwmCounter() As Int16)
        Dim j As Int16
        For j = 0 To doubleDwmCounter.Length - 1
            If einzelnDwmCounter(j) > 1 Then
                doubleDwmCounter(j) = doubleDwmCounter(j) + einzelnDwmCounter(j) - 1
            End If
        Next
    End Sub
    Private Function is_not_empty(ByVal datumBookPos(,) As Integer) As Boolean
        If datumBookPos(0, 0) <> 0 Then
            Return True
        Else
            Return False
        End If
    End Function
    Private Function exist_dwm_in_liste(ByVal dwm As String, ByVal liste() As String) As Boolean
        Dim j As Int16

        If liste.Length = 0 Then
            Return False
        End If
        For j = 0 To liste.Length - 1
            If liste(j) = dwm Then
                Return True
            End If
        Next
        Return False


    End Function
    Private Function welche_tag_der_woche(ByVal day As Integer) As String
        Select Case day
            Case 0
                Return "Κυ"
            Case 1
                Return "Δε"
            Case 2
                Return "Τρ"
            Case 3
                Return "Τε"
            Case 4
                Return "Πε"
            Case 5
                Return "Πα"
            Case 6
                Return "Σα"


        End Select
        Return Nothing
    End Function
    '*************************PLIROTITA XENODOXEIOU******************PLIROTITA XENODOXEIOU**************************PLIROTITA XENODOXEIOU*
    '*************************PLIROTITA XENODOXEIOU******************PLIROTITA XENODOXEIOU**************************PLIROTITA XENODOXEIOU*
    '*************************PLIROTITA XENODOXEIOU******************PLIROTITA XENODOXEIOU**************************PLIROTITA XENODOXEIOU*
    '*************************PLIROTITA XENODOXEIOU******************PLIROTITA XENODOXEIOU**************************PLIROTITA XENODOXEIOU*
    'edw opws plirotita praktoreiwn alla SYNOLIKA gia OLA mazi->Achtung ->tautish apotelesmatvn me ta synola apo ta epimerous praktoreia
    '->(Otan epilegetai ektypvsh tote DEN tautuzontai ta Synola otan epilegei (ola,ola)->Parathesi Olwn tvn moegliche Kombinationen!!!
    Private Sub plirotita_xenodox()


        XenodStatus4Pnl.Controls.Clear()
        XenodStatusImerPck.Value = imeromErgasias

        EtikLbl.Text = "ΠΛΗΡΟΤΗΤΕΣ OLD TOWN"
        EtikLbl.Location = New Point(XenodStatusPnl.Width / 4, 25)

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        XenodStatusPnl.Location = New Point(2, EtiketaErgHmPnl.Height)

        Me.XenodStatusPnl.Size = New Point(800, ZentralPnl.Height)
        Me.TipoiTableAdapter1.FillTipoiXenodByKwd(Me.DbhotelDataSet1.tipoi, 13, 25)
        Me.KlinesTableAdapter1.Fill(Me.DbhotelDataSet1.klines)
        init_klines_tipoi_cboxen_2()
        male_xenod3_pnl()
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        Me.ZentralPnl.Controls.Add(XenodStatusPnl)
    End Sub

    Private Sub init_klines_tipoi_cboxen_2()
        Dim j As Int16

        XenodStatusKlinesCbx.Items.Clear()
        XenodStatusTiposCbx.Items.Clear()
        For j = 0 To 3
            If j <> 0 Then
                XenodStatusKlinesCbx.Items.Add(Me.DbhotelDataSet1.klines(j - 1).perigrafi)
            Else
                XenodStatusKlinesCbx.Items.Add("Όλες")
            End If
        Next



        For j = 0 To Me.DbhotelDataSet1.tipoi.Count
            If j <> 0 Then
                XenodStatusTiposCbx.Items.Add(Me.DbhotelDataSet1.tipoi(j - 1).tipos)
            Else
                XenodStatusTiposCbx.Items.Add("Όλοι")
            End If
        Next
    End Sub

    Private Sub XenodStatusKlinesCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles XenodStatusKlinesCbx.SelectedIndexChanged, XenodStatusTiposCbx.SelectedIndexChanged
        Dim anzahl As Int16

        'If currentsimbolaio <> -1 Then

        'If Not isDBEintrag Then
        If sender.name.Equals("XenodStatusKlinesCbx") Then
            XenodStatus4Pnl.Controls.Clear()

            If sender.selectedindex <> -1 Then
                klinesKwd = get_kwd_klins_byname(sender.selectedItem.ToString)
            Else
                klinesKwd = -1
            End If
            If klinesKwd = -1 Then
                klinesKwd = 0
            End If
            If klinesKwd > 0 Then
                anzahl = Me.KatigoriesTableAdapter.ExistEintrag2(klinesKwd)
                If anzahl = 0 Then
                    MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    XenodStatusKlinesCbx.SelectedIndex = 0

                End If
            End If
        ElseIf sender.name.Equals("XenodStatusTiposCbx") Then
            XenodStatus4Pnl.Controls.Clear()

            If sender.selectedindex <> -1 Then
                tiposKwd = get_kwd_tipos_byname(sender.selectedItem.ToString)
            Else
                tiposKwd = -1
            End If
            If tiposKwd = -1 Then
                tiposKwd = 0
            End If
            If tiposKwd > 0 Then
                anzahl = Me.KatigoriesTableAdapter.ExistEintrag(tiposKwd)
                If anzahl = 0 Then
                    MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    XenodStatusTiposCbx.SelectedIndex = 0
                End If
            End If
        End If
        If klinesKwd > 0 And tiposKwd > 0 Then
            anzahl = Me.KatigoriesTableAdapter.ExistKatigoria(klinesKwd, tiposKwd)
            If anzahl = 0 Then
                MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                XenodStatusTiposCbx.SelectedIndex = 0
                XenodStatusKlinesCbx.SelectedIndex = 0
                'Else
                '    If SimbCbx.Items.Count <> 0 Then
                '        If Not isDBEintrag Then
                '            SimbCbx.SelectedIndex = 0
                '        End If
                '    End If
            End If
        End If

    End Sub

    Private Sub male_xenod3_pnl()
        Dim AloLbl As New Label
        AloLbl.TextAlign = ContentAlignment.MiddleCenter
        AloLbl.Size = New Point(120, 60)
        Me.XenodStatus3Pnl.Controls.Add(AloLbl)
        AloLbl.Location = New Point(1, 0) 'New Point(locx + (i - 1) * stepx, locy
        AloLbl.Text = "Δωμάτια Allotment"
        Dim BookLbl As New Label
        BookLbl.TextAlign = ContentAlignment.MiddleCenter
        BookLbl.Size = New Point(120, 60)
        Me.XenodStatus3Pnl.Controls.Add(BookLbl)
        BookLbl.Location = New Point(1, 2 + AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        BookLbl.Text = "Booking Position"
        Dim KratLbl As New Label
        KratLbl.TextAlign = ContentAlignment.MiddleCenter
        KratLbl.Size = New Point(120, 60)
        Me.XenodStatus3Pnl.Controls.Add(KratLbl)
        KratLbl.Location = New Point(1, 15 + 2 * AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        KratLbl.Text = "Κλεισμένα Δωμάτια"
        Dim KalipsLbl As New Label
        KalipsLbl.TextAlign = ContentAlignment.MiddleCenter
        KalipsLbl.Size = New Point(120, 60)
        Me.XenodStatus3Pnl.Controls.Add(KalipsLbl)
        KalipsLbl.Location = New Point(1, 5 + 4 * AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        KalipsLbl.Text = "Ελεύθερα Δωμάτια"
    End Sub

    Private Sub XenodStatusEmfbtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles XenodStatusEmfbtn.Click
        Dim datumAllotm(), datumBook(), datumKlDwm(), anzahl As Int16

        ReDim datumAllotm(30)
        ReDim datumBook(30)
        ReDim datumKlDwm(30)
        Try
            Me.Cursor = Cursors.WaitCursor
            anzahl = 0
            Me.XenodStatus4Pnl.Controls.Clear()
            If klinesKwd > 0 And tiposKwd > 0 Then 'enas orismenos tipos dwmatiou me kathorismeno arithmo klinwn
                Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, klinesKwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, klinesKwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, klinesKwd, tiposKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    fuehle_datum_krat_xenodox(datumKlDwm)
                End If
                anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(klinesKwd, tiposKwd)
            ElseIf klinesKwd = 0 And tiposKwd > 0 Then 'enas tipos (thea) Anexartitou klinwn
                Me.AllotmentTableAdapter.FillByTipApMex(Me.DbhotelDataSet.allotment, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByTipApMexr(Me.DbhotelDataSet.bookingpos, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter.FillByTipAfAnax(Me.DbhotelDataSet.kratiseis, tiposKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    fuehle_datum_krat_xenodox(datumKlDwm)
                End If
                anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(tiposKwd)
            ElseIf klinesKwd > 0 And tiposKwd = 0 Then 'kathorismnes klines anexartitou tipou dwmatiou
                Me.AllotmentTableAdapter.FillByKlApMexr(Me.DbhotelDataSet.allotment, klinesKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByKlApMexr(Me.DbhotelDataSet.bookingpos, klinesKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter1.FillByKlAfAnax(Me.DbhotelDataSet1.kratiseis, klinesKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date, 13, 25)
                If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
                    fuehle_datum_krat_xenodox_old_town(datumKlDwm)
                End If
                anzahl = Me.KatigoriesTableAdapter1.AnzahlByKlines(klinesKwd, 13, 25)
            Else
                Me.AllotmentTableAdapter.FillByApMexr(Me.DbhotelDataSet.allotment, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByApMexr(Me.DbhotelDataSet.bookingpos, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter1.FillByAfAnax(Me.DbhotelDataSet1.kratiseis, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date, 13, 25)
                If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
                    fuehle_datum_krat_xenodox_old_town(datumKlDwm)
                End If
                anzahl = Me.KatigoriesTableAdapter1.AnzahlBy(13, 25)
            End If


            'MsgBox(Me.DbhotelDataSet.allotment.Count)
            male_xenod_4_pnl(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, anzahl)
        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try
        Me.Cursor = Cursors.Default

    End Sub
    Private Sub male_xenod_4_pnl(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datAllotm() As Int16, ByVal datBook() As Int16, ByVal datKrat() As Int16, ByVal anzahlDwm As Int16)
        Dim tageCount, i As Int16
        Dim locx, locy, stepx, k As Int16
        'Dim katigDwm As String = Nothing
        locx = 33
        locy = 70
        stepx = 31



        tageCount = telosIm.DayOfYear - arxiIm.DayOfYear
        For i = 0 To tageCount
            Dim ImeroLbl As New Label
            ImeroLbl.TextAlign = ContentAlignment.MiddleCenter
            ImeroLbl.Size = New Point(30, 30)

            Me.XenodStatus4Pnl.Controls.Add(ImeroLbl)
            ImeroLbl.Location = New Point(locx + (i - 1) * stepx, locy - stepx) '(locx + (i - 1) * stepx, locy)
            ImeroLbl.Text = arxiIm.Date.AddDays(i).Day.ToString
            ImeroLbl.ForeColor = Color.Blue
            'Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = arxiIm.Date.AddDays(i).Day.ToString
        Next
        Dim DwmLbl As New Label
        DwmLbl.TextAlign = ContentAlignment.MiddleLeft
        DwmLbl.Size = New Point(250, 30)

        Me.XenodStatus4Pnl.Controls.Add(DwmLbl)
        DwmLbl.Location = New Point(5, 5) '(locx + (i - 1) * stepx, locy)
        DwmLbl.Text = "Δωμάτια : " + anzahlDwm.ToString
        DwmLbl.ForeColor = Color.Maroon

        locx = 33
        locy = 70
        k = -1

        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Allotment"
        For i = 0 To datAllotm.Length - 1
            Dim AllotmLbl As New Label
            AllotmLbl.TextAlign = ContentAlignment.MiddleLeft
            AllotmLbl.Size = New Point(35, 30)

            Me.XenodStatus4Pnl.Controls.Add(AllotmLbl)
            AllotmLbl.Location = New Point(locx + (i - 1) * stepx, 23 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            AllotmLbl.Text = datAllotm(i)
            'posostoK(i) = datAllotm(i)
            'ImeroLbl.ForeColor = Color.Blue
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datAllotm(i)
        Next
        locx = 33
        locy = 70
        k = -1
        For i = 0 To datBook.Length - 1
            Dim BookLbl As New Label
            BookLbl.TextAlign = ContentAlignment.MiddleLeft
            BookLbl.Size = New Point(35, 30)

            Me.XenodStatus4Pnl.Controls.Add(BookLbl)
            BookLbl.Location = New Point(locx + (i - 1) * stepx, 23 + 70 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            BookLbl.Text = datBook(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
        Next
        locx = 33
        locy = 70
        k = -1
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Real Booking"
        For i = 0 To datKrat.Length - 1
            Dim KratLbl As New Label
            KratLbl.TextAlign = ContentAlignment.MiddleLeft
            KratLbl.Size = New Point(35, 30)

            Me.XenodStatus4Pnl.Controls.Add(KratLbl)
            KratLbl.Location = New Point(locx + (i - 1) * stepx, 23 + 140 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)

            KratLbl.Text = datKrat(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datKrat(i)
            Dim FreeLbl As New Label
            FreeLbl.TextAlign = ContentAlignment.MiddleLeft
            FreeLbl.Size = New Point(35, 30)
            FreeLbl.Text = anzahlDwm - datKrat(i)
            Me.XenodStatus4Pnl.Controls.Add(FreeLbl)
            FreeLbl.Location = New Point(locx - 3 + (i - 1) * stepx, 23 + 240 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
        Next
    End Sub
    Private Sub XenodStatusEktipbtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles XenodStatusEktipbtn.Click
        Dim j, anzDwm As Int16

        ReDim dAllotmSum(30)
        ReDim dBookSum(30)
        ReDim dKlDwmSum(30)

        Me.DbhotelDataSet.ekt_status_dwm.Clear()
        anzDwm = 0
        Try
            Me.Cursor = Cursors.WaitCursor
            If klinesKwd = 0 And tiposKwd = 0 Then
                For j = 0 To Me.DbhotelDataSet.tipoi.Count - 2
                    xenod_ekt_1(0, Me.DbhotelDataSet.tipoi(j).kwd, False, anzDwm)
                Next
                xenod_ekt_1(0, Me.DbhotelDataSet.tipoi(j).kwd, True, anzDwm)
            Else
                xenod_ekt_1(klinesKwd, tiposKwd, True, anzDwm)
            End If

            zeige_ektiposi()
            Me.Cursor = Cursors.Default
        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try

    End Sub
    Private Sub xenod_ekt_1(ByVal klinesKwd As Integer, ByVal tiposKwd As Integer, ByVal synolOK As Boolean, ByRef anzSum As Int16) 'EKTIPOSI->synolOK ean prepei na ginei 
        'Berechnung ta merika sunola->px sthn anlytiki ektiposi (ola,oloi) den prepei ta merika  alla mono to geniko sinolo
        Dim datumAllotm(), datumBook(), datumKlDwm(), anzahl As Int16
        Dim j As Int16
        Dim aprosdOK As Boolean = False
        ReDim datumAllotm(30)
        ReDim datumBook(30)
        ReDim datumKlDwm(30)



        anzahl = 0
        'Me.XenodStatus4Pnl.Controls.Clear()
        If klinesKwd > 0 And tiposKwd > 0 Then 'enas orismenos tipos dwmatiou me kathorismeno arithmo klinwn->apli ektiposi! (enos)
            Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, klinesKwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
            Try
                anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(klinesKwd, tiposKwd)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, klinesKwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, klinesKwd, tiposKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    fuehle_datum_krat_xenodox(datumKlDwm)
                End If
                xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, anzahl, klinesKwd, tiposKwd, False, anzSum)
            Catch ex As InvalidOperationException

            End Try
        ElseIf klinesKwd = 0 And tiposKwd > 0 Then 'enas tipos me OLES tis  klines (kathemia ksexwrista)
            For j = 0 To Me.DbhotelDataSet.klines.Count - 1
                ReDim datumAllotm(30)
                ReDim datumBook(30)
                ReDim datumKlDwm(30)
                Try
                    anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(Me.DbhotelDataSet.klines(j).kwd, tiposKwd)
                    'anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(tiposKwd)
                    Me.DbhotelDataSet.allotment.Clear()
                    Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, Me.DbhotelDataSet.klines(j).kwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.allotment.Count <> 0 Then
                        fuehle_datum_allotm_xenodox(datumAllotm)
                    End If

                    Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, Me.DbhotelDataSet.klines(j).kwd, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                        fuehle_datum_book_xenodox(datumBook)
                    End If
                    Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, Me.DbhotelDataSet.klines(j).kwd, tiposKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        fuehle_datum_krat_xenodox(datumKlDwm)
                    End If
                    xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, anzahl, Me.DbhotelDataSet.klines(j).kwd, tiposKwd, False, anzSum)
                Catch ex As InvalidOperationException

                End Try
            Next
            ReDim datumAllotm(30)
            ReDim datumBook(30)
            ReDim datumKlDwm(30)
            Try
                'anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(Me.DbhotelDataSet.klines(j).kwd, tiposKwd)
                anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(tiposKwd)
                Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, 0, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, 0, tiposKwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, 0, tiposKwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_krat_xenodox(datumKlDwm)
                End If
                If aprosdOK Then
                    xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, 0, 0, tiposKwd, False, anzSum)
                    aprosdOK = False
                End If
            Catch ex As InvalidOperationException

            End Try
            If anzahl <> 0 And synolOK Then
                xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, dAllotmSum, dBookSum, dKlDwmSum, anzSum, 0, 0, True, anzSum)
            End If


        ElseIf klinesKwd > 0 And tiposKwd = 0 Then 'kathorismnes klines anexartitou tipou dwmatiou

            For j = 0 To Me.DbhotelDataSet.tipoi.Count - 1
                ReDim datumAllotm(30)
                ReDim datumBook(30)
                ReDim datumKlDwm(30)
                Try
                    anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(klinesKwd, Me.DbhotelDataSet.tipoi(j).kwd)
                    'anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(tiposKwd)
                    Me.DbhotelDataSet.allotment.Clear()
                    Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, klinesKwd, Me.DbhotelDataSet.tipoi(j).kwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.allotment.Count <> 0 Then
                        fuehle_datum_allotm_xenodox(datumAllotm)
                    End If

                    Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, klinesKwd, Me.DbhotelDataSet.tipoi(j).kwd, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                        fuehle_datum_book_xenodox(datumBook)
                    End If
                    Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, klinesKwd, Me.DbhotelDataSet.tipoi(j).kwd, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        fuehle_datum_krat_xenodox(datumKlDwm)
                    End If
                    xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, anzahl, klinesKwd, Me.DbhotelDataSet.tipoi(j).kwd, False, anzSum)
                Catch ex As InvalidOperationException

                End Try

            Next

            ReDim datumAllotm(30)
            ReDim datumBook(30)
            ReDim datumKlDwm(30)
            Try
                'anzahl = Me.KatigoriesTableAdapter.AnzahlByKlinesTipos(Me.DbhotelDataSet.klines(j).kwd, tiposKwd)
                anzahl = Me.KatigoriesTableAdapter.AnzahlByKlines(klinesKwd)
                Me.AllotmentTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.allotment, klinesKwd, 0, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_allotm_xenodox(datumAllotm)
                End If
                Me.BookingposTableAdapter.FillByKlTipApMex(Me.DbhotelDataSet.bookingpos, klinesKwd, 0, XenodStatusImerPck.Value.AddDays(30).Date, XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_book_xenodox(datumBook)
                End If
                Me.KratiseisTableAdapter.FillByKlTipAfAnax(Me.DbhotelDataSet.kratiseis, klinesKwd, 0, XenodStatusImerPck.Value.Date.AddDays(30), XenodStatusImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    aprosdOK = True
                    fuehle_datum_krat_xenodox(datumKlDwm)
                End If
                If aprosdOK Then
                    xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, datumAllotm, datumBook, datumKlDwm, 0, klinesKwd, 0, False, anzSum)
                    aprosdOK = False
                End If

            Catch ex As InvalidOperationException

            End Try
            If anzahl <> 0 And synolOK Then
                xenod_ektiposi(XenodStatusImerPck.Value.Date, XenodStatusImerPck.Value.AddDays(30).Date, dAllotmSum, dBookSum, dKlDwmSum, anzSum, 0, 0, True, anzSum)
            End If

        End If
    End Sub
    Private Sub xenod_ektiposi(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datAllotm() As Int16, ByVal datBook() As Int16, ByVal datKrat() As Int16, ByVal anzahlDwm As Int16, ByVal klines As Integer, ByVal tipos As Integer, ByVal isSum As Boolean, ByRef anzSum As Int16)
        Dim i As Int16
        Dim katigoria As String
        Dim klinesPerigr, tiposPerigr As String

        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Allotment"
        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        If Not isSum Then
            klinesPerigr = get_klines_by_kwdikos(klines)
            If klinesPerigr = Nothing Then
                klinesPerigr = " Απροσδιόριστες κλίνες"
            End If
            tiposPerigr = get_tipos_by_kwdikos(tipos)
            If tiposPerigr = Nothing Then
                tiposPerigr = "Απροσδιόριστος τύπος (Θέα)"
            End If
            katigoria = klinesPerigr + " " + tiposPerigr
        Else
            katigoria = "Γενικό Σύνολο"
        End If


        'MsgBox(katigoria)
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).sum = anzahlDwm
        anzSum = anzSum + anzahlDwm
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigoria
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Allot."

        For i = 0 To datAllotm.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datAllotm(i)
            dAllotmSum(i) = dAllotmSum(i) + datAllotm(i)
        Next
        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigoria
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Forec."

        For i = 0 To datBook.Length - 1

            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
            dBookSum(i) = dBookSum(i) + datBook(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
        Next
        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigoria
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Κατηλ."
        For i = 0 To datKrat.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datKrat(i)
            dKlDwmSum(i) = dKlDwmSum(i) + datKrat(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
        Next
    End Sub

    Private Sub zeige_ektiposi()
        Dim i As Int16
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New StatusXenodoxeiou()


        'Me.DbhotelDataSet.ekt_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
        For i = 0 To 30
            Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = XenodStatusImerPck.Value.Date.AddDays(i).Day.ToString
        Next

        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = XenodStatusImerPck.Value.Date
        'Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        'sender.Enabled = True
    End Sub
    Private Sub fuehle_datum_allotm_xenodox(ByRef datumAllotm() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.allotment.Count - 1

            If Me.DbhotelDataSet.allotment(j).apo.Date <= XenodStatusImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.allotment(j).apo.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.allotment(j).mexri.Date >= XenodStatusImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.allotment(j).mexri.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            For k = index1 To index2
                datumAllotm(k) = datumAllotm(k) + Me.DbhotelDataSet.allotment(j).anzahl
            Next
        Next

    End Sub
    Private Sub fuehle_datum_book_xenodox(ByRef datumBook() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.bookingpos.Count - 1

            If Me.DbhotelDataSet.bookingpos(j).apo.Date <= XenodStatusImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.bookingpos(j).apo.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.bookingpos(j).mexri.Date >= XenodStatusImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.bookingpos(j).mexri.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            For k = index1 To index2
                datumBook(k) = datumBook(k) + Me.DbhotelDataSet.bookingpos(j).anzahl
            Next
        Next

    End Sub

    Private Sub fuehle_datum_krat_xenodox(ByRef datumKrat() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.kratiseis.Count - 1

            If Me.DbhotelDataSet.kratiseis(j).afixi.Date <= XenodStatusImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.kratiseis(j).afixi.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= XenodStatusImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If

            For k = index1 To index2
                datumKrat(k) = datumKrat(k) + 1
            Next
        Next

    End Sub

    Private Sub fuehle_datum_krat_xenodox_old_town(ByRef datumKrat() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet1.kratiseis.Count - 1

            If Me.DbhotelDataSet1.kratiseis(j).afixi.Date <= XenodStatusImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet1.kratiseis(j).afixi.DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= XenodStatusImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - XenodStatusImerPck.Value.Date.DayOfYear
            End If

            For k = index1 To index2
                datumKrat(k) = datumKrat(k) + 1
            Next
        Next

    End Sub
    '*************************PLIROTITA PRAKTOREIWN******************PLIROTITA PRAKTOREIWN**************************PLIROTITA PRAKTOREIWN

    '*************************PLIROTITA PRAKTOREIWN******************PLIROTITA PRAKTOREIWN**************************PLIROTITA PRAKTOREIWN

    '*************************PLIROTITA PRAKTOREIWN******************PLIROTITA PRAKTOREIWN**************************PLIROTITA PRAKTOREIWN

    'epixirei sigkrisi Allotment-BookPos (Forecast problepsi) -Pragmatikes Kratiseis
    'H Plirotita Praktorteiou isoutai me to klasma BookPos/AllotmX100!!!!!!!!!!!! 
    Private Sub plirotita_praktoreiwn()


        PraktStatus4Pnl.Controls.Clear()
        StPraktImerPck.Value = imeromErgasias

        EtikLbl.Text = "ΠΛΗΡΟΤΗΤΑ ΠΡΑΚΤΟΡΕΙΩΝ"
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 4, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        PraktStatusPnl.Location = New Point(2, EtiketaErgHmPnl.Height)

        Me.PraktStatusPnl.Size = New Point(800, ZentralPnl.Height)
        ReDim datumAllotmSum(30)
        ReDim datumBookSum(30)
        Me.ZentralPnl.Controls.Add(PraktStatusPnl)
        'ReDim datumKratSum(30)
    End Sub

    Private Sub StPraktPrTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles StPraktPrTbx.Click
        Dim PraktForm As New SimbolaiaFrm()
        Dim kwdikos As Integer
        Dim praktname As String
        Dim j, i, k, length As Int16
        'Dim praktKwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres

        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        kwdikos = PraktForm.return_praktoreio_kwdikos
        'praktKwd = PraktForm.return_praktoreio_kwdikos
        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If praktStKwd = Nothing Then
                PrktTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
                Exit Sub
            End If
        Else
            PraktStatus4Pnl.Controls.Clear()
            PraktStatus2Pnl.Controls.Clear()
            praktStKwd = kwdikos

        End If
        praktname = PraktForm.return_praktoreio
        If praktname = Nothing Then
            StPraktPrTbx.Text = sender.text
        Else
            StPraktPrTbx.Text = praktname
        End If
        'PraktTbx.Text = PraktForm.return_praktoreio
        Dim date1, date2 As Date
        date1 = StPraktImerPck.Value.Date
        date2 = StPraktImerPck.Value.Date.AddDays(30)
        'date1 = "1/1/" + etos.ToString
        'DateTimePicker2.MinDate = imeromErgasias.Date
        'date2 = "31/12/" + etos.ToString
        PraktForm.Dispose()
        male_alotment_pnl()
        ReDim praktStatus(-1)
        'ola ta simbolaia praktoreiou gia to etos ergasias
        Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktStKwd, etos)
        length = 0
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            'sigkentrwnw katigories gia kathe simboalaio tou praktoreoiou gia to ZeitInterval twn 30 Imerwn
            Me.AllotmentTableAdapter.AllotmKatigoriesBySimbolaioImerom(Me.DbhotelDataSet.allotment, Me.DbhotelDataSet.simbolaia(j).kwd, date1, date1, Me.DbhotelDataSet.simbolaia(j).kwd, date2, date2, Me.DbhotelDataSet.simbolaia(j).kwd, date1, date2)
            If Me.DbhotelDataSet.allotment.Count <> 0 Then
                For i = 0 To Me.DbhotelDataSet.allotment.Count - 1
                    ReDim Preserve praktStatus(length)

                    praktStatus(length).simb = Me.DbhotelDataSet.simbolaia(j).kwd
                    praktStatus(length).tipos = Me.DbhotelDataSet.allotment(i).tipos
                    praktStatus(length).klines = Me.DbhotelDataSet.allotment(i).klines
                    praktStatus(length).guarantee = Me.DbhotelDataSet.allotment(i).guaranti
                    length += 1
                Next
            End If

            Me.DbhotelDataSet.kratiseis.Clear()
            'psaxnw kratisies pou eginan xwris allotment!!
            Me.KratiseisTableAdapter.FillBySimbAfAnax(Me.DbhotelDataSet.kratiseis, Me.DbhotelDataSet.simbolaia(j).kwd, date2, date1)
            For k = 0 To Me.DbhotelDataSet.kratiseis.Count - 1
                'If Me.DbhotelDataSet.kratiseis(k).tipos = -1 Then
                '    Me.DbhotelDataSet.kratiseis(k).tipos = 0
                'End If
                'If Me.DbhotelDataSet.kratiseis(k).klines = -1 Then
                '    Me.DbhotelDataSet.kratiseis(k).klines = 0
                'End If
                'If Me.DbhotelDataSet.kratiseis(k).tipos <> Me.DbhotelDataSet.allotment(i).tipos Or Me.DbhotelDataSet.kratiseis(k).klines <> Me.DbhotelDataSet.allotment(i).klines And Me.DbhotelDataSet.kratiseis(k).guarantie <> Me.DbhotelDataSet.allotment(i).guaranti Then
                If not_exist_alllotm(Me.DbhotelDataSet.kratiseis(k).tipos, Me.DbhotelDataSet.kratiseis(k).klines, Me.DbhotelDataSet.kratiseis(k).guarantie) Then
                    ReDim Preserve praktStatus(length)
                    praktStatus(length).simb = Me.DbhotelDataSet.simbolaia(j).kwd
                    praktStatus(length).tipos = Me.DbhotelDataSet.kratiseis(k).tipos
                    praktStatus(length).klines = Me.DbhotelDataSet.kratiseis(k).klines
                    praktStatus(length).guarantee = Me.DbhotelDataSet.kratiseis(k).guarantie
                    length += 1
                End If
            Next
        Next
        indexPraktStat = 0
        'indexGroupEkt = 0

        init_allotm_sum(datumAllotmSum)

        init_allotm_sum(datumBookSum)
        PraktStatusEmfBtn.Focus()
        'init_allotm_sum(datumKratSum)
    End Sub
    Private Function not_exist_alllotm(ByVal tipos As Integer, ByVal klines As Integer, ByVal guarant As Boolean) As Boolean
        Dim j As Int16
        For j = 0 To praktStatus.Length - 1
            If praktStatus(j).tipos = tipos And praktStatus(j).klines = klines And praktStatus(j).guarantee = guarant Then
                Return False
            End If
        Next
        Return True
    End Function
    Private Sub StPraktImerPck_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles StPraktImerPck.ValueChanged
        PraktStatus4Pnl.Controls.Clear()
        StPraktPrTbx.Clear()
        indexPraktStat = -1
        praktStKwd = Nothing
    End Sub
    Private Sub PraktStatusEmfBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktStatusEmfBtn.Click
        Dim datumAllotm(), datumBook(), datumKrat() As Int16
        'Dim i As Int16
        ReDim datumAllotm(30)
        ReDim datumBook(30)
        ReDim datumKrat(30)

        Me.PraktStatus4Pnl.Controls.Clear()
        If indexPraktStat <> -1 Then
            Try
                If indexPraktStat <= praktStatus.Length - 1 Then
                    Me.DbhotelDataSet.allotment.Clear()
                    Me.AllotmentTableAdapter.FillBySimbKlTipApMexGuar(Me.DbhotelDataSet.allotment, praktStatus(indexPraktStat).simb, praktStatus(indexPraktStat).klines,
                   praktStatus(indexPraktStat).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(indexPraktStat).guarantee)

                    If Me.DbhotelDataSet.allotment.Count <> 0 Then
                        fuehle_datum_allotm(datumAllotm)
                        'male_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotm)
                        addiere(datumAllotm, datumAllotmSum)
                    End If
                    Me.BookingposTableAdapter.FillBySimbKlTipApMexGuar(Me.DbhotelDataSet.bookingpos, praktStatus(indexPraktStat).simb, praktStatus(indexPraktStat).klines,
                               praktStatus(indexPraktStat).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(indexPraktStat).guarantee)
                    If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                        fuehle_datum_book(datumBook)

                        addiere(datumBook, datumBookSum)
                    End If
                    Me.KratiseisTableAdapter.FillBySimbKlTipAfAnGuar(Me.DbhotelDataSet.kratiseis, praktStatus(indexPraktStat).simb, praktStatus(indexPraktStat).klines,
                                                 praktStatus(indexPraktStat).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(indexPraktStat).guarantee)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        fuehle_datum_krat(datumKrat)

                    End If

                    male_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotm, datumBook, datumKrat, False)
                    indexPraktStat += 1

                ElseIf indexPraktStat = praktStatus.Length Then
                    Me.KratiseisTableAdapter.FillByPraktAfAnGuar(Me.DbhotelDataSet.kratiseis, praktStKwd, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        fuehle_datum_krat(datumKrat)
                    End If
                    male_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotmSum, datumBookSum, datumKrat, True)
                    indexPraktStat = 0
                    'indexGroupEkt += 1
                    init_allotm_sum(datumAllotmSum)
                    init_allotm_sum(datumBookSum)
                    'init_allotm_sum(datumKratSum)
                End If
            Catch ex As NullReferenceException
                MsgBox("Επιλέξτε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End Try
        Else
            MsgBox("Επιλέξτε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If

    End Sub
    Private Sub male_status_prakt_pnl(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datAllotm() As Int16, ByVal datBook() As Int16, ByVal datKrat() As Int16, ByVal isSum As Boolean)
        Dim i, k As Int16
        Dim tageCount As Integer
        Dim locx, locy, stepx As Int16
        Dim posostoK() As Single
        'Dim katigDwm As String = Nothing

        locx = 33
        locy = 70
        stepx = 31

        'Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()


        tageCount = telosIm.DayOfYear - arxiIm.DayOfYear

        Dim SimbLbl, TiposLbl, KlinesLbl, GuarLbl, SumLbl As New Label
        If Not isSum Then
            SimbLbl.Size = New Point(140, 30)
            SimbLbl.Location = New Point(locx, 5)
            SimbLbl.Text = "Συμβ.: " + get_aasimbolaiou_by_kwd(praktStatus(indexPraktStat).simb)
            'katigDwm = SimbLbl.Text
            TiposLbl.Size = New Point(140, 30)
            TiposLbl.Location = New Point(locx + SimbLbl.Width, 5)
            If praktStatus(indexPraktStat).tipos <> 0 Then
                TiposLbl.Text = get_tipos_by_kwdikos(praktStatus(indexPraktStat).tipos)
            Else
                TiposLbl.Text = "<Ολοι Τύποι>"
            End If
            'katigDwm = katigDwm + " " + TiposLbl.Text
            KlinesLbl.Size = New Point(140, 30)
            KlinesLbl.Location = New Point(locx + SimbLbl.Width + TiposLbl.Width, 5)
            If praktStatus(indexPraktStat).klines <> 0 Then
                KlinesLbl.Text = get_klines_by_kwdikos(praktStatus(indexPraktStat).klines)
            Else
                KlinesLbl.Text = "<Ολες Κλίνες>"
            End If
            'katigDwm = katigDwm + " " + KlinesLbl.Text
            'KlinesLbl.Text = get_klines_by_kwdikos(praktStatus(indexPraktStat).klines)
            GuarLbl.Size = New Point(140, 30)
            GuarLbl.Location = New Point(locx + SimbLbl.Width + TiposLbl.Width + KlinesLbl.Width, 5)
            If praktStatus(indexPraktStat).guarantee Then
                GuarLbl.Text = "Guarantee"
            End If
            'katigDwm = katigDwm + " " + GuarLbl.Text
            SimbLbl.ForeColor = Color.Maroon
            TiposLbl.ForeColor = Color.Maroon
            KlinesLbl.ForeColor = Color.Maroon
            GuarLbl.ForeColor = Color.Maroon
            Me.PraktStatus4Pnl.Controls.Add(SimbLbl)
            Me.PraktStatus4Pnl.Controls.Add(TiposLbl)
            Me.PraktStatus4Pnl.Controls.Add(KlinesLbl)
            Me.PraktStatus4Pnl.Controls.Add(GuarLbl)
        Else
            SumLbl.Size = New Point(350, 30)
            SumLbl.Location = New Point(locx, 5)
            SumLbl.Text = "ΣΥΝΟΛΟ " + StPraktPrTbx.Text
            'katigDwm = SumLbl.Text
            'SumLbl.BackColor = Color.Yellow
            SumLbl.ForeColor = Color.Maroon
            Me.PraktStatus4Pnl.Controls.Add(SumLbl)
        End If

        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm

        For i = 0 To tageCount
            Dim ImeroLbl As New Label
            ImeroLbl.TextAlign = ContentAlignment.MiddleCenter
            ImeroLbl.Size = New Point(30, 30)

            Me.PraktStatus4Pnl.Controls.Add(ImeroLbl)
            ImeroLbl.Location = New Point(locx + (i - 1) * stepx, locy - stepx) '(locx + (i - 1) * stepx, locy)
            ImeroLbl.Text = arxiIm.Date.AddDays(i).Day.ToString
            ImeroLbl.ForeColor = Color.Blue
            'Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = arxiIm.Date.AddDays(i).Day.ToString
        Next
        locx = 33
        locy = 70
        k = -1
        ReDim posostoK(datAllotm.Length - 1)
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Allotment"
        For i = 0 To datAllotm.Length - 1
            Dim AllotmLbl As New Label
            AllotmLbl.TextAlign = ContentAlignment.MiddleLeft
            AllotmLbl.Size = New Point(35, 30)

            Me.PraktStatus4Pnl.Controls.Add(AllotmLbl)
            AllotmLbl.Location = New Point(locx + (i - 1) * stepx, 23 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            AllotmLbl.Text = datAllotm(i)
            posostoK(i) = datAllotm(i)
            'ImeroLbl.ForeColor = Color.Blue
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datAllotm(i)
        Next
        locx = 33
        locy = 70
        k = -1

        'Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Forecast"
        For i = 0 To datBook.Length - 1
            Dim BookLbl As New Label
            BookLbl.TextAlign = ContentAlignment.MiddleLeft
            BookLbl.Size = New Point(35, 30)

            Me.PraktStatus4Pnl.Controls.Add(BookLbl)
            BookLbl.Location = New Point(locx + (i - 1) * stepx, 23 + 70 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            BookLbl.Text = datBook(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
            If posostoK(i) <> 0 Then
                posostoK(i) = (100 * datBook(i) / posostoK(i)).ToString("F0")
            End If
        Next
        locx = 33
        locy = 70
        k = -1
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Real Booking"
        For i = 0 To datKrat.Length - 1
            Dim KratLbl As New Label
            KratLbl.TextAlign = ContentAlignment.MiddleLeft
            KratLbl.Size = New Point(35, 30)

            Me.PraktStatus4Pnl.Controls.Add(KratLbl)
            KratLbl.Location = New Point(locx + (i - 1) * stepx, 23 + 140 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            KratLbl.Text = datKrat(i)
            'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datKrat(i)

        Next
        k = -1
        'Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Real Booking"
        For i = 0 To posostoK.Length - 1
            Dim PosostLbl As New Label
            PosostLbl.TextAlign = ContentAlignment.MiddleLeft
            PosostLbl.Size = New Point(35, 30)

            Me.PraktStatus4Pnl.Controls.Add(PosostLbl)
            PosostLbl.Location = New Point(locx + (i - 1) * stepx, 23 + 240 + (k * 10) + PraktStatus2Pnl.Height) '(locx + (i - 1) * stepx, locy)
            k = -1 * k
            PosostLbl.Text = posostoK(i)
        Next
    End Sub
    Private Sub PraktStatusProepiskfBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktStatusProepiskfBtn.Click
        Dim i As Int16


        Me.DbhotelDataSet.ekt_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
        For i = 0 To 30
            Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = StPraktImerPck.Value.Date.AddDays(i).Day.ToString
        Next

        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New StatusPraktoreiwn()
        Try
            Me.Cursor = Cursors.WaitCursor
            ekt_st_prakt()
            Me.Cursor = Cursors.Default
        Catch ex As NullReferenceException
            MsgBox("Επιλέξτε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            Me.Cursor = Cursors.Default
            Exit Sub
        Catch X As Exception
            Me.Cursor = Cursors.Default
        End Try


        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = StPraktImerPck.Value.Date
        Me.DbhotelDataSet.ekt_status_ekdosi(0).perigrafi = Me.PraktoreiaTableAdapter.GetEponimiaByKwd(praktStKwd)
        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        sender.Enabled = True
    End Sub
    Private Sub ekt_st_prakt()
        Dim datumAllotm(), datumBook(), datumKrat() As Int16
        Dim i As Int16
        init_allotm_sum(datumAllotmSum)

        init_allotm_sum(datumBookSum)

        For i = 0 To praktStatus.Length
            ReDim datumAllotm(30) 'to teleytaio gia sum tis seiras->blepe ektiposi
            ReDim datumBook(30)
            ReDim datumKrat(30)

            If i <= praktStatus.Length - 1 Then
                Me.DbhotelDataSet.allotment.Clear()
                Me.AllotmentTableAdapter.FillBySimbKlTipApMexGuar(Me.DbhotelDataSet.allotment, praktStatus(i).simb, praktStatus(i).klines,
               praktStatus(i).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(i).guarantee)

                If Me.DbhotelDataSet.allotment.Count <> 0 Then
                    fuehle_datum_allotm(datumAllotm)
                    'male_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotm)
                    addiere(datumAllotm, datumAllotmSum)
                End If
                Me.BookingposTableAdapter.FillBySimbKlTipApMexGuar(Me.DbhotelDataSet.bookingpos, praktStatus(i).simb, praktStatus(i).klines,
                           praktStatus(i).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(i).guarantee)
                If Me.DbhotelDataSet.bookingpos.Count <> 0 Then
                    fuehle_datum_book(datumBook)

                    addiere(datumBook, datumBookSum)
                End If

                Me.KratiseisTableAdapter.FillBySimbKlTipAfAnGuar(Me.DbhotelDataSet.kratiseis, praktStatus(i).simb, praktStatus(i).klines,
                           praktStatus(i).tipos, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date, praktStatus(i).guarantee)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    fuehle_datum_krat(datumKrat)

                End If
                ektiposi_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotm, datumBook, datumKrat, False, i)


            ElseIf i = praktStatus.Length Then
                Me.KratiseisTableAdapter.FillByPraktAfAnGuar(Me.DbhotelDataSet.kratiseis, praktStKwd, StPraktImerPck.Value.Date.AddDays(30), StPraktImerPck.Value.Date)
                If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                    fuehle_datum_krat(datumKrat)
                End If
                ektiposi_status_prakt_pnl(StPraktImerPck.Value.Date, StPraktImerPck.Value.Date.AddDays(30), datumAllotmSum, datumBookSum, datumKrat, True, i)

                'indexGroupEkt += 1
                init_allotm_sum(datumAllotmSum)
                init_allotm_sum(datumBookSum)
                'init_allotm_sum(datumKratSum)
            End If
        Next




    End Sub
    Private Sub ektiposi_status_prakt_pnl(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal datAllotm() As Int16, ByVal datBook() As Int16, ByVal datKrat() As Int16, ByVal isSum As Boolean, ByVal index As Int16)
        Dim i, sum As Int16
        Dim tageCount As Integer

        Dim posostoK() As Single
        Dim katigDwm As String = Nothing

        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()


        tageCount = telosIm.DayOfYear - arxiIm.DayOfYear


        If Not isSum Then

            katigDwm = "(Συμβόλαιο " + get_aasimbolaiou_by_kwd(praktStatus(index).simb) + ")"
            'katigDwm = SimbLbl.Text

            If praktStatus(index).tipos <> 0 Then
                katigDwm = katigDwm + " " + get_tipos_by_kwdikos(praktStatus(index).tipos)
            Else
                katigDwm = katigDwm + " <Ολοι Τύποι>"
            End If
            'katigDwm = katigDwm + " " + TiposLbl.Text

            If praktStatus(index).klines <> 0 Then
                katigDwm = katigDwm + " " + get_klines_by_kwdikos(praktStatus(index).klines)
            Else
                katigDwm = katigDwm + " <Ολες Κλίνες>"
            End If
            'katigDwm = katigDwm + " " + KlinesLbl.Text

            If praktStatus(index).guarantee Then
                katigDwm = katigDwm + " Guarantee"
            End If
            'katigDwm = katigDwm + " " + GuarLbl.Text

        Else
            katigDwm = "ΣΥΝΟΛΟ " + StPraktPrTbx.Text
            'katigDwm = SumLbl.Text
            'SumLbl.BackColor = Color.Yellow
        End If

        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm

        sum = 0
        ReDim posostoK(datAllotm.Length - 1)
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Allotm."
        For i = 0 To datAllotm.Length - 1
            posostoK(i) = datAllotm(i)
            sum = sum + datAllotm(i)
            'ImeroLbl.ForeColor = Color.Blue
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datAllotm(i)
        Next
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).sum = sum

        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Forec."
        sum = 0
        For i = 0 To datBook.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datBook(i)
            sum = sum + datBook(i)
            If posostoK(i) <> 0 Then
                posostoK(i) = (100 * datBook(i) / posostoK(i)).ToString("F0")
            End If
        Next
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).sum = sum


        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "RealΒ."
        sum = 0
        For i = 0 To datKrat.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = datKrat(i)
            sum = sum + datKrat(i)
        Next
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).sum = sum
        Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).group = katigDwm
        Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(0) = "Κάλ.%"
        For i = 0 To posostoK.Length - 1
            Me.DbhotelDataSet.ekt_status_dwm(Me.DbhotelDataSet.ekt_status_dwm.Count - 1).Item(i + 1) = posostoK(i)
        Next
    End Sub

    Private Sub fuehle_datum_allotm(ByRef datumAllotm() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.allotment.Count - 1

            If Me.DbhotelDataSet.allotment(j).apo.Date <= StPraktImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.allotment(j).apo.DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.allotment(j).mexri.Date >= StPraktImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.allotment(j).mexri.DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If
            For k = index1 To index2
                datumAllotm(k) = Me.DbhotelDataSet.allotment(j).anzahl
            Next
        Next

    End Sub
    Private Sub fuehle_datum_book(ByRef datumBook() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.bookingpos.Count - 1

            If Me.DbhotelDataSet.bookingpos(j).apo.Date <= StPraktImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.bookingpos(j).apo.DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.bookingpos(j).mexri.Date >= StPraktImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.bookingpos(j).mexri.DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If
            For k = index1 To index2
                datumBook(k) = Me.DbhotelDataSet.bookingpos(j).anzahl
            Next
        Next

    End Sub
    Private Sub fuehle_datum_krat(ByRef datumKrat() As Int16)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet.kratiseis.Count - 1

            If Me.DbhotelDataSet.kratiseis(j).afixi.Date <= StPraktImerPck.Value.Date Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet.kratiseis(j).afixi.DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If
            If Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= StPraktImerPck.Value.Date.AddDays(30) Then
                index2 = 30
            Else
                index2 = Me.DbhotelDataSet.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - StPraktImerPck.Value.Date.DayOfYear
            End If

            For k = index1 To index2
                datumKrat(k) = datumKrat(k) + 1
            Next
        Next

    End Sub
    Private Sub addiere(ByVal datumXXX() As Int16, ByRef datumXXXSum() As Int16)
        Dim j As Int16

        For j = 0 To datumXXX.Length - 1
            datumXXXSum(j) = datumXXXSum(j) + datumXXX(j)
        Next



    End Sub


    Private Sub male_alotment_pnl()
        Dim AloLbl As New Label
        AloLbl.TextAlign = ContentAlignment.MiddleCenter
        AloLbl.Size = New Point(120, 60)
        Me.PraktStatus3Pnl.Controls.Add(AloLbl)
        AloLbl.Location = New Point(1, 0) 'New Point(locx + (i - 1) * stepx, locy
        AloLbl.Text = "Allotment"
        Dim BookLbl As New Label
        BookLbl.TextAlign = ContentAlignment.MiddleCenter
        BookLbl.Size = New Point(120, 60)
        Me.PraktStatus3Pnl.Controls.Add(BookLbl)
        BookLbl.Location = New Point(1, 2 + AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        BookLbl.Text = "Booking Pos."
        Dim KratLbl As New Label
        KratLbl.TextAlign = ContentAlignment.MiddleCenter
        KratLbl.Size = New Point(120, 60)
        Me.PraktStatus3Pnl.Controls.Add(KratLbl)
        KratLbl.Location = New Point(1, 15 + 2 * AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        KratLbl.Text = "Πραγματικές Κρατήσεις"
        Dim KalipsLbl As New Label
        KalipsLbl.TextAlign = ContentAlignment.MiddleCenter
        KalipsLbl.Size = New Point(120, 60)
        Me.PraktStatus3Pnl.Controls.Add(KalipsLbl)
        KalipsLbl.Location = New Point(1, 5 + 4 * AloLbl.Height) 'New Point(locx + (i - 1) * stepx, locy
        KalipsLbl.Text = "Ποσοστό Κάλυψης"

    End Sub

    Private Sub init_allotm_sum(ByRef xxxSum() As Int16)
        Dim j As Int16

        For j = 0 To xxxSum.Length - 1
            xxxSum(j) = 0
        Next
    End Sub

    Private Sub plirotita_timwn()
        Dim Frm As New PlirotitaDwmFrm(connectionString, imeromErgasias)

        Frm.Show()
        Frm.TopMost = True
    End Sub

    'Private Sub frm_Activated(sender As Object, e As EventArgs) Handles Me.Activated

    '    Me.TopMost = True
    'End Sub
    Private Sub plirotita_old_town()
        Dim Frm As New PlirotitaXenodFrm(connectionString, imeromErgasias)
        Frm.Show()
        Frm.TopMost = True
    End Sub
    '*************************PLIROTITA DWMATIWN*****************PLIROTITA DWMATIWN***************************PLIROTITA DWMATIWN*

    Private Sub plirotita_dwmatiwn()
        zeigerDwm1 = -1
        zeigerDwm2 = -1

        Dim numDays As Integer = DateTime.DaysInMonth(Now.Year, imeromErgasias.Date.Month)

        PlirDwmPlithImerTbx.Text = numDays.ToString
        DwmPlirot2Pnl.Controls.Clear()
        DwmPlirot3Pnl.Controls.Clear()
        ImeromPlirotDwm.Value = imeromErgasias

        EtikLbl.Text = "ΠΛΗΡΟΤΗΤΑ ΔΩΜΑΤΙΩΝ"
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 3, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        DwmPlirotitaPnl.Location = New Point(2, EtiketaErgHmPnl.Height)

        Me.DwmPlirotitaPnl.Size = New Point(830, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(DwmPlirotitaPnl)
        'Me.Diamenontes2Pnl.Size = New Point(Diamenontes1Pnl.Width, 2 * Diamenontes1Pnl.Height)
        'ProepDiamBtn.Location = New Point(DiamenBtn.Location.X, Diamenontes2Pnl.Location.Y + Diamenontes2Pnl.Height + 20)


    End Sub
    Private Sub ImeromPlirotDwm_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ImeromPlirotDwm.ValueChanged

        zeigerDwm1 = -1
        zeigerDwm2 = -1
        Me.ProgressBar1.Value = 0
        EktStatusDwmBtn.Enabled = False
        DwmPlirot2Pnl.Controls.Clear()
        DwmPlirot3Pnl.Controls.Clear()
    End Sub

    Private Sub ImeromPlirotDwm_ValueLeave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ImeromPlirotDwm.Leave
        Dim numDays As Integer = DateTime.DaysInMonth(Now.Year, ImeromPlirotDwm.Value.Date.Month)
        'MsgBox(numDays)
        PlirDwmPlithImerTbx.Text = numDays.ToString
    End Sub

    Private Sub ExcelBtn_Click(sender As Object, e As EventArgs) Handles ExcelBtn.Click

        Dim oExcel As Microsoft.Office.Interop.Excel.Application
        Dim oBook As Microsoft.Office.Interop.Excel.Workbook
        Dim oSheet As Microsoft.Office.Interop.Excel.Sheets
        Dim arxiIm As Date = ImeromPlirotDwm.Value.Date
        Dim telosIm As Date = ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1)
        Dim tageCount, i, j As Int16
        Dim range As String

        Try
            ExcelBtn.Enabled = False
            Dim pathstart As String = "n:\winfo\ExcelPlan.xls"
            Dim filename As String = ""
            If File.Exists(pathstart) Then
                filename = "n:\winfo\ExcelPlan.xls"
            Else

                filename = "c:\winfo\ExcelPlan.xls"

            End If
            oExcel = CreateObject("Excel.Application")
            oBook = oExcel.Workbooks.Open(filename)
            oSheet = oBook.Worksheets


            Me.KratiseisTableAdapter.FillKratforConfirmByEtosApoMexrChkin(Me.DbhotelDataSet.kratiseis, etos, arxiIm, telosIm, False)
            '     MsgBox(Me.DbhotelDataSet.kratiseis.Count)
            '   tageCount = telosIm.DayOfYear - arxiIm.DayOfYear
            tageCount = telosIm.Subtract(arxiIm).Days()
            'Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
            'Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
            For i = 0 To tageCount

                oSheet(1).Cells(1, i + 2).value = arxiIm.Date.AddDays(i).Date
            Next

            Dim dwmatiaList As New List(Of String)()

            Using connection As New SqlConnection(connectionString)
                Dim command As New SqlCommand("SELECT villa FROM planovilles ORDER BY displayorder", connection)
                connection.Open()
                Dim reader As SqlDataReader = command.ExecuteReader()

                While reader.Read()
                    dwmatiaList.Add(reader.GetString(0)) ' Assuming the villa names are stored as strings
                End While

                connection.Close()
            End Using
            For x As Integer = 0 To dwmatiaList.Count - 1
                oSheet(1).Cells(x + 2, 1).Value = dwmatiaList(x)
            Next
            ' Convert the List to an array if needed
            dwm = dwmatiaList.ToArray()
            'oSheet(1).Cells(2, 1).value = "EEAN"
            'oSheet(1).Cells(3, 1).value = "MAIL"
            'oSheet(1).Cells(4, 1).value = "PERS"
            'oSheet(1).Cells(5, 1).value = "THOI"
            'oSheet(1).Cells(6, 1).value = "PUE"
            'oSheet(1).Cells(7, 1).value = "MAVI"
            'oSheet(1).Cells(8, 1).value = "IKR"


            'oSheet(1).Cells(9, 1).value = "ARCH"
            'oSheet(1).Cells(10, 1).value = "IRI"
            'oSheet(1).Cells(11, 1).value = "AFR"
            'oSheet(1).Cells(12, 1).value = "IPER"

            'oSheet(1).Cells(13, 1).value = "UB1Y"

            'oSheet(1).Cells(14, 1).value = "UB1C"
            'oSheet(1).Cells(15, 1).value = "UB2C"

            'oSheet(1).Cells(16, 1).value = "UB3C"
            'oSheet(1).Cells(17, 1).value = "UB4C"

            'oSheet(1).Cells(18, 1).value = "UB1D"
            'oSheet(1).Cells(19, 1).value = "UB3D"

            'oSheet(1).Cells(20, 1).value = "BLUE"
            'oSheet(1).Cells(21, 1).value = "GRY"

            'oSheet(1).Cells(22, 1).value = "ORA"
            'oSheet(1).Cells(23, 1).value = "YELL"
            'oSheet(1).Cells(24, 1).value = "RED"
            'oSheet(1).Cells(25, 1).value = "COC"
            'oSheet(1).Cells(26, 1).value = "GRE"
            'oSheet(1).Cells(27, 1).value = "SAN"
            'oSheet(1).Cells(28, 1).value = "WHI"
            'oSheet(1).Cells(29, 1).value = "MARU"




            'oSheet(1).Cells(30, 1).value = "THET"
            'oSheet(1).Cells(31, 1).value = "OLDRE"
            'oSheet(1).Cells(32, 1).value = "SKANT"
            'oSheet(1).Cells(33, 1).value = "THEROS"
            'oSheet(1).Cells(34, 1).value = "P1ATH"
            'oSheet(1).Cells(35, 1).value = "P2ATH"
            'oSheet(1).Cells(36, 1).value = "ORTH"

            'ReDim dwm(34)
            'dwm(0) = "EEAN"
            'dwm(1) = "MAIL"
            'dwm(2) = "PERS"
            'dwm(3) = "THOI"
            'dwm(4) = "PUE"
            'dwm(5) = "MAVI"
            'dwm(6) = "IKR"
            ''dwm(5) = "ALE"
            ''dwm(6) = "MIC"
            'dwm(7) = "ARCH"
            'dwm(8) = "IRI"
            'dwm(9) = "AFR"
            'dwm(10) = "IPER"
            '' dwm(11) = "SF6"
            'dwm(11) = "UB1Y"

            'dwm(12) = "UB1C" 'neo
            'dwm(13) = "UB2C" 'neo

            'dwm(14) = "UB3C"
            'dwm(15) = "UB4C"


            'dwm(16) = "UB1D" 'neo
            'dwm(17) = "UB3D" 'neo


            'dwm(18) = "BLUE"
            'dwm(19) = "GRY"

            'dwm(20) = "ORA"
            'dwm(21) = "YELL"

            'dwm(22) = "RED" 'neo


            'dwm(23) = "COC"
            'dwm(24) = "GRE"
            'dwm(25) = "SAN"
            'dwm(26) = "WHI"
            'dwm(27) = "MARU"
            ''dwm(20) = "MAVI"


            ''dwm(23) = "MHILL" 'bgainei!
            'dwm(28) = "THET"
            'dwm(29) = "OLDRE"

            'dwm(30) = "SKANT" 'neo
            'dwm(31) = "THEROS"
            'dwm(32) = "P1ATH"
            'dwm(33) = "P2ATH"
            'dwm(34) = "ORTH" 'neo
            'SOS ALAKSE KAI TON ARITHMO For j = 0 To 31

        Catch ex As System.Runtime.InteropServices.COMException
            MsgBox("Παρουσιάστηκε σφάλμα", MsgBoxStyle.Critical)
            oExcel.Quit()
            ExcelBtn.Enabled = True
            Exit Sub
        End Try
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection



            For j = 0 To dwm.Length - 1

                Dim imeresStat() As Integer
                Dim kwdKrat() As Integer
                ReDim imeresStat(tageCount)
                ReDim kwdKrat(tageCount)
                init_status_dwmatiou(imeresStat)
                init_kwd_krat(kwdKrat)

                command.Parameters.AddWithValue("@dwmatio1", dwm(j))
                command.Parameters.AddWithValue("@enarxi1", arxiIm)
                command.Parameters.AddWithValue("@lixi1", arxiIm)
                command.Parameters.AddWithValue("@dwmatio2", dwm(j))
                command.Parameters.AddWithValue("@enarxi2", telosIm)
                command.Parameters.AddWithValue("@lixi2", telosIm)
                command.Parameters.AddWithValue("@dwmatio3", dwm(j))
                command.Parameters.AddWithValue("@enarxi3", arxiIm)
                command.Parameters.AddWithValue("@lixi3", telosIm)
                command.CommandText = "SELECT DISTINCT kwd, dwmatio, kratisi, enarxi, lixi, dwmatiostatus FROM status WHERE (dwmatio=@dwmatio1) AND (enarxi<=@enarxi1) AND (lixi>=@lixi1) OR (dwmatio=@dwmatio2) AND (enarxi<=@enarxi2) AND (lixi>=@lixi2) OR (dwmatio=@dwmatio3) AND (enarxi>@enarxi3) AND (lixi<@lixi3)"
                myReader = command.ExecuteReader()
                ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
                While myReader.Read()
                    'kalutera diktes apo pou mexri pou sto imeresStat
                    Dim zeiger1, zeiger2 As Integer
                    ' zeiger1 = arxiIm.DayOfYear - myReader.GetDateTime(3).DayOfYear
                    zeiger1 = arxiIm.Subtract(myReader.GetDateTime(3)).Days()
                    If myReader.GetDateTime(3) < arxiIm Then
                        zeiger1 = 0
                    ElseIf myReader.GetDateTime(3) >= arxiIm And myReader.GetDateTime(3) <= telosIm Then
                        '  zeiger1 = myReader.GetDateTime(3).DayOfYear - arxiIm.DayOfYear
                        zeiger1 = myReader.GetDateTime(3).Subtract(arxiIm).Days()
                    Else
                        zeiger1 = -1
                    End If

                    If myReader.GetDateTime(4) >= telosIm Then
                        zeiger2 = imeresStat.Length - 1
                    ElseIf myReader.GetDateTime(4) >= arxiIm And myReader.GetDateTime(4) < telosIm Then
                        ' zeiger2 = myReader.GetDateTime(4).DayOfYear - arxiIm.DayOfYear
                        zeiger2 = myReader.GetDateTime(4).Subtract(arxiIm).Days()
                    Else
                        zeiger2 = -1
                    End If
                    If zeiger1 >= 0 AndAlso zeiger2 >= 0 Then
                        'DOMISI -> allagh gia na blepw not Confirmed Kratiseis
                        setze_status(zeiger1, zeiger2, myReader.GetInt32(5), imeresStat, myReader.GetInt32(2), kwdKrat)
                    End If

                End While
                myReader.Close()
                command.Parameters.Clear()



                command.CommandText = "SELECT apo, mexri, mindays from minstay where vila = @dwmatia and etos = @arxiImYear"
                command.Parameters.AddWithValue("@dwmatia", dwmatia(j))
                command.Parameters.AddWithValue("@arxiImYear", arxiIm.Year.ToString())

                Dim minstayAdapter As New SqlDataAdapter(command)

                Dim minstayset As New DataSet()
                minstayAdapter.Fill(minstayset, "minstay")
                Dim MinimStayTable As DataTable
                MinimStayTable = minstayset.Tables("minstay")
                Dim Rows() As DataRow
                Dim imerom As String


                For i = 0 To imeresStat.Length - 1
                    '   oSheet(1).Cells(13, 1).value = "UB1Y"
                    oSheet(1).Cells(j + 2, i + 2).value = get_status_by_kwd(imeresStat(i))
                    range = get_range((i + 2), j + 2)


                    If imeresStat(i) <> -1 And range <> "" Then
                        If imeresStat(i) = 1 Or imeresStat(i) = 9 Then
                            If ist_heat_pisina(kwdKrat(i).ToString) Then

                                oSheet(1).Range(range).Font.Color = Color.SkyBlue

                            Else
                                oSheet(1).Range(range).Font.Color = Color.Blue


                            End If

                        ElseIf imeresStat(i) = 5 Then
                            oSheet(1).Range(range).Font.Color = Color.Maroon

                        ElseIf imeresStat(i) = 3 Then
                            oSheet(1).Range(range).Font.Color = Color.Red

                        ElseIf imeresStat(i) = 8 Then
                            oSheet(1).Range(range).Font.Color = Color.Black

                        End If

                    Else




                        imerom = arxiIm.AddDays(i).ToString("M/d/yyyy")
                        Rows = MinimStayTable.Select("apo <= #" + imerom + "# AND mexri>=#" + imerom + "#")

                        If Rows.Length = 0 Then

                            oSheet(1).Cells(j + 2, i + 2).value = "-"
                        Else


                            oSheet(1).Cells(j + 2, i + 2).value = Rows(0).Item(2)
                        End If


                    End If


                Next

                Try
                    Me.ProgressBar1.Value += 10
                Catch ex As ArgumentOutOfRangeException
                    Me.ProgressBar1.Value = 0
                End Try

            Next
            Me.ProgressBar1.Value = 100
            oExcel.Quit()

        End Using
        ExcelBtn.Enabled = True
    End Sub
    Private Function get_range(ByVal column As Int16, ByVal row As Int16) As String
        Dim range As String = ""
        Select Case column
            Case 2
                range = "B" + row.ToString + ":B" + row.ToString
                Return range
            Case 3
                range = "C" + row.ToString + ":C" + row.ToString
                Return range
            Case 4
                range = "D" + row.ToString + ":D" + row.ToString
                Return range
            Case 5
                range = "E" + row.ToString + ":E" + row.ToString
                Return range
            Case 6
                range = "F" + row.ToString + ":F" + row.ToString
                Return range
            Case 7
                range = "G" + row.ToString + ":G" + row.ToString
                Return range
            Case 8
                range = "H" + row.ToString + ":H" + row.ToString
                Return range
            Case 9
                range = "I" + row.ToString + ":I" + row.ToString
                Return range
            Case 10
                range = "J" + row.ToString + ":J" + row.ToString
                Return range
            Case 11
                range = "K" + row.ToString + ":K" + row.ToString
                Return range
            Case 12
                range = "L" + row.ToString + ":L" + row.ToString
                Return range
            Case 13
                range = "M" + row.ToString + ":M" + row.ToString
                Return range
            Case 14
                range = "N" + row.ToString + ":N" + row.ToString
                Return range
            Case 15
                range = "O" + row.ToString + ":O" + row.ToString
                Return range
            Case 16
                range = "P" + row.ToString + ":P" + row.ToString
                Return range
            Case 17
                range = "Q" + row.ToString + ":Q" + row.ToString
                Return range
            Case 18
                range = "R" + row.ToString + ":R" + row.ToString
                Return range
            Case 19
                range = "S" + row.ToString + ":S" + row.ToString
                Return range
            Case 20
                range = "T" + row.ToString + ":T" + row.ToString
                Return range
            Case 21
                range = "U" + row.ToString + ":U" + row.ToString
                Return range
            Case 22
                range = "V" + row.ToString + ":V" + row.ToString
                Return range
            Case 23
                range = "W" + row.ToString + ":W" + row.ToString
                Return range
            Case 24
                range = "X" + row.ToString + ":X" + row.ToString
                Return range
            Case 25
                range = "Y" + row.ToString + ":Y" + row.ToString
                Return range
            Case 26
                range = "Z" + row.ToString + ":Z" + row.ToString
                Return range
            Case 27
                range = "AA" + row.ToString + ":AA" + row.ToString
                Return range
            Case 28
                range = "AB" + row.ToString + ":AB" + row.ToString
                Return range
            Case 29
                range = "AC" + row.ToString + ":AC" + row.ToString
                Return range
            Case 30
                range = "AD" + row.ToString + ":AD" + row.ToString
                Return range
            Case 31
                range = "AE" + row.ToString + ":AE" + row.ToString
                Return range
            Case 32
                range = "AF" + row.ToString + ":AF" + row.ToString
                Return range
            Case 33
                range = "AG" + row.ToString + ":AG" + row.ToString
                Return range
            Case 34
                range = "AH" + row.ToString + ":AH" + row.ToString
                Return range
            Case 35
                range = "AI" + row.ToString + ":AI" + row.ToString
                Return range
            Case 36
                range = "AJ" + row.ToString + ":AJ" + row.ToString
                Return range
            Case 37
                range = "AK" + row.ToString + ":AK" + row.ToString
                Return range
            Case 38
                range = "AL" + row.ToString + ":AL" + row.ToString
                Return range
            Case 39
                range = "AM" + row.ToString + ":AM" + row.ToString
                Return range
            Case 40
                range = "AN" + row.ToString + ":AN" + row.ToString
                Return range
            Case 41
                range = "AO" + row.ToString + ":AO" + row.ToString
                Return range
            Case 42
                range = "AP" + row.ToString + ":AP" + row.ToString
                Return range
            Case 43
                range = "AQ" + row.ToString + ":AQ" + row.ToString
                Return range
            Case 44
                range = "AR" + row.ToString + ":AR" + row.ToString
                Return range
            Case 45
                range = "AS" + row.ToString + ":AS" + row.ToString
                Return range
            Case 46
                range = "AT" + row.ToString + ":AT" + row.ToString
                Return range
            Case 47
                range = "AU" + row.ToString + ":AU" + row.ToString
                Return range
            Case 48
                range = "AV" + row.ToString + ":AV" + row.ToString
                Return range
            Case 49
                range = "AW" + row.ToString + ":AW" + row.ToString
                Return range
            Case 50
                range = "AX" + row.ToString + ":AX" + row.ToString
                Return range
            Case 51
                range = "AY" + row.ToString + ":AY" + row.ToString
                Return range
            Case 52
                range = "AZ" + row.ToString + ":AZ" + row.ToString
                Return range

            Case 53
                range = "BA" + row.ToString + ":BA" + row.ToString
                Return range
            Case 54
                range = "BB" + row.ToString + ":BB" + row.ToString
                Return range
            Case 55
                range = "BC" + row.ToString + ":BC" + row.ToString
                Return range
            Case 56
                range = "BD" + row.ToString + ":BD" + row.ToString
                Return range
            Case 57
                range = "BE" + row.ToString + ":BE" + row.ToString
                Return range
            Case 58
                range = "BF" + row.ToString + ":BF" + row.ToString
                Return range
            Case 59
                range = "BG" + row.ToString + ":BG" + row.ToString
                Return range
            Case 60
                range = "BH" + row.ToString + ":BH" + row.ToString
                Return range
            Case 61
                range = "BI" + row.ToString + ":BI" + row.ToString
                Return range
            Case 62
                range = "BJ" + row.ToString + ":BJ" + row.ToString
                Return range
            Case 63
                range = "BK" + row.ToString + ":BK" + row.ToString
                Return range
            Case 64
                range = "BL" + row.ToString + ":BL" + row.ToString
                Return range
            Case 65
                range = "BM" + row.ToString + ":BM" + row.ToString
                Return range
            Case 66
                range = "BN" + row.ToString + ":BN" + row.ToString
                Return range
            Case 67
                range = "BO" + row.ToString + ":BO" + row.ToString
                Return range
            Case 68
                range = "BP" + row.ToString + ":BP" + row.ToString
                Return range
            Case 69
                range = "BQ" + row.ToString + ":BQ" + row.ToString
                Return range
            Case 70
                range = "BR" + row.ToString + ":BR" + row.ToString
                Return range
            Case 71
                range = "BS" + row.ToString + ":BS" + row.ToString
                Return range
            Case 72
                range = "BT" + row.ToString + ":BT" + row.ToString
                Return range
            Case 73
                range = "BU" + row.ToString + ":BU" + row.ToString
                Return range
            Case 74
                range = "BV" + row.ToString + ":BV" + row.ToString
                Return range
            Case 75
                range = "BW" + row.ToString + ":BW" + row.ToString
                Return range
            Case 76
                range = "BX" + row.ToString + ":BX" + row.ToString
                Return range
            Case 77
                range = "BY" + row.ToString + ":BY" + row.ToString
                Return range
            Case 78
                range = "BZ" + row.ToString + ":BZ" + row.ToString
                Return range

            Case 79
                range = "CA" + row.ToString + ":CA" + row.ToString
                Return range
            Case 80
                range = "CB" + row.ToString + ":CB" + row.ToString
                Return range
            Case 81
                range = "CC" + row.ToString + ":CC" + row.ToString
                Return range
            Case 82
                range = "CD" + row.ToString + ":CD" + row.ToString
                Return range
            Case 83
                range = "CE" + row.ToString + ":CE" + row.ToString
                Return range
            Case 84
                range = "CF" + row.ToString + ":CF" + row.ToString
                Return range
            Case 85
                range = "CG" + row.ToString + ":CG" + row.ToString
                Return range
            Case 86
                range = "CH" + row.ToString + ":CH" + row.ToString
                Return range
            Case 87
                range = "CI" + row.ToString + ":CI" + row.ToString
                Return range
            Case 88
                range = "CJ" + row.ToString + ":CJ" + row.ToString
                Return range
            Case 89
                range = "CK" + row.ToString + ":CK" + row.ToString
                Return range
            Case 90
                range = "CL" + row.ToString + ":CL" + row.ToString
                Return range
            Case 91
                range = "CM" + row.ToString + ":CM" + row.ToString
                Return range
            Case 92
                range = "CN" + row.ToString + ":CN" + row.ToString
                Return range
            Case 93
                range = "CO" + row.ToString + ":CO" + row.ToString
                Return range
            Case 94
                range = "CP" + row.ToString + ":CP" + row.ToString
                Return range
            Case 95
                range = "CQ" + row.ToString + ":CQ" + row.ToString
                Return range
            Case 96
                range = "CR" + row.ToString + ":CR" + row.ToString
                Return range
            Case 97
                range = "CS" + row.ToString + ":CS" + row.ToString
                Return range
            Case 98
                range = "CT" + row.ToString + ":CT" + row.ToString
                Return range
            Case 99
                range = "CU" + row.ToString + ":CU" + row.ToString
                Return range
            Case 100
                range = "CV" + row.ToString + ":CV" + row.ToString
                Return range
            Case 101
                range = "CW" + row.ToString + ":CW" + row.ToString
                Return range
            Case 102
                range = "CX" + row.ToString + ":CX" + row.ToString
                Return range
            Case 103
                range = "CY" + row.ToString + ":CY" + row.ToString
                Return range
            Case 104
                range = "CZ" + row.ToString + ":CZ" + row.ToString
                Return range

        End Select
        Return range
        'oSheet.Range("A1:A1").Interior.Color = RGB(255, 100, 120)
    End Function

    Private Sub DwmPlirotBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmPlirotBtn.Click
        'Dim count As Single
        BtnsPnl.Enabled = True
        If zeigerDwm1 = -1 And zeigerDwm2 = -1 Then
            fuele_alle_zimmer()
            'PlirDwmPlithImerTbx
            'PlirDwmEwsTbx
            'count = dwmatia.Length / 10
            If dwmatia.Length - 1 <= 9 Then
                zeigerDwm1 = 0
                zeigerDwm2 = dwmatia.Length - 1
                zeig_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1), zeigerDwm1, zeigerDwm2)
            Else
                zeigerDwm1 = 0
                zeigerDwm2 = 9
                zeig_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1), zeigerDwm1, zeigerDwm2)
            End If
            EktStatusDwmBtn.Enabled = True
        End If

    End Sub
    Private Sub sortkatichk_CheckedChanged(sender As Object, e As EventArgs) Handles sortkatichk.CheckedChanged
        zeigerDwm1 = -1
        zeigerDwm2 = -1
        Me.ProgressBar1.Value = 0
        EktStatusDwmBtn.Enabled = False
        DwmPlirot2Pnl.Controls.Clear()
        DwmPlirot3Pnl.Controls.Clear()
    End Sub
    Private Sub zeig_plirotita_dwmatiwn(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal index1 As Int16, ByVal index2 As Int16)
        Dim i, j As Int16
        Dim tageCount As Integer
        'Dim dateCount As Date
        Dim locx, locy, stepx As Int16
        'If zeigerDwm1 = -1 And zeigerDwm2 = -1 Then
        'End If
        locx = 40
        locy = 32

        stepx = 33
        'dateCount = arxiIm
        If index1 <> -1 Then
            'DOMISI kratiseis gia confirmation
            Me.KratiseisTableAdapter.FillKratforConfirmByEtosApoMexrChkin(Me.DbhotelDataSet.kratiseis, etos, arxiIm, telosIm, False)
            '     MsgBox(Me.DbhotelDataSet.kratiseis.Count)
            '   tageCount = telosIm.DayOfYear - arxiIm.DayOfYear
            tageCount = telosIm.Subtract(arxiIm).Days()
            'Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
            'Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
            For i = 0 To tageCount
                Dim ImeroLbl As New Label
                ImeroLbl.TextAlign = ContentAlignment.MiddleCenter
                ImeroLbl.Size = New Point(35, 35)

                Me.DwmPlirot2Pnl.Controls.Add(ImeroLbl)
                ImeroLbl.Location = New Point(locx + (i - 1) * stepx, locy - stepx) '(locx + (i - 1) * stepx, locy)
                ImeroLbl.Text = arxiIm.Date.AddDays(i).DayOfWeek.ToString.Substring(0, 2) + ChrW(13) + arxiIm.Date.AddDays(i).Day.ToString
                ImeroLbl.ForeColor = Color.Black
                'Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = arxiIm.Date.AddDays(i).Day.ToString
            Next


            'Me.DbhotelDataSet.ekt_status_dwm.Rows.Clear()
            For j = index1 To index2
                Dim MinasLbl As New Label
                MinasLbl.TextAlign = ContentAlignment.MiddleCenter
                MinasLbl.Size = New Point(70, 30)
                Me.DwmPlirot3Pnl.Controls.Add(MinasLbl)
                MinasLbl.Location = New Point(1, locy) 'New Point(locx + (i - 1) * stepx, locy
                MinasLbl.Text = dwmatia(j)
                'Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
                'Me.DbhotelDataSet.ekt_status_dwm(j - index1).dwmatio = dwmatia(j)
                locy = locy + stepx

                MinasLbl.ForeColor = Color.Blue
            Next

            locx = 40
            locy = 30
            'Me.ProgressBar1.Value += 10
            Using connection As New SqlConnection(connectionString)
                Dim command As New SqlCommand()
                Dim myReader As SqlDataReader
                connection.Open()
                command.Connection = connection

                For j = index1 To index2

                    Dim imeresStat() As Integer
                    Dim kwdKrat() As Integer
                    ReDim imeresStat(tageCount)
                    ReDim kwdKrat(tageCount)
                    init_status_dwmatiou(imeresStat)
                    init_kwd_krat(kwdKrat)

                    command.Parameters.AddWithValue("@dwmatio1", dwmatia(j))
                    command.Parameters.AddWithValue("@enarxi1", arxiIm)
                    command.Parameters.AddWithValue("@lixi1", arxiIm)
                    command.Parameters.AddWithValue("@dwmatio2", dwmatia(j))
                    command.Parameters.AddWithValue("@enarxi2", telosIm)
                    command.Parameters.AddWithValue("@lixi2", telosIm)
                    command.Parameters.AddWithValue("@dwmatio3", dwmatia(j))
                    command.Parameters.AddWithValue("@enarxi3", arxiIm)
                    command.Parameters.AddWithValue("@lixi3", telosIm)
                    command.CommandText = "SELECT DISTINCT kwd, dwmatio, kratisi, enarxi, lixi, dwmatiostatus FROM status WHERE (dwmatio=@dwmatio1) AND (enarxi<=@enarxi1) AND (lixi>=@lixi1) OR (dwmatio=@dwmatio2 ) AND (enarxi<=@enarxi2) AND (lixi>=@lixi2) OR (dwmatio=@dwmatio3) AND (enarxi>@enarxi3) AND (lixi<@lixi3)"
                    myReader = command.ExecuteReader()
                    ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
                    While myReader.Read()
                        'kalutera diktes apo pou mexri pou sto imeresStat
                        Dim zeiger1, zeiger2 As Integer
                        ' zeiger1 = arxiIm.DayOfYear - myReader.GetDateTime(3).DayOfYear
                        zeiger1 = arxiIm.Subtract(myReader.GetDateTime(3)).Days()
                        If myReader.GetDateTime(3) < arxiIm Then
                            zeiger1 = 0
                        ElseIf myReader.GetDateTime(3) >= arxiIm And myReader.GetDateTime(3) <= telosIm Then
                            '  zeiger1 = myReader.GetDateTime(3).DayOfYear - arxiIm.DayOfYear
                            zeiger1 = myReader.GetDateTime(3).Subtract(arxiIm).Days()
                        Else
                            zeiger1 = -1
                        End If

                        If myReader.GetDateTime(4) >= telosIm Then
                            zeiger2 = imeresStat.Length - 1
                        ElseIf myReader.GetDateTime(4) >= arxiIm And myReader.GetDateTime(4) < telosIm Then
                            ' zeiger2 = myReader.GetDateTime(4).DayOfYear - arxiIm.DayOfYear
                            zeiger2 = myReader.GetDateTime(4).Subtract(arxiIm).Days()
                        Else
                            zeiger2 = -1
                        End If
                        If zeiger1 >= 0 AndAlso zeiger2 >= 0 Then
                            'DOMISI -> allagh gia na blepw not Confirmed Kratiseis
                            setze_status(zeiger1, zeiger2, myReader.GetInt32(5), imeresStat, myReader.GetInt32(2), kwdKrat)
                        End If

                    End While
                    myReader.Close()
                    command.Parameters.Clear()


                    command.CommandText = "SELECT apo, mexri, mindays from minstay where  vila = '" + dwmatia(j) + "'" + " and etos =  " + arxiIm.Year.ToString '+ " and
                    Dim minstayAdapter As New SqlDataAdapter(command)
                    Dim minstayset As New DataSet()
                    minstayAdapter.Fill(minstayset, "minstay")
                    Dim MinimStayTable As DataTable
                    MinimStayTable = minstayset.Tables("minstay")
                    Dim Rows() As DataRow
                    Dim imerom As String


                    For i = 0 To imeresStat.Length - 1
                        Dim ImeroWertLbl As New Label
                        ImeroWertLbl.Name = kwdKrat(i).ToString
                        ImeroWertLbl.TextAlign = ContentAlignment.MiddleCenter
                        ImeroWertLbl.Size = New Point(30, 30)
                        '   AddHandler ImeroWertLbl.MouseClick, AddressOf info_plano_zeigen
                        ImeroWertLbl.BackColor = Color.Azure
                        '(locx + (i - 1) * stepx, locy)
                        If imeresStat(i) <> -1 Then
                            If imeresStat(i) = 1 Or imeresStat(i) = 9 Then
                                If ist_heat_pisina(kwdKrat(i).ToString) Then
                                    ImeroWertLbl.ForeColor = Color.SkyBlue
                                Else
                                    ImeroWertLbl.ForeColor = Color.Blue
                                End If

                            ElseIf imeresStat(i) = 5 Then
                                ImeroWertLbl.ForeColor = Color.Maroon
                            ElseIf imeresStat(i) = 3 Then
                                ImeroWertLbl.ForeColor = Color.Red
                            ElseIf imeresStat(i) = 8 Then
                                ImeroWertLbl.ForeColor = Color.Black
                            End If
                            'ImeroWertLbl.Text = Me.DwmatiastatusTableAdapter.GetStatusByKwd(imeresStat(i))
                            ImeroWertLbl.Text = get_status_by_kwd(imeresStat(i))
                        Else
                            ImeroWertLbl.ForeColor = Color.Green

                            imerom = arxiIm.AddDays(i).ToString("M/d/yyyy")
                            Rows = MinimStayTable.Select("apo <= #" + imerom + "# AND mexri>=#" + imerom + "#")

                            If Rows.Length = 0 Then
                                ImeroWertLbl.Text = "-"
                            Else

                                ImeroWertLbl.Text = Rows(0).Item(2)
                            End If
                        End If
                        ImeroWertLbl.Location = New Point(locx + (i - 1) * stepx, locy) '(locx + (i - 1) * stepx, locy - stepx)
                        'ImeroWertLbl.ForeColor = Color.Maroon
                        Me.DwmPlirot2Pnl.Controls.Add(ImeroWertLbl)

                    Next
                    locy = locy + stepx
                    Try
                        Me.ProgressBar1.Value += 10
                    Catch ex As ArgumentOutOfRangeException
                        Me.ProgressBar1.Value = 0
                    End Try

                Next
            End Using

            Me.ProgressBar1.Value = 0
        End If
        'Me.DwmPlirot2Pnl.Controls.Add(DwmPlirot3Pnl)

    End Sub
    Private Function ist_heat_pisina(ByVal kratisi As String) As Boolean
        Dim i As Int16
        Dim drarray() As DataRow
        Dim filterExp As String

        filterExp = "kwd= " + kratisi
        drarray = Me.DbhotelDataSet.kratiseis.Select(filterExp)

        For i = 0 To drarray.Length - 1
            If drarray(i)("allagesdwmatiwn") = True Then
                Return True
            End If
        Next

        Return False
    End Function

    'Private Sub info_plano_zeigen(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Dim kwdikos As Integer
    '    Dim onoma As String
    '    Try
    '        kwdikos = CType(sender.name, Integer)
    '    Catch ex As InvalidCastException
    '        Exit Sub
    '    End Try

    '    Me.AfixeisAnaxwriseis2TableAdapter.FillBykwdikokratisis(Me.DbhotelDataSet.AfixeisAnaxwriseis2, kwdikos)
    '    If kwdikos <> -1 AndAlso Me.DbhotelDataSet.AfixeisAnaxwriseis2.Count <> 0 Then

    '        If Not IsDBNull(Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).Item("onomateponimo")) Then
    '            onoma = Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).onomateponimo
    '        Else
    '            onoma = ""
    '        End If
    '        MsgBox("Αρ.Κρατ.: " + Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).arithmos.ToString + ChrW(13) + "Πρακτορ.: " + Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).eponimia + ChrW(13) + _
    '                "Ονομα. : " + onoma + ChrW(13) + "Αφιξη : " + Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).afixi + ChrW(13) + "Αναχώριση : " + Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).anaxwrisi)
    '    End If
    'End Sub
    Private Sub ektiposi_plirotita_dwmatiwn(ByVal arxiIm As Date, ByVal telosIm As Date, ByVal index1 As Int16, ByVal index2 As Int16)
        Dim i, j As Int16
        Dim tageCount As Integer
        'Dim dateCount As Date
        'dateCount = arxiIm
        '   tageCount = telosIm.DayOfYear - arxiIm.DayOfYear
        tageCount = telosIm.Subtract(arxiIm).Days()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Clear()
        Me.DbhotelDataSet.ekt_imeres_status_dwm.Rows.Add()
        For i = 0 To tageCount
            Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i) = arxiIm.Date.AddDays(i).DayOfWeek.ToString.Substring(0, 2) + ChrW(13) + arxiIm.Date.AddDays(i).Day.ToString
            'MsgBox(Me.DbhotelDataSet.ekt_imeres_status_dwm(0).Item(i))
        Next

        Me.DbhotelDataSet.ekt_status_dwm.Rows.Clear()
        For j = index1 To index2
            Me.DbhotelDataSet.ekt_status_dwm.Rows.Add()
            Me.DbhotelDataSet.ekt_status_dwm(j - index1).dwmatio = dwmatia(j)
        Next
        'Me.ProgressBar1.Value += 10


        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            connection.Open()
            command.Connection = connection
            For j = index1 To index2
                Dim imeresStat(), imeresPrakt() As Integer

                ReDim imeresStat(tageCount)
                ReDim imeresPrakt(tageCount)
                init_status_dwmatiou(imeresStat)
                init_status_dwmatiou(imeresPrakt)
                command.Parameters.AddWithValue("@dwmatio1", dwmatia(j))
                command.Parameters.AddWithValue("@enarxi1", arxiIm)
                command.Parameters.AddWithValue("@lixi1", arxiIm)
                command.Parameters.AddWithValue("@dwmatio2", dwmatia(j))
                command.Parameters.AddWithValue("@enarxi2", telosIm)
                command.Parameters.AddWithValue("@lixi2", telosIm)
                command.Parameters.AddWithValue("@dwmatio3", dwmatia(j))
                command.Parameters.AddWithValue("@enarxi3", arxiIm)
                command.Parameters.AddWithValue("@lixi3", telosIm)
                command.CommandText = "SELECT DISTINCT kwd, dwmatio, kratisi, enarxi, lixi, dwmatiostatus FROM status WHERE (dwmatio=@dwmatio1 AND enarxi<=@enarxi1 AND lixi>=@lixi1) OR (dwmatio=@dwmatio2 AND enarxi<=@enarxi2 AND lixi>=@lixi2) OR (dwmatio=@dwmatio3 AND enarxi>@enarxi3 AND lixi<@lixi3)"
                myReader = command.ExecuteReader()

                ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
                While myReader.Read()
                    Dim zeiger1, zeiger2 As Integer
                    ' zeiger1 = arxiIm.DayOfYear - myReader.GetDateTime(3).DayOfYear
                    zeiger1 = arxiIm.Subtract(myReader.GetDateTime(3)).Days()
                    If myReader.GetDateTime(3) < arxiIm Then
                        zeiger1 = 0
                    ElseIf myReader.GetDateTime(3) >= arxiIm And myReader.GetDateTime(3) <= telosIm Then
                        ' zeiger1 = myReader.GetDateTime(3).DayOfYear - arxiIm.DayOfYear
                        zeiger1 = myReader.GetDateTime(3).Subtract(arxiIm).Days()
                    Else
                        zeiger1 = -1
                    End If

                    If myReader.GetDateTime(4) >= telosIm Then
                        zeiger2 = imeresStat.Length - 1
                    ElseIf myReader.GetDateTime(4) >= arxiIm And myReader.GetDateTime(4) < telosIm Then
                        'zeiger2 = myReader.GetDateTime(4).DayOfYear - arxiIm.DayOfYear
                        zeiger2 = myReader.GetDateTime(4).Subtract(arxiIm).Days()
                    Else
                        zeiger2 = -1
                    End If
                    If zeiger1 >= 0 AndAlso zeiger2 >= 0 Then
                        setze_status_praktoreio(zeiger1, zeiger2, myReader.GetInt32(5), imeresStat, imeresPrakt, myReader.GetInt32(2))
                    End If

                End While
                myReader.Close()
                command.Parameters.Clear()
                Dim kratisiTemp As Integer = 0
                Dim change As Integer = 1
                For i = 0 To imeresStat.Length - 1

                    '(locx + (i - 1) * stepx, locy)
                    If imeresStat(i) <> -1 And imeresStat(i) <> 1 Then

                        Me.DbhotelDataSet.ekt_status_dwm(j - index1).Item(i + 1) = get_status_by_kwd(imeresStat(i)) ' + ChrW(13) + "(" + imeresPrakt(i).ToString + ")"
                    ElseIf imeresStat(i) = 1 Then
                        If kratisiTemp <> imeresPrakt(i) Then
                            change = change * -1
                        End If
                        If change = 1 Then
                            Me.DbhotelDataSet.ekt_status_dwm(j - index1).Item(i + 1) = "R"
                        Else
                            Me.DbhotelDataSet.ekt_status_dwm(j - index1).Item(i + 1) = "r"
                        End If
                    Else
                        Me.DbhotelDataSet.ekt_status_dwm(j - index1).Item(i + 1) = "V"
                    End If

                    kratisiTemp = imeresPrakt(i)
                Next

                Try
                    Me.ProgressBar1.Value += 10
                Catch ex As ArgumentOutOfRangeException
                    Me.ProgressBar1.Value = 0
                End Try

            Next

            Me.ProgressBar1.Value = 0
        End Using
        Me.ProgressBar1.Value = 0

    End Sub
    'DOMISI
    Private Sub setze_status(ByVal zeiger1 As Integer, ByVal zeiger2 As Integer, ByVal dwmStatus As Integer, ByRef imeresStat() As Integer, ByVal kwdikoskrat As Integer, ByRef kwdkrat() As Integer)
        Dim i As Integer

        For i = zeiger1 To zeiger2
            If imeresStat(i) = -1 Then

                'DOMISI
                If dwmStatus = 1 Then
                    If ist_kratisi_not_confirmed(kwdikoskrat) Then
                        imeresStat(i) = 9
                    Else
                        imeresStat(i) = dwmStatus
                    End If
                Else
                    imeresStat(i) = dwmStatus
                End If

                'End If

            Else
                Select Case dwmStatus
                    'Case 1
                    '    If imeresStat(i) = -1 Then
                    '        If ist_kratisi_not_confirmed(kwdkrat) Then
                    '            imeresStat(i) = 9
                    '        Else
                    '            imeresStat(i) = 1
                    '        End If
                    '    End If

                    Case 1
                        If imeresStat(i) = 1 Then
                            imeresStat(i) = 3
                        End If
                    Case 8
                        If imeresStat(i) = -1 OrElse imeresStat(i) = 1 Then
                            imeresStat(i) = 8 'n.S kwd=8
                        End If
                    Case 5
                        If imeresStat(i) = -1 OrElse imeresStat(i) = 1 OrElse imeresStat(i) = 8 Then
                            'MsgBox("KASDLFSLFD")
                            imeresStat(i) = 5 'S kwd=5
                        ElseIf imeresStat(i) = 5 Then
                            imeresStat(i) = 3 'D doppelStay
                        End If
                End Select

            End If
            kwdkrat(i) = kwdikoskrat
        Next

    End Sub
    Private Function ist_kratisi_not_confirmed(ByVal kratisi As Integer) As Boolean
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.kratiseis.Count - 1
            If Me.DbhotelDataSet.kratiseis(j).kwd = kratisi Then
                If Me.DbhotelDataSet.kratiseis(0).prokataboli = 0 Then
                    If imeromErgasias.DayOfYear - Me.DbhotelDataSet.kratiseis(0).imeromkratisis.DayOfYear >= 0 AndAlso (imeromErgasias.DayOfYear - Me.DbhotelDataSet.kratiseis(0).imeromkratisis.DayOfYear) >= Me.DbhotelDataSet.etaireia(0).timolkwd Then
                        Return True
                    Else
                        Return False
                    End If
                Else
                    Return False
                End If

            End If
        Next
        Return False
    End Function
    Private Sub setze_status_praktoreio(ByVal zeiger1 As Integer, ByVal zeiger2 As Integer, ByVal dwmStatus As Integer, ByRef imeresStat() As Integer, ByRef imeresPrakt() As Integer, ByVal kratisi As Integer)
        Dim i As Integer


        For i = zeiger1 To zeiger2
            If imeresStat(i) = -1 Then
                imeresStat(i) = dwmStatus
                If dwmStatus = 1 Or dwmStatus = 8 Or dwmStatus = 5 Or dwmStatus = 3 Then
                    imeresPrakt(i) = kratisi 'Me.KratiseisTableAdapter.GetPraktkwdByKwd(kratisi)
                End If

            Else
                Select Case dwmStatus
                    'Case 1
                    '    If imeresStat(i) = -1 Then
                    '        imeresStat(i) = 1 'reservation kwd=1
                    '    End If
                    Case 8
                        If imeresStat(i) = -1 OrElse imeresStat(i) = 1 Then
                            imeresStat(i) = 8 'n.S kwd=8
                            imeresPrakt(i) = kratisi 'Me.KratiseisTableAdapter.GetPraktkwdByKwd(kratisi)
                        End If
                    Case 5
                        If imeresStat(i) = -1 OrElse imeresStat(i) = 1 OrElse imeresStat(i) = 8 Then
                            'MsgBox("KASDLFSLFD")
                            imeresStat(i) = 5 'S kwd=5
                            imeresPrakt(i) = kratisi 'Me.KratiseisTableAdapter.GetPraktkwdByKwd(kratisi)
                        ElseIf imeresStat(i) = 5 Then
                            imeresStat(i) = 3 'D doppelStay
                            imeresPrakt(i) = kratisi 'Me.KratiseisTableAdapter.GetPraktkwdByKwd(kratisi)
                        End If
                End Select

            End If
        Next

    End Sub
    Private Sub init_status_dwmatiou(ByRef imeresStat() As Integer)
        Dim j As Int16

        For j = 0 To imeresStat.Length - 1
            imeresStat(j) = -1
        Next
    End Sub
    Private Sub init_kwd_krat(ByRef kwdkrat() As Integer)
        Dim j As Int16

        For j = 0 To kwdkrat.Length - 1
            kwdkrat(j) = -1
        Next
    End Sub
    Private Sub fuele_alle_zimmer()
        'Dim i As Int16
        'Dim zimmerApo, zimmerEws As String


        'If PlirDwmApoTbx.Text.Equals("") Then
        '    zimmerApo = Me.DwmatiaTableAdapter.GetMinArDwmatiou()
        'Else
        '    zimmerApo = PlirDwmApoTbx.Text
        'End If
        'If PlirDwmEwsTbx.Text.Equals("") Then
        '    zimmerEws = Me.DwmatiaTableAdapter.GetMaxArDwmatiou()
        'Else
        '    zimmerEws = PlirDwmEwsTbx.Text
        'End If
        'If zimmerApo <= zimmerEws Then
        '    If sortkatichk.Checked Then
        '        Me.DwmatiaTableAdapter.DwmatiaApoEws1(Me.DbhotelDataSet.dwmatia, zimmerApo, zimmerEws)
        '    Else
        '        Me.DwmatiaTableAdapter.DwmatiaApoEws(Me.DbhotelDataSet.dwmatia, zimmerApo, zimmerEws)
        '    End If

        'Else
        '    Me.DwmatiaTableAdapter.FillOhneOvBook(Me.DbhotelDataSet.dwmatia)
        'End If


        'ReDim dwmatia(34)
        'dwmatia(0) = "EEAN"
        'dwmatia(1) = "MAIL"
        'dwmatia(2) = "PERS"
        'dwmatia(3) = "THOI"
        'dwmatia(4) = "PUE"
        'dwmatia(5) = "MAVI"
        'dwmatia(6) = "IKR"

        'dwmatia(7) = "ARCH"
        'dwmatia(8) = "IRI"
        'dwmatia(9) = "AFR"
        'dwmatia(10) = "IPER"
        '' dwmatia(11) = "SF6"
        'dwmatia(11) = "UB1Y"

        'dwmatia(12) = "UB1C" 'neo
        'dwmatia(13) = "UB2C" 'neo

        'dwmatia(14) = "UB3C"
        'dwmatia(15) = "UB4C"


        'dwmatia(16) = "UB1D" 'neo
        'dwmatia(17) = "UB3D" 'neo


        'dwmatia(18) = "BLUE"
        'dwmatia(19) = "GRY"

        'dwmatia(20) = "ORA"
        'dwmatia(21) = "YELL"

        'dwmatia(22) = "RED" 'neo


        'dwmatia(23) = "COC"
        'dwmatia(24) = "GRE"
        'dwmatia(25) = "SAN"
        'dwmatia(26) = "WHI"
        'dwmatia(27) = "MARU"

        'dwmatia(28) = "THET"
        'dwmatia(29) = "OLDRE"

        'dwmatia(30) = "SKANT" 'neo
        'dwmatia(31) = "THEROS" 'neo
        'dwmatia(32) = "P1ATH" 'neo
        'dwmatia(33) = "P2ATH" 'neo
        'dwmatia(34) = "ORTH" 'neo

        Dim dwmatiaList As New List(Of String)()

        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand("SELECT villa FROM planovilles ORDER BY displayorder", connection)
            connection.Open()
            Dim reader As SqlDataReader = command.ExecuteReader()

            While reader.Read()
                dwmatiaList.Add(reader.GetString(0)) ' Assuming the villa names are stored as strings
            End While

            connection.Close()
        End Using

        ' Convert the List to an array if needed
        dwmatia = dwmatiaList.ToArray()

    End Sub
    Private Sub PlirDwmPlithImerTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PlirDwmPlithImerTbx.Leave

        Try
            sender.text = Math.Abs(CType(sender.text, Int16))
            zeigerDwm1 = -1
            zeigerDwm2 = -1
            DwmPlirot2Pnl.Controls.Clear()
            DwmPlirot3Pnl.Controls.Clear()
            BtnsPnl.Enabled = False
        Catch ex As InvalidCastException
            MsgBox("Δώστε Αριθμό !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.text = "21"
        End Try

    End Sub
    Private Sub PlirDwmApoTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PlirDwmApoTbx.TextChanged, PlirDwmEwsTbx.TextChanged
        zeigerDwm1 = -1
        zeigerDwm2 = -1
        DwmPlirot2Pnl.Controls.Clear()
        DwmPlirot3Pnl.Controls.Clear()
        BtnsPnl.Enabled = False
    End Sub
    Private Sub dwmatia_apo_ews_leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PlirDwmApoTbx.Leave, PlirDwmEwsTbx.Leave
        Dim count As Integer
        If Not sender.text.Equals("") Then
            count = Me.DwmatiaTableAdapter.ExistArDwmatiou(sender.text)

            If count = 0 Then
                MsgBox("Δεν υπάρχει Δωμάτιο μ'αυτόν τον Αριθμό !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                sender.clear()
            End If
        End If

    End Sub
    Private Sub PrDwmBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PrDwmBtn.Click
        Try
            If dwmatia.Length <> 0 Then
                If zeigerDwm1 <> 0 And zeigerDwm2 <> 0 Then
                    DwmPlirot2Pnl.Controls.Clear()
                    DwmPlirot3Pnl.Controls.Clear()
                End If
                If zeigerDwm1 - 9 >= 0 Then
                    zeigerDwm2 = zeigerDwm1
                    'meiwsw kata 9 ton prwto zeiger
                    zeigerDwm1 -= 9
                    zeig_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1), zeigerDwm1, zeigerDwm2)
                Else
                    zeigerDwm1 = 0
                End If

            End If
        Catch ex As NullReferenceException

        End Try

    End Sub
    Private Sub EpomDwmBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EpomDwmBtn.Click
        Try
            If zeigerDwm2 < dwmatia.Length - 1 Then
                DwmPlirot2Pnl.Controls.Clear()
                DwmPlirot3Pnl.Controls.Clear()
                zeigerDwm1 = zeigerDwm2

                If zeigerDwm2 + 9 < dwmatia.Length - 1 Then
                    zeigerDwm2 += 9
                Else

                    zeigerDwm2 = dwmatia.Length - 1
                End If
                zeig_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1), zeigerDwm1, zeigerDwm2)
            End If
        Catch ex As NullReferenceException
        End Try

    End Sub
    Private Function get_status_by_kwd(ByVal kwdikos As Int32) As String
        Dim j As Int16

        For j = 0 To Me.DbhotelDataSet.dwmatiastatus.Count - 1
            If Me.DbhotelDataSet.dwmatiastatus(j).kwd = kwdikos Then
                'MsgBox(Me.DbhotelDataSet.dwmatiastatus(j).status)
                Return Me.DbhotelDataSet.dwmatiastatus(j).status
            End If
        Next
        Return ""
    End Function
    Private Sub EktStatusDwmBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EktStatusDwmBtn.Click
        Dim Form1 As New EktiposeisFrm()
        Dim filename As String
        Dim ektiposi As New StatusDwmatiwn()

        Try
            If dwmatia.Length <= 0 Then
                Exit Sub
            End If
        Catch ex As NullReferenceException
            MsgBox("Επιλέξτε πρώτα εμφάνιση !", MsgBoxStyle.Information, "winfo\nikEl.")
            Exit Sub
        End Try
        If PlirDwmPlithImerTbx.Text <= 31 Then
            ektiposi_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(PlirDwmPlithImerTbx.Text - 1), 0, dwmatia.Length - 1)
        Else
            ektiposi_plirotita_dwmatiwn(ImeromPlirotDwm.Value.Date, ImeromPlirotDwm.Value.Date.AddDays(30), 0, dwmatia.Length - 1)
        End If

        Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
        Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
        Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
        Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = ImeromPlirotDwm.Value.Date

        'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)

        'If SendMailChk.Checked Then
        '    MsgBox(Me.DbhotelDataSet.etaireia.Count)
        '    filename = AppDomain.CurrentDomain.BaseDirectory + "\" + MonthName(ImeromPlirotDwm.Value.Date.Month) + "_απο_" + ImeromPlirotDwm.Value.Date.Day.ToString + "η.xls"

        '    ektiposi.ExportToDisk(CrystalDecisions.Shared.ExportFormatType.Excel, filename)


        '    Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
        '    mailadapter.Fill(Me.DbhotelDataSet.Mail)

        '    Dim theThread _
        '  As New Threading.Thread(AddressOf SendMailPlirotitaDwm)
        '    theThread.Start(filename)
        'End If


        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        sender.Enabled = True
    End Sub
    Private Sub SendMialBtn_Click(sender As Object, e As EventArgs) Handles SendMialBtn.Click

        Dim greekCulture As New System.Globalization.CultureInfo("el-GR", False)
        Dim englishCulture As New System.Globalization.CultureInfo("en-US", False)
        Dim j As Int16
        Dim filename, pathstart As String
        Dim attachment As String()
        Dim counter As Int16 = 0
        Dim ektiposi As New StatusDwmatiwn()
        Dim threadList As List(Of Threading.Thread) = New List(Of Threading.Thread)
        'Dim proti As String
        'Dim protiDate As Date
        'Dim format() = {"dd/MM/yyyy", "d/M/yyyy"}

        'For j = ImeromPlirotDwm.Value.Month To 11
        '    proti = "1/" + j.ToString + "/" + ImeromPlirotDwm.Value.Year.ToString

        '    Date.TryParseExact(proti, format, System.Globalization.DateTimeFormatInfo.InvariantInfo, Globalization.DateTimeStyles.None, protiDate)
        '    MsgBox(protiDate.ToString)
        'Next
        ' System.Threading.Thread.CurrentThread.CurrentCulture = englishCulture

        Me.Cursor = Cursors.WaitCursor
        Dim protiString As String
        '  j = ImeromPlirotDwm.Value.Month
        j = ImeromPlirotDwm.Value.Month
        Dim dateApo, dateMexri As DateTime


        For j = ImeromPlirotDwm.Value.Month To 12
            If j < 10 Then
                protiString = "01/0" + j.ToString + "/" + ImeromPlirotDwm.Value.Year.ToString
            Else
                protiString = "01/" + j.ToString + "/" + ImeromPlirotDwm.Value.Year.ToString
            End If


            If Not DateTime.TryParse(protiString, dateApo) Then
                Throw New ArgumentException("Unable to parse date")
            End If
            ' MsgBox("APO " + dateApo.ToString)
            dateMexri = dateApo.AddDays(DateTime.DaysInMonth(dateApo.Year, dateApo.Month) - 1)
            ' MsgBox(dateMexri.ToString("dd/MM/yyy"))
            Try
                ektiposi_plirotita_dwmatiwn(dateApo, dateMexri, 0, dwmatia.Length - 1)
            Catch ex As NullReferenceException
                MsgBox("Παρουσιάστηκε πρόβλημα. Επιλέξτε αρχικά εμφάνιση!", MsgBoxStyle.Exclamation)
                Me.Cursor = Cursors.Default
                Exit Sub
            End Try



            Me.DbhotelDataSet.ekt_status_ekdosi.Clear()
            Me.DbhotelDataSet.ekt_status_ekdosi.Rows.Add()
            Me.DbhotelDataSet.ekt_status_ekdosi(0).ekdosi = imeromErgasias
            Me.DbhotelDataSet.ekt_status_ekdosi(0).arxi = dateApo.Date

            'Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
            sender.Enabled = False
            ektiposi.SetDataSource(DbhotelDataSet)

            System.Threading.Thread.CurrentThread.CurrentCulture = englishCulture

            Try
                pathstart = Environment.GetEnvironmentVariable("location")
                If pathstart <> "" Then
                    filename = pathstart + "\winfo\" + MonthName(dateApo.Month) + ".xls"
                Else
                    filename = "n:\winfo\" + MonthName(dateApo.Month) + ".xls"
                End If

            Catch ex As ArgumentNullException
                filename = "n:\winfo\" + MonthName(dateApo.Month) + ".xls"

            End Try


            Try
                ektiposi.ExportToDisk(CrystalDecisions.Shared.ExportFormatType.Excel, filename)
            Catch ex As System.IO.DirectoryNotFoundException
                MsgBox("Δεν βρέθηκε ο φάκελος προσωρινής αποθήκευσης", MsgBoxStyle.Exclamation)
                Me.Cursor = Cursors.Default
                Exit Sub
            End Try




            System.Threading.Thread.CurrentThread.CurrentCulture = greekCulture
            counter = counter + 1
            ReDim Preserve attachment(counter - 1)
            attachment(counter - 1) = filename

            CrystalReportViewer1.ReportSource = ektiposi
            CrystalReportViewer1.DisplayGroupTree = False
            'CrystalReportViewer1.DisplayGroupTree = False
            'Form1.Controls.Add(CrystalReportViewer1)
            'CrystalReportViewer1.Dock = DockStyle.Fill
            'CrystalReportViewer1.Visible = True
        Next

        Try
            If (attachment IsNot Nothing AndAlso attachment.Count > 0) Then
                Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
                mailadapter.Fill(Me.DbhotelDataSet.Mail)
                Dim theThread _
      As New Threading.Thread(AddressOf SendMailPlirotitaDwm)
                theThread.Start(attachment)
                threadList.Add(theThread)
                '     SendMailPlirotitaDwm(attachment)

                For Each theThread In threadList
                    theThread.Join()
                Next
                theThread.Abort()
                SendMialBtn.Enabled = True
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.Default
            End If
        Catch ex As NullReferenceException
            Me.Cursor = Cursors.Default
        End Try
        Me.Cursor = Cursors.Default

    End Sub
    Public Sub SendMailPlirotitaDwm(ByVal attachment As String())
        Dim j As Int16
        Dim instanceList As List(Of Attachment) = New List(Of Attachment)
        '    ByVal from As String, ByVal [to] As String, ByVal subject As String, ByVal body As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String, ByVal attach As String
        'Dim fileName As String = "C:\winfo\testAtach.xlsx"
        'Dim instance As New Attachment(fileName)
        'MsgBox(Me.DbhotelDataSet.etaireia.Count)
        Dim message As New MailMessage(Me.DbhotelDataSet.Mail(0).ffrom, Me.DbhotelDataSet.etaireia(0).tilefono, "ΠΛΑΝΟ", "")
        message.To.Add("stakap15@gmail.com")
        For j = 0 To attachment.Length - 1

            Dim instance As New Attachment(attachment(j))
            message.Attachments.Add(instance)
            instanceList.Add(instance)
            ' instance.Dispose()
        Next


        'message.Attachments.Add(instance)

        Dim smtpClient As New SmtpClient(Me.DbhotelDataSet.Mail(0).smtpServer, 25)

        smtpClient.UseDefaultCredentials = False

        Dim credentials As New NetworkCredential(Me.DbhotelDataSet.Mail(0).smtpUsername, Me.DbhotelDataSet.Mail(0).smtpPassword)

        smtpClient.Credentials = credentials
        smtpClient.EnableSsl = True
        smtpClient.Send(message)
        For Each item As Attachment In instanceList
            item.Dispose()
        Next
        'For Each prog As Process In Process.GetProcesses
        '    MsgBox(prog.ProcessName)
        '      prog.Kill()
        'Next
    End Sub
    '*************************EMFANISI DIAMENONTON*****************EMFANISI DIAMENONTON**************************EMFANISI DIAMENONTON
    Private Sub emf_diamenontwn_oldtown()
        diamflag = 1
        Diamenontes2Pnl.Controls.Clear()
        DiamImeromPck.Value = imeromErgasias
        ImeromEkdDiamPck.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "OLD TOWN - ΕΜΦΑΝΙΣΗ ΔΙΑΜΕΝΟΝΤΩΝ"
        EtikLbl.Location = New Point(Diamenontes2Pnl.Width / 4, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)


        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        DiamenontesPnl.Location = New Point(2, EtiketaErgHmPnl.Height)

        Me.DiamenontesPnl.Size = New Point(800, ZentralPnl.Height)
        Me.Diamenontes2Pnl.Size = New Point(Diamenontes1Pnl.Width, 2 * Diamenontes1Pnl.Height)
        ProepDiamBtn.Location = New Point(DiamenBtn.Location.X, Diamenontes2Pnl.Location.Y + Diamenontes2Pnl.Height + 20)
        Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        Me.ZentralPnl.Controls.Add(DiamenontesPnl)
    End Sub
    Private Sub emf_diamenontwn_viles()
        diamflag = 2
        Diamenontes2Pnl.Controls.Clear()
        DiamImeromPck.Value = imeromErgasias
        ImeromEkdDiamPck.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "ΒΙΛΕΣ - ΕΜΦΑΝΙΣΗ ΔΙΑΜΕΝΟΝΤΩΝ"
        EtikLbl.Location = New Point(Diamenontes2Pnl.Width / 4, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)


        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        DiamenontesPnl.Location = New Point(2, EtiketaErgHmPnl.Height)

        Me.DiamenontesPnl.Size = New Point(800, ZentralPnl.Height)
        Me.Diamenontes2Pnl.Size = New Point(Diamenontes1Pnl.Width, 2 * Diamenontes1Pnl.Height)
        ProepDiamBtn.Location = New Point(DiamenBtn.Location.X, Diamenontes2Pnl.Location.Y + Diamenontes2Pnl.Height + 20)
        Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        Me.ZentralPnl.Controls.Add(DiamenontesPnl)
    End Sub
    Private Sub DiamPraktTbx_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DiamPraktTbx.Enter
        Dim PraktForm As New SimbolaiaFrm()

        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        praktDiamKwd = PraktForm.return_praktoreio_kwdikos

        If praktDiamKwd = Nothing Then
            DiamPraktTbx.Text = " Όλα τα Πρακτoρεία "
            praktDiamKwd = -1
            simbDiamKwd = -1
            'KatastSimb.SelectedIndex = 0
            DiamSimbCbx.Items.Clear()
            DiamSimbCbx.Items.Add("<A/A Συμβoλαίου>")
            DiamSimbCbx.SelectedIndex = 0
            Exit Sub
        Else
            DiamPraktTbx.Text = PraktForm.return_praktoreio
            DiamSimbCbx.Items.Clear()
            Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktDiamKwd, etos)

            fuehle_simbol_diamenontwn_cbox()
            If DiamSimbCbx.Items.Count <> 0 Then
                DiamSimbCbx.SelectedIndex = 0
                simbDiamKwd = -1

            End If
        End If
        'Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, etos)

    End Sub
    Private Sub DiamSimbCbx_Update(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DiamSimbCbx.TextUpdate

        MsgBox("Δεν επιτρέπεται αλλαγή  !", MsgBoxStyle.Information, "winfo\nikEl.")
        DiamSimbCbx.SelectedIndex = -1
        simbDiamKwd = -1
    End Sub
    Private Sub DiamSimbCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DiamSimbCbx.SelectedIndexChanged
        Dim simbolaioTemp As Integer

        If sender.selectedindex <> -1 Then
            simbolaioTemp = get_kwd_simbol_by_katastasi(DiamSimbCbx.SelectedItem.ToString, praktDiamKwd, etos)

            If simbolaioTemp = -1 Then
                simbDiamKwd = -1

            Else
                simbDiamKwd = simbolaioTemp
                'MsgBox(simbK)
            End If
        Else
            simbDiamKwd = -1
            'Poies Seasons paizoun
        End If
    End Sub
    Private Sub Dwm_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmApoTbx.Leave, DwmEwsTbx.Leave
        Dim count As Int16

        If Not sender.text.Equals("") Then
            count = Me.DwmatiaTableAdapter.ExistArDwmatiou(sender.text)
            If count = 0 Then
                sender.text = ""
            End If
        End If

    End Sub
    Private Sub DiamenBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DiamenBtn.Click
        Dim tempKwd As Integer = -1
        Dim j, aa, index As Int16
        Dim dwmApo, dwmEws As String
        Dim nonShowOK As Boolean = False
        Try
            Me.Cursor = Cursors.WaitCursor
            dwmApo = DwmApoTbx.Text
            dwmEws = DwmEwsTbx.Text

            'If dwmApo.Equals("") Then
            '    dwmApo = Nothing 'Me.DwmatiaTableAdapter.GetMinArDwmatiou
            'End If
            If dwmEws.Equals("") Then
                dwmEws = Me.DwmatiaTableAdapter.GetMaxArDwmatiou
            End If

            If NonShowRdb.Checked = True Then
                nonShowOK = True
                'Diamenontes2Pnl.Controls.Clear()
                'Diamenontes2Pnl.Controls.Add(NonShowGrid)
                'Me.NonShowGrid.Dock = DockStyle.Fill
                Diamenontes2Pnl.Controls.Clear()
                Diamenontes2Pnl.Controls.Add(DiamenontesDGrid)
                Me.DiamenontesDGrid.Columns.Item(8).HeaderText = "Αφιξη"
                Me.DiamenontesDGrid.Columns.Item(9).HeaderText = "Αναχώρηση"
                Me.DiamenontesDGrid.Dock = DockStyle.Fill
                Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
                If praktDiamKwd <> -1 AndAlso simbDiamKwd <> -1 Then
                    'Me.AfixeisAnaxwriseis1TableAdapter.NonShowDiamByEtosAnAfApMexSimbPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, dwmApo, dwmEws, DiamSimbCbx.SelectedItem.ToString, DiamPraktTbx.Text)
                    '     Me.NonshowkratiseisTableAdapter.FillByAfixPraktSimb(Me.DbhotelDataSet.nonshowkratiseis, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, praktDiamKwd, simbDiamKwd)

                ElseIf praktDiamKwd <> -1 AndAlso simbDiamKwd = -1 Then
                    'Me.AfixeisAnaxwriseis1TableAdapter.NonShowDiamByEtosAnAfMexPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, dwmApo, dwmEws, DiamPraktTbx.Text)
                    '    Me.NonshowkratiseisTableAdapter.FillByAfixPrakt(Me.DbhotelDataSet.nonshowkratiseis, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, praktDiamKwd)
                Else
                    'Me.AfixeisAnaxwriseis1TableAdapter.NonShowDiamenontesByEtosAfAnApoMexri(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, dwmApo, dwmEws)
                    If diamflag = 1 Then
                        Me.NonshowkratiseisTableAdapter.FillByAfixiTipoi(Me.DbhotelDataSet.nonshowkratiseis, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25)
                    ElseIf diamflag = 2 Then
                        Me.NonshowkratiseisTableAdapter.FillByAfixiTipoi(Me.DbhotelDataSet.nonshowkratiseis, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12)
                    End If

                End If
                'For j = 0 To Me.DbhotelDataSet.nonshowkratiseis.Count - 1
                '    Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aa = j + 1
                'Next
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                For j = 0 To Me.DbhotelDataSet.nonshowkratiseis.Count - 1
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2.Rows.Add()
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aa = j + 1
                    'Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aa = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aa
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).dwmatio = Me.DbhotelDataSet.nonshowkratiseis(j).dwmatio
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enilikes = Me.DbhotelDataSet.nonshowkratiseis(j).enilikes
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).paidia = Me.DbhotelDataSet.nonshowkratiseis(j).paidia


                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).xrewsi = Me.DbhotelDataSet.nonshowkratiseis(j).oroi
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).tipos = Me.DbhotelDataSet.nonshowkratiseis(j).tiposname
                    'Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).perigrafi = Me.DbhotelDataSet.nonshowkratiseis(j).klinesname
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).onomateponimo = Me.DbhotelDataSet.nonshowkratiseis(j).onoma1
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).afixi = Me.DbhotelDataSet.nonshowkratiseis(j).afixi.Date
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).anaxwrisi = Me.DbhotelDataSet.nonshowkratiseis(j).anaxwrisi
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).eponimia = Me.DbhotelDataSet.nonshowkratiseis(j).praktname
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).voucher = Me.DbhotelDataSet.nonshowkratiseis(j).voucher
                    'Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).epithimia = Me.DbhotelDataSet.nonshowkratiseis(j).epithimia
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd = Me.DbhotelDataSet.nonshowkratiseis(j).kwd
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aasimbolaiou = Me.DbhotelDataSet.nonshowkratiseis(j).aasimbolaiou
                Next
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΚΑΤΑΣΤΑΣΗ NON SHOW ΤΗΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).flag = 1
                If Me.DbhotelDataSet.nonshowkratiseis.Count <> 0 Then
                    If praktDiamKwd <> -1 Then
                        Me.DbhotelDataSet.ekt_AfixAnax(0).praktoreio = Me.DbhotelDataSet.nonshowkratiseis(0).praktname
                    End If
                    If simbDiamKwd <> -1 Then
                        Me.DbhotelDataSet.ekt_AfixAnax(0).simbolaio = Me.DbhotelDataSet.nonshowkratiseis(0).aasimbolaiou
                    End If
                End If

                Me.DbhotelDataSet.ekt_AfixAnax(0).dwmapo = DwmApoTbx.Text
                Me.DbhotelDataSet.ekt_AfixAnax(0).dwmmexri = DwmEwsTbx.Text
            ElseIf OverRdb.Checked = True Then
                Diamenontes2Pnl.Controls.Clear()
                Diamenontes2Pnl.Controls.Add(DiamenontesDGrid)
                Me.DiamenontesDGrid.Columns.Item(8).HeaderText = "από"
                Me.DiamenontesDGrid.Columns.Item(9).HeaderText = "μέχρι και"
                Me.DiamenontesDGrid.Dock = DockStyle.Fill
                Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()

                If praktDiamKwd <> -1 AndAlso simbDiamKwd <> -1 Then
                    '     Me.AfixeisAnaxwriseis1TableAdapter.OverByEtosAnAFMexSimbPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString)
                ElseIf praktDiamKwd <> -1 AndAlso simbDiamKwd = -1 Then

                    '     Me.AfixeisAnaxwriseis1TableAdapter.OverByEtosAnAfMexPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamPraktTbx.Text)
                Else
                    If diamflag = 1 Then
                        Me.AfixeisAnaxwriseis1TableAdapter.OverByEtosAfAnApoMexriTipoi(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25)
                    ElseIf diamflag = 2 Then
                        Me.AfixeisAnaxwriseis1TableAdapter.OverByEtosAfAnApoMexriTipoi(Me.DbhotelDataSet.AfixeisAnaxwriseis1, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12)
                    End If

                End If
                'For j = 0 To Me.DbhotelDataSet.AfixeisAnaxwriseis1.Count - 1
                '    Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aa = j + 1
                'Next
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                For j = 0 To Me.DbhotelDataSet.AfixeisAnaxwriseis1.Count - 1
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2.Rows.Add()
                    Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aa = j + 1
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aa = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aa
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).dwmatio = "OV-BOOK"
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enilikes = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).enilikes
                    Try
                        Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).paidia = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).paidia
                    Catch ex As StrongTypingException
                        Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).paidia = 0
                    End Try

                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).xrewsi = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).xrewsi
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).tipos = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).tipos
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).perigrafi = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).perigrafi
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).onomateponimo = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).onomateponimo
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).afixi = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).overab
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).anaxwrisi = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).overbis
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).eponimia = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).eponimia
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).voucher = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).voucher
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).epithimia = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).epithimia
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).kwd
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aasimbolaiou = Me.DbhotelDataSet.AfixeisAnaxwriseis1(j).aasimbolaiou
                Next

                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΚΑΤΑΣΤΑΣΗ OVER ΤΗΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).flag = 2
                If Me.DbhotelDataSet.AfixeisAnaxwriseis1.Count Then
                    If praktDiamKwd <> -1 Then
                        Me.DbhotelDataSet.ekt_AfixAnax(0).praktoreio = Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).eponimia
                    End If
                    If simbDiamKwd <> -1 Then
                        Me.DbhotelDataSet.ekt_AfixAnax(0).simbolaio = Me.DbhotelDataSet.AfixeisAnaxwriseis2(0).aasimbolaiou
                    End If

                End If



            Else
                Diamenontes2Pnl.Controls.Clear()
                Diamenontes2Pnl.Controls.Add(DiamenontesDGrid)
                Me.DiamenontesDGrid.Columns.Item(8).HeaderText = "Αφιξη"
                Me.DiamenontesDGrid.Columns.Item(9).HeaderText = "Αναχώρηση"
                Me.DiamenontesDGrid.Dock = DockStyle.Fill
                If DiamenRdb.Checked = True Then
                    If praktDiamKwd <> -1 AndAlso simbDiamKwd <> -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesByEtosImerPraktSimbDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, DiamImeromPck.Value.Date, dwmApo, dwmEws)
                        '           Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesByEtosImerPraktSimbDwm_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, etos, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        '(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, DiamImeromPck.Value.Date, dwmApo, dwmEws, True)
                    ElseIf praktDiamKwd <> -1 AndAlso simbDiamKwd = -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesByEtosImerPraktDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamImeromPck.Value.Date, dwmApo, dwmEws)
                        '           Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesByEtosImerPraktDwm_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamPraktTbx.Text, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, etos, DiamPraktTbx.Text, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        '(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamImeromPck.Value.Date, dwmApo, dwmEws, True)
                    ElseIf praktDiamKwd = -1 AndAlso simbDiamKwd = -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesByEtosImeromDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, dwmApo, dwmEws)
                        If diamflag = 1 Then
                            Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesByEtosImeromDwmTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25, etos, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        ElseIf diamflag = 2 Then
                            Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesByEtosImeromDwmTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12, etos, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        End If

                    End If
                ElseIf EpithimiaRdb.Checked = True Then
                    If praktDiamKwd <> -1 AndAlso simbDiamKwd <> -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesEpithimiaByEtosImPrSimbDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, DiamImeromPck.Value.Date, "", dwmApo, dwmEws)
                        '  Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesEpithimiaByEtosImPrSimbDwm_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, "", DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, etos, "", DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        '(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamSimbCbx.SelectedItem.ToString, DiamImeromPck.Value.Date, "", dwmApo, dwmEws, True)
                    ElseIf praktDiamKwd <> -1 AndAlso simbDiamKwd = -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesEpithimiaByEtosImerPraktDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamImeromPck.Value.Date, "", dwmApo, dwmEws)
                        '    Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesEpithimiaByEtosImerPraktDwm_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, "", DiamPraktTbx.Text, dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, etos, "", DiamPraktTbx.Text, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        '(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamImeromPck.Value.Date, DiamPraktTbx.Text, DiamImeromPck.Value.Date, "", dwmApo, dwmEws, True)
                    ElseIf praktDiamKwd = -1 AndAlso simbDiamKwd = -1 Then
                        'Me.AfixeisAnaxwriseisTableAdapter.DiamenontesEpithimiaByEtosImeromDwm(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, "", dwmApo, dwmEws)
                        If diamflag = 1 Then
                            Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesEpithimiaByEtosImeromDwmTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, "", dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25, etos, "", True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 13, 25, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        ElseIf diamflag = 2 Then
                            Me.AfixeisAnaxwriseis2TableAdapter.DiamenontesEpithimiaByEtosImeromDwmTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, "", dwmApo, dwmEws, True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12, etos, "", True, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, 1, 12, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date)
                        End If

                        '(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, DiamImeromPck.Value.Date, DiamImeromPck.Value.Date, "", dwmApo, dwmEws, True)
                    End If
                End If

                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                If EpithimiaRdb.Checked = True Then
                    Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΔΙΑΜΕΝΟΝΤΕΣ ΜΕ ΕΠΙΘΥΜΙΑ"
                Else
                    Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΚΑΤΑΣΤΑΣΗ ΔΙΑΜΕΝΟΝΤΩΝ ΤΗΣ"
                End If
                Me.DbhotelDataSet.ekt_AfixAnax(0).flag = 1
                Me.DbhotelDataSet.ekt_AfixAnax(0).dwmapo = DwmApoTbx.Text
                Me.DbhotelDataSet.ekt_AfixAnax(0).dwmmexri = DwmEwsTbx.Text

            End If

            Dim enilCount, paidiaCount, atomaCount As Int16

            aa = 0
            j = 0
            While j <= Me.DbhotelDataSet.AfixeisAnaxwriseis2.Count - 1
                If tempKwd <> Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd Then
                    index = j
                    tempKwd = Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd
                    aa += 1
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aa = aa
                    enilCount = enilCount + Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enilikes
                    paidiaCount = paidiaCount + Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).paidia
                    If Not nonShowOK Then
                        Try
                            If Not Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enarxi <= DiamImeromPck.Value.Date Or Not _
                                                                  Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).lixi >= DiamImeromPck.Value.Date.AddDays(-1) Then
                                Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = "OV-BOOK"
                            End If
                        Catch ex As StrongTypingException
                            Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = "OV-BOOK"
                        End Try
                    End If

                    j += 1
                Else
                    Try
                        If Not Me.DbhotelDataSet.AfixeisAnaxwriseis2(index).onomateponimo.Contains(Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).onomateponimo) Then
                            Me.DbhotelDataSet.AfixeisAnaxwriseis2(index).onomateponimo = Me.DbhotelDataSet.AfixeisAnaxwriseis2(index).onomateponimo + ", " + Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).onomateponimo
                        End If

                    Catch ex As ArgumentException 'pola onomata (mexri 250 char kanei unterstuetzen to Dataset)

                    End Try
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2.Rows.RemoveAt(j)
                End If
            End While
            atomaCount = enilCount + paidiaCount
            Me.DbhotelDataSet.ekt_AfixAnax(0).imerominia = DiamImeromPck.Value.Date
            Me.DbhotelDataSet.ekt_AfixAnax(0).ekdosi = ImeromEkdDiamPck.Value.Date
            Me.DbhotelDataSet.ekt_AfixAnax(0).enilikes = enilCount
            Me.DbhotelDataSet.ekt_AfixAnax(0).paidia = paidiaCount
            Me.DbhotelDataSet.ekt_AfixAnax(0).atoma = atomaCount
        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try
        Me.Cursor = Cursors.Default



    End Sub
    Private Sub ProepDiamBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProepDiamBtn.Click
        Dim Form1 As New EktiposeisFrm()
        Dim ektiposi As New Diamenontes()

        Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        Me.PaidiaTableAdapter.Fill(Me.DbhotelDataSet.paidia)
        sender.Enabled = False
        ektiposi.SetDataSource(DbhotelDataSet)
        CrystalReportViewer1.ReportSource = ektiposi
        CrystalReportViewer1.DisplayGroupTree = False
        'CrystalReportViewer1.DisplayGroupTree = False
        Form1.Controls.Add(CrystalReportViewer1)
        CrystalReportViewer1.Dock = DockStyle.Fill
        CrystalReportViewer1.Visible = True

        Form1.ShowDialog()

        ektiposi.Close()
        ektiposi.Dispose()
        sender.Enabled = True
    End Sub
    Private Sub fuehle_simbol_diamenontwn_cbox()
        Dim j As Int16
        DiamSimbCbx.Items.Clear()

        For j = 0 To Me.DbhotelDataSet.simbolaia.Count
            If j <> 0 Then
                Try
                    If Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou.Equals("") Then
                        DiamSimbCbx.Items.Add(j)
                    Else
                        DiamSimbCbx.Items.Add(Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou)
                    End If
                Catch ex As NullReferenceException
                    DiamSimbCbx.Items.Add(j)
                End Try
            Else
                DiamSimbCbx.Items.Add("<A/A Συμβoλαίου>")
            End If

        Next
    End Sub


    '*************************EMFANISI KINISIS TMIMATWN******************EMFANISI KINISIS TMIMATWN***************************EMFANISI KINISIS TMIMATWN*
    Private Sub emf_kinisis_tmimatwn()


        TmimKnsImerom.Value = imeromErgasias

        'Etiketa panel initialisieren
        EtikLbl.Text = "ΕΜΦΑΝΙΣΗ ΚΙΝΗΣΗΣ ΤΜΗΜΑΤΩΝ"
        EtikLbl.Location = New Point(TmimataKnsPnl.Width / 6, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        TmimataKnsPnl.Location = New Point(2, EtiketaErgHmPnl.Height)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        Me.TmimataKnsPnl.Size = New Point(800, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(TmimataKnsPnl)
    End Sub


    Private Sub TmimataTmTbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TmimataTmTbx.Click, TmimataTmTbx.Enter
        Dim TmimaForm As New TmimataFrm(False)
        Dim kwdikos As Integer
        Dim tmimaName As String

        'Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres

        TmimaForm.StartPosition = FormStartPosition.CenterParent
        TmimaForm.ShowDialog()
        kwdikos = TmimaForm.return_tmima_kwdikos

        'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
        If kwdikos = Nothing Then
            tmimaKd = -1
            MsgBox("Δεν επιλέχθηκε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            Exit Sub
        Else
            tmimaKd = kwdikos
        End If

        tmimaName = TmimaForm.return_tmima
        If tmimaName = Nothing Then
            TmimataTmTbx.Text = sender.text
        Else
            TmimataTmTbx.Text = tmimaName
        End If
        TmimaForm.Dispose()
        TmimataKns2Pnl.Controls.Clear()
        male_tmima_kiniseis_kefalida(kwdikos)
        TmimataKns2Pnl.Focus()
    End Sub
    Private Sub TmimKnsImerom_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TmimKnsImerom.ValueChanged
        If tmimaKd <> -1 Then
            TmimataKns2Pnl.Controls.Clear()
            male_tmima_kiniseis_kefalida(tmimaKd)
        End If
    End Sub
    Private Sub male_tmima_kiniseis_kefalida(ByVal tmimaKwdikos As Integer)
        Dim fpaCount As Int16 = 0
        Dim fpa() As Single
        Dim j, stepy, stepx, xstart, ystart As Int16
        Dim locationX() As Koordinaten
        Dim kefalCount As Int16 = 0

        stepx = 100
        stepy = 100
        xstart = 2
        ystart = 10
        'Me.EggrafitakiniseisTableAdapter.FillByEggrafi(Me.DbhotelDataSet.eggrafitakiniseis, eggrafiKwd)
        Me.TmimataTableAdapter.FillByKwd(Me.DbhotelDataSet.tmimata, tmimaKwdikos)
        'edw epilogi posostwn FPA 
        'VORSICHT -> EAN PREPEI NA EXW KAI FPA 0,00% TOTE METATREPSE SE Me.DbhotelDataSet.tmimata(j).fpa1 >= 0 (!) TA PARAKATW KLAUSEL
        For j = 0 To Me.DbhotelDataSet.tmimata.Count - 1
            If Me.DbhotelDataSet.tmimata(j).fpa1 >= 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa1, fpa) Then ' AndAlso Array.Exists(fpa, AddressOf Me.DbhotelDataSet.tmimata(j).fpa1)
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa1
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa2 >= 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa2, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa2
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa3 >= 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa3, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa3
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa4 >= 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa4, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa4
            End If
        Next
        'posa fpa exei to tmima
        If fpaCount = 0 Then
            MsgBox("Δεν εχουν δωθεί Φ.Π.Α. Τμήματος : Ανατρέξτε στις Σταθερές Εταιρείας (Τμήματα) και ενημερώστε τα ποσά Φ.Π.Α. !", MsgBoxStyle.Critical, "winfo\nikEl.")
            Exit Sub
        End If

        Dim AALbl, TPliromLbl, AitLbl, SinolLbl, LeerLbl As New Label

        AALbl.Text = "Α/Α"
        AALbl.TextAlign = ContentAlignment.MiddleCenter
        AALbl.Size = New Point(40, 20)
        AALbl.Location = New Point(xstart, ystart)
        AALbl.BackColor = Color.DarkKhaki
        AALbl.ForeColor = Color.Blue
        kefalCount = kefalCount + 1
        ReDim Preserve locationX(kefalCount - 1)
        locationX(kefalCount - 1).locX = AALbl.Location.X
        locationX(kefalCount - 1).fpa = -1 'es handelt sich nicht um FPA
        TmimataKns2Pnl.Controls.Add(AALbl)

        TPliromLbl.Text = "Τρ.Πληρ."
        TPliromLbl.TextAlign = ContentAlignment.MiddleCenter
        TPliromLbl.Size = New Point(82, 20)
        TPliromLbl.Location = New Point(xstart + AALbl.Width + 2, ystart)
        TPliromLbl.BackColor = Color.DarkKhaki
        TPliromLbl.ForeColor = Color.Blue
        kefalCount = kefalCount + 1
        ReDim Preserve locationX(kefalCount - 1)
        locationX(kefalCount - 1).locX = TPliromLbl.Location.X
        locationX(kefalCount - 1).fpa = -1
        TmimataKns2Pnl.Controls.Add(TPliromLbl)


        AitLbl.Text = "Αιτιολογία"
        AitLbl.TextAlign = ContentAlignment.MiddleCenter
        AitLbl.Size = New Point(140, 20)
        AitLbl.Location = New Point(xstart + AALbl.Width + TPliromLbl.Width + 4, ystart)
        AitLbl.BackColor = Color.DarkKhaki
        AitLbl.ForeColor = Color.Blue
        kefalCount = kefalCount + 1
        ReDim Preserve locationX(kefalCount - 1)
        locationX(kefalCount - 1).locX = AitLbl.Location.X
        locationX(kefalCount - 1).fpa = -1
        TmimataKns2Pnl.Controls.Add(AitLbl)


        'LeerLbl.TextAlign = ContentAlignment.MiddleCenter
        LeerLbl.Size = New Point(94, 20)
        LeerLbl.Location = New Point(xstart + AALbl.Width + TPliromLbl.Width + AitLbl.Width + 4, ystart)
        LeerLbl.BackColor = Color.DarkKhaki
        LeerLbl.ForeColor = Color.Blue
        kefalCount = kefalCount + 1
        ReDim Preserve locationX(kefalCount - 1)
        locationX(kefalCount - 1).locX = LeerLbl.Location.X
        locationX(kefalCount - 1).fpa = -1
        TmimataKns2Pnl.Controls.Add(LeerLbl)


        For j = 0 To fpa.Length - 1
            Dim FpaXXLbl As New Label
            FpaXXLbl.Text = fpa(j).ToString + " %"
            FpaXXLbl.TextAlign = ContentAlignment.MiddleCenter
            FpaXXLbl.Size = New Point(98, 20)
            FpaXXLbl.Location = New Point(xstart + AALbl.Width + TPliromLbl.Width + AitLbl.Width + (j + 1) * stepx, ystart)
            FpaXXLbl.BackColor = Color.DarkKhaki
            FpaXXLbl.ForeColor = Color.Blue
            kefalCount = kefalCount + 1
            ReDim Preserve locationX(kefalCount - 1)
            locationX(kefalCount - 1).locX = FpaXXLbl.Location.X
            locationX(kefalCount - 1).fpa = fpa(j)
            TmimataKns2Pnl.Controls.Add(FpaXXLbl)
        Next

        SinolLbl.Text = "Συν. Ποσό"
        SinolLbl.TextAlign = ContentAlignment.MiddleCenter
        SinolLbl.Size = New Point(98, 20)
        SinolLbl.Location = New Point(xstart + AALbl.Width + TPliromLbl.Width + AitLbl.Width + (j + 1) * stepx, ystart)
        SinolLbl.BackColor = Color.DarkKhaki
        SinolLbl.ForeColor = Color.Blue
        kefalCount = kefalCount + 1
        ReDim Preserve locationX(kefalCount - 1)
        locationX(kefalCount - 1).locX = SinolLbl.Location.X
        locationX(kefalCount - 1).fpa = -1
        TmimataKns2Pnl.Controls.Add(SinolLbl)

        zeige_werte_tmimata(tmimaKwdikos, locationX)

    End Sub
    Private Sub zeige_werte_tmimata(ByVal tmimaKwdikos As Integer, ByVal koord() As Koordinaten)
        Dim j, i, index As Int16
        Dim stepy As Int16
        Dim sumKathAxies(), sumFpa(), sumGenSyn() As Koordinaten
        'MsgBox(tmimaKwdikos)
        stepy = 60
        ReDim sumKathAxies(0)
        ReDim sumFpa(0)
        ReDim sumGenSyn(0)
        init_sum(sumKathAxies, sumFpa, sumGenSyn, koord)

        Me.TmimataegrafesTableAdapter.FillByTmimaImerominia(Me.DbhotelDataSet.tmimataegrafes, TmimKnsImerom.Value.Date, tmimaKwdikos)
        'MsgBox(Me.DbhotelDataSet.tmimataegrafes.Count)

        For j = 0 To Me.DbhotelDataSet.tmimataegrafes.Count - 1

            Dim AALbl, TPliromLbl, AitLbl, SinolKathLbl, SinolFpaLbl, LeerLbl As New Label

            AALbl.Text = (j + 1).ToString
            'AALbl.ForeColor = Color.Maroon
            AALbl.TextAlign = ContentAlignment.MiddleCenter
            AALbl.Size = New Point(40, 20)
            AALbl.Location = New Point(koord(0).locX, (j + 1) * stepy)
            TmimataKns2Pnl.Controls.Add(AALbl)

            Try
                If Me.DbhotelDataSet.tmimataegrafes(j).pliromi.Length > 9 Then
                    TPliromLbl.Text = Me.DbhotelDataSet.tmimataegrafes(j).pliromi.Substring(0, 9)
                Else
                    TPliromLbl.Text = Me.DbhotelDataSet.tmimataegrafes(j).pliromi
                End If

            Catch ex As StrongTypingException
            End Try
            TPliromLbl.TextAlign = ContentAlignment.MiddleCenter
            TPliromLbl.Size = New Point(82, 20)
            TPliromLbl.Location = New Point(koord(1).locX, (j + 1) * stepy)
            TmimataKns2Pnl.Controls.Add(TPliromLbl)


            AitLbl.Text = Me.DbhotelDataSet.tmimataegrafes(j).aitiologia
            'AitLbl.ForeColor = Color.Maroon
            AitLbl.TextAlign = ContentAlignment.MiddleCenter
            AitLbl.Size = New Point(230, 20)
            AitLbl.Location = New Point(koord(2).locX, (j + 1) * stepy)
            TmimataKns2Pnl.Controls.Add(AitLbl)

            LeerLbl.TextAlign = ContentAlignment.MiddleRight
            LeerLbl.Text = "(Φ.Π.Α)"
            LeerLbl.Size = New Point(94, 20)
            LeerLbl.Location = New Point(koord(3).locX, (j + 1) * stepy + 25)
            TmimataKns2Pnl.Controls.Add(LeerLbl)

            Dim eggrafKD As Integer
            eggrafKD = Me.DbhotelDataSet.tmimataegrafes(j).kwd
            Me.EggrafitakiniseisTableAdapter.FillByEggrafi(Me.DbhotelDataSet.eggrafitakiniseis, eggrafKD)


            Dim poso, kathPos, fpaPos, synKathPoso, synFpaPoso As Single
            synKathPoso = 0
            synFpaPoso = 0

            For i = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1 'DIAFORETIKA fpa STO eggrafitakiniseis (ANA tmimataegrafes)
                Dim PosoKathTbx As New Label
                Dim PosoFpaTbx As New Label
                'FpaMTbx.Text = fpa(j).ToString + " %"
                PosoKathTbx.TextAlign = ContentAlignment.MiddleRight
                'PosoKathTbx.ForeColor = Color.Maroon
                PosoKathTbx.Size = New Point(98, 20)
                PosoFpaTbx.TextAlign = ContentAlignment.MiddleRight
                'PosoFpaTbx.ForeColor = Color.Maroon
                PosoFpaTbx.Size = New Point(98, 20)

                index = finde_fpapos_in_array(Me.DbhotelDataSet.eggrafitakiniseis(i).fpa, koord)
                'poso = Me.EggrafitakiniseisTableAdapter.SumPosaByTmimaeggrFpa(eggrafKD, Me.DbhotelDataSet.eggrafitakiniseis(i).fpa)
                poso = Me.DbhotelDataSet.eggrafitakiniseis(i).poso.ToString("N")
                'kathPos = (Me.DbhotelDataSet.eggrafitakiniseis(i).poso / (1 + Me.DbhotelDataSet.eggrafitakiniseis(i).fpa / 100)).ToString("N")
                kathPos = Me.DbhotelDataSet.eggrafitakiniseis(i).posoneto.ToString("N")
                'fpaPos = (Me.DbhotelDataSet.eggrafitakiniseis(i).poso - kathPos).ToString("N")
                fpaPos = Me.DbhotelDataSet.eggrafitakiniseis(i).fpaposo.ToString("N")


                synKathPoso = (synKathPoso + kathPos).ToString("N")
                synFpaPoso = synFpaPoso + fpaPos

                PosoKathTbx.Text = kathPos.ToString("N")
                PosoFpaTbx.Text = fpaPos.ToString("N")

                addiere_wert(sumKathAxies, kathPos.ToString("N"), Me.DbhotelDataSet.eggrafitakiniseis(i).fpa)
                addiere_wert(sumFpa, fpaPos.ToString("N"), Me.DbhotelDataSet.eggrafitakiniseis(i).fpa)
                addiere_wert(sumGenSyn, poso, Me.DbhotelDataSet.eggrafitakiniseis(i).fpa)

                PosoKathTbx.Location = New Point(koord(index).locX, (j + 1) * stepy)
                PosoFpaTbx.Location = New Point(koord(index).locX, (j + 1) * stepy + 25)

                TmimataKns2Pnl.Controls.Add(PosoKathTbx)
                TmimataKns2Pnl.Controls.Add(PosoFpaTbx)

            Next

            SinolKathLbl.Text = synKathPoso.ToString("N")
            'AitLbl.ForeColor = Color.Maroon
            SinolKathLbl.TextAlign = ContentAlignment.BottomRight
            SinolKathLbl.Size = New Point(98, 20)
            SinolKathLbl.Location = New Point(koord(koord.Length - 1).locX, (j + 1) * stepy)
            TmimataKns2Pnl.Controls.Add(SinolKathLbl)

            SinolFpaLbl.Text = synFpaPoso.ToString("N")
            'AitLbl.ForeColor = Color.Maroon
            SinolFpaLbl.TextAlign = ContentAlignment.BottomRight
            SinolFpaLbl.Size = New Point(98, 20)
            SinolFpaLbl.Location = New Point(koord(koord.Length - 1).locX, (j + 1) * stepy + 25)
            TmimataKns2Pnl.Controls.Add(SinolFpaLbl)

        Next

        Dim SynTxtLbl, FpaTxtLbl, GenSynTxtLbl As New Label
        Dim sumsumKAxies, sumsumFpa, sumsumGenSynol As Single


        SynTxtLbl.Text = "Σύνολο Τμήματος (Καθ.Αξία):"
        SynTxtLbl.TextAlign = ContentAlignment.MiddleRight
        SynTxtLbl.Size = New Point(240, 20)
        SynTxtLbl.Location = New Point(koord(2).locX, (j + 1) * (stepy + 10))
        TmimataKns2Pnl.Controls.Add(SynTxtLbl)

        For i = 0 To sumKathAxies.Length - 1
            Dim SynWertLbl As New Label
            index = finde_fpapos_in_array(sumKathAxies(i).fpa, koord)

            SynWertLbl.Text = sumKathAxies(i).locX.ToString("N")
            sumsumKAxies = sumsumKAxies + sumKathAxies(i).locX
            'MsgBox(SynWertLbl.Text)
            SynWertLbl.TextAlign = ContentAlignment.MiddleRight
            SynWertLbl.Size = New Point(98, 20)
            SynWertLbl.Location = New Point(koord(index).locX, (j + 1) * (stepy + 10))
            TmimataKns2Pnl.Controls.Add(SynWertLbl)
        Next


        FpaTxtLbl.Text = "(Φ.Π.Α):"
        FpaTxtLbl.TextAlign = ContentAlignment.MiddleRight
        FpaTxtLbl.Size = New Point(240, 20)
        FpaTxtLbl.Location = New Point(koord(2).locX, (j + 1) * (stepy + 10) + 25)
        TmimataKns2Pnl.Controls.Add(FpaTxtLbl)
        For i = 0 To sumFpa.Length - 1
            Dim SynFpaWertLbl As New Label
            index = finde_fpapos_in_array(sumFpa(i).fpa, koord)

            SynFpaWertLbl.Text = sumFpa(i).locX.ToString("N")
            sumsumFpa = sumsumFpa + sumFpa(i).locX
            'MsgBox(SynWertLbl.Text)
            SynFpaWertLbl.TextAlign = ContentAlignment.MiddleRight
            SynFpaWertLbl.Size = New Point(98, 20)
            SynFpaWertLbl.Location = New Point(koord(index).locX, (j + 1) * (stepy + 10) + 25)
            TmimataKns2Pnl.Controls.Add(SynFpaWertLbl)
        Next

        GenSynTxtLbl.Text = "Γεν. Σύνολα:"
        GenSynTxtLbl.TextAlign = ContentAlignment.MiddleRight
        GenSynTxtLbl.Size = New Point(240, 20)
        GenSynTxtLbl.Location = New Point(koord(2).locX, (j + 1) * (stepy + 10) + 50)
        TmimataKns2Pnl.Controls.Add(GenSynTxtLbl)

        For i = 0 To sumGenSyn.Length - 1
            Dim SynGenWertLbl As New Label
            index = finde_fpapos_in_array(sumGenSyn(i).fpa, koord)
            SynGenWertLbl.Text = sumGenSyn(i).locX.ToString("N")
            sumsumGenSynol = sumsumGenSynol + sumGenSyn(i).locX
            'MsgBox(SynWertLbl.Text)
            SynGenWertLbl.TextAlign = ContentAlignment.MiddleRight
            SynGenWertLbl.Size = New Point(98, 20)
            SynGenWertLbl.Location = New Point(koord(index).locX, (j + 1) * (stepy + 10) + 50)
            TmimataKns2Pnl.Controls.Add(SynGenWertLbl)
        Next

        Dim SumSumKathAxiesLbl As New Label
        SumSumKathAxiesLbl.TextAlign = ContentAlignment.MiddleRight
        SumSumKathAxiesLbl.Size = New Point(98, 20)
        SumSumKathAxiesLbl.Text = sumsumKAxies.ToString("N")
        SumSumKathAxiesLbl.Location = New Point(koord(koord.Length - 1).locX, (j + 1) * (stepy + 10))
        TmimataKns2Pnl.Controls.Add(SumSumKathAxiesLbl)

        Dim SumSumFpaLbl As New Label
        SumSumFpaLbl.TextAlign = ContentAlignment.MiddleRight
        SumSumFpaLbl.Size = New Point(98, 20)
        SumSumFpaLbl.Text = sumsumFpa.ToString("N")
        SumSumFpaLbl.Location = New Point(koord(koord.Length - 1).locX, (j + 1) * (stepy + 10) + 25)
        TmimataKns2Pnl.Controls.Add(SumSumFpaLbl)

        Dim SumSumGenSynLbl As New Label
        SumSumGenSynLbl.TextAlign = ContentAlignment.MiddleRight
        SumSumGenSynLbl.Size = New Point(98, 20)
        SumSumGenSynLbl.Text = sumsumGenSynol.ToString("N")
        SumSumGenSynLbl.Location = New Point(koord(koord.Length - 1).locX, (j + 1) * (stepy + 10) + 50)
        TmimataKns2Pnl.Controls.Add(SumSumGenSynLbl)
    End Sub
    Private Sub addiere_wert(ByRef sumXXX() As Koordinaten, ByVal wert As Single, ByVal fpa As Single)
        Dim j As Int16

        For j = 0 To sumXXX.Length - 1
            If sumXXX(j).fpa = fpa Then
                sumXXX(j).locX = sumXXX(j).locX + wert
                Exit Sub
            End If
        Next


    End Sub


    Private Sub init_sum(ByRef sumKathAxies() As Koordinaten, ByRef sumFpa() As Koordinaten, ByRef sumGenSyn() As Koordinaten, ByVal koord() As Koordinaten)
        Dim j, index As Int16

        index = 0
        For j = 0 To koord.Length - 1
            If koord(j).fpa <> -1 Then

                ReDim Preserve sumKathAxies(index)
                sumKathAxies(index).locX = 0
                sumKathAxies(index).fpa = koord(j).fpa
                ReDim Preserve sumFpa(index)
                sumFpa(index).locX = 0
                sumFpa(index).fpa = koord(j).fpa

                ReDim Preserve sumGenSyn(index)
                sumGenSyn(index).locX = 0
                sumGenSyn(index).fpa = koord(j).fpa

                index = index + 1
            End If
        Next

    End Sub



    Private Function finde_fpapos_in_array(ByVal fpa As Single, ByVal koord() As Koordinaten) As Int16
        Dim j As Int16

        For j = 0 To koord.Length - 1
            If koord(j).fpa = fpa Then
                Return j
            End If
        Next
        Return -1
    End Function

    'Private Sub VoucherTbx_TextChanged(sender As Object, e As EventArgs) Handles VoucherTbx.TextChanged
    '    Dim fores, fores1 As Int16


    '    If VoucherTbx.Text.Length > 0 And VoucherTbx.Text.Contains("@") And VoucherTbx.Text.Contains(".") Then
    '        fores1 = 0
    '        If repeaterLbl.Text <> "" AndAlso repeaterLbl.Text.Length > 7 Then
    '            Try
    '                fores1 = CType(repeaterLbl.Text.Substring(7, repeaterLbl.Text.Length - 7), Int16)
    '            Catch ex As InvalidCastException

    '            End Try
    '        End If
    '        fores = ist_repeater(connectionString, 1)
    '        If fores < fores1 Then
    '            fores = fores1
    '        End If
    '        If fores > 0 Then
    '            repeaterLbl.Text = "Repeat_" + fores.ToString
    '        Else
    '            repeaterLbl.Text = ""
    '        End If

    '    Else
    '        repeaterLbl.Text = ""
    '    End If
    'End Sub
    'Private Function ist_repeater(ByVal connectionString As String, ByVal flag As Byte) As Int16
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        Dim counter As Int16
    '        connection.Open()
    '        command.Connection = connection

    '        If flag = 1 Then
    '            command.Parameters.AddWithValue("voucher", Trim(VoucherTbx.Text))
    '            command.CommandText = "SELECT COUNT(*) FROM kratiseis where (voucher=?) and (checkout=true)"
    '            myReader = command.ExecuteReader(CommandBehavior.SingleResult)
    '            myReader.Read()

    '        Else
    '            command.Parameters.AddWithValue("onoma", OnomTbx1.Text)
    '            command.CommandText = "SELECT COUNT(*) FROM kratiseis  inner join enilikes on kratiseis.kwd=enilikes.kratisi where (enilikes.onomateponimo = onoma) and (kratiseis.checkout=true)"
    '            myReader = command.ExecuteReader(CommandBehavior.SingleResult)
    '            myReader.Read()
    '        End If
    '        Try
    '            counter = myReader.Item(0)
    '            Return counter
    '        Catch ex As InvalidCastException
    '            myReader.Close()
    '            command.Parameters.Clear()
    '            Return -1
    '        End Try

    '    End Using
    'End Function
    Private Function ist_repeater(ByVal connectionString As String, ByVal flag As Byte) As Int16
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim counter As Int16

            connection.Open()
            command.Connection = connection

            If flag = 1 Then
                command.Parameters.AddWithValue("voucher", Trim(VoucherTbx.Text))
                command.CommandText = "SELECT COUNT(*) FROM kratiseis WHERE (voucher=@voucher) AND (checkout=1)"
            Else
                command.Parameters.AddWithValue("onoma", OnomTbx1.Text)
                command.CommandText = "SELECT COUNT(*) FROM kratiseis INNER JOIN enilikes ON kratiseis.kwd=enilikes.kratisi WHERE (enilikes.onomateponimo=@onoma) AND (kratiseis.checkout=1)"
            End If

            Try
                counter = Convert.ToInt16(command.ExecuteScalar())
                Return counter
            Catch ex As Exception
                Return -1
            End Try
        End Using

        Return -1
    End Function

    '*************************EMFANISI-EKTIPOSI AFIXEWN ANAXWRISEWN******************EMFANISI-EKTIPOSI AFIXEWN ANAXWRISEWN***********************EMFANISI-EKTIPOSI AFIXEWN ANAXWRISEWN
    Private Sub ekt_afix_anax_zeig_old()
        'simbK = -1
        'praktK = -1

        afixflag = 1
        ImerKatastPicker.Value = imeromErgasias
        ImerEkdosisPicker.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "OLD TOWN ΑΦΙΞ. - ΑΝΑΧ. - ΚΡΑΤ."
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 5, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        AfixAnaxPnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
        Me.AfixAnaxPnl.Size = New Point(783, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(AfixAnaxPnl)

    End Sub
    Private Sub ekt_afix_anax_zeig_viles()
        'simbK = -1
        'praktK = -1

        afixflag = 2
        ImerKatastPicker.Value = imeromErgasias
        ImerEkdosisPicker.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "ΒΙΛΕΣ ΑΦΙΞ. - ΑΝΑΧ. - ΚΡΑΤ."
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 5, 25)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        'LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        AfixAnaxPnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        Me.DbhotelDataSet.AfixeisAnaxwriseis2.Clear()
        Me.AfixAnaxPnl.Size = New Point(783, ZentralPnl.Height)
        Me.ZentralPnl.Controls.Add(AfixAnaxPnl)

    End Sub

    Private Sub KatastPrakt_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KatastPrakt.Click
        Dim PraktForm As New SimbolaiaFrm()


        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        praktK = PraktForm.return_praktoreio_kwdikos

        If praktK = Nothing Then
            KatastPrakt.Text = " Όλα τα Πρακτoρεία "
            praktK = -1
            simbK = -1
            'KatastSimb.SelectedIndex = 0
            KatastSimb.Items.Clear()

            KatastSimb.Items.Add("<A/A Συμβoλαίου>")
            KatastSimb.SelectedIndex = 0
            Exit Sub
        Else
            KatastPrakt.Text = PraktForm.return_praktoreio
            KatastSimb.Items.Clear()
            Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktK, etos)

            fuehle_simbol_katastasi_cbox()
            If KatastSimb.Items.Count <> 0 Then
                KatastSimb.SelectedIndex = 0
                simbK = -1
            End If
        End If
        'Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, etos)


    End Sub

    Private Sub KatastSimbCbx_Update(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KatastSimb.TextUpdate

        MsgBox("Δεν επιτρέπεται αλλαγή  !", MsgBoxStyle.Information, "winfo\nikEl.")
        KatastSimb.SelectedIndex = -1
        simbK = -1
    End Sub
    Private Sub KatastSimb_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KatastSimb.SelectedIndexChanged
        Dim simbolaioTemp As Integer

        If sender.selectedindex > 0 Then
            simbolaioTemp = get_kwd_simbol_by_katastasi(KatastSimb.SelectedItem.ToString, praktK, etos)

            If simbolaioTemp = -1 Then
                simbK = -1

            Else
                simbK = simbolaioTemp
                'MsgBox(simbK)
            End If
        Else
            simbK = -1

        End If
    End Sub
    Private Sub KatastEmfBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KatastEmfBtn.Click
        Dim j, aa As Int16
        Dim tempKwd As Integer = -1
        Dim kratOK, afixOK As Boolean
        'Dim countKopelia As Int16 = 0
        Try
            Me.Cursor = Cursors.WaitCursor
            kratOK = False
            afixOK = False
            If AfixeisRdb.Checked Then
                afixOK = True

                If praktK <> -1 AndAlso simbK <> -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImeromPraktSimb(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text, KatastSimb.SelectedItem.ToString)

                    '  Me.AfixeisAnaxwriseis2TableAdapter.AfixeisByEtosImeromPraktSimbTipoikwd_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22)

                ElseIf praktK <> -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImeromPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text)
                    '  Me.AfixeisAnaxwriseis2TableAdapter.AfixeisByEtosImeromPraktTipoikwdikoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 21, ImerKatastPicker.Value.Date)
                ElseIf praktK = -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImerom(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date)
                    If afixflag = 1 Then
                        Me.AfixeisAnaxwriseis2TableAdapter.AfixeisByEtosImeromTpoikwd_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 25, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 25, ImerKatastPicker.Value.Date)
                    Else
                        Me.AfixeisAnaxwriseis2TableAdapter.AfixeisByEtosImeromTpoikwd_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 1, 12, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 1, 12, ImerKatastPicker.Value.Date)
                    End If


                End If
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΑΦΙΞΕΙΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).imerominia = ImerKatastPicker.Value.Date
                Me.DbhotelDataSet.ekt_AfixAnax(0).ekdosi = ImerEkdosisPicker.Value.Date
            ElseIf KratiseisRdb.Checked Then
                kratOK = True
                If praktK <> -1 AndAlso simbK <> -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImeromPraktSimb(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text, KatastSimb.SelectedItem.ToString)
                    ' Me.AfixeisAnaxwriseis2TableAdapter.FillKratiseisByImeromKratisisPraktSimb_ChkinAfix(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, False, ImerKatastPicker.Value.Date)
                ElseIf praktK <> -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImeromPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text)
                    'Me.AfixeisAnaxwriseis2TableAdapter.FillKratiseisByImeromKratisisPrakt_ChkinAf(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, False, ImerKatastPicker.Value.Date)
                ElseIf praktK = -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixeisByEtosImerom(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date)
                    If afixflag = 1 Then
                        Me.AfixeisAnaxwriseis2TableAdapter.FillKratiseisByImeromKratisis_ChkinAfixTipoikwd(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, False, ImerKatastPicker.Value.Date, 13, 25)
                    Else
                        Me.AfixeisAnaxwriseis2TableAdapter.FillKratiseisByImeromKratisis_ChkinAfixTipoikwd(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, False, ImerKatastPicker.Value.Date, 1, 12)
                    End If

                End If

                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΚΡΑΤΗΣΕΙΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).imerominia = ImerKatastPicker.Value.Date
                Me.DbhotelDataSet.ekt_AfixAnax(0).ekdosi = ImerEkdosisPicker.Value.Date

            ElseIf AnaxwriseisRdb.Checked Then
                If praktK <> -1 AndAlso simbK <> -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AnaxwriseisByEtosImeromPraktSimb(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text, KatastSimb.SelectedItem.ToString)
                    ' Me.AfixeisAnaxwriseis2TableAdapter.AnaxwriseisByEtosImeromPraktSimbTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22)
                ElseIf praktK <> -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AnaxwriseisByEtosImeromPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, KatastPrakt.Text)
                    ' Me.AfixeisAnaxwriseis2TableAdapter.AnaxwriseisByEtosImeromPraktTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 22)
                ElseIf praktK = -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AnaxwriseisByEtosImerom(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date)
                    If afixflag = 1 Then
                        Me.AfixeisAnaxwriseis2TableAdapter.AnaxwriseisByEtosImeromTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 13, 25, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, 13, 25, ImerKatastPicker.Value.Date)
                    Else
                        Me.AfixeisAnaxwriseis2TableAdapter.AnaxwriseisByEtosImeromTipoi_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, 1, 12, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, 1, 12, ImerKatastPicker.Value.Date)
                    End If

                End If
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΑΝΑΧΩΡΗΣΕΙΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).imerominia = ImerKatastPicker.Value.Date
                Me.DbhotelDataSet.ekt_AfixAnax(0).ekdosi = ImerEkdosisPicker.Value.Date
            ElseIf AfixAnaxRdb.Checked Then
                If praktK <> -1 AndAlso simbK <> -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixAnaxByPraktSimb(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, _
                    'ImerKatastPicker.Value.Date)
                    Me.AfixeisAnaxwriseis2TableAdapter.AfixAnaxByPraktSimb_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, KatastSimb.SelectedItem.ToString, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date)
                ElseIf praktK <> -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixAnaxByPrakt(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date)
                    Me.AfixeisAnaxwriseis2TableAdapter.AfixAnaxByPrakt_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, KatastPrakt.Text, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date)

                ElseIf praktK = -1 AndAlso simbK = -1 Then
                    'Me.AfixeisAnaxwriseisTableAdapter.AfixAnax(Me.DbhotelDataSet.AfixeisAnaxwriseis, etos, ImerKatastPicker.Value.Date, etos, ImerKatastPicker.Value.Date)
                    'Dim nullo As DBNull
                    '  Me.AfixeisAnaxwriseis2TableAdapter.AfixeisAnaxwriseis_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date.AddDays(-1), ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date)

                End If
                Me.DbhotelDataSet.ekt_AfixAnax.Clear()
                Me.DbhotelDataSet.ekt_AfixAnax.Rows.Add()
                Me.DbhotelDataSet.ekt_AfixAnax(0).perigrafi = "ΑΦΙΞΕΙΣ-ΑΝΑΧΩΡΗΣΕΙΣ"
                Me.DbhotelDataSet.ekt_AfixAnax(0).imerominia = ImerKatastPicker.Value.Date
                Me.DbhotelDataSet.ekt_AfixAnax(0).ekdosi = ImerEkdosisPicker.Value.Date 'ImerKatastPicker.Value.Date
            End If
            'arithmisi a/a twn apotelesmatwn
            ' epeidi alaksa tis afixeisanaxwriseis ERWTHMA sto Database kai twra kanei Join OLA ta ONOMATA twn enhlikwn (giati ta xreiazomai stous DIAMENWNTES
            'Menou Panw)_> edw epilegw MONO mia Row (xreiazomao edw Mono ena Onoma (to allo to kanw delete sto dataset)
            aa = 0
            j = 0
            While j <= Me.DbhotelDataSet.AfixeisAnaxwriseis2.Count - 1
                If tempKwd <> Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd Then
                    aa += 1
                    tempKwd = Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).kwd
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).aa = aa

                    If Not kratOK Then
                        Try
                            'If Not Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enarxi <= ImerKatastPicker.Value.Date Or Not _
                            '                                      Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).lixi >= ImerKatastPicker.Value.Date.AddDays(-1) Then
                            '    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = "OV-BOOK"
                            'End If
                            If Not (Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).enarxi <= ImerKatastPicker.Value.Date And
                                                                                             Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).lixi >= ImerKatastPicker.Value.Date.AddDays(-1)) Then
                                Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = "OV-BOOK"
                            End If
                        Catch ex As StrongTypingException
                            Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).dwmatio
                            'If afixOK Then
                            '    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).dwmatio
                            'Else
                            '    Me.DbhotelDataSet.AfixeisAnaxwriseis2(j).statusdwmatio = "OV-BOOK"
                            'End If

                        End Try
                    End If

                    j += 1
                Else
                    Me.DbhotelDataSet.AfixeisAnaxwriseis2.Rows.RemoveAt(j)
                End If
            End While
        Catch ex As System.Exception
            Me.Cursor = Cursors.Default
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try
        Me.Cursor = Cursors.Default


    End Sub
    'Private Sub AfixeisAnaxwriseisDataGridView_RowPrePaint(ByVal sender As Object, ByVal e As System.Windows.Forms.DataGridViewRowPrePaintEventArgs) Handles AfixeisAnaxwriseisDataGridView.RowPrePaint
    '    'aaAfixGrid = aaAfixGrid + 1
    '    'MsgBox(
    '    Me.AfixeisAnaxwriseisDataGridView.Item(0, AfixeisAnaxwriseisDataGridView.CurrentRow.Index).Value = Me.AfixeisAnaxwriseisBindingSource.Count
    'End Sub
    Private Sub fuehle_simbol_katastasi_cbox()
        Dim j As Int16
        KatastSimb.Items.Clear()

        For j = 0 To Me.DbhotelDataSet.simbolaia.Count
            If j <> 0 Then
                Try
                    If Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou.Equals("") Then
                        KatastSimb.Items.Add(j)
                    Else
                        KatastSimb.Items.Add(Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou)
                    End If
                Catch ex As NullReferenceException
                    KatastSimb.Items.Add(j)
                End Try
            Else
                KatastSimb.Items.Add("<A/A Συμβoλαίου>")
            End If
        Next
    End Sub
    Private Sub ProepiskopisiBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProepiskopisiBtn.Click
        Dim Form1 As New EktiposeisFrm()

        If Not AfixeisRdb.Checked Then
            Dim ektiposi As New Afixeis()

            Try
                Me.Cursor = Cursors.WaitCursor
                Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                sender.Enabled = False

                ektiposi.SetDataSource(DbhotelDataSet)
                CrystalReportViewer1.ReportSource = ektiposi
                CrystalReportViewer1.DisplayGroupTree = False
                'CrystalReportViewer1.DisplayGroupTree = False
                Form1.Controls.Add(CrystalReportViewer1)
                CrystalReportViewer1.Dock = DockStyle.Fill
                CrystalReportViewer1.Visible = True

                Form1.ShowDialog()

                ektiposi.Close()
                ektiposi.Dispose()
                sender.Enabled = True
            Catch ex As System.Exception
                Me.Cursor = Cursors.Default
                System.Windows.Forms.MessageBox.Show(ex.Message)
            End Try
            Me.Cursor = Cursors.Default
        Else ' afixei 15thimerou DOMISI

            Dim ektiposi As New AnamenAfixeis15()

            Try
                Me.Cursor = Cursors.WaitCursor

                sender.Enabled = False

                OldCustomAdapter1.FillAnamenomenesAfixeis(Me.DbhotelDataSet1.OldCustomers, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.AddDays(15).Date)

                ektiposi.SetDataSource(DbhotelDataSet1)
                CrystalReportViewer1.ReportSource = ektiposi
                CrystalReportViewer1.DisplayGroupTree = False
                'CrystalReportViewer1.DisplayGroupTree = False
                Form1.Controls.Add(CrystalReportViewer1)
                CrystalReportViewer1.Dock = DockStyle.Fill
                CrystalReportViewer1.Visible = True

                Form1.ShowDialog()

                ektiposi.Close()
                ektiposi.Dispose()
                sender.Enabled = True
            Catch ex As System.Exception
                Me.Cursor = Cursors.Default
                System.Windows.Forms.MessageBox.Show(ex.Message)
            End Try
            Me.Cursor = Cursors.Default
        End If




    End Sub
    Private Function get_kwd_simbol_by_katastasi(ByVal aa As String, ByVal praktoreio As Integer, ByVal xronia As Int16) As Integer

        Try
            Return Me.SimbolaiaTableAdapter.GetKwdByAaPraktEtos(aa, praktoreio, xronia)
        Catch ex As Exception
            Return -1
        End Try


    End Function

    'Dim ektiposi As New EktEntoles()
    'Dim Form1 As New ApodixiForm()



    '        ektiposi.SetDataSource(EfpaDataSet)

    '        CrystalReportViewer1.ReportSource = ektiposi
    '        Form1.Controls.Add(CrystalReportViewer1)
    '        CrystalReportViewer1.Dock = DockStyle.Fill
    '        CrystalReportViewer1.Visible = True

    '        Form1.ShowDialog()

    '        ektiposi.Close()
    '        ektiposi.Dispose()
    '        Me.Button11.Enabled = True

    '**************************LOGARIASMOI*****************LOGARIASMOI*************************************LOGARIASMOI****
    Private Sub logariasmoi_zeig()
        Dim s As Single = 0
        kwdKratLDB = -1
        tmimaLKwd = -1
        pelatisKwd = 0
        PelatisTbx.Clear()
        TmimaLTbx.Clear()
        AitiaLTbx.Clear()
        KartellaPnl.Controls.Clear()
        SumPistPlirPnl.Controls.Clear()
        Panel7.Controls.Clear()
        PistosLTbx.Text = s.ToString("F")
        PliromLTbx.Text = s.ToString("F")
        EggrafLCbx.SelectedIndex = -1
        EggrafLCbx.Items.Clear()
        Me.DateTimePicker6.MinDate = imeromErgasias
        Me.DateTimePicker6.MaxDate = imeromErgasias
        DateTimePicker6.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "TMHMATA ΛΟΓΑΡΙΑΣΜΟΙ"
        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 4, 25)

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        LogariasmoiPnl.Location = New Point(5, EtiketaErgHmPnl.Height)

        Me.LogariasmoiPnl.Size = New Point(783, ZentralPnl.Height)
        LogarEpimChk.Enabled = False

        'AddHandler PistosLTbx.KeyPress, AddressOf komma_einschalten
        'AddHandler PliromLTbx.KeyPress, AddressOf komma_einschalten

        LogariasmoiPnl.Controls.Add(LogarHeaderPnl)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        Me.ZentralPnl.Controls.Add(LogariasmoiPnl)
    End Sub
    Private Sub PelatisTbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PelatisTbx.Enter
        Dim kwdKratTemp As Integer
        Dim s As Single = 0

        Dim form As New KratiseisSucheF(imeromErgasias, True, False, 1, rechte)
        form.StartPosition = FormStartPosition.CenterParent
        form.ShowDialog()
        kwdKratTemp = form.return_kwdiko_kratisis()

        If kwdKratTemp <> -1 Then
            afixiLog = form.return_afixi
            anaxLog = form.return_anaxwrisi
            Me.DateTimePicker6.MinDate = afixiLog
            Me.DateTimePicker6.MaxDate = anaxLog
            kwdKratLDB = kwdKratTemp
            Try
                PelatisTbx.Text = form.return_onoma
                pelatisKwd = Me.EnilikesTableAdapter.GetKwdByKratisiOnomatep(kwdKratLDB, PelatisTbx.Text)
            Catch ex As InvalidOperationException
                pelatisKwd = 0
                MsgBox("Δεν επιλέχθηκε Πελάτης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                DateTimePicker6.Focus()
                Exit Sub
            End Try
        ElseIf kwdKratLDB <> -1 Then
            MsgBox("Δεν επιλέχθηκε Πελάτης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            DateTimePicker6.Focus()
            Exit Sub
        End If
        PelatisTbx.Text = form.return_onoma
        If Not PelatisTbx.Text.Equals("") Then
            LogarEpimChk.Enabled = True
        End If
        form.Dispose()
        fuelle_aaegraf_logar_cbx()

        Me.Cursor = Cursors.WaitCursor
        TmimaLTbx.Clear()
        tmimaLKwd = -1
        AitiaLTbx.Clear()
        PistosLTbx.Text = s.ToString("F")
        PliromLTbx.Text = s.ToString("F")
        KartellaPnl.Controls.Clear()
        SumPistPlirPnl.Controls.Clear()
        Panel7.Controls.Clear()
        If LogarEpimChk.Checked Then
            male_kartella_pelati(False)
        Else
            male_kartella_pelati(True)
        End If
        Me.Cursor = Cursors.Default
        EggrafLCbx.Focus()
    End Sub

    Private Sub fuelle_aaegraf_logar_cbx()
        Dim j As Int16
        EggrafLCbx.SelectedIndex = -1
        EggrafLCbx.Items.Clear()

        Me.LogariasmoidiamTableAdapter.FillLogariasmoiByKratisiDiamenwn(Me.DbhotelDataSet.logariasmoidiam, kwdKratLDB, pelatisKwd, 0)
        'Me.Tmimata()
        For j = 0 To Me.DbhotelDataSet.logariasmoidiam.Count
            If j <> 0 Then
                EggrafLCbx.Items.Add(Me.DbhotelDataSet.logariasmoidiam(j - 1).aaeggrafis)
            Else
                EggrafLCbx.Items.Add("ΝΕΑ")
            End If
        Next

    End Sub
    Private Sub TmimaLTbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TmimaLTbx.Enter
        Dim TmimaForm As New TmimataFrm(True)
        Dim kwdikos As Integer
        Dim tmimaName As String

        'Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres

        TmimaForm.StartPosition = FormStartPosition.CenterParent
        TmimaForm.ShowDialog()
        kwdikos = TmimaForm.return_tmima_kwdikos
        'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            'If tmimaLKwd = Nothing Then
            TmimaTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
            DateTimePicker6.Focus()
            Exit Sub
            'End If
        Else
            'Guarant2Pnl.Controls.Clear()
            tmimaLKwd = kwdikos
        End If
        tmimaName = TmimaForm.return_tmima
        If tmimaName = Nothing Then
            TmimaLTbx.Text = sender.text
        Else
            TmimaLTbx.Text = tmimaName
        End If
        TmimaForm.Dispose()
        AitiaLTbx.Focus()
    End Sub
    Private Sub EggrafLTbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EggrafLCbx.SelectedIndexChanged
        Dim s As Single = 0
        If kwdKratLDB > 0 Then
            If EggrafLCbx.SelectedIndex > 0 Then
                Dim kwdEggrafis As Integer
                kwdEggrafis = Me.LogariasmoidiamTableAdapter.GetKwdByKratDiamAAEgraf(kwdKratLDB, pelatisKwd, EggrafLCbx.SelectedItem.ToString)
                tmimaLKwd = Me.LogariasmoidiamTableAdapter.GetTmimaByKwd(kwdEggrafis)
                TmimaLTbx.Text = Me.TmimataTableAdapter.GetOnomaByKwd(tmimaLKwd)
                AitiaLTbx.Text = Me.LogariasmoidiamTableAdapter.GetAitiolByKwd(kwdEggrafis)
                s = Me.LogariasmoidiamTableAdapter.GetPistosiByKwdAAgram(kwdEggrafis, 0)
                PistosLTbx.Text = s.ToString("N")
                s = Me.LogariasmoidiamTableAdapter.GetPliromiByKwdAAgram(kwdEggrafis, 0)
                PliromLTbx.Text = s.ToString("N")
            ElseIf EggrafLCbx.SelectedIndex = 0 Then
                AitiaLTbx.Clear()
                PistosLTbx.Text = s.ToString("F")
                PliromLTbx.Text = s.ToString("F")
            End If
            'Else
            '    MsgBox("Δεν επιλέχθηκε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If

    End Sub
    Private Sub LogarSpeicherBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles LogarSpeicherBtn.Click
        Dim remale As Boolean = False
        Dim aaEggr As Byte
        Dim response As MsgBoxResult


        If kwdKratLDB > 0 Then
            If tmimaLKwd <> -1 Then
                Try
                    If CType(PistosLTbx.Text, Single) = 0 AndAlso CType(PliromLTbx.Text, Single) = 0 Then
                        response = MsgBox("Θέλετε να αποθηκευθούν μηδενικές τιμές;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                        If response = MsgBoxResult.No Then
                            Exit Sub
                        End If
                    End If
                Catch ex As InvalidCastException
                    MsgBox("Δώστε ποσά πίστωσης- πληρωμής!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Exit Sub
                End Try


                If EggrafLCbx.SelectedIndex > 0 Then
                    Dim kwdEggrafis As Integer
                    kwdEggrafis = Me.LogariasmoidiamTableAdapter.GetKwdByKratDiamAAEgraf(kwdKratLDB, pelatisKwd, EggrafLCbx.SelectedItem.ToString)
                    Me.LogariasmoidiamTableAdapter.UpdateLogarByKwd(tmimaLKwd, DateTimePicker6.Value,
                                AitiaLTbx.Text, PistosLTbx.Text, PliromLTbx.Text, kwdEggrafis)
                    aaEggr = Me.LogariasmoidiamTableAdapter.GetAAEggrafByKwd(kwdEggrafis)
                    remale = True
                ElseIf EggrafLCbx.SelectedIndex = 0 Or EggrafLCbx.SelectedIndex = -1 Then

                    Try
                        aaEggr = Me.LogariasmoidiamTableAdapter.MaxAAByKratisi(kwdKratLDB)
                        aaEggr = aaEggr + 1
                    Catch ex As InvalidOperationException
                        aaEggr = 1
                    End Try

                    Me.LogariasmoidiamTableAdapter.InsertLogariasmDiam(kwdKratLDB, tmimaLKwd, DateTimePicker6.Value,
                                    aaEggr, AitiaLTbx.Text, PistosLTbx.Text, PliromLTbx.Text, pelatisKwd)
                    remale = True
                Else
                    MsgBox("Επιλέξτε Εγγραφή !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If
            Else
                MsgBox("Επιλέξτε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End If

        End If
        If remale Then
            Me.Cursor = Cursors.WaitCursor
            KartellaPnl.Controls.Clear()
            SumPistPlirPnl.Controls.Clear()
            Panel7.Controls.Clear()
            fuelle_aaegraf_logar_cbx()
            EggrafLCbx.SelectedIndex = 0
            'EggrafLCbx.SelectedIndex = get_index_eggrafi_cbox(aaEggr)
            If LogarEpimChk.Checked Then
                male_kartella_pelati(False)
            Else
                male_kartella_pelati(True)
            End If
            Me.Cursor = Cursors.Default
        End If
    End Sub
    Private Sub LogarEpimChk_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles LogarEpimChk.CheckedChanged
        If Not PelatisTbx.Text.Equals("") Then
            If sender.checked Then
                Me.Cursor = Cursors.WaitCursor
                KartellaPnl.Controls.Clear()
                SumPistPlirPnl.Controls.Clear()
                Panel7.Controls.Clear()
                Me.LogariasmoidiamTableAdapter.FillLogariasmoiByKratisiDiamenwn(Me.DbhotelDataSet.logariasmoidiam, kwdKratLDB, pelatisKwd, 0)
                KartelaLbl.Text = "Καρτέλα Διαμένωντα"
                male_kartella_pelati(False)
                Me.Cursor = Cursors.Default
            Else
                Me.Cursor = Cursors.WaitCursor
                KartellaPnl.Controls.Clear()
                SumPistPlirPnl.Controls.Clear()
                Panel7.Controls.Clear()
                Me.LogariasmoidiamTableAdapter.FillLogariasmoiByKratisi(Me.DbhotelDataSet.logariasmoidiam, kwdKratLDB, 0)
                KartelaLbl.Text = "Συνολική Καρτέλα"
                male_kartella_pelati(True)
                Me.Cursor = Cursors.Default
            End If
        Else
            MsgBox("Επιλέξτε Πελάτη !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If
    End Sub
    Private Sub male_kartella_pelati(ByVal synoliki As Boolean)
        Dim j, stepy As Int16
        Dim sumPist, sumPlirom As Single

        If synoliki Then
            Me.LogariasmoidiamTableAdapter.FillLogariasmoiByKratisi(Me.DbhotelDataSet.logariasmoidiam, kwdKratLDB, 0)
        ElseIf pelatisKwd > 0 Then
            Me.LogariasmoidiamTableAdapter.FillLogariasmoiByKratisiDiamenwn(Me.DbhotelDataSet.logariasmoidiam, kwdKratLDB, pelatisKwd, 0)
        End If

        stepy = 40
        For j = 0 To Me.DbhotelDataSet.logariasmoidiam.Count - 1
            Dim AALbl As New Label
            AALbl.Size = New Point(40, 30)
            AALbl.BackColor = Color.Azure
            AALbl.TextAlign = ContentAlignment.MiddleCenter
            AALbl.Text = Me.DbhotelDataSet.logariasmoidiam(j).aaeggrafis
            KartellaPnl.Controls.Add(AALbl)
            AALbl.Location = New Point(AALabel.Location.X, 5 + j * stepy)

            Dim ImeromLbl As New Label
            ImeromLbl.Size = New Point(120, 30)
            ImeromLbl.BackColor = Color.Azure
            ImeromLbl.TextAlign = ContentAlignment.MiddleCenter
            ImeromLbl.Text = Me.DbhotelDataSet.logariasmoidiam(j).imerominia
            KartellaPnl.Controls.Add(ImeromLbl)
            ImeromLbl.Location = New Point(AALabel.Location.X + AALbl.Width + 2, 5 + j * stepy)

            Dim TmimaLbl As New Label
            TmimaLbl.Size = New Point(140, 30)
            TmimaLbl.BackColor = Color.Azure
            TmimaLbl.TextAlign = ContentAlignment.MiddleCenter
            Try
                TmimaLbl.Text = Me.TmimataTableAdapter.GetOnomaByKwd(Me.DbhotelDataSet.logariasmoidiam(j).tmima)
            Catch ex As InvalidOperationException
                TmimaLbl.Text = "<ΔΕΝ ΕΠΙΛΕΧΘΗΚΕ>"
            End Try

            KartellaPnl.Controls.Add(TmimaLbl)
            TmimaLbl.Location = New Point(AALabel.Location.X + AALbl.Width + ImeromLbl.Width + 4, 5 + j * stepy)

            Dim AitiolLbl As New Label
            AitiolLbl.Size = New Point(230, 30)
            AitiolLbl.BackColor = Color.Azure
            AitiolLbl.TextAlign = ContentAlignment.MiddleCenter
            Try
                AitiolLbl.Text = Me.DbhotelDataSet.logariasmoidiam(j).aitiologia
            Catch ex As InvalidOperationException
                AitiolLbl.Text = ""
            End Try
            KartellaPnl.Controls.Add(AitiolLbl)
            AitiolLbl.Location = New Point(AALabel.Location.X + AALbl.Width + ImeromLbl.Width + TmimaLbl.Width + 6, 5 + j * stepy)

            Dim PistosiLbl As New Label
            PistosiLbl.Size = New Point(90, 30)
            PistosiLbl.BackColor = Color.Azure
            PistosiLbl.TextAlign = ContentAlignment.MiddleRight
            Try
                PistosiLbl.Text = Me.DbhotelDataSet.logariasmoidiam(j).pistosi.ToString("N")
                sumPist = sumPist + Me.DbhotelDataSet.logariasmoidiam(j).pistosi
            Catch ex As InvalidOperationException
                AitiolLbl.Text = ""
            End Try
            KartellaPnl.Controls.Add(PistosiLbl)
            PistosiLbl.Location = New Point(AALabel.Location.X + AALbl.Width + ImeromLbl.Width + TmimaLbl.Width + AitiolLbl.Width + 8, 5 + j * stepy)

            Dim PliromiLbl As New Label
            PliromiLbl.Size = New Point(90, 30)
            PliromiLbl.BackColor = Color.Azure
            PliromiLbl.TextAlign = ContentAlignment.MiddleRight
            Try
                PliromiLbl.Text = Me.DbhotelDataSet.logariasmoidiam(j).pliromi.ToString("N")
                sumPlirom = sumPlirom + Me.DbhotelDataSet.logariasmoidiam(j).pliromi
            Catch ex As InvalidOperationException
                AitiolLbl.Text = ""
            End Try
            KartellaPnl.Controls.Add(PliromiLbl)
            PliromiLbl.Location = New Point(AALabel.Location.X + AALbl.Width + ImeromLbl.Width + TmimaLbl.Width + AitiolLbl.Width + PistosiLbl.Width + 10, 5 + j * stepy)

        Next
        Dim SumPistLbl As New Label
        SumPistLbl.Size = New Point(90, 25)
        SumPistLbl.BackColor = Color.Azure
        SumPistLbl.TextAlign = ContentAlignment.MiddleRight
        SumPistLbl.Text = sumPist.ToString("N")
        SumPistPlirPnl.Controls.Add(SumPistLbl)
        SumPistLbl.Location = New Point(178, 3)

        Dim SumPliromLbl As New Label
        SumPliromLbl.Size = New Point(90, 25)
        SumPliromLbl.BackColor = Color.Azure
        SumPliromLbl.TextAlign = ContentAlignment.MiddleRight
        SumPliromLbl.Text = sumPlirom.ToString("N")
        SumPistPlirPnl.Controls.Add(SumPliromLbl)
        SumPliromLbl.Location = New Point(178 + SumPistLbl.Width + 2, 3)

        Dim epimer As Single
        Dim EpimLbl As New Label
        EpimLbl.Size = New Point(170, 25)
        'EpimLbl.BackColor = Color.Azure
        EpimLbl.TextAlign = ContentAlignment.MiddleRight
        epimer = (sumPist - sumPlirom)
        EpimLbl.Text = "(Υπόλ.: " + epimer.ToString("N") + ")" 'επιμ. Υπολ.:
        SumPistPlirPnl.Controls.Add(EpimLbl)
        EpimLbl.Location = New Point(4, 3)
        Dim ypol As Single
        Dim YpoloipoLbl As New Label
        YpoloipoLbl.Size = New Point(300, 30)
        'YpoloipoLbl.BackColor = Color.Azure
        YpoloipoLbl.TextAlign = ContentAlignment.MiddleLeft
        Try
            ypol = Me.LogariasmoidiamTableAdapter.GetYpoloipoKratAAgram(kwdKratLDB, 0)
        Catch ex As InvalidOperationException
            ypol = 0
        End Try
        'MsgBox(ypol)
        YpoloipoLbl.Text = "Συνολ. Υπόλοιπο: " + ypol.ToString("C2")
        Panel7.Controls.Add(YpoloipoLbl)
        YpoloipoLbl.Location = New Point(4, 3)


    End Sub
    Private Sub PistosLTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PistosLTbx.Leave, PliromLTbx.Leave
        Dim s As Single = 0
        Try
            s = CType(sender.text, Single)
            sender.text = s.ToString("N")
        Catch ex As InvalidCastException
            sender.text = s.ToString("F")
        End Try
    End Sub
    Private Function get_index_eggrafi_cbox(ByVal aa As String) As Int16
        Dim i As Int16

        For i = 0 To EggrafLCbx.Items.Count - 1
            If EggrafLCbx.Items(i).ToString = aa Then
                Return i
            End If
        Next
        Return -1
    End Function
    Private Sub Box_SelectAllText(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PistosLTbx.Click, PliromLTbx.Click
        sender.SelectAll()
    End Sub
    '**************************METRITOIS *****************METRITOIS ************************************METRITOIS ************
    Private Sub metritis_zeig()
        'tmimaMKwd = -1
        felder_clear()

        DateTimePicker1.Value = imeromErgasias
        'Etiketa panel initialisieren
        EtikLbl.Text = "TMHMATA ΜΕΤΡΗΤΟΙΣ"
        EtikLbl.Location = New Point(MetritoisPnl.Width / 4, 25)
        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)

        MetritoisPnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        Me.MetritoisPnl.Size = New Point(783, ZentralPnl.Height)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        Me.ZentralPnl.Controls.Add(MetritoisPnl)
    End Sub
    Private Sub felder_clear()
        FpaPnl.Controls.Clear()
        PosaPnl.Controls.Clear()
        MetritisSpeichPnl.Controls.Clear()
        SPosaPnl.Controls.Clear()
        Sum1Pnl.Controls.Clear()
        Sum2Pnl.Controls.Clear()
        TmimaTbx.Clear()
        AitiaTbx.Clear()
        EggrafiCbx.SelectedIndex = -1
    End Sub
    Private Sub DateTimePicker1_ValueChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DateTimePicker1.ValueChanged

        felder_clear()
        EggrafiCbx.SelectedIndex = -1
        ReDim eggrafesKwd(-1)
        EggrafiCbx.Items.Clear()

        If tmimaMKwd <> Nothing Then
            fuelle_eggrafi_cbox()
        End If
    End Sub
    Private Sub TmimaTbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TmimaTbx.Enter
        Dim TmimaForm As New TmimataFrm(True)
        Dim kwdikos As Integer
        Dim tmimaName As String

        'Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres

        TmimaForm.StartPosition = FormStartPosition.CenterParent
        TmimaForm.ShowDialog()
        kwdikos = TmimaForm.return_tmima_kwdikos
        'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If tmimaMKwd = Nothing Then
                TmimaTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
                Exit Sub
            End If
        Else
            'Guarant2Pnl.Controls.Clear()
            tmimaMKwd = kwdikos
        End If
        felder_clear()
        tmimaName = TmimaForm.return_tmima
        If tmimaName = Nothing Then
            TmimaTbx.Text = sender.text
        Else
            TmimaTbx.Text = tmimaName
        End If
        TmimaForm.Dispose()

        EggrafiCbx.SelectedIndex = -1
        EggrafiCbx.Items.Clear()
        ReDim eggrafesKwd(-1)
        AitiaTbx.Clear()
        fuelle_eggrafi_cbox()

        EggrafiCbx.Focus()
    End Sub
    Private Sub fuelle_eggrafi_cbox()
        Dim j As Int16

        Me.TmimataegrafesTableAdapter.FillByTmimaImerominia(Me.DbhotelDataSet.tmimataegrafes, DateTimePicker1.Value, tmimaMKwd)

        For j = 0 To Me.DbhotelDataSet.tmimataegrafes.Count
            If j <> 0 Then
                EggrafiCbx.Items.Add(Me.DbhotelDataSet.tmimataegrafes(j - 1).eggrafi)
                ReDim Preserve eggrafesKwd(j - 1)
                eggrafesKwd(j - 1) = Me.DbhotelDataSet.tmimataegrafes(j - 1).kwd
            Else
                EggrafiCbx.Items.Add("ΝΕΑ")
            End If
        Next

    End Sub

    Private Sub EggrafiCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EggrafiCbx.SelectedIndexChanged
        'Dim eggrafiKwd As Integer
        'MsgBox(EggrafiCbx.SelectedIndex)
        If tmimaMKwd > 0 Then
            If EggrafiCbx.SelectedIndex <> -1 Then
                FpaPnl.Controls.Clear()
                PosaPnl.Controls.Clear()
                SPosaPnl.Controls.Clear()
                Sum1Pnl.Controls.Clear()
                Sum2Pnl.Controls.Clear()
                AitiaTbx.Clear()
                If EggrafiCbx.SelectedIndex > 0 Then
                    Me.Cursor = Cursors.WaitCursor
                    AitiaTbx.Text = Me.DbhotelDataSet.tmimataegrafes(EggrafiCbx.SelectedIndex - 1).aitiologia
                    eggrafiKwd = Me.TmimataegrafesTableAdapter.GetKwdByTmimaImerominiaEggrafi(tmimaMKwd, DateTimePicker1.Value, EggrafiCbx.SelectedItem)
                    male_posa_kinisis()
                    Me.Cursor = Cursors.Default
                Else
                    eggrafiKwd = -1
                    male_posa_kinisis()
                End If
            End If
        Else
            MsgBox("Δεν επιλέχθηκε Τμήμα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If


    End Sub
    Private Sub EggrafiCbx_TextUpdate(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EggrafiCbx.TextUpdate
        MsgBox("Δεν επιτρέπεται αλλαγή !", MsgBoxStyle.Information, "winfo\nikEl.")
        EggrafiCbx.SelectedIndex = -1
    End Sub
    Private Sub male_posa_kinisis()
        Dim fpaCount As Int16 = 0
        Dim fpa() As Single
        Dim j, stepy As Int16

        stepy = 35

        If EggrafiCbx.SelectedIndex > 0 Then
            AitiaTbx.Text = Me.DbhotelDataSet.tmimataegrafes(EggrafiCbx.SelectedIndex - 1).aitiologia
        End If

        Me.TmimataTableAdapter.FillByKwd(Me.DbhotelDataSet.tmimata, tmimaMKwd)
        'edw epilogi posostwn FPA 
        'VORSICHT -> EAN PREPEI NA EXW KAI FPA 0,00% TOTE METATREPSE SE Me.DbhotelDataSet.tmimata(j).fpa1 >= 0 (!) TA PARAKATW KLAUSEL

        For j = 0 To Me.DbhotelDataSet.tmimata.Count - 1
            If Me.DbhotelDataSet.tmimata(j).fpa1 <> 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa1, fpa) Then ' AndAlso Array.Exists(fpa, AddressOf Me.DbhotelDataSet.tmimata(j).fpa1)
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa1
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa2 <> 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa2, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa2
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa3 <> 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa3, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa3
            End If
            If Me.DbhotelDataSet.tmimata(j).fpa4 <> 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.tmimata(j).fpa4, fpa) Then
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.tmimata(j).fpa4
            End If
        Next
        'posa fpa exei to tmima
        If fpaCount = 0 Then
            MsgBox("Δεν εχουν δωθεί Φ.Π.Α. Τμήματος : Ανατρέξτε στις Σταθερές Εταιρείας (Τμήματα) και ενημερώστε τα ποσά Φ.Π.Α. !", MsgBoxStyle.Critical, "winfo\nikEl.")
            Exit Sub
        End If

        If tmimaMKwd <> Nothing Then
            'kanw Join-> oles oi kiniseis tou tmimatos autin tin imera
            Me.EggrafitakiniseisTableAdapter.FillJoinKiniseisByTmima(Me.DbhotelDataSet.eggrafitakiniseis, tmimaMKwd, DateTimePicker1.Value)
        End If
        'se periptosi poy exei alaksei o FPA tou tmimatos kai anatreksoume se mia palaioteri Imerominia-> palaiotero FPA erscheinen lassen!
        For j = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1
            If Me.DbhotelDataSet.eggrafitakiniseis(j).fpa <> 0 AndAlso Not kommt_vor(Me.DbhotelDataSet.eggrafitakiniseis(j).fpa, fpa) Then ' AndAlso Array.Exists(fpa, AddressOf Me.DbhotelDataSet.tmimata(j).fpa1)
                fpaCount = fpaCount + 1
                ReDim Preserve fpa(fpaCount - 1)
                fpa(fpaCount - 1) = Me.DbhotelDataSet.eggrafitakiniseis(j).fpa
            End If
        Next


        Dim counter As Int16 = 0
        Dim sNeto, sFpa, ssPoso, ssFpa, sMaizon, sfpaMaizon, ssMaizon, ssMaizFpa As Single

        'diekse ta fpa
        For j = 0 To fpa.Length - 1
            ReDim Preserve kiniseis(fpaCount - 1)
            Dim FpawertLbl As New Label
            Dim kwdKinisis As Integer

            sNeto = 0
            sFpa = 0
            sMaizon = 0
            sfpaMaizon = 0


            counter = get_index_von_dataset(fpa(j))
            FpawertLbl.TextAlign = ContentAlignment.TopCenter
            FpawertLbl.Size = New Point(50, 30)
            FpawertLbl.Text = fpa(j).ToString + "%"

            FpaPnl.Controls.Add(FpawertLbl)
            FpawertLbl.Location = New Point(FpaLbl.Location.X, 10 + j * stepy)

            Dim PosoTbx As New TextBox
            PosoTbx.ForeColor = Color.Maroon
            PosoTbx.TextAlign = HorizontalAlignment.Right
            PosoTbx.MaxLength = 7
            Dim MaisonTbx As New TextBox
            MaisonTbx.ForeColor = Color.Maroon
            MaisonTbx.TextAlign = HorizontalAlignment.Right
            MaisonTbx.MaxLength = 7
            Dim SynolLbl As New Label
            SynolLbl.Name = "SPos" + fpa(j).ToString
            SynolLbl.TextAlign = ContentAlignment.MiddleRight
            SynolLbl.Size = New Point(90, 20)
            'SynolLbl.BackColor = Color.Azure
            Dim SynolFpaLbl As New Label
            SynolFpaLbl.Name = "SFpa" + fpa(j).ToString
            SynolFpaLbl.TextAlign = ContentAlignment.MiddleRight
            SynolFpaLbl.Size = New Point(90, 20)
            'SynolFpaLbl.BackColor = Color.Azure
            Dim SynolMaizonLbl As New Label
            SynolMaizonLbl.Name = "SMai" + fpa(j).ToString
            SynolMaizonLbl.TextAlign = ContentAlignment.MiddleRight
            SynolMaizonLbl.Size = New Point(90, 20)
            'SynolMaizonLbl.BackColor = Color.Azure
            Dim SynolMaizonFpaLbl As New Label
            SynolMaizonFpaLbl.Name = "SMaF" + fpa(j).ToString
            SynolMaizonFpaLbl.TextAlign = ContentAlignment.MiddleRight
            SynolMaizonFpaLbl.Size = New Point(90, 20)
            'SynolMaizonFpaLbl.BackColor = Color.Azure


            'EGGRAFI POSA-FPA-> edw kanw behandeln ta kentrika felder aristera tou bruto posou kai maizon ana fpa
            Try
                kwdKinisis = Me.EggrafitakiniseisTableAdapter.GetKwdByTmimaeggrFpaPoso(fpa(j), eggrafiKwd)
                PosoTbx.Name = "Poso" + fpa(j).ToString '+ "_" + kwdKinisis.ToString
                MaisonTbx.Name = "Mais" + fpa(j).ToString '+ "_" + kwdKinisis.ToString
                If eggrafiKwd <> -1 Then
                    PosoTbx.Text = Me.DbhotelDataSet.eggrafitakiniseis(counter).poso.ToString("N")
                    MaisonTbx.Text = Me.DbhotelDataSet.eggrafitakiniseis(counter).maizon.ToString("N")
                    kiniseis(j).kwdKin = kwdKinisis
                    kiniseis(j).fpa = fpa(j)
                    kiniseis(j).poso = PosoTbx.Text
                    kiniseis(j).netopos = (kiniseis(j).poso / (1 + fpa(j) / 100)).ToString("N")
                    kiniseis(j).fpapos = (kiniseis(j).poso - kiniseis(j).netopos).ToString("N")
                    kiniseis(j).maizon = MaisonTbx.Text
                    kiniseis(j).netomaizon = (kiniseis(j).maizon / (1 + fpa(j) / 100)).ToString("N")
                    kiniseis(j).fpamaizon = (kiniseis(j).maizon - kiniseis(j).netomaizon).ToString("N")
                End If
                counter += 1
            Catch ex As InvalidOperationException ' edw sw peptwsi NEAS kinisis
                PosoTbx.Name = "Poso" + fpa(j).ToString '+ "_" + (-1).ToString
                PosoTbx.Text = "0,00"
                MaisonTbx.Name = "Mais" + fpa(j).ToString '+ "_" + (-1).ToString
                MaisonTbx.Text = "0,00"
                kiniseis(j).kwdKin = -1
                kiniseis(j).fpa = fpa(j)
                kiniseis(j).poso = PosoTbx.Text
                kiniseis(j).netopos = 0
                kiniseis(j).fpapos = 0
                kiniseis(j).maizon = MaisonTbx.Text
                kiniseis(j).netomaizon = 0
                kiniseis(j).fpamaizon = 0
            End Try

            AddHandler PosoTbx.Leave, AddressOf berechne_erneut_synola
            AddHandler MaisonTbx.Leave, AddressOf berechne_erneut_synola
            'AddHandler PosoTbx.KeyPress, AddressOf komma_einschalten
            'AddHandler MaisonTbx.KeyPress, AddressOf komma_einschalten
            AddHandler PosoTbx.Click, AddressOf selectall
            AddHandler MaisonTbx.Click, AddressOf selectall

            'edw deksia athroismata twn katharwn poswn-fpa-maizon-maizonfpa gia OLES tis eggrafes tis imeras gia to tmima

            berechne_sum_sposo_sfpa(sNeto, sFpa, fpa(j))
            ssPoso = (ssPoso + sNeto).ToString("N")
            SynolLbl.Text = sNeto.ToString("N")
            ssFpa = (ssFpa + sFpa).ToString("N")
            SynolFpaLbl.Text = sFpa.ToString("N")
            kiniseis(j).sPoso = SynolLbl.Text
            kiniseis(j).sFpa = SynolFpaLbl.Text

            berechne_sum_smaizon_smaizfpa(sMaizon, sfpaMaizon, fpa(j))

            ssMaizon = (ssMaizon + sMaizon).ToString("N")
            SynolMaizonLbl.Text = (sMaizon.ToString("N"))

            ssMaizFpa = (ssMaizFpa + sfpaMaizon).ToString("N")
            SynolMaizonFpaLbl.Text = sfpaMaizon.ToString("N")
            kiniseis(j).sMaizon = SynolMaizonLbl.Text
            kiniseis(j).sMaizFpa = SynolMaizonFpaLbl.Text


            PosoTbx.Location = New Point(PosoLbl.Location.X - FpaPnl.Width - 30, 10 + j * stepy)
            MaisonTbx.Location = New Point(MaisonLbl.Location.X - FpaPnl.Width - 30, 10 + j * stepy)
            PosaPnl.Controls.Add(PosoTbx)
            PosaPnl.Controls.Add(MaisonTbx)

            SynolLbl.Location = New Point(SPosoLbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 10 + j * stepy)
            SPosaPnl.Controls.Add(SynolLbl)

            SynolFpaLbl.Location = New Point(SFpa1Lbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 10 + j * stepy)
            SPosaPnl.Controls.Add(SynolFpaLbl)

            SynolMaizonLbl.Location = New Point(SMaisonLbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 10 + j * stepy)
            SPosaPnl.Controls.Add(SynolMaizonLbl)

            SynolMaizonFpaLbl.Location = New Point(SFpa2Lbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 10 + j * stepy)
            SPosaPnl.Controls.Add(SynolMaizonFpaLbl)
        Next
        'Edw ta athroismata stin katw seira!!! 

        Dim sumPoso, sumMaizon As Single

        Dim SumPosoLbl As New Label
        SumPosoLbl.Name = "SumP"
        SumPosoLbl.TextAlign = ContentAlignment.MiddleRight
        SumPosoLbl.Size = New Point(90, 20)
        'SumPosoLbl.BackColor = Color.Azure
        sumPoso = Me.berechne_synolo_synolikoposo()

        SumPosoLbl.Text = sumPoso.ToString("N")
        sum(0) = SumPosoLbl.Text


        Dim SumMaizonLbl As New Label
        SumMaizonLbl.Name = "SumM"
        SumMaizonLbl.TextAlign = ContentAlignment.MiddleRight
        SumMaizonLbl.Size = New Point(90, 20)
        'SumMaizonLbl.BackColor = Color.Azure
        sumMaizon = Me.berechne_synolo_synolikomaizon()
        SumMaizonLbl.Text = sumMaizon.ToString("N")
        sum(1) = SumMaizonLbl.Text

        Dim SumSPosoLbl As New Label
        SumSPosoLbl.Name = "SSPo"
        SumSPosoLbl.TextAlign = ContentAlignment.MiddleRight
        SumSPosoLbl.Size = New Point(90, 20)
        SumSPosoLbl.Text = ssPoso.ToString("N") 'ssPoso, ssFpa, ssMaizon, ssMaizFpa As Single
        sum(2) = SumSPosoLbl.Text

        Dim SumSFpaLbl As New Label
        SumSFpaLbl.Name = "SSFp"
        SumSFpaLbl.TextAlign = ContentAlignment.MiddleRight
        SumSFpaLbl.Size = New Point(90, 20)
        'SumSFpaLbl.BackColor = Color.Azure
        SumSFpaLbl.Text = ssFpa.ToString("N") 'ssPoso, ssFpa, ssMaizon, ssMaizFpa As Single
        sum(3) = SumSFpaLbl.Text

        Dim SumSMaizLbl As New Label
        SumSMaizLbl.Name = "SSMz"
        SumSMaizLbl.TextAlign = ContentAlignment.MiddleRight
        SumSMaizLbl.Size = New Point(90, 20)
        'SumSMaizLbl.BackColor = Color.Azure
        SumSMaizLbl.Text = ssMaizon.ToString("N") 'ssPoso, ssFpa, ssMaizon, ssMaizFpa As Single
        sum(4) = SumSMaizLbl.Text

        Dim SumSMaizFpaLbl As New Label
        SumSMaizFpaLbl.Name = "SSMF"
        SumSMaizFpaLbl.TextAlign = ContentAlignment.MiddleRight
        SumSMaizFpaLbl.Size = New Point(90, 20)
        'SumSMaizFpaLbl.BackColor = Color.Azure
        SumSMaizFpaLbl.Text = ssMaizFpa.ToString("N")
        sum(5) = SumSMaizFpaLbl.Text


        SumPosoLbl.Location = New Point(PosoLbl.Location.X - FpaPnl.Width - 20, 3)
        Sum1Pnl.Controls.Add(SumPosoLbl)

        SumMaizonLbl.Location = New Point(MaisonLbl.Location.X - FpaPnl.Width - 20, 3)
        Sum1Pnl.Controls.Add(SumMaizonLbl)

        SumSPosoLbl.Location = New Point(SPosoLbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 3)
        Sum2Pnl.Controls.Add(SumSPosoLbl)

        SumSFpaLbl.Location = New Point(SFpa1Lbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 3)
        Sum2Pnl.Controls.Add(SumSFpaLbl)

        SumSMaizLbl.Location = New Point(SMaisonLbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 3)
        Sum2Pnl.Controls.Add(SumSMaizLbl)

        SumSMaizFpaLbl.Location = New Point(SFpa2Lbl.Location.X - FpaPnl.Width - PosaPnl.Width - 20, 3)
        Sum2Pnl.Controls.Add(SumSMaizFpaLbl)

        Dim SpeicherButton As New Button
        SpeicherButton.BackColor = Color.Azure
        SpeicherButton.ForeColor = Color.Maroon
        SpeicherButton.Text = "Αποθήκευση"
        SpeicherButton.Size = New Point(140, 30)
        SpeicherButton.Cursor = Cursors.Hand
        'SpeicherButton.Location = New Point(Allotm3Pnl.Width / 2 - 80, locy + ImerLbl.Height + k * (ImerLbl.Height + 10))
        SpeicherButton.Location = New Point(MetritisSpeichPnl.Width / 2 - 80, 40)
        MetritisSpeichPnl.Controls.Add(SpeicherButton)
        AddHandler SpeicherButton.Click, AddressOf kiniseis_speichern   'MsgBox

    End Sub
    Private Sub kiniseis_speichern(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim j As Int16
        Dim maxEggr As Byte
        Dim neuEggr As Boolean = False


        Me.TmimataegrafesTableAdapter.UpdatePliromiImeromAitioByKwd("Μετρητοίς", DateTimePicker1.Value, AitiaTbx.Text, eggrafiKwd)

        For j = 0 To kiniseis.Length - 1
            If kiniseis(j).kwdKin <> -1 Then
                If kiniseis(j).poso = 0 And kiniseis(j).maizon = 0 Then
                    Try
                        Me.EggrafitakiniseisTableAdapter.DeleteKinisi(kiniseis(j).kwdKin)
                    Catch ex As SqlException
                        MsgBox("Παρουσιάστηκε πρόβλημα στην Διαγραφή μίας Κίνησης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    End Try
                Else
                    Try
                        Me.EggrafitakiniseisTableAdapter.UpdateKinisi(eggrafiKwd, kiniseis(j).fpa, kiniseis(j).poso, kiniseis(j).maizon, kiniseis(j).netopos, kiniseis(j).fpapos, kiniseis(j).netomaizon, kiniseis(j).fpamaizon, kiniseis(j).kwdKin)
                    Catch ex As SqlException
                        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση μίας Κίνησης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    End Try
                End If
            ElseIf kiniseis(j).poso <> 0 Or kiniseis(j).maizon <> 0 Then
                If eggrafiKwd <> -1 Then 'Nea Kratisi-> h sxetiki eggrafi ston pinaka TMIMATAEGGRAFES iparxei 
                    Try
                        Me.EggrafitakiniseisTableAdapter.InsertKinisi(eggrafiKwd, kiniseis(j).fpa, kiniseis(j).poso, kiniseis(j).maizon, kiniseis(j).netopos, kiniseis(j).fpapos, kiniseis(j).netomaizon, kiniseis(j).fpamaizon)
                    Catch ex As SqlException
                        MsgBox("Παρουσιάστηκε πρόβλημα στην Εισαγωγή νέας Κίνησης !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    End Try
                Else 'Nea eggrafi + nea kratisi
                    Try
                        maxEggr = Me.TmimataegrafesTableAdapter.GetMaxEggrafiByTmimaImerom(tmimaMKwd, DateTimePicker1.Value)
                    Catch ex As InvalidOperationException
                        maxEggr = 0
                    End Try

                    Me.TmimataegrafesTableAdapter.InsertEggrafi(tmimaMKwd, DateTimePicker1.Value, (maxEggr + 1), AitiaTbx.Text, "Μετρητοίς")
                    Try
                        eggrafiKwd = Me.TmimataegrafesTableAdapter.GetKwdByTmimaImerominiaEggrafi(tmimaMKwd, DateTimePicker1.Value, (maxEggr + 1))
                    Catch ex As InvalidOperationException
                        MsgBox("Παρουσιάστηκε πρόβλημα στην Εισαγωγή νέας Εγγραφής !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Exit Sub
                    End Try
                    Me.EggrafitakiniseisTableAdapter.InsertKinisi(eggrafiKwd, kiniseis(j).fpa, kiniseis(j).poso, kiniseis(j).maizon, kiniseis(j).netopos, kiniseis(j).fpapos, kiniseis(j).netomaizon, kiniseis(j).fpamaizon)
                    'EggrafiCbx.SelectedIndex = -1
                    neuEggr = True
                End If

            End If
        Next

        Me.TmimataegrafesTableAdapter.FillByTmimaImerominia(Me.DbhotelDataSet.tmimataegrafes, DateTimePicker1.Value, tmimaMKwd)

        If Not neuEggr Then
            FpaPnl.Controls.Clear()
            PosaPnl.Controls.Clear()
            SPosaPnl.Controls.Clear()
            Sum1Pnl.Controls.Clear()
            Sum2Pnl.Controls.Clear()
            AitiaTbx.Clear()
            Try
                AitiaTbx.Text = Me.DbhotelDataSet.tmimataegrafes(EggrafiCbx.SelectedIndex - 1).aitiologia
            Catch ex As IndexOutOfRangeException

            End Try


            ReDim kiniseis(-1)
            'eggrafiKwd = Me.TmimataegrafesTableAdapter.GetKwdByTmimaImerominiaEggrafi(tmimaMKwd, imeromErgasias, EggrafiCbx.SelectedItem)
            male_posa_kinisis()
        Else
            neuEggr = False
            EggrafiCbx.Items.Clear()
            ReDim kiniseis(-1)
            fuelle_eggrafi_cbox()

            EggrafiCbx.SelectedIndex = Me.DbhotelDataSet.tmimataegrafes.Count
        End If


    End Sub
    'erechne ta synola bei Veraenderung der Werte  
    Private Sub berechne_erneut_synola(ByVal sender As System.Object, ByVal e As System.EventArgs)
        'Dim split As String() = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4).Split(New [Char]() {"_"c})
        Dim fpa As String = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
        Dim diferenz, diferenzKath, fpaKath As Single
        'Dim ss(3) As Single
        Dim index As Int16
        Dim find() As Control
        Try
            'sender.text = Math.Round(CType(sender.text, Single), 2)
            sender.text = Math.Round(CType(sender.text, Single), 2).ToString("N") 'CType(sender.text, Single).ToString("N")
        Catch ex As Exception
            sender.text = "0,00"
        End Try
        index = return_index(fpa)
        'MsgBox(sender.NAME)
        'Allages stin stili posou(ME FPA)
        If sender.NAME.Substring(0, 4).Equals("Poso") AndAlso sender.text <> kiniseis(index).poso Then

            'diferenz = sender.text - kiniseis(index).poso
            'kiniseis(index).poso = sender.text
            'diferenzKath = diferenz / (1 + fpa / 100)
            'fpaKath = diferenz - diferenzKath
            ''Spos deksia
            'find = SPosaPnl.Controls.Find("SPos" + fpa.ToString, False)
            'find(0).Text = (kiniseis(index).sPoso + diferenzKath).ToString("N")
            'kiniseis(index).sPoso = find(0).Text


            diferenz = sender.text - kiniseis(index).poso
            kiniseis(index).poso = sender.text
            diferenzKath = (diferenz / (1 + fpa / 100)).ToString("N")
            fpaKath = diferenz - diferenzKath
            'kiniseis(index).netopos = diferenzKath.ToString("N")
            kiniseis(index).netopos = (kiniseis(index).poso / (1 + fpa / 100)).ToString("N")
            kiniseis(index).fpapos = (kiniseis(index).poso - kiniseis(index).netopos).ToString("N")

            'Spos deksia
            find = SPosaPnl.Controls.Find("SPos" + fpa.ToString, False)
            find(0).Text = (kiniseis(index).sPoso + diferenzKath).ToString("N")
            kiniseis(index).sPoso = find(0).Text
            'deksia
            find = SPosaPnl.Controls.Find("SFpa" + fpa.ToString, False)
            find(0).Text = (kiniseis(index).sFpa + fpaKath).ToString("N")
            kiniseis(index).sFpa = find(0).Text
            'deksia->katw seira athroismatwn
            find = Sum2Pnl.Controls.Find("SSPo", False)
            find(0).Text = (sum(2) + diferenzKath).ToString("N")
            sum(2) = find(0).Text
            'End If
            find = Sum2Pnl.Controls.Find("SSFp", False)
            find(0).Text = (sum(3) + +fpaKath).ToString("N")
            sum(3) = find(0).Text
            'aristera kato seira athroismatwn
            find = Sum1Pnl.Controls.Find("SumP", False)
            find(0).Text = (sum(0) + diferenz).ToString("N")
            sum(0) = find(0).Text
        ElseIf sender.NAME.Substring(0, 4).Equals("Mais") AndAlso sender.text <> kiniseis(index).maizon Then
            diferenz = sender.text - kiniseis(index).maizon
            kiniseis(index).maizon = sender.text
            diferenzKath = diferenz / (1 + fpa / 100)
            kiniseis(index).netomaizon = (kiniseis(index).maizon / (1 + fpa / 100)).ToString("N")
            fpaKath = diferenz - diferenzKath
            kiniseis(index).fpamaizon = (kiniseis(index).maizon - kiniseis(index).netomaizon).ToString("N")
            ' deksia
            find = SPosaPnl.Controls.Find("SMai" + fpa.ToString, False)
            find(0).Text = (kiniseis(index).sMaizon + diferenzKath).ToString("N")
            kiniseis(index).sMaizon = find(0).Text
            'deksia
            find = SPosaPnl.Controls.Find("SMaF" + fpa.ToString, False)
            find(0).Text = (kiniseis(index).sMaizFpa + fpaKath).ToString("N")
            kiniseis(index).sMaizFpa = find(0).Text
            'deksia->katw seira athroismatwn
            find = Sum2Pnl.Controls.Find("SSMz", False)
            find(0).Text = (sum(4) + diferenzKath).ToString("N")
            sum(4) = find(0).Text
            'End If
            find = Sum2Pnl.Controls.Find("SSMF", False)
            find(0).Text = (sum(5) + +fpaKath).ToString("N")
            sum(5) = find(0).Text
            'aristera kato seira athroismatwn
            find = Sum1Pnl.Controls.Find("SumM", False)
            find(0).Text = (sum(1) + diferenz).ToString("N")
            sum(1) = find(0).Text
        End If

    End Sub
    Private Function return_index(ByVal fpa As Single) As Int16
        Dim j As Int16
        For j = 0 To kiniseis.Length - 1
            If kiniseis(j).fpa = fpa Then
                Return j
            End If
        Next
        Return -1
    End Function
    'Private Sub sum_sum(ByRef sum() As Single)
    '    Dim j As Int16

    '    For j = 0 To kiniseis.Length - 1
    '        sum(0) = kiniseis(j).sPoso + sum(0)
    '        sum(1) = kiniseis(j).sFpa + sum(1)
    '        sum(2) = kiniseis(j).sMaizon + sum(2)
    '        sum(3) = kiniseis(j).sMaizFpa + sum(3)
    '    Next
    'End Sub
    'BERECHNET TO SYNOLO TOY POSOU STHN KATW SEIRA -> SYNOLIKA POSA
    Private Function berechne_synolo_synolikoposo() As Single
        Dim j As Int16
        Dim synolo, s As Single
        synolo = 0
        s = 0
        Try
            For j = 0 To eggrafesKwd.Length - 1
                Try
                    s = Me.EggrafitakiniseisTableAdapter.SumPosoByTmimaeggrafi(eggrafesKwd(j))
                    synolo = (synolo + s).ToString("N")
                    'MsgBox(synolo)
                Catch ex As InvalidOperationException

                End Try
            Next
            Return synolo
        Catch ex As NullReferenceException
            Return synolo
        End Try

    End Function
    Private Function berechne_synolo_synolikomaizon() As Single
        Dim j As Int16
        Dim synolo, s As Single
        synolo = 0
        s = 0
        Try
            For j = 0 To eggrafesKwd.Length - 1
                Try
                    s = Me.EggrafitakiniseisTableAdapter.SumMaizByTmimaeggrafi(eggrafesKwd(j))
                    synolo = (synolo + s).ToString
                Catch ex As InvalidOperationException

                End Try
            Next
            Return synolo
        Catch ex As NullReferenceException
            Return synolo
        End Try

    End Function
    'Private Function kriege_ind_von_eggrkin_dataset_by_fpa(ByVal fpa As Single) As Int16
    '    Dim j As Int16
    '    For j = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1
    '        If Me.DbhotelDataSet.eggrafitakiniseis(j).fpa = fpa Then
    '            Return j
    '        End If

    '    Next
    '    Return -1
    'End Function
    Private Sub berechne_sum_sposo_sfpa(ByRef sNeto As Single, ByRef sFpa As Single, ByVal fpa As Single)
        Dim j As Int16

        For j = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1
            If Me.DbhotelDataSet.eggrafitakiniseis(j).fpa = fpa Then
                sNeto = sNeto + Me.DbhotelDataSet.eggrafitakiniseis(j).posoneto
                sFpa = sFpa + Me.DbhotelDataSet.eggrafitakiniseis(j).fpaposo
            End If

        Next


    End Sub
    Private Sub berechne_sum_smaizon_smaizfpa(ByRef sMaizon As Single, ByRef sMaizFpa As Single, ByVal fpa As Single)
        Dim j As Int16

        For j = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1
            If Me.DbhotelDataSet.eggrafitakiniseis(j).fpa = fpa Then
                sMaizon = sMaizon + Me.DbhotelDataSet.eggrafitakiniseis(j).maizonneto
                sMaizFpa = sMaizFpa + Me.DbhotelDataSet.eggrafitakiniseis(j).fpamaizon
            End If

        Next


    End Sub
    Private Function berechne_sum_smaizon(ByVal fpa As Single) As Single
        Dim j As Int16
        Dim synolo, s As Single
        synolo = 0
        s = 0
        Try
            For j = 0 To eggrafesKwd.Length - 1
                Try
                    s = Me.EggrafitakiniseisTableAdapter.SumNetoMaizonByTmimaeggrFpa(eggrafesKwd(j), fpa)
                    synolo = (synolo + s).ToString("N")
                Catch ex As InvalidOperationException

                End Try
            Next
            Return synolo
        Catch ex As NullReferenceException
            Return synolo
        End Try

    End Function
    Private Function get_index_von_dataset(ByVal fpa As Single)
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.eggrafitakiniseis.Count - 1
            If Me.DbhotelDataSet.eggrafitakiniseis(j).tmimataeggrafi = eggrafiKwd AndAlso Me.DbhotelDataSet.eggrafitakiniseis(j).fpa = fpa Then
                Return j
            End If
        Next
        Return -1
    End Function
    Private Function kommt_vor(ByVal nummer As Single, ByVal fpa() As Single) As Boolean
        Dim j As Int16
        Try
            For j = 0 To fpa.Length - 1
                If nummer = fpa(j) Then
                    Return True
                End If
            Next
            Return False
        Catch ex As NullReferenceException
            Return False
        End Try


    End Function


    '**************************GUARANTEE*****************GUARANTEE*************************************GUARANTEE***GUARANTEE************
    Private Sub guarantee_zeig()
        Dim datum1, datum2 As Date
        GuaranteePnl.Controls.Add(Guarant1Pnl)
        GuaranteePnl.Controls.Add(Guarant2Pnl)
        Guarant1Pnl.Size = New Point(761, 95)
        Guarant2Pnl.Size = New Point(761, 265)
        datum1 = "#1/1/" + etos.ToString + "#"
        datum2 = "#31/12/" + etos.ToString + "#"
        Me.GuaranteeTableAdapter.FillByEtos(Me.DbhotelDataSet.guarantee, datum1, datum2)

        EtikLbl.Location = New Point(EtiketaErgHmPnl.Width / 4, 25)
        EtikLbl.Text = "ΚΑΤΑΧΩΡHΣΗ GUARANTEE"

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)


        'ZentralPnl.Controls.Add(GuarantPnl)
        GuaranteePnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        Guarant1Pnl.Location = New Point(5, 5)
        Guarant2Pnl.Location = New Point(5, Guarant1Pnl.Height + 10)
        'Datum2.CustomFormat = " "
        ZentralPnl.Controls.Add(GuaranteePnl)
        GuaranteePnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        GuaranteePnl.Size = New Point(783, ZentralPnl.Height)
        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
    End Sub

    Private Sub guarantee_felder(ByVal minas As String)
        Dim Button2 As New Button
        Dim datum1 As Date
        Dim etos1 As Integer = 2008

        datum1 = "#1/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"



        Dim i, j, k As Int16
        Dim locx, locy, stepx As Int16

        locx = 200
        locy = 60


        stepx = 47
        For i = 0 To 9
            Dim ImeroLbl As New Label
            ImeroLbl.TextAlign = ContentAlignment.MiddleCenter
            ImeroLbl.Size = New Point(30, 30)
            'Me.SplitContainer1.Panel2.Controls.Add(ImeroLbl)
            Guarant2Pnl.Controls.Add(ImeroLbl)
            ImeroLbl.Location = New Point(locx + i * stepx, locy - stepx) '(locx + (i - 1) * stepx, locy)
            If i <> 10 Then
                ImeroLbl.Text = i
            Else
                ImeroLbl.Text = 0
            End If

            ImeroLbl.ForeColor = Color.Blue
            'ImeroLbl.Font.Height0
        Next

        Dim MinasLbl As New Label

        MinasLbl.TextAlign = ContentAlignment.BottomCenter
        MinasLbl.Size = New Point(150, 30)
        MinasPnl.Size = New Point(160, 50)
        MinasPnl.Controls.Add(MinasLbl)
        Me.Guarant2Pnl.Controls.Add(MinasPnl)
        MinasPnl.Location = New Point(1, locy - 40)
        MinasLbl.Text = minas
        'locy = locy + stepx
        MinasLbl.ForeColor = Color.Maroon

        k = MinesCbx.SelectedIndex + 1

        For j = 0 To 3
            Dim DekadLbl As New Label
            DekadLbl.TextAlign = ContentAlignment.MiddleCenter
            DekadLbl.Size = New Point(30, 30)
            Me.Guarant2Pnl.Controls.Add(DekadLbl)

            DekadLbl.Location = New Point(locx - DekadLbl.Width - 10, locy - 10 + j * (stepx - 17)) '(locx + (i - 1) * stepx, locy)
            DekadLbl.Text = j
            DekadLbl.ForeColor = Color.Blue

            For i = 0 To 9
                If (Not j = 3 Or i = 1 Or i = 0) And (Not j = 0 Or Not i = 0) Then
                    If (k = 2 And j = 3 And i = 1) OrElse (k = 2 And j = 3 And i = 0) OrElse (k = 4 And j = 3 And i = 1) _
                    OrElse (k = 6 And j = 3 And i = 1) OrElse (k = 9 And j = 3 And i = 1) OrElse (k = 11 And j = 3 And i = 1) OrElse (System.DateTime.IsLeapYear(etos) = False And k = 2 And j = 2 And i = 9) Then

                        Exit For
                    End If
                    Dim PlithLbl As New Label
                    PlithLbl.TextAlign = ContentAlignment.MiddleCenter
                    PlithLbl.BackColor = Color.DarkKhaki
                    PlithLbl.Name = "PlithLbl" + j.ToString + "_" + i.ToString
                    PlithLbl.Size = New Point(30, 30)
                    Me.Guarant2Pnl.Controls.Add(PlithLbl)
                    PlithLbl.Location = New Point(locx + i * stepx, locy - 10 + j * (stepx - 17))


                    If guarant(j, i).kwdDb <> -1 Then
                        PlithLbl.Text = guarant(j, i).plithosDwm
                    Else
                        PlithLbl.Text = 0
                    End If
                    If PlithLbl.Text <> 0 Then
                        PlithLbl.ForeColor = Color.Red
                    End If
                    AddHandler PlithLbl.TextChanged, AddressOf set_rot_text

                End If

            Next
        Next
        Dim SpeicherButton As New Button
        SpeicherButton.BackColor = Color.Azure
        SpeicherButton.ForeColor = Color.Maroon
        SpeicherButton.Text = "Αποθήκευση"
        SpeicherButton.Size = New Point(140, 30)
        SpeicherButton.Cursor = Cursors.Hand
        'SpeicherButton.Location = New Point(Allotm3Pnl.Width / 2 - 80, locy + ImerLbl.Height + k * (ImerLbl.Height + 10))
        SpeicherButton.Location = New Point(Guarant2Pnl.Width / 2 - 80, locy - 10 + (j + 1) * (stepx - 17))
        Guarant2Pnl.Controls.Add(SpeicherButton)
        AddHandler SpeicherButton.Click, AddressOf guarant_speichern   'MsgBox(allotm(29, 3))

    End Sub
    Private Sub PraktCbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PrktTbx.Enter
        Dim PraktForm As New SimbolaiaFrm()
        Dim kwdikos As Integer
        Dim praktname As String

        'Dim praktKwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres

        PraktForm.StartPosition = FormStartPosition.CenterParent
        PraktForm.ShowDialog()
        kwdikos = PraktForm.return_praktoreio_kwdikos
        'praktKwd = PraktForm.return_praktoreio_kwdikos
        If kwdikos = Nothing Then
            MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If praktKwd = Nothing Then
                PrktTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
                Exit Sub
            End If
        Else
            Guarant2Pnl.Controls.Clear()
            praktKwd = kwdikos
        End If
        praktname = PraktForm.return_praktoreio
        If praktname = Nothing Then
            PrktTbx.Text = sender.text
        Else
            PrktTbx.Text = praktname
        End If
        'PraktTbx.Text = PraktForm.return_praktoreio

        PraktForm.Dispose()
        MinesCbx.Focus()
        MinesCbx.SelectedIndex = -1
        clear_felder()
    End Sub
    Private Sub lade_guarantee_von_db()
        'Dim find() As Control
        Dim datum1, datum2 As Date
        Dim i, dekada, monada As Int16
        Dim day As Integer
        datum1 = "#1/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"

        day = System.DateTime.DaysInMonth(etos, (MinesCbx.SelectedIndex + 1))
        datum2 = "#" + day.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"

        Me.GuaranteeTableAdapter.FillByPraktoreioMinas(Me.DbhotelDataSet.guarantee, datum1, datum2, praktKwd)

        For i = 0 To Me.DbhotelDataSet.guarantee.Count - 1
            day = Me.DbhotelDataSet.guarantee(i).imerominia.Date.Day
            If day.ToString.Length = 2 Then
                Try
                    dekada = CType(day.ToString.Substring(0, 1), Int16)
                    monada = CType(day.ToString.Substring(1, 1), Int16)
                Catch ex As InvalidCastException

                End Try
            ElseIf day.ToString.Length = 1 Then
                dekada = 0
                monada = CType(day.ToString.Substring(0, 1), Int16)
            End If
            guarant(dekada, monada).kwdDb = Me.DbhotelDataSet.guarantee(i).kwd
            guarant(dekada, monada).plithosDwm = Me.DbhotelDataSet.guarantee(i).dwmatia
            guarant(dekada, monada).timi = Me.DbhotelDataSet.guarantee(i).timi
            'MsgBox(guarant(dekada, monada).timi)
            'find = Guarant2Pnl.Controls.Find("PlithLbl" + dekada.ToString + "_" + monada.ToString, False)
            'Try
            '    find(0).Text = Me.DbhotelDataSet.guarantee(i).dwmatia
            'Catch ex As IndexOutOfRangeException

            'End Try
        Next
    End Sub
    Private Sub guarant_speichern(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim i, j As Int16
        Dim datum As Date

        For i = 0 To 3
            For j = 0 To 9

                If guarant(i, j).kwdDb = -1 Then
                    If guarant(i, j).plithosDwm <> 0 Then
                        If i <> 0 Then
                            datum = "#" + i.ToString + j.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"
                        Else
                            datum = "#" + j.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"
                        End If
                        Me.GuaranteeTableAdapter.InsertGuarant(praktKwd, datum, guarant(i, j).plithosDwm, guarant(i, j).timi)
                    End If
                ElseIf guarant(i, j).kwdDb > 0 Then
                    If i <> 0 Then
                        datum = "#" + i.ToString + j.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"
                    Else
                        datum = "#" + j.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"
                    End If
                    If guarant(i, j).plithosDwm <> 0 Then
                        Me.GuaranteeTableAdapter.UpdateGuarant(datum, guarant(i, j).plithosDwm, guarant(i, j).timi, guarant(i, j).kwdDb)
                    Else
                        Me.GuaranteeTableAdapter.DeleteGuarnt(guarant(i, j).kwdDb)
                    End If

                End If
                'guarant(i, j).plithosDwm = 0
                'guarant(i, j).timi = 0
            Next
        Next
        init_guarant()
        clear_felder()
        lade_guarantee_von_db()
        guarantee_felder(MinesCbx.SelectedItem)
        setze_athroismata()
        'ImerTbx.Focus()
    End Sub
    Private Sub MinesCbx_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MinesCbx.SelectedIndexChanged
        If sender.selectedindex <> -1 Then
            If praktKwd <> -1 Then
                init_guarant()
                clear_felder()
                lade_guarantee_von_db()
                guarantee_felder(sender.selecteditem)
                setze_athroismata()
            Else
                MsgBox(" Επιλέξτε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                sender.selectedindex = -1
            End If
        End If
    End Sub
    Private Sub Imera_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ImerTbx.Leave
        Dim datum As Date
        Dim monada, dekada As Int16
        Dim timi As Single = 0

        If MinesCbx.SelectedIndex <> -1 Then
            Try
                datum = "#" + sender.text.ToString + "/" + (MinesCbx.SelectedIndex + 1).ToString + "/" + etos.ToString + "#"
                ImeraLbl.Text = return_imera(datum.DayOfWeek)
            Catch ex As InvalidCastException
                MsgBox("Δώστε Ημέρα (Αριθμό!) του μήνα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                sender.clear()
                Exit Sub
                'sender.focus()
            End Try

            If ImerTbx.Text.Length = 2 Then
                Try
                    dekada = CType(ImerTbx.Text.Substring(0, 1), Int16)
                    monada = CType(ImerTbx.Text.Substring(1, 1), Int16)
                Catch ex As InvalidCastException

                End Try
            ElseIf ImerTbx.Text.Length = 1 Then
                dekada = 0
                monada = CType(ImerTbx.Text.Substring(0, 1), Int16)
            End If
            PlithTbx.Text = Me.GuaranteeTableAdapter.GetPlithosByKwd(guarant(dekada, monada).kwdDb).ToString
            Try
                timi = Me.GuaranteeTableAdapter.GetTimiByKwd(guarant(dekada, monada).kwdDb) 'GetTimiByKwd(guarant(dekada, monada).kwdDb)

                TimiTbx.Text = timi.ToString("F")
            Catch ex As InvalidOperationException
                timi = 0
                TimiTbx.Text = timi.ToString("F")
            End Try

        Else
            MsgBox(" Επιλέξτε Μήνα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            'MinesCbx.Focus()
        End If

    End Sub
    Private Sub Plithos_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PlithTbx.Leave
        Dim find() As Control
        Dim dekada, monada As Int16 '(dekada+monada=Imerominia!!!!


        If ImerTbx.Text.Length = 2 Then
            Try
                dekada = CType(ImerTbx.Text.Substring(0, 1), Int16)
                monada = CType(ImerTbx.Text.Substring(1, 1), Int16)
            Catch ex As InvalidCastException

            End Try
        ElseIf ImerTbx.Text.Length = 1 Then
            dekada = 0
            monada = CType(ImerTbx.Text.Substring(0, 1), Int16)
        End If
        find = Guarant2Pnl.Controls.Find("PlithLbl" + dekada.ToString + "_" + monada.ToString, False)
        Try
            If sender.text >= 0 Then
                Try
                    find(0).Text = sender.text
                Catch ex As IndexOutOfRangeException
                    MsgBox("Δώστε Ημέρα (Αριθμό!) του μήνα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Exit Sub
                End Try

                guarant(dekada, monada).plithosDwm = sender.text
                setze_athroismata()
            End If
            'Catch ex As IndexOutOfRangeException

        Catch ex1 As InvalidCastException
            sender.text = 0
            Try
                find(0).Text = sender.text
            Catch ex As IndexOutOfRangeException

            End Try
            guarant(dekada, monada).plithosDwm = sender.text
            setze_athroismata()
            'MsgBox("Δώστε πλήθος Δωματίων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End Try

    End Sub
    Private Sub TextBox2_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TimiTbx.Leave
        Dim s As Single
        Dim dekada, monada As Int16 '(dekada+monada=Imerominia!!!!


        If ImerTbx.Text.Length = 2 Then
            Try
                dekada = CType(ImerTbx.Text.Substring(0, 1), Int16)
                monada = CType(ImerTbx.Text.Substring(1, 1), Int16)
            Catch ex As InvalidCastException

            End Try
        ElseIf ImerTbx.Text.Length = 1 Then
            dekada = 0
            monada = CType(ImerTbx.Text.Substring(0, 1), Int16)
        End If

        Try
            If Math.Abs(CType(sender.text, Single)) >= 0 Then
                s = Math.Abs(CType(sender.text, Single))
                sender.text = s.ToString("N")
                guarant(dekada, monada).timi = sender.text
                setze_athroismata()
            End If
        Catch ex As InvalidCastException
            s = 0
            sender.text = s.ToString("N")
            guarant(dekada, monada).timi = sender.text
            setze_athroismata()

        End Try

    End Sub
    Private Sub clear_felder()
        Guarant2Pnl.Controls.Clear()
        ImerTbx.Clear()
        PlithTbx.Clear()
        TimiTbx.Clear()
        MinasPnl.Controls.Clear()
        ImeraLbl.Text = ""
        PlithosLbl.Text = ""
        SynoloLbl.Text = ""
    End Sub

    Private Function return_imera(ByVal wochentag As Int16) As String

        Select Case wochentag
            Case 0
                Return "Κυριακή"
            Case 1
                Return "Δευτέρα"
            Case 2
                Return "Τρίτη"
            Case 3
                Return "Τετάρτη"
            Case 4
                Return "Πέμπτη"
            Case 5
                Return "Παρασκευή"
            Case 6
                Return "Σάββατο"
        End Select
        Return Nothing
    End Function
    Private Sub set_rot_text(ByVal sender As System.Object, ByVal e As System.EventArgs)

        Try
            If sender.text > 0 Then
                sender.ForeColor = Color.Red
            Else
                sender.forecolor = Color.Black
            End If
        Catch ex As InvalidCastException
            MsgBox(" Δώστε αριθμό Δωματίων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End Try

    End Sub

    Private Sub init_guarant()
        Dim i, j As Int16

        For i = 0 To 3
            For j = 0 To 9
                guarant(i, j).kwdDb = -1
                guarant(i, j).plithosDwm = 0
                guarant(i, j).timi = 0
            Next
        Next

    End Sub
    Private Sub setze_athroismata()
        Dim i, j As Int16
        Dim plithos As Int16
        Dim synolo As Single
        For i = 0 To 3
            For j = 0 To 9
                If guarant(i, j).plithosDwm <> 0 Then
                    plithos = plithos + guarant(i, j).plithosDwm
                End If
                If guarant(i, j).timi <> 0 Then
                    synolo = synolo + guarant(i, j).timi * guarant(i, j).plithosDwm
                End If
            Next
        Next
        PlithosLbl.Text = plithos
        SynoloLbl.Text = synolo.ToString("N")

    End Sub

    Private Sub ImerTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TimiTbx.Enter, PlithTbx.Enter, ImerTbx.Enter
        sender.Selectall()

    End Sub
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS***
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS***
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS***
    '**************************KRATHSEIS*****************KRATHSEIS*************************************KRATHSEIS***
    Private Sub init_kratiseis_diamenontes(ByVal remalen As Boolean)
        'Etiketa panel initialisieren
        '
        'InputLanguage.CurrentInputLanguage = InputLanguage.FromCulture(languageEN)

        EtiketaErgHmPnl.Location = New Point(5, 5)
        EtiketaErgHmPnl.Size = New Point(ZentralPnl.Width - 20, 60)
        'DateTimePicker2.Enabled = False
        'DateTimePicker2.MinDate = "1/1/" + etos.ToString
        'DateTimePicker2.MaxDate = "31/12/" + etos.ToString
        'DateTimePicker3.MinDate = "1/1/" + etos.ToString
        'DateTimePicker3.MaxDate = "31/12/" + etos.ToString
        ImeromKratTbx.Text = imeromErgasias.Date

        Kratiseis1Pnl.Location = New Point(5, EtiketaErgHmPnl.Height)
        Kratiseis2Pnl.Location = New Point(Kratiseis1Pnl.Width + 10, EtiketaErgHmPnl.Height)

        Kratiseis3Pnl.Location = New Point(5, Kratiseis1Pnl.Location.Y + Kratiseis1Pnl.Height + 5)

        Kratiseis4Pnl.Location = New Point(Kratiseis1Pnl.Location.X, Kratiseis1Pnl.Location.Y + Kratiseis1Pnl.Height + Kratiseis3Pnl.Height + 10)

        NonShowLbl.Text = ""
        SynolPnl.Location = New Point(Kratiseis4Pnl.Location.X + Kratiseis4Pnl.Width - SynolPnl.Width, Kratiseis4Pnl.Location.Y + Kratiseis4Pnl.Height + 5)

        If remalen AndAlso Me.DbhotelDataSet.kratiseis.Count <> 0 AndAlso kwdikoKratisisDB <> -1 Then
            isDBEintrag = True
            remale_kratisi()
        Else
            SimbCbx.Items.Clear()
            SimbLbl.Text = ""
            repeaterLbl.Text = ""
            kwdikoKratisisDB = -1
            sesionID = get_sesion()
            init_ekptoseis()
            praktoreiokwd = -1
            praktoreiokwdValue = -1
            currentsimbolaio = -1
            'currentsimbolaioValue = -1
            isDBEintrag = False
            init_felder()
            KratisiTbx.Text = "ΝΕΑ"

        End If

        EtiketaErgHmPnl.Controls.Add(EtikLbl)
        ZentralPnl.Controls.Add(EtiketaErgHmPnl)
        ZentralPnl.Controls.Add(Kratiseis1Pnl)
        ZentralPnl.Controls.Add(Kratiseis2Pnl)
        ZentralPnl.Controls.Add(Kratiseis3Pnl)
        ZentralPnl.Controls.Add(Kratiseis4Pnl)
        ZentralPnl.Controls.Add(SynolPnl)
        Me.SplitContainer1.Panel2.Controls.Add(ZentralPnl)
    End Sub
    Private Sub kratiseis_zeig(ByVal remalen As Boolean)
        If remalen AndAlso Me.DbhotelDataSet.kratiseis.Count <> 0 AndAlso kwdikoKratisisDB <> -1 Then
            isDBEintrag = True
            remale_kratisi()
            onomChangeOK = False
            'MsgBox("onomChangeOK")
        Else
            kwdikoKratisisDB = -1
            sesionID = get_sesion()
            init_ekptoseis()
            'EDW ALAKSA ->O USER DEN PREPEI GIA NEO EINTRAG NA KSANADWSEI EK NEOY PRAKTOREIO(BLEPE MANIKI)  
            'praktoreiokwd = -1
            'currentsimbolaio = -1
            isDBEintrag = False
            init_felder()
            If status = 1 Then
                KratisiTbx.Text = "ΝΕΑ"
            Else
                KratisiTbx.Text = "Αρ.Κρ."
            End If

        End If
    End Sub
    Private Sub init_felder()


        Kratiseis4Pnl.Controls.Clear()
        ButtonsPnl.Controls.Clear()
        SynolLbl.Text = "0,00"
        EtikLbl.Location = New Point(5, 25)
        If status = 1 Then
            EtikLbl.Text = "ΚΡΑΤΗΣΕΙΣ-ΑΦΙΞΕΙΣ ΕΙΣΑΓΩΓΗ ΝΕΑΣ ΚΡΑΤΗΣΗΣ-ΑΦΙΞΗΣ"
        Else
            EtikLbl.Text = "                     ΕΠΕΞΕΡΓΑΣΙΑ ΔΙΑΜΕΝΟΝΤΩΝ             "
        End If
        'KratisiTbx.Text =
        ImeromKratTbx.Text = imeromErgasias
        If status = 1 Then
            Kratiseis2Pnl.Enabled = True
            Kratiseis3Pnl.Enabled = True
            If praktoreiokwd = -1 Then
                PraktTbx.Text = "<Κάνετε κλίκ εδώ>"
                PraktTimolTbx.Text = "<Κάνετε κλίκ εδώ>"
                KwdPraktTbx1.Clear()
                KwdPraktTbx2.Clear()
            End If
            'EDW ALAKSA ->O USER DEN PREPEI GIA NEO EINTRAG NA KSANADWSEI EK NEOY PRAKTOREIO(BLEPE MANIKI) 
            'KwdPraktTbx1.Clear()
            'KwdPraktTbx2.Clear()
        ElseIf status = 2 Then
            PraktTbx.Clear()
            PraktTimolTbx.Clear()
            KwdPraktTbx1.Clear()
            KwdPraktTbx2.Clear()
            Kratiseis2Pnl.Enabled = False
            Kratiseis3Pnl.Enabled = False
        End If
        'EDW ALAKSA ->O USER DEN PREPEI GIA NEO EINTRAG NA KSANADWSEI EK NEOY PRAKTOREIO(BLEPE MANIKI) 
        'PraktTbx.Text = "<Κάνετε κλίκ εδώ>"
        'PraktTimolTbx.Text = "<Κάνετε κλίκ εδώ>"
        VoucherTbx.Clear()
        DateTimePicker2.CustomFormat = " dd/MM/yy  -  H:mm "
        DateTimePicker3.CustomFormat = " dd/MM/yy  " ' " dd/MM/yy  -  H:mm "
        DateTimePicker2.MinDate = "1/1/" + etos.ToString


        If status = 1 Then
            If imeromErgasias <= currentAfixi Then
                DateTimePicker2.Value = currentAfixi
                DateTimePicker3.Value = currentAnaxwrisi
            Else
                DateTimePicker2.Value = imeromErgasias
                DateTimePicker3.Value = imeromErgasias.AddDays(7)
            End If

        ElseIf status = 2 Then
            DateTimePicker2.Value = imeromErgasias
            currentAfixi = DateTimePicker2.Value.Date
            DateTimePicker3.Value = DateTimePicker2.Value.Date.AddDays(7) ' DateTimePicker3.MaxDate 
            currentAnaxwrisi = DateTimePicker3.Value.Date
        End If

        PliromiCbx.SelectedIndex = 0

        If KlinesCbx.Items.Count = 0 OrElse TipiCbx.Items.Count = 0 Then
            init_klines_tipoi_cboxen()
        End If
        KlinesCbx.SelectedIndex = -1
        currentklines = 0 'alaksa -1->0
        TipiCbx.SelectedIndex = -1
        currenttipos = 0 'alaksa -1->0

        DwmTbx.Clear()
        If SimbCbx.Items.Count <> 0 Then
            SimbCbx.SelectedIndex = -1
        Else
            SimbCbx.Items.Add("<A/A Συμβoλαίου>")
            SimbCbx.SelectedIndex = 0
        End If

        'SimbCbx.Items.Clear()

        EnilikTbx.Text = 0
        PaidiaTbx.Text = 0
        OnomTbx1.Clear()
        OnomTbx2.Clear()
        OnomTbx3.Clear()
        CotTbx1.Clear()
        CotTbx2.Clear()
        CotTbx3.Clear()
        PaidiTbx1.Text = 0
        PaidiTbx2.Text = 0
        PaidiTbx3.Text = 0
        EthnAnzTbx1.Text = 0
        EthnAnzTbx2.Text = 0
        EthnikTbx1.Clear()
        EthnikTbx2.Clear()
        EthnKwd1.Text = 0
        kwdEthnik1.Clear()
        EthnKwd2.Text = 0
        kwdEthnik2.Clear()
        TilefTbx.Clear()
        EpithimTbx.Clear()
        SimetTbx.Text = "0"
        ProkatTbx.Text = "0,00"
        DateTimePicker4.Value = imeromErgasias
        DateTimePicker5.Value = imeromErgasias
        heatChk.Checked = False
        optionChk.Checked = False
        blinkLbl.Text = ""
        myTimer.Stop()
    End Sub
    Private Sub remale_kratisi()
        Dim j As Int16
        Dim find() As Control
        Dim index As Int16
        Dim simbolAA As Int16
        Dim ekptosiPoso As Single

        'MsgBox(System.Threading.Thread.CurrentThread.CurrentCulture.ToString)

        'EtikLbl.Text = "ΚΡΑΤΗΣΕΙΣ ΑΦΙΞΕΙΣ ΕΠΕΞΕΡΓΑΣΙΑ ΚΡΑΤΗΣΗΣ-ΑΦΙΞΗΣ"
        PraktTbx.Text = get_praktoreio_by_kwdiko(Me.DbhotelDataSet.kratiseis(0).praktoreio)
        KwdPraktTbx1.Text = Me.DbhotelDataSet.kratiseis(0).praktoreio
        PraktTimolTbx.Text = get_praktoreio_by_kwdiko(Me.DbhotelDataSet.kratiseis(0).praktimologio)
        KwdPraktTbx2.Text = Me.DbhotelDataSet.kratiseis(0).praktimologio
        VoucherTbx.Text = Me.DbhotelDataSet.kratiseis(0).voucher
        ImeromKratTbx.Text = Me.DbhotelDataSet.kratiseis(0).imeromkratisis
        '   MsgBox(DateTimePicker2.MinDate.ToString)
        Try
            DateTimePicker2.Value = New DateTime(Me.DbhotelDataSet.kratiseis(0).afixi.Year, Me.DbhotelDataSet.kratiseis(0).afixi.Month,
                  Me.DbhotelDataSet.kratiseis(0).afixi.Day, Me.DbhotelDataSet.kratiseis(0).wra.Hour.ToString, Me.DbhotelDataSet.kratiseis(0).wra.Minute.ToString, 0)
        Catch ex As ArgumentOutOfRangeException
            DateTimePicker2.MinDate = Me.DbhotelDataSet.kratiseis(0).afixi
            DateTimePicker2.Value = Me.DbhotelDataSet.kratiseis(0).afixi
        End Try

        'DateTimePicker2.Value = Me.DbhotelDataSet.kratiseis(0).afixi
        'DateTimePicker2.Value = Ctype(Me.DbhotelDataSet.kratiseis(0).wra,Date).TimeOfDay)
        currentAfixi = DateTimePicker2.Value.Date
        DateTimePicker3.Value = Me.DbhotelDataSet.kratiseis(0).anaxwrisi
        currentAnaxwrisi = DateTimePicker3.Value.Date

        praktoreiokwd = Me.DbhotelDataSet.kratiseis(0).praktoreio
        praktortimolkwd = Me.DbhotelDataSet.kratiseis(0).praktimologio
        DwmTbx.Text = Me.DbhotelDataSet.kratiseis(0).dwmatio

        SimbCbx.Items.Clear()
        If isDBEintrag Then     'EDW ALAKSA ->O USER DEN PREPEI GIA NEO EINTRAG NA KSANADWSEI EK NEOY PRAKTOREIO(BLEPE MANIKI->synexomena to idio prakt gia neue Eintraege) 
            Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, DateTimePicker2.Value.AddDays(-1).Year) 'DateTimePicker3.Value.Date.Year
            fuehle_simbol_cboxen()

            'simbolAA = Me.SimbolaiaTableAdapter.GetAAByKwd(Me.DbhotelDataSet.kratiseis(0).simbolaio)
            simbolAA = Me.get_aa_simbolaiou_by_kwd(Me.DbhotelDataSet.kratiseis(0).simbolaio)
            If simbolAA <> -1 Then
                index = get_index_simbolaio_cbox(simbolAA)
                SimbCbx.SelectedIndex = index
            Else
                SimbCbx.SelectedIndex = -1
            End If

        End If



        If KlinesCbx.Items.Count = 0 OrElse TipiCbx.Items.Count = 0 Then
            init_klines_tipoi_cboxen()
        End If
        'MsgBox(Me.DbhotelDataSet.kratiseis(0).klines)
        'MsgBox(currenttipos)
        'MsgBox(currentklines)
        currenttipos = Me.DbhotelDataSet.kratiseis(0).tipos
        currentklines = Me.DbhotelDataSet.kratiseis(0).klines
        index = get_index_klines(Me.DbhotelDataSet.kratiseis(0).klines)
        KlinesCbx.SelectedIndex = index + 1
        index = get_index_tipos(Me.DbhotelDataSet.kratiseis(0).tipos)
        TipiCbx.SelectedIndex = index + 1
        'isDBEintrag = False
        optionChk.Checked = Me.DbhotelDataSet.kratiseis(0).guarantie
        heatChk.Checked = Me.DbhotelDataSet.kratiseis(0).allagesdwmatiwn
        EnilikTbx.Text = Me.DbhotelDataSet.kratiseis(0).enilikes
        PaidiaTbx.Text = Me.DbhotelDataSet.kratiseis(0).paidia
        Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikoKratisisDB) 'laden toys enilikes sortiert nach DB kwdiko toys-> Gia metepeita Update!!!!!
        Dim countEnilikes As Int16
        OnomTbx1.Clear()
        OnomTbx2.Clear()
        OnomTbx3.Clear()
        If Me.DbhotelDataSet.enilikes.Count > 3 Then 'giati stin forma exw mono 3 felder gia onomata enilikwn
            countEnilikes = 3
        Else
            countEnilikes = Me.DbhotelDataSet.enilikes.Count
        End If
        For j = 0 To countEnilikes - 1
            find = Kratiseis2Pnl.Controls.Find("OnomTbx" + (j + 1).ToString, False)
            find(0).Text = Me.DbhotelDataSet.enilikes(j).onomateponimo
        Next

        Me.PaidiaTableAdapter.FillByKratisi(Me.DbhotelDataSet.paidia, kwdikoKratisisDB)
        Dim countPaidia As Int16
        CotTbx1.Clear()
        CotTbx2.Clear()
        CotTbx3.Clear()
        PaidiTbx1.Text = 0
        PaidiTbx2.Text = 0
        PaidiTbx3.Text = 0
        If Me.DbhotelDataSet.paidia.Count > 3 Then 'giati stin forma exw mono 3 felder gia onomata PAIDIWN
            countPaidia = 3
        Else
            countPaidia = Me.DbhotelDataSet.paidia.Count
        End If
        For j = 0 To countPaidia - 1
            find = Kratiseis2Pnl.Controls.Find("PaidiTbx" + (j + 1).ToString, False)
            find(0).Text = Me.DbhotelDataSet.paidia(j).ilikia
            find = Kratiseis2Pnl.Controls.Find("CotTbx" + (j + 1).ToString, False)
            find(0).Text = Me.DbhotelDataSet.paidia(j).cot
        Next

        'Ethnikotites
        EthnAnzTbx1.Text = Me.DbhotelDataSet.kratiseis(0).anzethnikotites
        Try
            'MsgBox(Me.DbhotelDataSet.kratiseis(0).ethnikotites)
            EthnKwd1.Text = Me.DbhotelDataSet.kratiseis(0).ethnikotites
            kwdEthnik1.Text = Me.DbhotelDataSet.kratiseis(0).ethnikotites
            EthnikTbx1.Text = get_ethikotita_by_kwdiko(Me.DbhotelDataSet.kratiseis(0).ethnikotites)
        Catch ex As StrongTypingException
            EthnikTbx1.Clear()
        End Try
        EthnAnzTbx2.Text = Me.DbhotelDataSet.kratiseis(0).anzethnikotites2
        Try
            EthnKwd2.Text = Me.DbhotelDataSet.kratiseis(0).ethnikotites2
            kwdEthnik2.Text = Me.DbhotelDataSet.kratiseis(0).ethnikotites2
            EthnikTbx2.Text = get_ethikotita_by_kwdiko(Me.DbhotelDataSet.kratiseis(0).ethnikotites2)
        Catch ex As StrongTypingException
            EthnikTbx2.Clear()
        End Try

        TilefTbx.Text = Me.DbhotelDataSet.kratiseis(0).tilefonomem
        DateTimePicker4.Value = Me.DbhotelDataSet.kratiseis(0).epithimdate
        EpithimTbx.Text = Me.DbhotelDataSet.kratiseis(0).epithimia
        SimetTbx.Text = Me.DbhotelDataSet.kratiseis(0).simetoxi
        ProkatTbx.Text = Me.DbhotelDataSet.kratiseis(0).prokataboli.ToString("F")
        If status = 1 AndAlso Me.DbhotelDataSet.kratiseis(0).prokataboli = 0 Then
            If imeromErgasias.DayOfYear - Me.DbhotelDataSet.kratiseis(0).imeromkratisis.DayOfYear > 0 AndAlso (imeromErgasias.DayOfYear - Me.DbhotelDataSet.kratiseis(0).imeromkratisis.DayOfYear) > Me.DbhotelDataSet.etaireia(0).timolkwd Then
                myTimer.Interval = 1000 '500 milliseconds = 1/2 a second. 
                myTimer.Start()
            Else
                myTimer.Stop()
            End If
        Else
            myTimer.Stop()
        End If




        DateTimePicker5.Value = Me.DbhotelDataSet.kratiseis(0).prokatdate
        PliromiCbx.SelectedIndex = Me.get_index_von_pliromicbox(Me.DbhotelDataSet.kratiseis(0).pliromi)


        'If Me.DbhotelDataSet.touristperiodoi.Count = 0 Then
        Me.TouristperiodoiTableAdapter.FillBySimbAnaxwrisiAfixi(Me.DbhotelDataSet.touristperiodoi, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date,
                          currentsimbolaio, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date)
        'End If
        'MsgBox(Me.DbhotelDataSet.touristperiodoi.Count)
        If status = 1 Then
            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
        Else
            Me.TimeskratisisTableAdapter.FillByKratisi(Me.DbhotelDataSet.timeskratisis, kwdikoKratisisDB)
            male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
        End If


        If Me.DbhotelDataSet.kratiseis(0).ekptosi Then
            ekptosiPoso = rechne_ekptosi_vom_synola(Me.DbhotelDataSet.kratiseis(0).synolo, Me.DbhotelDataSet.kratiseis(0).ekptposo, Me.DbhotelDataSet.kratiseis(0).ekptpososto, Me.DbhotelDataSet.kratiseis(0).ekptimeres, Me.DbhotelDataSet.kratiseis(0).fee)
            EkptosiLbl.Text = "Έκπτωση: " + ekptosiPoso.ToString("N")
        Else
            EkptosiLbl.Text = ""
        End If

        SynolLbl.Text = Me.DbhotelDataSet.kratiseis(0).synolo.ToString("N")
        'firstLoadDBEintrag = False
    End Sub
    Private Sub myTimer_Tick(ByVal sender As Object, ByVal e As System.EventArgs) Handles myTimer.Tick

        'Static labelText As String = Label1.Text
        showLblText = Not showLblText

        If showLblText = True Then
            blinkLbl.Text = "NOT " + ChrW(13) + " CONFIRMED!"
        Else
            blinkLbl.Text = String.Empty
        End If

    End Sub
    Private Sub init_klines_tipoi_cboxen()
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.klines.Count
            If j <> 0 Then
                KlinesCbx.Items.Add(Me.DbhotelDataSet.klines(j - 1).perigrafi)
            Else
                KlinesCbx.Items.Add("Όλες")
            End If
        Next


        For j = 0 To Me.DbhotelDataSet.tipoi.Count
            If j <> 0 Then
                TipiCbx.Items.Add(Me.DbhotelDataSet.tipoi(j - 1).tipos)
            Else
                '   TipiCbx.Items.Add("Όλοι")
                TipiCbx.Items.Add("Xenod")
            End If
        Next
    End Sub
    Private Sub PraktTbx_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktTbx.Enter
        Dim PraktForm As New SimbolaiaFrm()
        Dim kwdikos, xrewsikwdikos As Integer
        Dim praktname As String
        'MsgBox(sender.backcolor)
        'Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio As Integer ' apoimeres
        If status = 1 Or status = 2 And isDBEintrag Then

            PraktForm.StartPosition = FormStartPosition.CenterParent
            PraktForm.ShowDialog()
            kwdikos = PraktForm.return_praktoreio_kwdikos
            xrewsikwdikos = PraktForm.return_praktoreio_xrewsi
            'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
            If kwdikos = Nothing Then
                MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                If praktoreiokwd = Nothing Then
                    PraktTbx.Text = "< Κάνετε απλό κλίκ εδώ πάνω >"
                    VoucherTbx.Focus()
                    Exit Sub
                End If
            Else
                Kratiseis4Pnl.Controls.Clear()
                ButtonsPnl.Controls.Clear()
                If status = 2 AndAlso kwdikos <> praktoreiokwd Then 'diamewntes allagi Praktoreiou kata'AndAlso currentAfixi < imeromErgasias
                    'thn diarkeia diamonis (oxi 1 mera)->touristperios stis timeskratiseis DB pairnei -1 
                    MsgBox(" Με την Αλλαγή του Πρακτορείου πρέπει να ελεχθούν ξανά οι τιμές !", MsgBoxStyle.Information, "winfo\nikEl.")
                    praktoreiokwdValue = kwdikos ' se autin tin periptwsi 
                Else
                    praktoreiokwd = kwdikos
                End If

                If xrewsikwdikos = 0 Then
                    praktXrewsKwd = -1
                Else
                    praktXrewsKwd = xrewsikwdikos
                End If
                KwdPraktTbx1.Text = kwdikos
                KwdPraktTbx2.Text = kwdikos
                praktortimolkwd = kwdikos
                currentsimbolaio = -1
                'currentsimbolaioValue = -1
                If KlinesCbx.Items.Count = 0 OrElse TipiCbx.Items.Count = 0 Then
                    init_klines_tipoi_cboxen()
                Else
                    KlinesCbx.SelectedIndex = -1
                    TipiCbx.SelectedIndex = -1
                End If
                SimbCbx.Items.Clear()
                Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, etos)
                'If etos <> DateTimePicker3.Value.AddDays(-1).Year Then
                '    Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, DateTimePicker3.Value.AddDays(-1).Year)
                'Else
                '    Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, etos)
                'End If


                fuehle_simbol_cboxen()
                ReDim timokatalog(-1)
            End If
            ' edw kanw herauskriegen ola ta simbolaia tou praktoreiou gia to etos
            currenttipos = 0
            currentklines = 0
            praktname = PraktForm.return_praktoreio
            If praktname = Nothing Then
                PraktTbx.Text = sender.text
            Else
                PraktTbx.Text = praktname
            End If
            'PraktTbx.Text = PraktForm.return_praktoreio
            If praktoreiokwd = praktortimolkwd Then
                PraktTimolTbx.Text = PraktTbx.Text
            End If

            PraktForm.Dispose()

            If isDBEintrag Then
                Me.TouristperiodoiTableAdapter.FillBySimbAnaxwrisiAfixi(Me.DbhotelDataSet.touristperiodoi, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date,
                               currentsimbolaio, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date)

            End If

            VoucherTbx.Focus()
            If SimbCbx.Items.Count <> 0 Then
                SimbCbx.SelectedIndex = 0
            End If
        Else
            MsgBox("Δεν επιλέχθηκε Διαμένων: Πατήστε τον φακό για επιλογή απο Λίστα ή εισάγετε τον Αρ.Κράτησης στο αντίστοιχο πεδίο και μετά πατήστε τον φακό!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If

    End Sub
    Private Sub PraktTimologioTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PraktTimolTbx.Click
        Dim PraktForm As New SimbolaiaFrm()

        If status = 1 Or status = 2 And isDBEintrag Then
            PraktForm.StartPosition = FormStartPosition.CenterParent
            PraktForm.ShowDialog()
            praktortimolkwd = PraktForm.return_praktoreio_kwdikos

            If praktortimolkwd = Nothing Then
                MsgBox("Δεν επιλέχθηκε Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                PraktTimolTbx.Text = PraktTbx.Text
                praktortimolkwd = praktoreiokwd
                Exit Sub
            End If
            'Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, etos)
            PraktTimolTbx.Text = PraktForm.return_praktoreio
            KwdPraktTbx2.Text = PraktForm.return_praktoreio_kwdikos
            PraktForm.Dispose()
        End If
    End Sub
    Private Sub DateTimePicker2_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DateTimePicker2.Enter

        ButtonsPnl.Enabled = False
        Kratiseis4Pnl.Enabled = False
        'DateTimePicker2.MaxDate = "31/12/" + etos.ToString
        'DateTimePicker2.Value = imeromErgasias 
    End Sub
    Private Sub tes(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DateTimePicker2.Leave, DateTimePicker3.Leave ', DateTimePicker4.ValueChanged
        'If sender.value > "31/12/" + etos.ToString OrElse sender.value < "1/1/" + etos.ToString Then
        '    'MsgBox("Λάθος Ημερομηνία !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '    If sender.name = "DateTimePicker2" Then
        '        sender.value = currentAfixi
        '    ElseIf sender.name = "DateTimePicker3" Then
        '        sender.value = currentAnaxwrisi
        '    Else
        '        sender.value = currentAfixi
        '    End If
        'End If

        If sender.value > "31/12/" + etos.ToString Then ' OrElse sender.value < "1/1/" + etos.ToString 
            Me.SimbolaiaTableAdapter.FillByEtos(Me.DbhotelDataSet.simbolaia, DateTimePicker3.Value.Year)
            fuehle_simbol_cboxen()
        End If
        If sender.name = "DateTimePicker2" Then
            currentAfixi = sender.value
            'MsgBox(currentAnaxwrisi)
            If status = 1 AndAlso Me.DbhotelDataSet.kratiseis.Count = 0 AndAlso currentAfixi > currentAnaxwrisi Then
                DateTimePicker3.Value = currentAfixi.AddDays(1)
            End If
        ElseIf sender.name = "DateTimePicker3" Then
            currentAnaxwrisi = sender.value ' = 
        Else
            currentAfixi = sender.value ' = 
        End If
    End Sub

    Private Function DateTimePicker2_change() As Boolean 'ByVal sender As System.Object, ByVal e As System.EventArgsHandles DateTimePicker2.Leave
        'Dim index As Int16

        If DateTimePicker2.Value.Date < imeromErgasias.Date And status = 1 Then
            MsgBox("Αφιξη προγενέστερα της τρέχουσας Ημερομηνίας Εργασίας !", MsgBoxStyle.Critical, "winfo\nikEl.")
            'DateTimePicker2.Value = currentAfixi
            Kratiseis4Pnl.Enabled = True
            Return False
        End If
        ButtonsPnl.Enabled = True
        Kratiseis4Pnl.Enabled = True

        Return DateTimePicker2_Validating()

    End Function

    Private Function DateTimePicker2_Validating() As Boolean '(ByVal sender As Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles DateTimePicker2.Validating
        'Dim count, j As Int16
        'Dim pnl(), find() As Object
        'DateTimePicker2.MaxDate = "31/12/" + etos.ToString
        If DateTimePicker2.Value.Date <> currentAfixi Then


            If DateTimePicker2.Value.Date >= DateTimePicker3.Value.Date Then
                MsgBox("Άφιξη μεταγενέσταρα της Αναχώρισης !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Kratiseis4Pnl.Controls.Clear()
                ButtonsPnl.Controls.Clear()
                DateTimePicker2.Value = currentAfixi
                Return False
            Else
                If currentsimbolaio > 0 Then
                    Dim arxiTourPer, lixiTourPer As Date

                    lixiTourPer = Me.TouristperiodoiTableAdapter.GetLixiToyrPeriodBySimb(currentsimbolaio)
                    If DateTimePicker3.Value.Date > lixiTourPer.AddDays(1) Then
                        MsgBox("Η Αναχώριση είναι αργότερα απο την τελευταία Τουριστική Περίοδο (" + lixiTourPer + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If
                    arxiTourPer = Me.TouristperiodoiTableAdapter.GetArxiTourPeriodBySimbolaikwd(currentsimbolaio)
                    If DateTimePicker2.Value.Date < arxiTourPer Then
                        MsgBox("Η Άφιξη είναι νωρίτερα απο την πρώτη Τουριστική Περίοδο (" + arxiTourPer + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If
                End If
            End If
        End If
        currentAfixi = DateTimePicker2.Value.Date
        Return True
    End Function
    Private Sub DateTimePicker3_enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DateTimePicker3.Enter
        'TimesBtn.Enabled = False
        ButtonsPnl.Enabled = False
        Kratiseis4Pnl.Enabled = False
    End Sub
    Private Function DateTimePicker3_ValueChanged() As Boolean 'ByVal sender As System.Object, ByVal e As System.EventArgs Handles DateTimePicker3.Leave
        'Dim index, count As Int16

        If DateTimePicker3.Value.Date <= currentAfixi Then
            MsgBox("Αναχώριση προγεγενέστερα της Αφιξης !", MsgBoxStyle.Critical, "winfo\nikEl.")

            DateTimePicker3.Value = currentAnaxwrisi
            Kratiseis4Pnl.Enabled = True
            ButtonsPnl.Enabled = True
            Return False
        End If

        If status = 2 Then
            If DateTimePicker3.Value < imeromErgasias.Date Then
                MsgBox("Αναχώρηση προγενέστερα της τρέχουσας Ημερομηνίας Εργασίας !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Return False
            Else
                anaxSperre = False
            End If
        End If

        ButtonsPnl.Enabled = True
        Kratiseis4Pnl.Enabled = True

        Return DateTimePicker3_Validating()
    End Function

    Private Function DateTimePicker3_Validating() As Boolean ' Handles DateTimePicker3.Validating

        If DateTimePicker3.Value.Date <> currentAnaxwrisi Then 'kanw to TextChanged simulieren!!!!
            If (status = 2 And DateTimePicker3.Value.Date <= currentAfixi) Or (status = 2 And DateTimePicker3.Value.Date < imeromErgasias.Date) Or anaxSperre Then
                Return False
            End If
            If DateTimePicker3.Value.Date <= DateTimePicker2.Value.Date Then
                MsgBox("Αναχώριση προγεγενέστερα της Αφιξης !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Kratiseis4Pnl.Controls.Clear()
                ButtonsPnl.Controls.Clear()
                TimesBtn.Enabled = False
                Return False
            Else
                If currentsimbolaio > 0 Then
                    Dim arxiTourPer, lixiTourPer As Date

                    lixiTourPer = Me.TouristperiodoiTableAdapter.GetLixiToyrPeriodBySimb(currentsimbolaio)
                    If DateTimePicker3.Value.Date > lixiTourPer.AddDays(1) Then
                        MsgBox("Η Αναχώριση είναι αργότερα απο την τελευταία Τουριστική Περίοδο (" + lixiTourPer + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If
                    arxiTourPer = Me.TouristperiodoiTableAdapter.GetArxiTourPeriodBySimbolaikwd(currentsimbolaio)
                    If DateTimePicker2.Value.Date < arxiTourPer Then
                        MsgBox("Η Άφιξη είναι νωρίτερα απο την πρώτη Τουριστική Περίοδο (" + arxiTourPer + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return False
                    End If
                End If
            End If

        End If
        currentAnaxwrisi = DateTimePicker3.Value.Date
        Return True
    End Function
    ' o elegxos timwn to kana recht spaet(->Oktombrios 2009!)->ousiastika alaksa ta datetimepicker wste na MIN kanoun handlen .leave kai .validating
    'giati eixa problimata-> o elegxos timwn epanaupologizzei tis times sta panel twn timwn (kai se peptwsi pou o User 'paiksei' me imerominies
    'afoxis-Anazwrisis (->komplex da imerespliromis alazoun)
    Private Sub elegxos_timwn()
        Dim count, j As Int16 'index,
        Dim pnl(), find() As Object
        count = Me.DbhotelDataSet.touristperiodoi.Count - 1
        If isDBEintrag AndAlso count >= 0 Then
            'count>0 simainei oti uparxoun touristikoi periodoi uberhaupt
            'ean tourist periodoi>= apo times kratisis.count->se periptwsi apothikeumenis ktratisis h diamenwntes pou Alazw tin diamoni (anaxwrisi)
            'se nea touristiki periodo  
            Dim e As System.EventArgs = Nothing
            If flagKr = 1 Then
                For j = 0 To Me.DbhotelDataSet.touristperiodoi.Count - 1
                    pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + Me.DbhotelDataSet.touristperiodoi(j).kwd.ToString, False)

                    Try
                        find = pnl(0).Controls.Find("Hme1" + Me.DbhotelDataSet.touristperiodoi(j).kwd.ToString, False)
                        imeres_leave(find(0), e)
                    Catch ex As IndexOutOfRangeException
                        MsgBox("ΠΡΟΣΟΧΗ: Πρέπει να ελεχθούν οι τιμές ξανά !", MsgBoxStyle.Exclamation, "winfo\nikEl.")

                        Exit For
                    End Try
                Next
            ElseIf flagKr = 2 Then
                For j = 0 To Me.DbhotelDataSet.timeskratisis.Count - 1
                    ' MONO ta  Eintraege apo timeskratisis   pou eiai PRIN tin Nea Anaxwrisi !!
                    If Me.DbhotelDataSet.timeskratisis(j).apo <= DateTimePicker3.Value.AddDays(-1) Then
                        'If Me.DbhotelDataSet.timeskratisis(j).mexri <= Me.DateTimePicker3.Value Then
                        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + Me.DbhotelDataSet.timeskratisis(j).kwd.ToString, False)

                        Try
                            find = pnl(0).Controls.Find("Hme1" + Me.DbhotelDataSet.timeskratisis(j).kwd.ToString, False)
                            imeres_leave(find(0), e)
                        Catch ex As IndexOutOfRangeException
                            MsgBox("ΠΡΟΣΟΧΗ: Πρέπει να ελεχθούν οι τιμές ξανά !", MsgBoxStyle.Exclamation, "winfo\nikEl.")

                            Exit For
                        End Try
                    End If

                Next
            End If
        End If
    End Sub
    Private Sub DatumsPnl_Paint(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DatumsPnl.Leave
        '   If etos <> DateTimePicker3.Value.Year Then
        SimbCbx.Items.Clear()
        Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, DateTimePicker2.Value.AddDays(-1).Year)

        fuehle_simbol_cboxen()
        SimbCbx.SelectedIndex = 0
        ReDim timokatalog(-1)
        '   End If
    End Sub
    'Epilogi katigorias(klines,tipos) + elegxos ean yparxei ueberhaupt, Default currntklines kai currnttipos=0 ean den epilegei tipota 
    Private Sub KlinesTipoiCbx_IndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KlinesCbx.SelectedIndexChanged, TipiCbx.SelectedIndexChanged
        Dim anzahl As Int16

        'If currentsimbolaio <> -1 Then

        'If Not isDBEintrag Then

        If sender.name.Equals("KlinesCbx") Then
            Kratiseis4Pnl.Controls.Clear()
            ButtonsPnl.Controls.Clear()
            If sender.selectedindex <> -1 Then
                currentklines = get_kwd_klins_byname(sender.selectedItem.ToString)
            Else
                currentklines = -1 'alaksa -1->0
            End If
            If currentklines = -1 Then
                currentklines = 0
                If SimbCbx.Items.Count <> 0 Then
                    If Not isDBEintrag Then
                        SimbCbx.SelectedIndex = 0
                    End If
                End If
            End If
            If currentklines > 0 Then
                anzahl = Me.KatigoriesTableAdapter.ExistEintrag2(currentklines)
                If anzahl = 0 Then
                    MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    KlinesCbx.SelectedIndex = 0
                Else
                    If SimbCbx.Items.Count <> 0 Then
                        If Not isDBEintrag Then
                            SimbCbx.SelectedIndex = 0
                        End If
                    End If
                End If
            End If
        ElseIf sender.name.Equals("TipiCbx") Then
            Kratiseis4Pnl.Controls.Clear()
            ButtonsPnl.Controls.Clear()
            If sender.selectedindex <> -1 Then
                currenttipos = get_kwd_tipos_byname(sender.selectedItem.ToString)
            Else
                currenttipos = -1
            End If
            If currenttipos = -1 Then
                currenttipos = 0
                If SimbCbx.Items.Count <> 0 Then
                    If Not isDBEintrag Then
                        SimbCbx.SelectedIndex = 0
                    End If
                End If
            End If
            If currenttipos > 0 Then
                anzahl = Me.KatigoriesTableAdapter.ExistEintrag(currenttipos)
                If anzahl = 0 Then
                    MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    TipiCbx.SelectedIndex = 0
                Else
                    If SimbCbx.Items.Count <> 0 Then
                        If Not isDBEintrag Then
                            SimbCbx.SelectedIndex = 0
                        End If
                    End If
                End If
            End If
        End If
        'If currentklines > 0 And currenttipos > 0 Then
        '    anzahl = Me.KatigoriesTableAdapter.ExistKatigoria(currentklines, currenttipos)
        '    If anzahl = 0 Then
        '        MsgBox("Δεν υπάρχει αυτός ο τύπος Δωματίου στην Δύναμη του Ξενοδοχείου!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '        TipiCbx.SelectedIndex = 0
        '        KlinesCbx.SelectedIndex = 0
        '    Else
        '        If SimbCbx.Items.Count <> 0 Then
        '            If Not isDBEintrag Then
        '                SimbCbx.SelectedIndex = 0
        '            End If
        '        End If
        '    End If
        'End If



    End Sub
    'Ola ta Simbolaia toy Praktoreiu gia to etos
    Private Sub fuehle_simbol_cboxen()
        Dim j As Int16
        SimbCbx.Items.Clear()
        SimbLbl.Text = ""
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count
            If j <> 0 Then
                Try
                    If Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou.Equals("") Then
                        SimbCbx.Items.Add(j)
                    Else
                        SimbCbx.Items.Add(Me.DbhotelDataSet.simbolaia(j - 1).aasimbolaiou)
                    End If
                Catch ex As NullReferenceException
                    SimbCbx.Items.Add(j)
                End Try
            Else
                SimbCbx.Items.Add("<A/A Συμβoλαίου>")
            End If

        Next
        'SimbCbx.SelectedIndex = -1
    End Sub
    'Epilogi Simbolaiou
    Private Sub SimbCbx_SelectedIndexChanged_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SimbCbx.SelectedIndexChanged
        'Dim simbolaioTemp As Integer

        'If sender.selectedindex > 0 Then
        '    simbolaioTemp = get_kwd_simbol_byAA(SimbCbx.SelectedItem.ToString) ', praktoreiokwd)
        '    If simbolaioTemp = -1 Then
        '        Exit Sub
        '    Else
        '        If currentsimbolaio <> simbolaioTemp Then
        '            currentsimbolaio = simbolaioTemp
        '            ButtonsPnl.Enabled = False
        '            Kratiseis4Pnl.Enabled = False
        '        End If

        '    End If
        'End If
        Dim simbolaioTemp As Integer

        If sender.selectedindex > 0 Then
            simbolaioTemp = get_kwd_simbolaiou_by_aa(SimbCbx.SelectedItem) ', praktoreiokwd)

            If simbolaioTemp = -1 Then
                Exit Sub
            Else
                'If status = 2 AndAlso currentsimbolaio <> -1 And currentsimbolaio <> simbolaioTemp And currentAfixi <> imeromErgasias Then
                '    MsgBox(" Αλλαγή συμβολαίου κατά την διάρκεια Διαμονής δεν επιτρέπεται !" & vbCrLf & " (Κάντε αναχώριση και νέα άφιξη με όρους του νέου συμβολαίου)", MsgBoxStyle.Critical, "winfo\nikEl.")
                '    Exit Sub
                'End If
                'If currentsimbolaio <> simbolaioTemp Then
                currentsimbolaio = simbolaioTemp
                Me.SimbLbl.Text = get_perigrafi_simb_by_aa(SimbCbx.SelectedItem)
                ButtonsPnl.Enabled = False
                Kratiseis4Pnl.Enabled = False
                'End If

            End If
        End If

    End Sub
    Private Sub times_btn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles TimesBtn.Click
        Dim imeromOK As Boolean = True
        Dim DaysStayed As Int32
        Dim minDate, maxDate As Date

        If Me.DateTimePicker2.Value.Date < Me.DateTimePicker3.Value.Date Then 'imeromErgasias <= Me.DateTimePicker2.Value.Date AndAlso 
            If status = 2 AndAlso Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals(DwmTbx.Text) AndAlso imeromErgasias = DateTimePicker3.Value.Date Then
                MsgBox(" Δεν είναι δυνατή η αλλαγή Δωματίου κατά την Ημέρα Αναχώρησης  !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Me.DwmTbx.Text = Me.DbhotelDataSet.kratiseis(0).dwmatio
                Exit Sub
            End If
            ButtonsPnl.Enabled = True
            Kratiseis4Pnl.Enabled = True
            If currentAfixi <> Me.DateTimePicker2.Value.Date Then
                imeromOK = Me.DateTimePicker2_change()
            End If
            If imeromOK Then
                If currentAnaxwrisi <> Me.DateTimePicker3.Value Then
                    imeromOK = Me.DateTimePicker3_ValueChanged()
                End If
            End If

            If imeromOK Then
                Cursor = Cursors.WaitCursor
                ButtonsPnl.Controls.Clear()
                If Not isDBEintrag Then
                    'SimbCbx.SelectedIndex = -1
                    Try
                        ReDim timokatalog(-1)
                        setze_sum_timokat()
                    Catch ex As Exception
                        MsgBox("Παρουσιάστηκε σφάλμα ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        ButtonsPnl.Enabled = False
                        Cursor = Cursors.Default
                        Exit Sub
                    End Try

                End If
                Kratiseis4Pnl.Focus()
                Kratiseis4Pnl.Controls.Clear()

                TimesBtn.Enabled = False

                Try
                    If pruefe_imerominies_allotment() Then
                        elegxos_timwn()
                        If SynolLbl.Text = "0,00" Then
                            Me.setze_sum_timokat()
                        End If
                    End If
                Catch ex As Exception
                    MsgBox("Παρουσιάστηκε σφάλμα ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    ButtonsPnl.Enabled = False
                    Cursor = Cursors.Default
                    Exit Sub
                End Try

                Cursor = Cursors.Default
                TimesBtn.Enabled = True
                '       If DwmTbx.Text = "GRE" Or DwmTbx.Text = "WHI" Or DwmTbx.Text = "COC" Or DwmTbx.Text = "SAN" Then ' URBAN
                'If ist_urban(DwmTbx.Text) Then

                '    Me.KratiseisTableadpter1.FilMinAfixiMaxAnaxwrisiEtosUrban(Me.DbhotelDataSet1.kratiseis, etos, DwmTbx.Text)
                '    Try
                '        If DateTime.Compare(Me.DateTimePicker2.Value.Date, Me.DbhotelDataSet1.kratiseis(0).afixi) > 0 Then 't1 is later than t2
                '            minDate = Me.DbhotelDataSet1.kratiseis(0).afixi
                '        Else
                '            minDate = Me.DateTimePicker2.Value.Date
                '        End If
                '        If DateTime.Compare(Me.DateTimePicker3.Value.Date, Me.DbhotelDataSet1.kratiseis(0).anaxwrisi) > 0 Then
                '            maxDate = Me.DateTimePicker3.Value.Date
                '        Else
                '            maxDate = Me.DbhotelDataSet1.kratiseis(0).anaxwrisi
                '        End If
                '        DaysStayed = maxDate.Subtract(minDate).Days
                '        If DaysStayed > 90 Then
                '            MsgBox("Υπέρβαση του τριμήνου! (" + DaysStayed.ToString + " Ημέρες)", MsgBoxStyle.Exclamation)
                '            'Else
                '            '    MsgBox("ασδασδασου τριμήνου!", MsgBoxStyle.Exclamation)

                '        End If
                '    Catch ex As StrongTypingException


                '    End Try
                'End If
            Else
                MsgBox(" Ελέγξτε τις Ημερομηνίες !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                ButtonsPnl.Enabled = False
            End If
        Else
            MsgBox(" Ελέγξτε τις Ημερομηνίες !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            ButtonsPnl.Enabled = False
        End If

    End Sub
    Private Function ist_urban(ByVal vila As String) As Boolean
        Dim i As Int16
        For i = 0 To Me.DbhotelDataSet.dwmatia.Count - 1
            If Me.DbhotelDataSet.dwmatia(i).arithmos.Equals(vila) Then
                If Me.DbhotelDataSet.dwmatia(i).katigoria = 16 Then
                    Return True
                Else
                    Return False
                End If
            End If
        Next
        Return False
    End Function
    Private Sub BiblPortasBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles BiblPortasBtn.Click
        Dim response As MsgBoxResult
        Dim biblioPortas As New BiblioPortasFormclass(imeromErgasias, Me.DbhotelDataSet.etaireia(0).biblportastimes, True, 1, 0)

        response = MsgBox("Πρόκειται να εκτυπώσετε Θεωρημένο Βιβλίο Πόρτας πρίν το κλείσιμο Ημέρας !" & vbCrLf & "Οι εγγραφές αυτής της εκτύπωσης δέν θα εμφανιστούν ξανά στην τελική" & vbCrLf & "εκτύπωση κατά το κλείσιμο της Ημέρας !" & vbCrLf & "Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
        If response = MsgBoxResult.Yes Then
            Try
                Me.Cursor = Cursors.WaitCursor
                biblioPortas.biblPortas()
            Catch ex As Exception
                Me.Cursor = Cursors.Default
            End Try
            Me.Cursor = Cursors.Default

            biblioPortas.Dispose()
        End If


    End Sub
    'Private Function pruefe_imerominies_allotment() As Boolean
    '    Dim allotmOK As Boolean
    '    Dim response As MsgBoxResult
    '    Dim count, extraPnl As Int16

    '    Me.TouristperiodoiTableAdapter.FillBySimbAnaxwrisiAfixi(Me.DbhotelDataSet.touristperiodoi, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, _
    '                    currentsimbolaio, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date)
    '    'Wait(0.1)
    '    'MsgBox("timeskratisis " + Me.DbhotelDataSet.timeskratisis.Count.ToString)
    '    If Not pruefe_ob_touristikes_periodoi_richtig() Then
    '        MsgBox(" Υπάρχει Λάθος στα χρονικά όρια των τουριστικών Περιόδων του Πρακτορείου !" & vbCrLf & " Διορθώστε τα όρια στο Μενού <Συμφωνίες->Τουριστικές Περίοδοι> !", MsgBoxStyle.Critical, "winfo\nikEl.")
    '        Return False
    '    End If

    '    If currentsimbolaio > 0 Then
    '        If Me.DbhotelDataSet.touristperiodoi.Count <> 0 Then
    '            If DateTimePicker2.Value.Date < Me.DbhotelDataSet.touristperiodoi(0).apo Then
    '                MsgBox("Η Άφιξη είναι νωρίτερα απο την πρώτη Τουριστική Περίοδο (" + Me.DbhotelDataSet.touristperiodoi(0).apo + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
    '                'If isDBEintrag Then
    '                '    DateTimePicker2.Value = Me.DbhotelDataSet.touristperiodoi(0).apo
    '                'End If
    '                TimesBtn.Enabled = True
    '                Return False
    '            ElseIf DateTimePicker3.Value.Date.AddDays(-1) > Me.DbhotelDataSet.touristperiodoi(Me.DbhotelDataSet.touristperiodoi.Count - 1).mexri Then
    '                MsgBox("Η Αναχώριση είναι αργότερα απο την τελευταία Τουριστική Περίοδο (" + Me.DbhotelDataSet.touristperiodoi(Me.DbhotelDataSet.touristperiodoi.Count - 1).mexri + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
    '                TimesBtn.Enabled = True
    '                Return False
    '            Else
    '                allotmOK = pruefe_allotment()
    '                Wait(0.1)
    '                If Not allotmOK Then
    '                    response = MsgBox("Δεν υπάρχει Allotment ! Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
    '                    If response = MsgBoxResult.Yes Then
    '                        'Kratiseis4Pnl.Controls.Clear()
    '                        'ButtonsPnl.Controls.Clear()
    '                        If Not isDBEintrag Then
    '                            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, -1, True, 1) 'male timokatalogo gia kathe Season!
    '                        Else
    '                            If status = 1 Then
    '                                male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                            Else
    '                                If Me.DbhotelDataSet.touristperiodoi.Count > Me.DbhotelDataSet.timeskratisis.Count Then
    '                                    If (Me.DbhotelDataSet.timeskratisis.Count <> 0 AndAlso Me.DbhotelDataSet.timeskratisis(0).touristperiod = -1) OrElse _
    '                                (currentsimbolaio <> Me.DbhotelDataSet.kratiseis(0).simbolaio AndAlso currentAfixi <> imeromErgasias) Then
    '                                        ' periptwsi pou exei alaksei kata thn diarkeia diamonis to praktoreiore (h to simbolaio tou IDIOU praktoreiou meta tin afixi)->koitw mono tis timeskratiseis kai 
    '                                        'tis touristikes periodoi pou den isxuoun giati me tin allagi ekana uebernehman tis times ara kai tis periodous
    '                                        'tou palaiou praktoreioy (h tou simbolaiou tou IDIOU praktoreiou)(->touristperiod stis timeskratiseis DB =-1!)
    '                                        male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
    '                                    Else
    '                                        male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                                        '
    '                                    End If
    '                                Else
    '                                    'Otan uparxoyn dedouleumena (->timeskratisis.count >= touristperiosodoi) tote uparxei problhma ean o User alaksei tin
    '                                    ' anaxwrisi se NEA touristiki periodo->To programm DEN pairnei xampari tin NEA touristiki periodo!!
    '                                    If DateTimePicker3.Value.Date > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then

    '                                        For count = 0 To Me.DbhotelDataSet.touristperiodoi.Count - 1
    '                                            If Me.DbhotelDataSet.touristperiodoi(count).apo > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1) Then
    '                                                extraPnl = extraPnl + 1
    '                                            End If
    '                                        Next
    '                                    End If
    '                                    If extraPnl <> 0 Then
    '                                        MsgBox(" Πρέπει να ελεχθούν οι τιμές της τελευταίας Τουριστικής Περιόδου !", MsgBoxStyle.Information, "winfo\nikEl.")
    '                                    End If
    '                                    'H nea Touristiki Periodos tha lifthei ypopsin Mono ean o user allakse tin anaxwrisi tin IDIA imerominia tis afixis
    '                                    ' (afixi prepei na einai aktuel kai oxi apo pisogirisma apo akyrosi kleisimatos->yparxei spaetere Eintrag tis kratisis sto Biblio Portas)
    '                                    If currentAfixi <> imeromErgasias Or extraPnl <> 0 Or Not ist_biblio_aktuel(connectionString, kwdikoKratisisDB) Then
    '                                        male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
    '                                    Else
    '                                        male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                                    End If

    '                                End If
    '                            End If
    '                        End If
    '                    Else
    '                        Exit Function
    '                    End If
    '                Else
    '                    'MsgBox("5" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
    '                    'Kratiseis4Pnl.Controls.Clear()
    '                    'ButtonsPnl.Controls.Clear()
    '                    If Not isDBEintrag Then
    '                        'pruefe_yperbasi_allotment()
    '                        'male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, -1, True, 1) 'male timokatalogo gia kathe Season!
    '                        'εδω εκανα αλλαγή για να παίρνει κρατήσεις που ακουμπάν σε 2 ετη (χριστουγεννα)
    '                        If DateTimePicker3.Value.Year = DateTimePicker2.Value.Year Then
    '                            pruefe_yperbasi_allotment()
    '                        Else
    '                            MsgBox(" Προσοχή: Επικάλυψη τουριστικών περιόδων 2 ετών !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '                        End If

    '                        male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, -1, True, 1) 'male timokatalogo gia kathe Season!
    '                    Else
    '                        If status = 1 Then
    '                            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                        Else
    '                            If Me.DbhotelDataSet.touristperiodoi.Count > Me.DbhotelDataSet.timeskratisis.Count Then
    '                                If (Me.DbhotelDataSet.timeskratisis.Count <> 0 AndAlso Me.DbhotelDataSet.timeskratisis(0).touristperiod = -1) OrElse _
    '                                (currentsimbolaio <> Me.DbhotelDataSet.kratiseis(0).simbolaio AndAlso currentAfixi <> imeromErgasias) Then
    '                                    ' periptwsi pou exei alaksei kata thn diarkeia diamonis to praktoreiore (h to simbolaio tou IDIOU praktoreiou)->koitw mono tis timeskratiseis kai 
    '                                    'tis touristikes periodoi pou den isxuoun giati me tin allagi ekana uebernehman tis times ara kai tis periodous
    '                                    'tou palaiou praktoreioy (h tou simbolaiou tou IDIOU praktoreiou)(->touristperiod stis timeskratiseis DB =-1!)
    '                                    male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
    '                                Else
    '                                    male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                                    'male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
    '                                End If
    '                            Else
    '                                If DateTimePicker3.Value.Date > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
    '                                    For count = 0 To Me.DbhotelDataSet.touristperiodoi.Count - 1
    '                                        If Me.DbhotelDataSet.touristperiodoi(count).apo > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1) Then
    '                                            extraPnl = extraPnl + 1
    '                                        End If
    '                                    Next
    '                                End If
    '                                If extraPnl <> 0 Then
    '                                    MsgBox(" Πρέπει να ελεχθούν οι τιμές της τελευταίας Τουριστικής Περιόδου !", MsgBoxStyle.Information, "winfo\nikEl.")
    '                                End If
    '                                'H nea Touristiki Periodos tha lifthei ypopsin Mono ean o user allakse tin anaxwrisi tin IDIA imerominia tis afixis
    '                                ' (afixi prepei na einai aktuel kai oxi apo pisogirisma apo akyrosi kleisimatos->yparxei spaetere Eintrag tis kratisis sto Biblio Portas)
    '                                If currentAfixi <> imeromErgasias Or extraPnl <> 0 Or Not ist_biblio_aktuel(connectionString, kwdikoKratisisDB) Then
    '                                    male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
    '                                Else
    '                                    male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
    '                                End If
    '                            End If

    '                        End If

    '                    End If
    '                End If

    '            End If
    '            'release_period_pruefen()
    '        Else
    '            'MsgBox("6" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
    '            MsgBox(" Ημερομηνίες εκτός ορίων τουριστικής περιόδου για το Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '            TimesBtn.Enabled = True
    '            Return False
    '        End If
    '    Else
    '        'MsgBox("7" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
    '        MsgBox(" Δεν έγινε επιλογή Συμβολαίου για το Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '        TimesBtn.Enabled = True
    '        Return False
    '    End If
    '    Return True
    'End Function
    'ACHTUNG am 30/10/2018 parousiastike problima sthn eisagwgi kratisis ta xristougenna se 2 eti....antegrpsa apo to nefelei tin procedure

    Private Function pruefe_imerominies_allotment() As Boolean
        Dim allotmOK As Boolean
        Dim response As MsgBoxResult
        Dim count, extraPnl As Int16

        Me.TouristperiodoiTableAdapter.FillBySimbAnaxwrisiAfixi(Me.DbhotelDataSet.touristperiodoi, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date,
                        currentsimbolaio, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date)
        'Wait(0.1)
        'MsgBox("timeskratisis " + Me.DbhotelDataSet.timeskratisis.Count.ToString)
        If Not pruefe_ob_touristikes_periodoi_richtig() Then
            MsgBox(" Υπάρχει Λάθος στα χρονικά όρια των τουριστικών Περιόδων του Πρακτορείου !" & vbCrLf & " Διορθώστε τα όρια στο Μενού <Συμφωνίες->Τουριστικές Περίοδοι> !", MsgBoxStyle.Critical, "winfo\nikEl.")
            Return False
        End If

        If currentsimbolaio <> 0 Then
            If Me.DbhotelDataSet.touristperiodoi.Count <> 0 Then
                If DateTimePicker2.Value.Date < Me.DbhotelDataSet.touristperiodoi(0).apo AndAlso DateTimePicker2.Value.Year = Me.DbhotelDataSet.touristperiodoi(0).apo.Year Then
                    MsgBox("Η Άφιξη είναι νωρίτερα απο την πρώτη Τουριστική Περίοδο (" + Me.DbhotelDataSet.touristperiodoi(0).apo + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                    'If isDBEintrag Then
                    '    DateTimePicker2.Value = Me.DbhotelDataSet.touristperiodoi(0).apo
                    'End If
                    TimesBtn.Enabled = True
                    Return False
                ElseIf (DateTimePicker3.Value.Year = DateTimePicker2.Value.Year) AndAlso DateTimePicker3.Value.Date.AddDays(-1) > Me.DbhotelDataSet.touristperiodoi(Me.DbhotelDataSet.touristperiodoi.Count - 1).mexri Then
                    MsgBox("Η Αναχώριση είναι αργότερα απο την τελευταία Τουριστική Περίοδο (" + Me.DbhotelDataSet.touristperiodoi(Me.DbhotelDataSet.touristperiodoi.Count - 1).mexri + ")", MsgBoxStyle.Critical, "winfo\nikEl.")
                    TimesBtn.Enabled = True
                    Return False
                Else
                    allotmOK = pruefe_allotment()
                    Wait(0.1)
                    If Not allotmOK Then
                        response = MsgBox("Δεν υπάρχει Allotment ! Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                        If response = MsgBoxResult.Yes Then
                            'Kratiseis4Pnl.Controls.Clear()
                            'ButtonsPnl.Controls.Clear()
                            If Not isDBEintrag Then
                                male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, -1, True, 1) 'male timokatalogo gia kathe Season!
                            Else
                                If status = 1 Then
                                    male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                                Else
                                    If Me.DbhotelDataSet.touristperiodoi.Count > Me.DbhotelDataSet.timeskratisis.Count Then
                                        If (Me.DbhotelDataSet.timeskratisis.Count <> 0 AndAlso Me.DbhotelDataSet.timeskratisis(0).touristperiod = -1) OrElse
                                    (currentsimbolaio <> Me.DbhotelDataSet.kratiseis(0).simbolaio AndAlso currentAfixi <> imeromErgasias) Then
                                            ' periptwsi pou exei alaksei kata thn diarkeia diamonis to praktoreiore (h to simbolaio tou IDIOU praktoreiou meta tin afixi)->koitw mono tis timeskratiseis kai 
                                            'tis touristikes periodoi pou den isxuoun giati me tin allagi ekana uebernehman tis times ara kai tis periodous
                                            'tou palaiou praktoreioy (h tou simbolaiou tou IDIOU praktoreiou)(->touristperiod stis timeskratiseis DB =-1!)
                                            male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
                                        Else
                                            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                                            '
                                        End If
                                    Else
                                        'Otan uparxoyn dedouleumena (->timeskratisis.count >= touristperiosodoi) tote uparxei problhma ean o User alaksei tin
                                        ' anaxwrisi se NEA touristiki periodo->To programm DEN pairnei xampari tin NEA touristiki periodo!!
                                        If DateTimePicker3.Value.Date > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then

                                            For count = 0 To Me.DbhotelDataSet.touristperiodoi.Count - 1
                                                If Me.DbhotelDataSet.touristperiodoi(count).apo > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1) Then
                                                    extraPnl = extraPnl + 1
                                                End If
                                            Next
                                        End If
                                        If extraPnl <> 0 Then
                                            MsgBox(" Πρέπει να ελεχθούν οι τιμές της τελευταίας Τουριστικής Περιόδου !", MsgBoxStyle.Information, "winfo\nikEl.")
                                        End If
                                        'H nea Touristiki Periodos tha lifthei ypopsin Mono ean o user allakse tin anaxwrisi tin IDIA imerominia tis afixis
                                        ' (afixi prepei na einai aktuel kai oxi apo pisogirisma apo akyrosi kleisimatos->yparxei spaetere Eintrag tis kratisis sto Biblio Portas)
                                        If currentAfixi <> imeromErgasias Or extraPnl <> 0 Or Not ist_biblio_aktuel(connectionString, kwdikoKratisisDB) Then
                                            male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
                                        Else
                                            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                                        End If

                                    End If
                                End If
                            End If
                        Else
                            Exit Function
                        End If
                    Else
                        'MsgBox("5" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
                        'Kratiseis4Pnl.Controls.Clear()
                        'ButtonsPnl.Controls.Clear()
                        If Not isDBEintrag Then
                            'εδω εκανα αλλαγή για να παίρνει κρατήσεις που ακουμπάν σε 2 ετη (χριστουγεννα)
                            If DateTimePicker3.Value.Year = DateTimePicker2.Value.Year Then
                                pruefe_yperbasi_allotment()
                            Else
                                MsgBox(" Προσοχή: Επικάλυψη τουριστικών περιόδων 2 ετών !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            End If

                            male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, -1, True, 1) 'male timokatalogo gia kathe Season!
                        Else
                            If status = 1 Then
                                male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                            Else
                                If Me.DbhotelDataSet.touristperiodoi.Count > Me.DbhotelDataSet.timeskratisis.Count Then
                                    If (Me.DbhotelDataSet.timeskratisis.Count <> 0 AndAlso Me.DbhotelDataSet.timeskratisis(0).touristperiod = -1) OrElse
                                    (currentsimbolaio <> Me.DbhotelDataSet.kratiseis(0).simbolaio AndAlso currentAfixi <> imeromErgasias) Then
                                        ' periptwsi pou exei alaksei kata thn diarkeia diamonis to praktoreiore (h to simbolaio tou IDIOU praktoreiou)->koitw mono tis timeskratiseis kai 
                                        'tis touristikes periodoi pou den isxuoun giati me tin allagi ekana uebernehman tis times ara kai tis periodous
                                        'tou palaiou praktoreioy (h tou simbolaiou tou IDIOU praktoreiou)(->touristperiod stis timeskratiseis DB =-1!)
                                        male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
                                    Else
                                        male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                                        'male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
                                    End If
                                Else
                                    If DateTimePicker3.Value.Date > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                        For count = 0 To Me.DbhotelDataSet.touristperiodoi.Count - 1
                                            If Me.DbhotelDataSet.touristperiodoi(count).apo > Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1) Then
                                                extraPnl = extraPnl + 1
                                            End If
                                        Next
                                    End If
                                    If extraPnl <> 0 Then
                                        MsgBox(" Πρέπει να ελεχθούν οι τιμές της τελευταίας Τουριστικής Περιόδου !", MsgBoxStyle.Information, "winfo\nikEl.")
                                    End If
                                    'H nea Touristiki Periodos tha lifthei ypopsin Mono ean o user allakse tin anaxwrisi tin IDIA imerominia tis afixis
                                    ' (afixi prepei na einai aktuel kai oxi apo pisogirisma apo akyrosi kleisimatos->yparxei spaetere Eintrag tis kratisis sto Biblio Portas)
                                    If currentAfixi <> imeromErgasias Or extraPnl <> 0 Or Not ist_biblio_aktuel(connectionString, kwdikoKratisisDB) Then
                                        male_timokatalogous_pnl(Me.DbhotelDataSet.timeskratisis.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 2)
                                    Else
                                        male_timokatalogous_pnl(Me.DbhotelDataSet.touristperiodoi.Count, Me.DbhotelDataSet.kratiseis(0).arithmos, True, 1)
                                    End If
                                End If

                            End If

                        End If
                    End If

                End If
                'release_period_pruefen()
            Else
                'MsgBox("6" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
                MsgBox(" Ημερομηνίες εκτός ορίων τουριστικής περιόδου για το Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                TimesBtn.Enabled = True
                Return False
            End If
        Else
            'MsgBox("7" + Me.DbhotelDataSet.timeskratisis.Count.ToString)
            MsgBox(" Δεν έγινε επιλογή Συμβολαίου για το Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            TimesBtn.Enabled = True
            Return False
        End If
        Return True
    End Function

    Private Function pruefe_allotment() As Boolean
        Dim allotmOK As Boolean = False

        If currentklines <= 0 And currenttipos <= 0 Then 'arxika elgxos ob (0,0) ola me ola->(exw balei >=0 gia na sumperilambanei to -1)
            'Me.AllotmentTableAdapter.AllotmKatigoriesBySimbolaio(Me.DbhotelDataSet.allotment, currentsimbolaio)
            'ola ta Allotment pou einai MEGALYTERA tou 0
            Me.AllotmentTableAdapter.FillAllotmBySimbGuarKlinesTiposApoMexri(Me.DbhotelDataSet.allotment, currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, 0, 0,
                                            currentsimbolaio, optionChk.Checked, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, 0, 0,
                                              currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, 0, 0)

            Return check_tupel_allotment_ob_nacheinander()


        Else
            If currenttipos > 0 AndAlso currentklines > 0 Then 'elegxos ob (x,y)
                Me.AllotmentTableAdapter.FillAllotmBySimbGuarKlinesTiposApoMexri(Me.DbhotelDataSet.allotment, currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, currentklines, currenttipos,
                                              currentsimbolaio, optionChk.Checked, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentklines, currenttipos,
                                                currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, currentklines, currenttipos)

                allotmOK = check_tupel_allotment_ob_nacheinander()
            End If
            ' ean den yparxei (x,y) tote elegxos gia (0,y) kai (x,0)
            If Not allotmOK AndAlso currentklines > 0 Then
                Me.AllotmentTableAdapter.FillAllotmBySimbGuarKlinesTiposApoMexri(Me.DbhotelDataSet.allotment, currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, currentklines, 0,
                                              currentsimbolaio, optionChk.Checked, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentklines, 0,
                                                currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, currentklines, 0)


                allotmOK = check_tupel_allotment_ob_nacheinander()
            End If
            If Not allotmOK AndAlso currenttipos > 0 Then
                Me.AllotmentTableAdapter.FillAllotmBySimbGuarKlinesTiposApoMexri(Me.DbhotelDataSet.allotment, currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, 0, currenttipos,
                                              currentsimbolaio, optionChk.Checked, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, 0, currenttipos,
                                                currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, 0, currenttipos)


                allotmOK = check_tupel_allotment_ob_nacheinander()
            End If
            If Not allotmOK Then
                Me.AllotmentTableAdapter.FillAllotmBySimbGuarKlinesTiposApoMexri(Me.DbhotelDataSet.allotment, currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, 0, 0,
                                                              currentsimbolaio, optionChk.Checked, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, 0, 0,
                                                                currentsimbolaio, optionChk.Checked, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, 0, 0)


                allotmOK = check_tupel_allotment_ob_nacheinander()
            End If

            Return allotmOK


        End If




    End Function

    Private Function check_tupel_allotment_ob_nacheinander() As Boolean
        Dim j As Int16

        If Me.DbhotelDataSet.allotment.Count <> 0 Then
            If Me.DbhotelDataSet.allotment(0).apo <= DateTimePicker2.Value.Date And Me.DbhotelDataSet.allotment(Me.DbhotelDataSet.allotment.Count - 1).mexri >= DateTimePicker3.Value.AddDays(-1).Date Then
                If Me.DbhotelDataSet.allotment.Count = 1 Then
                    Return True
                Else
                    For j = 0 To Me.DbhotelDataSet.allotment.Count - 2
                        If Me.DbhotelDataSet.allotment(j).mexri.AddDays(1) <> Me.DbhotelDataSet.allotment(j + 1).apo Then
                            Return False
                            Exit For
                        End If
                    Next
                End If
            Else
                Return False
            End If
        Else
            Return False
        End If

        Return True

    End Function
    'edw kanw malwn ta panelakia me tis times->arseason einani etweder to touristperiodoi.count oder oi timeskratisis.count analoga me to flag
    'ousiastika kanw malen tosa panel osa kai ta count-> ta Controls panw sta panelakia pairnoun name me kwdikous apo touristperiod oder timeskratisis
    'ean den einai DB eintrag ;h status=1 tote flag=1 kai count apo periods
    'ean status=2 tote ean oi timeskratisis.count>tourcount tote flag=2
    '->Oli i istoria me to flag 2 egine eksetias tis periptwsis pou mesa stin Diamoni allaxthei kati pou epireazei to biblio portas->neo eintrag dazwischen
    'stis timeskratisis -> ara iparxei periptwsi timeskratisis.count>tourperiodscount
    Private Sub male_timokatalogous_pnl(ByVal arseasons As Int16, ByVal arkratisis As Int16, ByVal timokPnlMalen As Boolean, ByVal flag As Byte) 'male timokatalogo gia kathe Season!
        Dim i, count, stepy, timesCount, imeresTotal, index As Int16 ', extraPnl
        Dim zahl As Single 'sum,
        'Dim response As MsgBoxResult

        flagKr = flag

        If timokPnlMalen Then
            'Kratiseis4Pnl.Controls.Clear()
            'ButtonsPnl.Controls.Clear()
            'MsgBox("Blitz1")
            'sum = 0
            stepy = 0
            'ReDim timokatalog(arseasons - 1)
            'init_timokatalog()
            Me.DbhotelDataSet.timeskratisis.Clear()
            Me.DbhotelDataSet.times.Clear()
            If arkratisis <> -1 AndAlso isDBEintrag Then
                Me.TimeskratisisTableAdapter.FillByKratisi(Me.DbhotelDataSet.timeskratisis, kwdikoKratisisDB)
                Wait(0.1)
                timesCount = Me.DbhotelDataSet.timeskratisis.Count
            End If
            'se periptwsi pou stis kratiseis o user alaksei tin AFIXI (wste na alaksei periodos) tote alazw to timesCount wste na min exw problima 
            'imeresTotal-pliromis-(to timesCount tsekarei ean to Eintrag timeskratiseis einai to teleuataio->tote einai imeresTotal 1 mera
            'ligotero apoti sinithws logw anaxwrisis)
            'ACHTUNG_>to timescount DEN einai aparaitita idio me to timekratiseis.count!!!!!!!!!!!

            ' TO APENERFOPOIHSA 25/7/2018!!!!!!!!!!!!!!!!!!!!!!PROSEKSE!!!
            'If timesCount <> 0 Then
            '    If flag = 1 Then
            '        For count = 0 To Me.DbhotelDataSet.timeskratisis.Count - 1
            '            If Me.DbhotelDataSet.timeskratisis(count).mexri < DateTimePicker2.Value Then
            '                timesCount = timesCount - 1
            '            End If
            '        Next
            '    End If
            'End If
            If flag = 2 Then
                If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                    'periptwsi diamenwnta pou o user mikreinei tin diamoni (anaxwrisi Datetimepicker3) stin parakatw toyristiki 
                    'periodo->epeidi controls exoun kwdikous apo timeskratisis koitw poia Eintraege apo timeskratisis  einai meta tin Nea Anaxwrisi kai DEN ta kanw malen!!
                    For count = 0 To Me.DbhotelDataSet.timeskratisis.Count - 1
                        If Me.DbhotelDataSet.timeskratisis(count).apo > DateTimePicker3.Value.AddDays(-1) Then
                            'timesCount = 0 'timesCount - 1 '0
                            Exit For
                        End If
                    Next
                    arseasons = count
                End If

            End If
            ReDim timokatalog(arseasons - 1)
            init_timokatalog()

            'kathe touristiki periodo kane mplok timis
            'ousiastika arseasons einai o arithmos twn panel stis times pou mporei na simpiptei me to timeskratiseis.count alla kai oxi ean o user 'paiksei'
            'me tis imerominies afixis-anaxwrisis
            For count = 0 To arseasons - 1
                Dim KatalogPnl As New Panel
                Dim TimokChk As New CheckBox
                Dim EtiketLbl, SimfLbl, XrewsLbl, KlnsLbl, HmeresLbl, EkptLbl, TimiApoLbl, IsonLbl, HmrsLbl, InfoLbl, Info2Lbl, DedoulLbl, DedoulPosLbl, Imerom1Lbl, Imerom2Lbl, SumLbl As New Label 'ParoxLbl,
                Dim SimfCbx, XrewsCbx, KlnsCbx As New ComboBox
                Dim EkptTbx, Hmer1Tbx, YpnosTbx, PrwinTbx, GeumTbx, DeipTbx, ExtrTbx As New TextBox ', Imerom1Tbx, Imerom2Tbx,ParoxTbx, 


                If flag = 1 Then
                    timokatalog(count).tourist = Me.DbhotelDataSet.touristperiodoi(count).kwd

                    KatalogPnl.Name = "Ktlg" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString 'AChTUNG->kwd tousristikis periodou

                    SynolPnl.Name = "Synl" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString 'AChTUNG->kwd tousristikis periodou


                    TimokChk.CheckAlign = ContentAlignment.MiddleRight
                    TimokChk.Text = "Τιμοκατ."
                    TimokChk.Name = "Tmkt" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    SimfCbx.Name = "Simf" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString 'AChTUNG->kwd tousristikis periodou
                    XrewsCbx.Name = "Xres" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    KlnsCbx.Name = "Klns" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    Hmer1Tbx.Name = "Hme1" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    'ParoxTbx.Name = "Parx" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                Else
                    timokatalog(count).tourist = Me.DbhotelDataSet.timeskratisis(count).touristperiod
                    KatalogPnl.Name = "Ktlg" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString 'AChTUNG->kwd tousristikis periodou
                    SynolPnl.Name = "Synl" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString 'AChTUNG->kwd tousristikis periodou
                    TimokChk.CheckAlign = ContentAlignment.MiddleRight
                    TimokChk.Text = "Τιμοκατ."
                    TimokChk.Name = "Tmkt" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    SimfCbx.Name = "Simf" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString 'AChTUNG->kwd timis kratisis
                    XrewsCbx.Name = "Xres" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    KlnsCbx.Name = "Klns" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    Hmer1Tbx.Name = "Hme1" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    'ParoxTbx.Name = "Parx" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                End If

                EkptTbx.TabStop = False
                Hmer1Tbx.TabStop = False

                TimokChk.Height = 20
                TimokChk.Width = 90
                SimfCbx.Width = 60
                XrewsCbx.Width = 60
                KlnsCbx.Width = 185
                'ParoxTbx.Width = 60
                Hmer1Tbx.Width = 40
                EkptTbx.Width = 60

                YpnosTbx.MaxLength = 7
                PrwinTbx.MaxLength = 7
                GeumTbx.MaxLength = 7
                DeipTbx.MaxLength = 7

                EkptTbx.MaxLength = 5
                Hmer1Tbx.MaxLength = 3
                'ParoxTbx.MaxLength = 9

                If flag = 1 Then
                    EkptTbx.Name = "Ekpt" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    Imerom1Lbl.Name = "Imr1" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    Imerom2Lbl.Name = "Imr2" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    YpnosTbx.Name = "Ypno" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    PrwinTbx.Name = "Prwi" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    GeumTbx.Name = "Geum" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    DeipTbx.Name = "Dipn" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    ExtrTbx.Name = "Extr" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                    SumLbl.Name = "Summ" + Me.DbhotelDataSet.touristperiodoi(count).kwd.ToString
                Else
                    EkptTbx.Name = "Ekpt" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    Imerom1Lbl.Name = "Imr1" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    Imerom2Lbl.Name = "Imr2" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    YpnosTbx.Name = "Ypno" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    PrwinTbx.Name = "Prwi" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    GeumTbx.Name = "Geum" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    DeipTbx.Name = "Dipn" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    ExtrTbx.Name = "Extr" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                    SumLbl.Name = "Summ" + Me.DbhotelDataSet.timeskratisis(count).kwd.ToString
                End If

                ' to index deixnei tin stelle sto timokatalog DSTR to opoio parakolouthei tis times se kathe panelaki->ean uparxei timeskratisis->laden
                '(ean DEN uparxoun (index=-1) tote initial werte px touristiki periodo neas kratisis ;h touristiki periodo pou proekipse apo allagi anaxwrisis)
                If flag = 1 Then 'FLAG 1 ->  psaxnw to Eintrag stis Timeskratisis me to idio kwdiko Touristikis periodou gia na to kanw malen
                    index = get_index_timeskratisis(Me.DbhotelDataSet.touristperiodoi(count).kwd) 'ME TO INDEX KOITW GIA TAYTOPOIHSH TOURISTIKIHS PERIODOU ME TIMIKRATISIS
                Else
                    index = count
                End If

                ' otan uparxei timesktatiseis Eintrag tote eneimrwnw to timokatalog Dstruktur
                '(uparxei ka i i periptwsi pou o User paizwntas me tis IMerominies dimiourgise extra panelaki (logw allagis touristikis periodou)
                'sto opoio den antistixei eintrag apo timeskratisis->tote initial Werte
                If index <> -1 And timesCount <> 0 Then

                    timokatalog(count).kwdDB = Me.DbhotelDataSet.timeskratisis(index).kwd
                    timokatalog(count).timi = Me.DbhotelDataSet.timeskratisis(index).timi
                    timokatalog(count).xrewsi = Me.DbhotelDataSet.timeskratisis(index).xrewsi
                    timokatalog(count).xrewsiDB = Me.DbhotelDataSet.timeskratisis(index).xrewsi


                    zahl = Me.DbhotelDataSet.timeskratisis(index).ekptosi
                    timokatalog(count).ekptosi = zahl
                    timokatalog(count).ekptosiDB = zahl

                    EkptTbx.Text = zahl.ToString("F")
                    Imerom1Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).apo.Date
                    timokatalog(count).apo = Me.DbhotelDataSet.timeskratisis(index).apo.Date
                    Imerom2Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).mexri.Date
                    timokatalog(count).mexri = Me.DbhotelDataSet.timeskratisis(index).mexri.Date
                    timokatalog(count).mexriDB = Me.DbhotelDataSet.timeskratisis(index).mexri.Date

                    zahl = Me.DbhotelDataSet.timeskratisis(index).imeres
                    timokatalog(count).imeresPlirom = zahl
                    timokatalog(count).imeresPliromDB = zahl
                    Hmer1Tbx.Text = zahl.ToString("F")


                    If index = Me.DbhotelDataSet.timeskratisis.Count - 1 Then 'timesCount - 1 Then 'orelsecount = arseasons - 1
                        timokatalog(count).imeresTotal = (timokatalog(count).mexri - timokatalog(count).apo).Days
                    Else
                        timokatalog(count).imeresTotal = (timokatalog(count).mexri - timokatalog(count).apo).Days + 1
                    End If

                    'edw enimerwnw ta stsoixeia tou timokatalog Dstruktur->achtung p.x. o ypnos pairnei arxika tin timi tou db alla ean imeresPliromis<>imerestotal
                    'pairnei diamorfwmeni timi apo (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom)
                    'ypnosTemp einai i timi pou fainetai sto panel (kai alazei otan tin alazei o user)
                    zahl = Me.DbhotelDataSet.timeskratisis(index).ypnos
                    timokatalog(count).ypnosTemp = zahl
                    'sum = sum + zahl
                    If timokatalog(count).ekptosi <> 100 Then
                        timokatalog(count).ypnos = zahl * 100 / (100 - timokatalog(count).ekptosi)
                    Else
                        timokatalog(count).ypnos = zahl
                    End If

                    If timokatalog(count).imeresPlirom <> 0 AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresTotal Then ' AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresPliromDB
                        timokatalog(count).ypnos = (timokatalog(count).ypnos * (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom))
                    End If
                    YpnosTbx.Text = zahl.ToString("F")


                    zahl = Me.DbhotelDataSet.timeskratisis(index).prwino
                    timokatalog(count).prwinoTemp = zahl
                    'sum = sum + zahl
                    If timokatalog(count).ekptosi <> 0 Then
                        timokatalog(count).prwino = zahl * 100 / (100 - timokatalog(count).ekptosi)
                    Else
                        timokatalog(count).prwino = zahl
                    End If
                    If timokatalog(count).imeresPlirom <> 0 AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresTotal Then
                        timokatalog(count).prwino = (timokatalog(count).prwino * (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom))
                    End If
                    PrwinTbx.Text = zahl.ToString("F")


                    zahl = Me.DbhotelDataSet.timeskratisis(index).geuma
                    timokatalog(count).geumaTemp = zahl
                    'sum = sum + zahl
                    If timokatalog(count).ekptosi <> 0 Then
                        timokatalog(count).geuma = zahl * 100 / (100 - timokatalog(count).ekptosi)
                    Else
                        timokatalog(count).geuma = zahl
                    End If
                    If timokatalog(count).imeresPlirom <> 0 AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresTotal Then
                        timokatalog(count).geuma = (timokatalog(count).geuma * (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom))
                    End If
                    GeumTbx.Text = zahl.ToString("F")


                    zahl = Me.DbhotelDataSet.timeskratisis(index).deipno
                    timokatalog(count).deipnoTemp = zahl
                    'sum = sum + zahl
                    If timokatalog(count).ekptosi <> 0 Then
                        timokatalog(count).deipno = zahl * 100 / (100 - timokatalog(count).ekptosi)
                    Else
                        timokatalog(count).deipno = zahl
                    End If
                    If timokatalog(count).imeresPlirom <> 0 AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresTotal Then
                        timokatalog(count).deipno = (timokatalog(count).deipno * (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom))
                    End If
                    DeipTbx.Text = zahl.ToString("F")


                    zahl = Me.DbhotelDataSet.timeskratisis(index).extra

                    timokatalog(count).paroxiTemp = zahl
                    'sum = sum + zahl
                    If timokatalog(count).ekptosi <> 0 Then
                        timokatalog(count).paroxi = zahl * 100 / (100 - timokatalog(count).ekptosi)
                    Else
                        timokatalog(count).paroxi = zahl
                    End If
                    If timokatalog(count).imeresPlirom <> 0 AndAlso timokatalog(count).imeresPlirom <> timokatalog(count).imeresTotal Then
                        timokatalog(count).paroxi = (timokatalog(count).paroxi * (timokatalog(count).imeresTotal / timokatalog(count).imeresPlirom))
                    End If
                    ExtrTbx.Text = zahl.ToString("F")

                    zahl = Me.DbhotelDataSet.timeskratisis(index).synolo
                    timokatalog(count).synolo = zahl
                    timokatalog(count).synoloTemp = zahl
                    SumLbl.Text = zahl.ToString("N")
                    'DateTimePicker3_Validating()
                    'MsgBox(zahl)

                    If status = 2 Then ' TIMES BASHS GIA DIAMENWNTES->XRISIMOPOIEITAI GIA DEDOULEUMENA!!!!!!
                        timokatalog(count).xrewsiDB = timokatalog(count).xrewsi ' Me.DbhotelDataSet.timeskratisis(index).xrewsi
                        timokatalog(count).ypnosDB = timokatalog(count).ypnosTemp
                        timokatalog(count).prwinoDB = timokatalog(count).prwinoTemp
                        timokatalog(count).geumaDB = timokatalog(count).geumaTemp
                        timokatalog(count).deipnoDB = timokatalog(count).deipnoTemp
                        timokatalog(count).paroxiDB = timokatalog(count).paroxiTemp
                        timokatalog(count).synoloDB = timokatalog(count).synoloTemp
                    End If

                    'Edw orizw ean tha emfanizetai to info2Lbl( sto katw meros katw apo SUM timwn) me tis plirofories gia Xrewsi(RR,HB ktl) Klines, paidia
                    If timokatalog(count).timi > 0 Then
                        TimokChk.Checked = True
                        Info2Lbl.Text = info_timiskratisis_by_kwdtimis(timokatalog(count).timi)

                    ElseIf timokatalog(count).timi = -1 Then
                        TimokChk.Checked = False
                        Info2Lbl.Text = info_timiskratisis_by_xrewsi(timokatalog(count).xrewsi)
                    End If
                Else 'den uparxei antistixia se timeskratisis eintrag

                    zahl = 0
                    TimokChk.Checked = True
                    Hmer1Tbx.Text = zahl.ToString
                    EkptTbx.Text = zahl.ToString("F")
                    YpnosTbx.Text = zahl.ToString("F")
                    PrwinTbx.Text = zahl.ToString("F")
                    GeumTbx.Text = zahl.ToString("F")
                    DeipTbx.Text = zahl.ToString("F")
                    ExtrTbx.Text = zahl.ToString("F")
                    SumLbl.Text = zahl.ToString("F")


                End If


                EkptTbx.TextAlign = HorizontalAlignment.Right
                YpnosTbx.Width = 60
                YpnosTbx.TextAlign = HorizontalAlignment.Right
                PrwinTbx.Width = 60
                PrwinTbx.TextAlign = HorizontalAlignment.Right
                GeumTbx.Width = 60
                GeumTbx.TextAlign = HorizontalAlignment.Right
                DeipTbx.Width = 60
                DeipTbx.TextAlign = HorizontalAlignment.Right
                ExtrTbx.Width = 60
                ExtrTbx.TextAlign = HorizontalAlignment.Right
                SumLbl.Width = 80
                SumLbl.TextAlign = ContentAlignment.MiddleLeft
                Imerom1Lbl.TextAlign = ContentAlignment.MiddleCenter
                Imerom2Lbl.TextAlign = ContentAlignment.MiddleCenter

                Imerom1Lbl.Width = 90
                Imerom2Lbl.Width = 90

                'Imerom1Tbx.Enabled = False
                'Imerom2Tbx.Enabled = False

                Imerom1Lbl.ForeColor = Color.Black
                Imerom2Lbl.ForeColor = Color.Black
                Imerom1Lbl.BackColor = Color.Azure
                Imerom2Lbl.BackColor = Color.Azure

                SumLbl.ForeColor = Color.Maroon
                'SumTbx.Enabled = False

                'MsgBox("Blitz2")
                If count Mod 2 <> 0 Then
                    KatalogPnl.BackColor = Color.Khaki
                    'Imerom1Lbl.BackColor = Color.DarkKhaki
                    'Imerom2Lbl.BackColor = Color.DarkKhaki
                Else
                    KatalogPnl.BackColor = Color.DarkKhaki
                    'Imerom1Lbl.BackColor = Color.Khaki
                    'Imerom2Lbl.BackColor = Color.Khaki
                End If
                If flag = 1 Then
                    Me.SimfoniesTableAdapter.FillByTiposSeason(Me.DbhotelDataSet.simfonies, currentsimbolaio, currenttipos, Me.DbhotelDataSet.touristperiodoi(count).season)
                Else
                    Me.SimfoniesTableAdapter.FillByTiposTouristperkwd(Me.DbhotelDataSet.simfonies, currentsimbolaio, currenttipos, Me.DbhotelDataSet.timeskratisis(index).touristperiod)
                End If
                Wait(0.1)

                If Me.DbhotelDataSet.simfonies.Count <> 0 Then
                    TimokChk.Checked = True
                    For i = 0 To Me.DbhotelDataSet.simfonies.Count - 1
                        SimfCbx.Items.Add(Me.DbhotelDataSet.simfonies(i).aa)
                    Next
                Else
                    If flag = 1 Then
                        Me.SimfoniesTableAdapter.FillByTiposSeason(Me.DbhotelDataSet.simfonies, currentsimbolaio, 0, Me.DbhotelDataSet.touristperiodoi(count).season)
                    Else
                        Me.SimfoniesTableAdapter.FillByTiposTouristperkwd(Me.DbhotelDataSet.simfonies, currentsimbolaio, 0, Me.DbhotelDataSet.timeskratisis(index).touristperiod)
                    End If

                    If Me.DbhotelDataSet.simfonies.Count <> 0 Then
                        TimokChk.Checked = True
                        currenttipos = 0
                        For i = 0 To Me.DbhotelDataSet.simfonies.Count - 1
                            SimfCbx.Items.Add(Me.DbhotelDataSet.simfonies(i).aa)
                        Next
                    Else
                        'edw alaksa-> ean DEN yparxei timokatalogos tote h xrewsi prepei na einai i idia me auti tou praktoreiou DB stous parametrous
                        TimokChk.Checked = False
                        timokatalog(count).timi = -1
                        If timokatalog(count).xrewsi = -1 Then
                            timokatalog(count).xrewsi = praktXrewsKwd
                        End If
                        TimokChk.Enabled = False
                        SimfCbx.Enabled = False
                        KlnsCbx.Enabled = False
                        For i = 0 To Me.DbhotelDataSet.xrewseis.Count - 1
                            XrewsCbx.Items.Add(Me.DbhotelDataSet.xrewseis(i).xrewsi)
                            If Me.DbhotelDataSet.xrewseis(i).kwd = timokatalog(count).xrewsi Then
                                XrewsCbx.SelectedIndex = i
                            End If
                        Next
                    End If
                End If

                'AddHandler SimfCbx.SelectedIndexChanged, AddressOf fuehle_xrewseis_cbxen
                SimfLbl.Text = "Συμφωνία:"
                SimfLbl.Width = 80
                SimfLbl.TextAlign = ContentAlignment.MiddleRight
                XrewsLbl.Text = "Χρεώσεις:"
                XrewsLbl.Width = 80
                XrewsLbl.TextAlign = ContentAlignment.MiddleRight
                KlnsLbl.Text = "Κλίνες:"
                KlnsLbl.Width = 60
                KlnsLbl.TextAlign = ContentAlignment.MiddleRight
                'ParoxLbl.Text = "Παροχή:"
                'ParoxLbl.Width = 80
                'ParoxLbl.TextAlign = ContentAlignment.MiddleRight

                'HmeresLbl.Text = "Ημέρες:"
                HmeresLbl.TextAlign = ContentAlignment.MiddleRight
                'EkptLbl.Text = "Εκπτωση(%):"
                EkptLbl.Text = "Μείωση(%)"
                EkptLbl.TextAlign = ContentAlignment.MiddleRight
                TimiApoLbl.Text = "Τιμή από "
                TimiApoLbl.TextAlign = ContentAlignment.MiddleRight
                'TimiApoLbl.ForeColor = Color.Maroon
                TimiApoLbl.Width = 80
                'HmrsLbl.ForeColor = Color.Maroon
                HmrsLbl.TextAlign = ContentAlignment.MiddleRight
                HmrsLbl.Width = 60
                IsonLbl.Text = "="
                IsonLbl.TextAlign = ContentAlignment.MiddleCenter
                IsonLbl.Width = 30
                InfoLbl.Text = "Ημέρες Χ [Υπνος-    Πρωϊνό-  Γεύμα-  Δείπνo-   Extra]"
                InfoLbl.Width = 400


                'InfoLbl.BackColor = Color.Azure
                Info2Lbl.Width = 300
                'Info2Lbl.BackColor = Color.Azure
                IsonLbl.ForeColor = Color.Maroon
                'SynolLbl.Text = " ΣΥΝΟΛΟ:"
                Info2Lbl.ForeColor = Color.Blue

                TimokChk.Location = New Point(1, count * stepy)

                SimfLbl.Location = New Point(5, count * stepy + 20)
                SimfCbx.Location = New Point(5 + SimfLbl.Width, count * stepy + 20)

                XrewsLbl.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width, count * stepy + 20)
                XrewsCbx.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width + XrewsLbl.Width, count * stepy + 20)

                KlnsLbl.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width + XrewsLbl.Width + XrewsCbx.Width, count * stepy + 20)
                KlnsCbx.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width + XrewsLbl.Width + XrewsCbx.Width + KlnsLbl.Width, count * stepy + 20)

                'ParoxLbl.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width + XrewsLbl.Width + XrewsCbx.Width + KlnsLbl.Width + KlnsCbx.Width, count * stepy + 20)
                'ParoxTbx.Location = New Point(5 + SimfLbl.Width + SimfCbx.Width + XrewsLbl.Width + XrewsCbx.Width + KlnsLbl.Width + KlnsCbx.Width + ParoxLbl.Width, count * stepy + 20)
                'ParoxTbx.TabStop = False
                '

                'Ypologismos Hmeres/apoHmeres gia Ekptosi!
                If count = 0 Then
                    If count = arseasons - 1 Then
                        'Hmer1Tbx.Text = (DateTimePicker3.Value - DateTimePicker2.Value).Days.ToString
                        imeresTotal = (DateTimePicker3.Value.Date - DateTimePicker2.Value.Date).Days.ToString
                        HmrsLbl.Text = imeresTotal.ToString + " X "
                        Imerom1Lbl.Text = DateTimePicker2.Value.Date
                        Imerom2Lbl.Text = DateTimePicker3.Value.Date
                    Else
                        'Hmer1Tbx.Text = (Me.DbhotelDataSet.touristperiodoi(count).mexri - DateTimePicker2.Value).Days.ToString
                        If flag = 1 Then
                            imeresTotal = (Me.DbhotelDataSet.touristperiodoi(count).mexri - DateTimePicker2.Value.Date).Days.ToString + 1
                        Else
                            imeresTotal = (Me.DbhotelDataSet.timeskratisis(index).mexri - DateTimePicker2.Value.Date).Days.ToString + 1
                        End If

                        HmrsLbl.Text = imeresTotal.ToString + " X "
                        Imerom1Lbl.Text = DateTimePicker2.Value.Date
                        If flag = 1 Then
                            Imerom2Lbl.Text = Me.DbhotelDataSet.touristperiodoi(count).mexri.Date
                        Else
                            Imerom2Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).mexri.Date
                        End If


                    End If
                Else
                    If count = arseasons - 1 Then
                        'Hmer1Tbx.Text = (DateTimePicker3.Value - Me.DbhotelDataSet.touristperiodoi(count).apo).Days.ToString
                        If flag = 1 Then
                            imeresTotal = (DateTimePicker3.Value.Date - Me.DbhotelDataSet.touristperiodoi(count).apo).Days.ToString
                        Else
                            imeresTotal = (DateTimePicker3.Value.Date - Me.DbhotelDataSet.timeskratisis(index).apo).Days.ToString
                        End If

                        'HmrsLbl.Text = Hmer1Tbx.Text + " X "
                        HmrsLbl.Text = imeresTotal.ToString + " X "
                        If flag = 1 Then
                            Imerom1Lbl.Text = Me.DbhotelDataSet.touristperiodoi(count).apo.Date
                        Else
                            Imerom1Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).apo.Date
                        End If
                        Imerom2Lbl.Text = DateTimePicker3.Value.Date
                    Else
                        'Hmer1Tbx.Text = (Me.DbhotelDataSet.touristperiodoi(count).mexri - Me.DbhotelDataSet.touristperiodoi(count).apo).Days.ToString
                        If flag = 1 Then
                            imeresTotal = (Me.DbhotelDataSet.touristperiodoi(count).mexri - Me.DbhotelDataSet.touristperiodoi(count).apo).Days.ToString + 1
                            Imerom1Lbl.Text = Me.DbhotelDataSet.touristperiodoi(count).apo.Date
                            Imerom2Lbl.Text = Me.DbhotelDataSet.touristperiodoi(count).mexri.Date
                        Else
                            imeresTotal = (Me.DbhotelDataSet.timeskratisis(index).mexri - Me.DbhotelDataSet.timeskratisis(index).apo).Days.ToString + 1
                            Imerom1Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).apo.Date
                            Imerom2Lbl.Text = Me.DbhotelDataSet.timeskratisis(index).mexri.Date
                        End If
                        HmrsLbl.Text = imeresTotal.ToString + " X "
                    End If
                End If


                'edw upologizw tis imerespliromis ->apo timeskratisis DB (imeres Attribute) ;h ean o User eixei paiksei me tis imerominies 
                'afixis- anaxwrisis tote timi apo imestotal pou exei upologisthei apo panw!
                If timesCount - count > 0 Then ' panelakia me antistixia se timeskratisis eintrag
                    If index <> -1 Then
                        If timokatalog(count).apo = CType(Imerom1Lbl.Text, Date) And timokatalog(count).mexriDB = CType(Imerom2Lbl.Text, Date) Then 'den exei alaksei i Afixi
                            If count = arseasons - 1 Then ' TELEUTAIO PANEL->EXEI NA KANEI ME TON ARIUTMO HMERWN (->-1 LOGW ANAXWRISHS)
                                If index <> Me.DbhotelDataSet.timeskratisis.Count - 1 Then 'DEN EINAI TO TELEUTAIO EINTRAG APO TIMESKRATISEIS
                                    Hmer1Tbx.Text = Me.DbhotelDataSet.timeskratisis(index).imeres - 1 '->IMERES APO DB -1
                                    timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                                Else 'TELEUTAIO EINTRAG APO TIMESKRATISEIS->OK IMERES TAYTIZWNTAI
                                    Hmer1Tbx.Text = Me.DbhotelDataSet.timeskratisis(index).imeres
                                    timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                                End If
                            Else 'DEN EINAI TO TELEUTAIO PANEL
                                If index <> Me.DbhotelDataSet.timeskratisis.Count - 1 Then 'DEN EINAI TO TELEUTAIO EINTRAG APO TIMESKRATISEIS
                                    Hmer1Tbx.Text = Me.DbhotelDataSet.timeskratisis(index).imeres
                                    timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                                Else 'EINAI TO TELEUTAIO EINTRAG APO TIMESKRATISEIS
                                    Hmer1Tbx.Text = Me.DbhotelDataSet.timeskratisis(index).imeres + 1
                                    timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                                End If
                            End If
                        Else
                            Hmer1Tbx.Text = imeresTotal
                            timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                        End If
                    Else
                        Hmer1Tbx.Text = imeresTotal
                        timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                    End If
                Else ' panelakia XWRIS antistixia se timeskratisis eintrag-> o user feripin exei paratinei tin anaxwrisi toso wste na alaksei touristiki periodo!
                    Hmer1Tbx.Text = imeresTotal
                    timokatalog(count).imeresPlirom = Hmer1Tbx.Text
                End If
                timokatalog(count).imeresTotal = imeresTotal
                timokatalog(count).apo = Imerom1Lbl.Text
                timokatalog(count).mexri = Imerom2Lbl.Text

                HmeresLbl.Text = "Ημέρες " + imeresTotal.ToString + "/"

                TimiApoLbl.Location = New Point(5, count * stepy + 2 * EkptTbx.Height + 10) '10 + SimfLbl.Height 
                Imerom1Lbl.Location = New Point(5 + TimiApoLbl.Width, count * stepy + 2 * EkptTbx.Height + 10)
                Imerom2Lbl.Location = New Point(10 + TimiApoLbl.Width + Imerom1Lbl.Width, count * stepy + 2 * EkptTbx.Height + 10)
                HmeresLbl.Location = New Point(5 + TimiApoLbl.Width + Imerom1Lbl.Width + Imerom2Lbl.Width, count * stepy + 2 * EkptTbx.Height + 10)
                Hmer1Tbx.Location = New Point(5 + TimiApoLbl.Width + Imerom1Lbl.Width + Imerom2Lbl.Width + HmeresLbl.Width, count * stepy + 2 * EkptTbx.Height + 10)
                EkptLbl.Location = New Point(5 + TimiApoLbl.Width + Imerom1Lbl.Width + Imerom2Lbl.Width + HmeresLbl.Width + Hmer1Tbx.Width, count * stepy + 2 * EkptTbx.Height + 10)
                EkptTbx.Location = New Point(5 + TimiApoLbl.Width + Imerom1Lbl.Width + Imerom2Lbl.Width + HmeresLbl.Width + Hmer1Tbx.Width + EkptLbl.Width, count * stepy + 2 * EkptTbx.Height + 10)
                If status = 2 Then ' Proetoimasia gia deouleumena
                    DedoulLbl.Name = "Dedo"
                    DedoulLbl.TextAlign = ContentAlignment.BottomLeft
                    DedoulLbl.ForeColor = Color.Black
                    'DedoulLbl.BackColor = Color.Azure
                    DedoulLbl.Width = 95
                    DedoulLbl.Text = "Δεδουλευμ.:"
                    DedoulLbl.Location = New Point(55 + YpnosTbx.Width + 4 * YpnosTbx.Width + 3 * IsonLbl.Width + SumLbl.Width, count * stepy + 4 * EkptTbx.Height)
                    'DedoulLbl.Location = New Point(5 + TimiApoLbl.Width + Imerom1Tbx.Width + Imerom2Tbx.Width + HmeresLbl.Width + Hmer1Tbx.Width + EkptLbl.Width + EkptTbx.Width, count * stepy + 2 * EkptTbx.Height + 10)
                    DedoulLbl.Visible = False
                    DedoulPosLbl.Name = "DedP"
                    DedoulPosLbl.TextAlign = ContentAlignment.BottomLeft
                    DedoulPosLbl.ForeColor = Color.Maroon
                    DedoulPosLbl.Width = 80
                    'DedoulPosLbl.Location = New Point(55 + YpnosTbx.Width + 6.5 * YpnosTbx.Width + 3 * IsonLbl.Width, count * stepy + 4 * EkptTbx.Height - 5)
                    DedoulPosLbl.Location = New Point(55 + YpnosTbx.Width + 4 * YpnosTbx.Width + 3 * IsonLbl.Width + SumLbl.Width + DedoulLbl.Width, count * stepy + 4 * EkptTbx.Height)
                    DedoulPosLbl.Visible = False
                End If

                HmrsLbl.Location = New Point(55, count * stepy + 4 * EkptTbx.Height)
                YpnosTbx.Location = New Point(55 + YpnosTbx.Width, count * stepy + 4 * EkptTbx.Height)
                PrwinTbx.Location = New Point(55 + YpnosTbx.Width + YpnosTbx.Width, count * stepy + 4 * EkptTbx.Height)
                GeumTbx.Location = New Point(55 + YpnosTbx.Width + 2 * YpnosTbx.Width, count * stepy + 4 * EkptTbx.Height)
                DeipTbx.Location = New Point(55 + YpnosTbx.Width + 3 * YpnosTbx.Width, count * stepy + 4 * EkptTbx.Height)
                ExtrTbx.Location = New Point(55 + YpnosTbx.Width + 4 * YpnosTbx.Width, count * stepy + 4 * EkptTbx.Height)
                IsonLbl.Location = New Point(55 + YpnosTbx.Width + 4 * YpnosTbx.Width + 2 * IsonLbl.Width, count * stepy + 4 * EkptTbx.Height)
                SumLbl.Location = New Point(55 + YpnosTbx.Width + 4 * YpnosTbx.Width + 3 * IsonLbl.Width, count * stepy + 4 * EkptTbx.Height)

                InfoLbl.Location = New Point(35, count * stepy + 5 * EkptTbx.Height + 3)
                Info2Lbl.Location = New Point(35 + InfoLbl.Width, count * stepy + 5 * EkptTbx.Height + 3)

                KatalogPnl.Size = New Point(Kratiseis4Pnl.Width - 30, 120)
                KatalogPnl.Location = New Point(3, count * (80 + 20 + SimfLbl.Height))
                '      YpnosTbx, PrwinTbx, GeumTbx, DeipTbx, ExtrTbx
                'AddHandler EkptTbx.KeyPress, AddressOf komma_einschalten
                'AddHandler YpnosTbx.KeyPress, AddressOf komma_einschalten
                'AddHandler PrwinTbx.KeyPress, AddressOf komma_einschalten
                'AddHandler GeumTbx.KeyPress, AddressOf komma_einschalten
                'AddHandler DeipTbx.KeyPress, AddressOf komma_einschalten
                'AddHandler ExtrTbx.KeyPress, AddressOf komma_einschalten
                AddHandler TimokChk.CheckedChanged, AddressOf timok_chk_changed
                AddHandler SimfCbx.SelectedIndexChanged, AddressOf simfon_cboxen_index
                AddHandler XrewsCbx.SelectedIndexChanged, AddressOf xrews_cboxen_index
                AddHandler KlnsCbx.SelectedIndexChanged, AddressOf klins_cboxen_index
                AddHandler ExtrTbx.Leave, AddressOf txtboxen_leave
                AddHandler ExtrTbx.Click, AddressOf TextBox_SelectAllText
                AddHandler YpnosTbx.Leave, AddressOf txtboxen_leave
                AddHandler YpnosTbx.Click, AddressOf TextBox_SelectAllText
                AddHandler PrwinTbx.Leave, AddressOf txtboxen_leave
                AddHandler PrwinTbx.Click, AddressOf TextBox_SelectAllText
                AddHandler GeumTbx.Leave, AddressOf txtboxen_leave
                AddHandler GeumTbx.Click, AddressOf TextBox_SelectAllText
                AddHandler DeipTbx.Leave, AddressOf txtboxen_leave
                AddHandler DeipTbx.Click, AddressOf TextBox_SelectAllText
                'AddHandler SumTbx.Leave, AddressOf txtboxen_leave
                AddHandler EkptTbx.Leave, AddressOf ekptbox_leave
                AddHandler Hmer1Tbx.Leave, AddressOf imeres_leave



                If status = 2 Then ' gia na min epirtpwntai allages stou diemenwntes ean exei perasei i imerominia KatalogouPnl
                    If count <> arseasons - 1 Then
                        'MsgBox("1" + timokatalog(count).mexri.Date.ToString)
                        If timokatalog(count).mexri < imeromErgasias Then
                            KatalogPnl.Enabled = False
                        End If
                    Else
                        'MsgBox("2" + timokatalog(count).mexri.Date.ToString)
                        If timokatalog(count).mexri.AddDays(-1) < imeromErgasias Then
                            KatalogPnl.Enabled = False
                        End If
                    End If
                End If
                KatalogPnl.Controls.Add(TimokChk)
                KatalogPnl.Controls.Add(SimfLbl)
                KatalogPnl.Controls.Add(SimfCbx)
                KatalogPnl.Controls.Add(XrewsLbl)
                KatalogPnl.Controls.Add(XrewsCbx)
                KatalogPnl.Controls.Add(KlnsLbl)
                KatalogPnl.Controls.Add(KlnsCbx)
                'KatalogPnl.Controls.Add(ParoxLbl)
                'KatalogPnl.Controls.Add(ParoxTbx)
                KatalogPnl.Controls.Add(HmeresLbl)
                KatalogPnl.Controls.Add(Hmer1Tbx)
                'KatalogPnl.Controls.Add(Hmer2Tbx)
                KatalogPnl.Controls.Add(EkptLbl)
                KatalogPnl.Controls.Add(EkptTbx)
                KatalogPnl.Controls.Add(TimiApoLbl)
                KatalogPnl.Controls.Add(Imerom1Lbl)
                KatalogPnl.Controls.Add(Imerom2Lbl)
                KatalogPnl.Controls.Add(HmrsLbl)
                KatalogPnl.Controls.Add(YpnosTbx)
                KatalogPnl.Controls.Add(PrwinTbx)
                KatalogPnl.Controls.Add(GeumTbx)
                KatalogPnl.Controls.Add(DeipTbx)
                KatalogPnl.Controls.Add(ExtrTbx)
                KatalogPnl.Controls.Add(InfoLbl)
                KatalogPnl.Controls.Add(Info2Lbl)
                KatalogPnl.Controls.Add(IsonLbl)
                KatalogPnl.Controls.Add(SumLbl)
                KatalogPnl.Controls.Add(DedoulLbl)
                KatalogPnl.Controls.Add(DedoulPosLbl)
                Kratiseis4Pnl.Controls.Add(KatalogPnl)

            Next

            'SynolPnl.Location = New Point(Kratiseis4Pnl.Location.X + Kratiseis4Pnl.Width - SynolPnl.Width, Kratiseis4Pnl.Location.Y + Kratiseis4Pnl.Height + 5)
            'ZentralPnl.Controls.Add(SynolPnl)
        End If



        Dim DeleteButton As New Button
        DeleteButton.BackColor = Color.Azure
        DeleteButton.ForeColor = Color.Maroon
        DeleteButton.Text = "Διαγραφή"
        DeleteButton.Size = New Point(140, 30)
        DeleteButton.Cursor = Cursors.Hand
        If status = 1 Then
            DeleteButton.Location = New Point(SynolPnl.Width / 2 + 150, 10)
        Else
            DeleteButton.Location = New Point(SynolPnl.Width / 2 + 150, 20)
        End If

        AddHandler DeleteButton.Click, AddressOf delete_kratisi

        If status = 1 Then
            Dim NeuButton As New Button
            NeuButton.BackColor = Color.Azure
            NeuButton.ForeColor = Color.Maroon
            NeuButton.Text = "Νέα Κράτηση"
            NeuButton.Size = New Point(140, 30)
            NeuButton.Cursor = Cursors.Hand
            NeuButton.Location = New Point(SynolPnl.Width / 2 - 50, 10)

            AddHandler NeuButton.Click, AddressOf nea_kratisi

            Dim SpeicherButton As New Button
            SpeicherButton.Name = "Speichern"
            SpeicherButton.BackColor = Color.Azure
            SpeicherButton.ForeColor = Color.Maroon
            SpeicherButton.Text = "Αποθήκευση"
            SpeicherButton.Size = New Point(140, 30)
            SpeicherButton.Cursor = Cursors.Hand
            SpeicherButton.Location = New Point(SynolPnl.Width / 2 - 250, 10)

            AddHandler SpeicherButton.Click, AddressOf timokat_speichern

            Dim AfixiButton As New Button
            AfixiButton.Name = "Afixi"
            AfixiButton.BackColor = Color.Azure
            AfixiButton.ForeColor = Color.Green
            AfixiButton.Text = "Άφιξη"
            AfixiButton.Size = New Point(140, 30)
            AfixiButton.Cursor = Cursors.Hand
            'AfixiButton.Location = New Point(SynolPnl.Width / 2 - 160, 100)
            AfixiButton.Location = New Point(SynolPnl.Width / 2 - 250, 50)

            If imeromErgasias <> DateTimePicker2.Value.Date Then
                AfixiButton.Enabled = False
                'DeleteButton.Enabled = False->     edw alaksa gia mporw na kanw delete mia kratisi->KOITA DIREKT APO KATW!
            End If
            If kwdikoKratisisDB = -1 And status = 1 Then
                DeleteButton.Enabled = False
            End If
            Dim OverButton As New Button
            OverButton.Name = "Over"
            OverButton.BackColor = Color.Azure
            OverButton.ForeColor = Color.Green
            OverButton.Text = "OV-BOOK"
            OverButton.Size = New Point(140, 30)
            OverButton.Cursor = Cursors.Hand
            'OverButton.Location = New Point(SynolPnl.Width / 2 + 60, 100)
            OverButton.Location = New Point(SynolPnl.Width / 2 - 50, 50)

            If imeromErgasias <> DateTimePicker2.Value.Date Then
                OverButton.Enabled = False
            End If
            AddHandler OverButton.Click, AddressOf timokat_speichern
            AddHandler AfixiButton.Click, AddressOf timokat_speichern

            Dim NonShowButton As New Button
            NonShowButton.BackColor = Color.Azure
            NonShowButton.ForeColor = Color.Green
            NonShowButton.Text = "Non show"
            NonShowButton.Size = New Point(140, 30)
            NonShowButton.Cursor = Cursors.Hand
            NonShowButton.Location = New Point(SynolPnl.Width / 2 + 150, 50)

            If imeromErgasias <> DateTimePicker2.Value.Date Then
                NonShowButton.Enabled = False
            End If
            AddHandler NonShowButton.Click, AddressOf non_show_kratisi
            NonShowLbl.Text = ""


            ButtonsPnl.Controls.Add(NonShowButton)
            ButtonsPnl.Controls.Add(DeleteButton)
            ButtonsPnl.Controls.Add(NeuButton)
            ButtonsPnl.Controls.Add(SpeicherButton)
            ButtonsPnl.Controls.Add(AfixiButton)
            ButtonsPnl.Controls.Add(OverButton)
        Else
            Dim SpeichDiamenwnButton As New Button
            SpeichDiamenwnButton.Name = "Speichern"
            SpeichDiamenwnButton.BackColor = Color.Azure
            SpeichDiamenwnButton.ForeColor = Color.Maroon
            SpeichDiamenwnButton.Text = "Αποθήκευση"
            SpeichDiamenwnButton.Size = New Point(140, 30)
            SpeichDiamenwnButton.Cursor = Cursors.Hand
            SpeichDiamenwnButton.Location = New Point(SynolPnl.Width / 2 - 250, 20)

            AddHandler SpeichDiamenwnButton.Click, AddressOf diamenwta_speichern

            Dim OverDiamenwnButton As New Button
            OverDiamenwnButton.Name = "Over"
            OverDiamenwnButton.BackColor = Color.Azure
            OverDiamenwnButton.ForeColor = Color.Maroon
            OverDiamenwnButton.Text = "OV-BOOK"
            OverDiamenwnButton.Size = New Point(140, 30)
            OverDiamenwnButton.Cursor = Cursors.Hand
            OverDiamenwnButton.Location = New Point(SynolPnl.Width / 2 - 50, 20)

            AddHandler OverDiamenwnButton.Click, AddressOf over_erneuern

            If anaxSperre Then
                ButtonsPnl.Enabled = False
            End If
            If Me.DbhotelDataSet.kratiseis(0).afixi.Date <> imeromErgasias Then
                DeleteButton.Enabled = False
            End If
            ' periptwsi apo akyrosi_kleisimatos na exei epilegei Progenesteri imerominia ergasias apo afixi 
            If Me.DbhotelDataSet.kratiseis(0).afixi.Date > imeromErgasias AndAlso Me.DbhotelDataSet.kratiseis(0).checkin Then
                DeleteButton.Enabled = False
                SpeichDiamenwnButton.Enabled = False
                OverDiamenwnButton.Enabled = False
            End If
            ButtonsPnl.Controls.Add(DeleteButton)
            ButtonsPnl.Controls.Add(SpeichDiamenwnButton)
            ButtonsPnl.Controls.Add(OverDiamenwnButton)

        End If
        ButtonsPnl.Size = New Point(SynolPnl.Width, 120)
        ZentralPnl.Controls.Add(ButtonsPnl)
        ButtonsPnl.Location = New Point(18, SynolPnl.Location.Y + SynolPnl.Height)

    End Sub
    'ean checked tote to timi attribute stin DB timeskratisis den einai -1 => mporw na antlisw plirofories apo to times Table
    ' gia xrewsi (RR,HB ktl) klines, paidia (->oi plirofories emfanizontai sto Info2Lbl ssto katw meros)
    Private Sub timok_chk_changed(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB As Integer
        Dim index, i As Int16
        Dim pnl(), find() As Object

        If flagKr = 1 Then ' ena panelaki touristikis periodou tote to name tou emperiexei tin touristiki periodo kwd
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else 'panelaki me timeskratisis->to name emperiexei ton kwd tis DB timeskratisis->apo auto kanw identifizieren mesw tou .kwdDB
            'tou Pio index tou timokatalog Dstr ist angesprochen
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If
        'tourist = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
        'index = get_index_v_timokatalog(tourist)
        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
        If sender.checked = True Then
            Try
                find = pnl(0).Controls.Find("Simf" + kwdDB.ToString, False)
                find(0).enabled = True
                If find(0).items.count > 0 Then
                    Try
                        find(0).SelectedIndex = -1
                    Catch ex As InvalidOperationException
                    End Try
                End If
                find = pnl(0).Controls.Find("Xres" + kwdDB.ToString, False)
                If find(0).items.count > 0 Then
                    Try
                        find(0).SelectedIndex = -1
                    Catch ex As Exception
                    End Try
                End If
                find(0).items.clear()
                find = pnl(0).Controls.Find("Klns" + kwdDB.ToString, False)
                If find(0).items.count > 0 Then
                    Try
                        find(0).SelectedIndex = -1
                    Catch ex As Exception
                    End Try
                End If
                'find(0).selectedindex = -1
                find(0).items.clear()
                find(0).enabled = True
                timokatalog(index).timi = Me.DbhotelDataSet.times(0).kwd
            Catch ex As IndexOutOfRangeException
                timokatalog(index).timi = -1
            End Try
        Else
            find = pnl(0).Controls.Find("Simf" + kwdDB.ToString, False)
            find(0).enabled = False
            find = pnl(0).Controls.Find("Xres" + kwdDB.ToString, False)
            find(0).items.clear()
            For i = 0 To Me.DbhotelDataSet.xrewseis.Count - 1
                find(0).Items.Add(Me.DbhotelDataSet.xrewseis(i).xrewsi)
            Next
            find = pnl(0).Controls.Find("Klns" + kwdDB.ToString, False)

            find(0).enabled = False
            timokatalog(index).timi = -1
        End If
    End Sub

    'kathe timokatalogos (PANEL) einai identifizierbar apo kwd toyristperiodou (kai oxi apo season->giati tha mporousame na eixame 
    'epanalambnaomenes xrewseis)-> mesa ston katalogo to xrewseisCBX mporei na einai identifierbar me kwd season (OXI omws oi simfoniesCBX)
    Private Sub simfon_cboxen_index(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB, season, simfonia As Integer
        Dim pnl(), find() As Object
        Dim i, index As Int16

        kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)

        If flagKr = 1 Then
            index = get_index_v_timokatalog(kwdDB)
        Else
            index = get_index_v_timokatalog_2(kwdDB)
        End If
        'kwd touristikis periodou->kathe timokatologos exei diaforetiko
        'tourist = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
        ''pios timokatalogos stin DSTR ?
        'index = get_index_v_timokatalog(tourist)

        'kwd season tou timokatalogou
        season = Me.TouristperiodoiTableAdapter.GetSeasonByKwd(timokatalog(index).tourist)
        'kwd simfonias tou timokatoalogou
        simfonia = (Me.SimfoniesTableAdapter.GetKwdBySimbolaioAaTiposSeason(currentsimbolaio, sender.selecteditem, currenttipos, season))
        'MsgBox(simfonia)
        'simfonia stin DSTR spechern
        timokatalog(index).simfonia = simfonia
        'rauskriegen olwn twn xrewsewn apo table times by simfonia kwd  
        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)

        Me.TimesTableAdapter.GetXrewseisBySimfonia(Me.DbhotelDataSet.times, simfonia)
        find = pnl(0).Controls.Find("Xres" + kwdDB.ToString, False)
        'gemise to xrewseis Cbox

        find(0).items.clear()


        For i = 0 To Me.DbhotelDataSet.times.Count - 1
            find(0).Items.Add(get_xrewsi_by_kwd(Me.DbhotelDataSet.times(i).xrewsi))
            'find(0).selectedIndex = 0
        Next
        If Me.DbhotelDataSet.times.Count > 0 Then
            find(0).selectedIndex = 0
        Else
            find(0).selectedIndex = -1
        End If


        'rauskriegen to xrewseisCbox  gia ton antistoixo timokatalogo (->identifizierbar me tousristKwd)

    End Sub
    Private Sub xrews_cboxen_index(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB, xrewsi As Integer
        Dim pnl(), find() As Object
        Dim i, index As Int16
        Dim str As String

        If flagKr = 1 Then
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else 'panelaki me timeskratisis->to name emperiexei ton kwd tis DB timeskratisis->apo auto kanw identifizieren mesw tou .kwdDB
            'tou Pio index tou timokatalog Dstr ist angesprochen
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If
        'kwd touristikis periodou->kathe timokatologos exei diaforetiko
        'tourist = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
        'index = get_index_v_timokatalog(tourist)
        'kwd season tou timokatalogou
        'Try
        xrewsi = Me.XrewseisTableAdapter.GetKwdByXrewsi(sender.selectedItem)
        'Catch ex As Exception

        'End Try

        timokatalog(index).xrewsi = xrewsi

        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)

        find = pnl(0).Controls.Find("Klns" + kwdDB.ToString, False)
        find(0).items.clear()

        Me.TimesTableAdapter.FillOrderByKlines(Me.DbhotelDataSet.times, timokatalog(index).simfonia, xrewsi)

        For i = 0 To Me.DbhotelDataSet.times.Count - 1
            str = Me.DbhotelDataSet.times(i).klines.ToString + " Κλιν./" + Me.DbhotelDataSet.times(i).paidi.ToString + " Παιδ.(" + Me.DbhotelDataSet.times(i).atoma.ToString + " Ατομ.)"
            find(0).Items.Add(str)
        Next
        If Me.DbhotelDataSet.times.Count > 0 Then
            find(0).selectedIndex = 0
        Else
            find(0).selectedIndex = -1
        End If

        'RAECHT SPAET->EDW KANW SIMOULIEREN EAN ALAKSEI H XREWSI MESA STIN dIAMONI OTI KANEI txtboxen_leave
        'gia na YPOLOGISW ta DEDOULEUMENA!!!!!!!!!!!!!
        If status = 2 AndAlso (timokatalog(index).xrewsi <> timokatalog(index).xrewsiDB OrElse timokatalog(index).dedoulPos <> 0) AndAlso currentAfixi <> imeromErgasias Then
            find = pnl(0).Controls.Find("Extr" + kwdDB.ToString, False)
            txtboxen_leave(find(0), e)
        End If
    End Sub
    Private Sub klins_cboxen_index(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB As Integer
        Dim klns, paid, atom, ilikiaPaid As Int16
        Dim index As Int16
        Dim split1 As String() = sender.selecteditem.ToString.Split(New [Char]() {"/"c})
        'Dim split2 As String = split1(1).Split(New [Char]() {"("c})
        If flagKr = 1 Then
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If
        'tourist = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
        'index = get_index_v_timokatalog(tourist)
        klns = CType(split1(0).Substring(0, split1(0).Length - 6).ToString, Int16)
        Dim split2 As String() = split1(1).ToString.Split(New [Char]() {"("c})
        paid = CType(split2(0).Substring(0, split2(0).Length - 6).ToString.Trim, Int16)
        atom = CType(split2(1).Substring(0, split2(1).Length - 7).ToString.Trim, Int16)
        'MsgBox(timokatalog(index).simfonia)
        'MsgBox(timokatalog(index).xrewsi)
        Try
            If klns = 1 Then
                If Not Me.PaidiTbx1.Text.Equals("") Then
                    ilikiaPaid = Me.SimfoniesTableAdapter.GetIlikiaPaidMonoklino(timokatalog(index).simfonia)
                    If ilikiaPaid <> 0 AndAlso ilikiaPaid < Me.PaidiTbx1.Text Then
                        MsgBox("Ηλικία Παιδιού μεγαλύτερη απο αυτήν στην συμφωνία !", MsgBoxStyle.Information, "winfo\nikEl.")
                    End If
                End If
            ElseIf klns = 2 Then
                If Not Me.PaidiTbx1.Text.Equals("") Then
                    ilikiaPaid = Me.SimfoniesTableAdapter.GetIlikiaPaidDiklino(timokatalog(index).simfonia)
                    If ilikiaPaid <> 0 AndAlso ilikiaPaid < Me.PaidiTbx1.Text Then
                        MsgBox("Ηλικία Παιδιού μεγαλύτερη απο αυτήν στην συμφωνία !", MsgBoxStyle.Information, "winfo\nikEl.")
                    End If
                End If
            Else
                If Not Me.PaidiTbx1.Text.Equals("") AndAlso Not Me.PaidiTbx1.Text.Equals("") Then
                    ilikiaPaid = Me.SimfoniesTableAdapter.GetIlikiaPrwtoPaidiapoDuo(timokatalog(index).simfonia)
                    If ilikiaPaid <> 0 AndAlso ilikiaPaid < Me.PaidiTbx1.Text Then
                        MsgBox("Ηλικία 1ου Παιδιού μεγαλύτερη απο αυτήν στην συμφωνία !", MsgBoxStyle.Information, "winfo\nikEl.")
                    End If
                    ilikiaPaid = Me.SimfoniesTableAdapter.GetIlikiaDeuteroPaidiapoDuo(timokatalog(index).simfonia)
                    If ilikiaPaid <> 0 AndAlso ilikiaPaid < Me.PaidiTbx2.Text Then
                        MsgBox("Ηλικία 2ου Παιδιού μεγαλύτερη απο αυτήν στην συμφωνία !", MsgBoxStyle.Information, "winfo\nikEl.")
                    End If

                End If

            End If
        Catch ex As InvalidOperationException

        End Try
        Me.TimesTableAdapter.FillBySimfXrewsPaidAtom(Me.DbhotelDataSet.times, timokatalog(index).simfonia, timokatalog(index).xrewsi, klns, atom, paid)
        'MsgBox(Me.DbhotelDataSet.times.Count)
        timokatalog(index).timi = Me.DbhotelDataSet.times(0).kwd
        timokatalog(index).ypnos = Me.DbhotelDataSet.times(0).ipnos
        timokatalog(index).prwino = Me.DbhotelDataSet.times(0).prwino
        timokatalog(index).geuma = Me.DbhotelDataSet.times(0).geuma
        timokatalog(index).deipno = Me.DbhotelDataSet.times(0).deipno
        timokatalog(index).paroxi = 0

        setze_times_anal(kwdDB, index)
    End Sub

    Private Sub setze_times_anal(ByVal kwdDB As Integer, ByVal indx As Int16)
        Dim pnl(), find() As Object
        Dim zahl, zahlai, zahlextr, sum, dedoulPoso As Single
        Dim dedoulDays, restDays As Int16

        sum = 0
        zahl = 0
        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)

        find = pnl(0).Controls.Find("Ypno" + kwdDB.ToString, False)

        zahl = timokatalog(indx).ypnos * (1 - timokatalog(indx).ekptosi / 100) * (timokatalog(indx).imeresPlirom / timokatalog(indx).imeresTotal)

        If timokatalog(indx).xrewsi = 6 AndAlso timokatalog(indx).paroxi = 0 AndAlso timokatalog(indx).deipno = 0 AndAlso timokatalog(indx).geuma = 0 AndAlso timokatalog(indx).prwino = 0 Then
            zahlai = (zahl * (100 - Me.DbhotelDataSet.etaireia(0).extras) / 100).ToString("F")
            zahlextr = zahl - zahlai
            find(0).text = zahlai.ToString("F")
            timokatalog(indx).ypnos = zahlai.ToString("F")
            timokatalog(indx).ypnosTemp = zahlai.ToString("F")
            sum = sum + zahlai.ToString("F")
            timokatalog(indx).paroxi = zahlextr.ToString("F")
            timokatalog(indx).paroxiTemp = zahlextr.ToString("F")
        Else
            find(0).text = zahl.ToString("F")
            timokatalog(indx).ypnosTemp = zahl.ToString("F")
            sum = sum + zahl.ToString("F")
        End If


        find = pnl(0).Controls.Find("Prwi" + kwdDB.ToString, False)

        zahl = timokatalog(indx).prwino * (1 - timokatalog(indx).ekptosi / 100) * (timokatalog(indx).imeresPlirom / timokatalog(indx).imeresTotal)

        find(0).text = zahl.ToString("F")
        timokatalog(indx).prwinoTemp = zahl.ToString("F")
        sum = sum + zahl.ToString("F")

        find = pnl(0).Controls.Find("Geum" + kwdDB.ToString, False)

        zahl = timokatalog(indx).geuma * (1 - timokatalog(indx).ekptosi / 100) * (timokatalog(indx).imeresPlirom / timokatalog(indx).imeresTotal)

        find(0).text = zahl.ToString("F")
        timokatalog(indx).geumaTemp = zahl.ToString("F")
        sum = sum + zahl.ToString("F")

        find = pnl(0).Controls.Find("Dipn" + kwdDB.ToString, False)
        'If (timokatalog(indx).mexriDB <> timokatalog(indx).mexri) Then
        '    zahl = 0
        'Else
        zahl = timokatalog(indx).deipno * (1 - timokatalog(indx).ekptosi / 100) * (timokatalog(indx).imeresPlirom / timokatalog(indx).imeresTotal)
        'End If
        find(0).text = zahl.ToString("F")
        timokatalog(indx).deipnoTemp = zahl.ToString("F")
        sum = sum + zahl.ToString("F")

        find = pnl(0).Controls.Find("Extr" + kwdDB.ToString, False)
        'If (timokatalog(indx).mexriDB <> timokatalog(indx).mexri) Then
        '    zahl = 0
        'Else
        zahl = timokatalog(indx).paroxi * (1 - timokatalog(indx).ekptosi / 100) * (timokatalog(indx).imeresPlirom / timokatalog(indx).imeresTotal)
        'End If

        find(0).text = zahl.ToString("F")
        timokatalog(indx).paroxiTemp = zahl.ToString("F")
        sum = sum + zahl.ToString("F")

        If status = 2 Then ' se peptosi pou alaxthei stous diamenwntes
            If timokatalog(indx).apo < imeromErgasias AndAlso timokatalog(indx).mexri >= imeromErgasias Then ' meta tin imerominia afixis->simainei oti uparxei sto biblio portas Eintrag me times
                If timokatalog(indx).ypnosDB <> timokatalog(indx).ypnosTemp Or timokatalog(indx).prwinoDB <> timokatalog(indx).prwinoTemp Or timokatalog(indx).deipnoDB <> timokatalog(indx).deipnoTemp Or timokatalog(indx).geumaDB <> timokatalog(indx).geumaTemp Or timokatalog(indx).paroxiDB <> timokatalog(indx).paroxiTemp Then
                    dedoulDays = imeromErgasias.DayOfYear - timokatalog(indx).apo.DayOfYear
                    restDays = timokatalog(indx).imeresTotal - dedoulDays
                End If
            End If
        End If

        If status = 1 Then
            zahl = timokatalog(indx).imeresTotal * sum
        Else ' stous diamenwntes meta tin afixi (imerominia)
            If restDays = 0 Then
                zahl = timokatalog(indx).imeresTotal * sum
                pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                find = pnl(0).Controls.Find("Dedo", False)
                find(0).visible = False
                pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                find = pnl(0).Controls.Find("DedP", False)
                find(0).text = dedoulPoso.ToString("N")
                find(0).visible = False
            Else
                zahl = restDays * sum
                dedoulPoso = dedoulDays * (timokatalog(indx).ypnosDB + timokatalog(indx).prwinoDB + timokatalog(indx).geumaDB + timokatalog(indx).deipnoDB + timokatalog(indx).paroxiDB)
                timokatalog(indx).dedoulPos = dedoulPoso
                pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                find = pnl(0).Controls.Find("Dedo", False)
                find(0).visible = True
                pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                find = pnl(0).Controls.Find("DedP", False)
                find(0).text = dedoulPoso.ToString("N")
                find(0).visible = True
            End If
        End If
        find = pnl(0).Controls.Find("Summ" + kwdDB.ToString, False)
        timokatalog(indx).synoloTemp = zahl '+ dedoulPoso
        find(0).text = zahl.ToString("N")
        setze_sum_timokat()


    End Sub
    'Boxen me times sta panelakia me tis times
    Private Sub txtboxen_leave(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB As Integer
        Dim index, dedoulDays As Int16
        Dim zahl, zahl1, sum, dedoulPoso As Single
        Dim pnl(), find() As Object

        sum = 0
        If flagKr = 1 Then 'prokeitai gia  panelaki xwris antistoixo eintrag stis timeskratiseis DB Table
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else 'panelaki me timeskratisis->to name emperiexei ton kwd tis DB timeskratisis->apo auto kanw identifizieren mesw tou .kwdDB
            'tou Pio index tou timokatalog Dstr ist angesprochen
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If

        Try
            zahl = Math.Abs(CType(sender.text, Single))
            sender.text = zahl.ToString("F")
        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("F")
        End Try

        If sender.name.Equals("Ypno" + kwdDB.ToString) Then

            If sender.text <> timokatalog(index).ypnosTemp.ToString Then
                If timokatalog(index).xrewsi = 6 Then ' Ean einai xrewsi All Inclusiv!!!!!!!!!!!!!
                    pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                    find = pnl(0).Controls.Find("Extr" + kwdDB.ToString, False)
                    If sender.text <> timokatalog(index).ypnosTemp.ToString AndAlso find(0).text = 0 AndAlso timokatalog(index).deipno = 0 AndAlso timokatalog(index).geuma = 0 AndAlso timokatalog(index).prwino = 0 Then
                        zahl1 = (zahl * (100 - Me.DbhotelDataSet.etaireia(0).extras) / 100).ToString("F")
                        sender.text = zahl1.ToString("F")
                        timokatalog(index).ypnosTemp = sender.text
                        find(0).text = (zahl - zahl1).ToString("F")
                        timokatalog(index).paroxiTemp = find(0).text
                        If timokatalog(index).paroxi = 0 Then
                            timokatalog(index).paroxi = timokatalog(index).paroxiTemp
                        End If
                    Else
                        timokatalog(index).ypnosTemp = sender.text
                    End If
                Else
                    timokatalog(index).ypnosTemp = sender.text
                End If
            End If
            If timokatalog(index).ypnos = 0 Then
                timokatalog(index).ypnos = timokatalog(index).ypnosTemp
            End If

        ElseIf sender.name.Equals("Prwi" + kwdDB.ToString) Then
            If sender.text <> timokatalog(index).prwinoTemp.ToString Then
                timokatalog(index).prwinoTemp = sender.text
            End If
            If timokatalog(index).prwino = 0 Then
                timokatalog(index).prwino = timokatalog(index).prwinoTemp
            End If
        ElseIf sender.name.Equals("Geum" + kwdDB.ToString) Then
            If sender.text <> timokatalog(index).geumaTemp.ToString Then
                timokatalog(index).geumaTemp = sender.text
            End If
            If timokatalog(index).geuma = 0 Then
                timokatalog(index).geuma = timokatalog(index).geumaTemp
            End If
        ElseIf sender.name.Equals("Dipn" + kwdDB.ToString) Then
            If sender.text <> timokatalog(index).deipnoTemp.ToString Then
                timokatalog(index).deipnoTemp = sender.text
            End If
            If timokatalog(index).deipno = 0 Then
                timokatalog(index).deipno = timokatalog(index).deipnoTemp
            End If
        ElseIf sender.name.Equals("Extr" + kwdDB.ToString) Then
            If sender.text <> timokatalog(index).paroxiTemp.ToString Then
                timokatalog(index).paroxiTemp = sender.text
            End If
            If timokatalog(index).paroxi = 0 Then
                timokatalog(index).paroxi = timokatalog(index).paroxiTemp
            End If
        End If

        'sum = timokatalog(index).imeresTotal * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp) * timokatalog(index).imeresPlirom / timokatalog(index).imeresTotal * (1 - timokatalog(index).ekptosi / 100)
        If status = 1 Then
            sum = timokatalog(index).imeresTotal * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
        Else ' status 2 diamenwntes->allagh timwn exei antikrisma apo dw kai twra kai oxi anadromika apo tin arxi tis periodou! ->logw bibliou portas!
            If timokatalog(index).apo < imeromErgasias AndAlso timokatalog(index).mexri >= imeromErgasias Then
                'tsekarisma gia allagi timwn!
                If timokatalog(index).ypnosDB <> timokatalog(index).ypnosTemp Or timokatalog(index).prwinoDB <> timokatalog(index).prwinoTemp Or timokatalog(index).deipnoDB <> timokatalog(index).deipnoTemp Or timokatalog(index).geumaDB <> timokatalog(index).geumaTemp Or timokatalog(index).paroxiDB <> timokatalog(index).paroxiTemp Or timokatalog(index).xrewsiDB <> timokatalog(index).xrewsi Then

                    'dedoulDays = imeromErgasias.DayOfYear - timokatalog(index).apo.DayOfYear
                    dedoulDays = imeromErgasias.Subtract(timokatalog(index).apo).Days
                    dedoulPoso = dedoulDays * (timokatalog(index).ypnosDB + timokatalog(index).prwinoDB + timokatalog(index).geumaDB + timokatalog(index).deipnoDB + timokatalog(index).paroxiDB)
                    If dedoulPoso <> 0 Or dedoulDays <> 0 Then
                        'timokatalog(index).synoloDB = dedoulPoso
                        timokatalog(index).dedoulPos = dedoulPoso
                        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                        find = pnl(0).Controls.Find("Dedo", False)
                        find(0).visible = True
                        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                        find = pnl(0).Controls.Find("DedP", False)
                        find(0).text = dedoulPoso.ToString("N")
                        find(0).visible = True
                        sum = (timokatalog(index).imeresTotal - dedoulDays) * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
                        '   sum = dedoulDays * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
                        timokatalog(index).imeresPlirom = timokatalog(index).imeresTotal - dedoulDays
                    Else
                        sum = (timokatalog(index).imeresTotal) * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
                    End If
                Else ' kamia allagh-> dedouleuena label unvisible!
                    pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                    find = pnl(0).Controls.Find("Dedo", False)
                    find(0).visible = False
                    pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
                    find = pnl(0).Controls.Find("DedP", False)
                    find(0).text = dedoulPoso.ToString("N")
                    find(0).visible = False
                    sum = (timokatalog(index).imeresTotal) * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
                End If
            Else ' kanonika upologismos sum
                sum = (timokatalog(index).imeresTotal) * (timokatalog(index).ypnosTemp + timokatalog(index).prwinoTemp + timokatalog(index).geumaTemp + timokatalog(index).deipnoTemp + timokatalog(index).paroxiTemp)
            End If

        End If

        pnl = Kratiseis4Pnl.Controls.Find("Ktlg" + kwdDB.ToString, False)
        find = pnl(0).Controls.Find("Summ" + kwdDB.ToString, False)
        find(0).text = sum.ToString("N")
        timokatalog(index).synoloTemp = sum ' + dedoulPoso
        setze_sum_timokat()

    End Sub
    Private Sub ekptbox_leave(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB As Integer
        Dim index As Int16
        Dim zahl As Single

        Try
            zahl = Math.Abs(CType(sender.text, Single)).ToString("F")
            If zahl > 100 Then
                zahl = 100
            End If
            sender.text = zahl.ToString("F")
        Catch ex As InvalidCastException
            zahl = 0
            sender.text = zahl.ToString("F")
        End Try
        If flagKr = 1 Then
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If


        If sender.text <> timokatalog(index).ekptosi Then
            timokatalog(index).ekptosi = sender.text

            setze_times_anal(kwdDB, index)

        End If

    End Sub
    Private Sub imeres_leave(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kwdDB As Integer
        Dim index As Int16
        Dim zahl As Int16

        If flagKr = 1 Then
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog(kwdDB)
        Else
            kwdDB = sender.NAME.ToString.Substring(4, sender.NAME.ToString.Length - 4)
            index = get_index_v_timokatalog_2(kwdDB)
        End If

        Try
            zahl = Math.Abs(CType(sender.text, Int16)).ToString("F")

            sender.text = zahl.ToString
            timokatalog(index).imeresPlirom = zahl.ToString

            'timokatalog(index).imeres = sender.text
        Catch ex As InvalidCastException
            zahl = timokatalog(index).imeresTotal
            sender.text = zahl.ToString
            timokatalog(index).imeresPlirom = zahl.ToString
        End Try
        setze_times_anal(kwdDB, index)

    End Sub
    Private Sub EkptosiBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EkptosiBtn.Click
        Dim imeres As Int16

        Try
            imeres = Me.rechne_imeres_diamonis()
        Catch ex As NullReferenceException
            MsgBox("Επιλέξτε πρώτα Κράτηση !", MsgBoxStyle.Information, "winfo\nikEl.")
            Exit Sub
        End Try
        'DOMISI ->ekptosipososto promitheia!!!
        If status = 1 AndAlso kwdikoKratisisDB = -1 Then
            If ekptPososto = 0 AndAlso ekptPoso = 0 AndAlso ekptFree = 0 Then
                Try
                    ekptPososto = CType(Me.PraktoreiaTableAdapter.GetPromithDomisiByKwd(praktortimolkwd), Single)
                Catch ex As InvalidCastException

                End Try
            End If


        End If
        Dim form As New EkptoseisFrm(SynolLbl.Text, imeres, ekptPoso, ekptPososto, ekptFree, ekptCFee)

        form.ShowDialog()

        ekptPoso = form.return_poso
        ekptPososto = form.return_pososto
        ekptFree = form.return_free
        ekptCFee = form.return_fee

        'kratisiArithm = form.return_arithmo_kratisis
        form.Dispose()
        setze_sum_timokat()
    End Sub

    Private Sub TextBox_SelectAllText(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EnilikTbx.Click, PaidiTbx1.Click, PaidiTbx2.Click,
  EthnAnzTbx1.Click, EthnAnzTbx2.Click, SimetTbx.Click, ProkatTbx.Click, KratisiTbx.Click, PaidiTbx3.Click, EispKataxParSinPlinTbx.Click, EispKataxParEisprTbx.Click, EispKataxParXrewsiTbx.Click, EispKataxParProkTbx.Click
        sender.SelectAll()
    End Sub

    Private Async Sub timokat_speichern(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim maxkrat, countPaid, countDB As Int16 ', arkrat
        Dim kwdikos, kwdikosOver As Integer
        Dim afixiOK As Boolean = False
        Dim overOK As Boolean = False
        Dim arithDwmat As String = Nothing
        Dim epistrofi As Date = #1/1/1900#
        Dim response As MsgBoxResult
        Dim ekptosiOK As Boolean = False

        'Dim paratiriseis As String = Nothing


        If sender.name.Equals("Afixi") Then
            afixiOK = True
        ElseIf sender.name.Equals("Over") Then
            overOK = True
        End If

        Me.Cursor = Cursors.WaitCursor
        sender.enabled = False


        If timokatalog.Length <> 0 Then 'DOMISI->PREPEI NA EXEI KATAXWRITHEI BILA!!!! AndAlso Not DwmTbx.Text.Equals("")
            If Not ist_xrewsi_ok() Then
                MsgBox("Δεν έχει επιλεγεί τύπος χρέωσης !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Me.Cursor = Cursors.Default
                sender.enabled = True
                Exit Sub
            End If
            If SynolLbl.Text >= 0 Then
                ersetze_temp_vor_speichern()
            Else
                MsgBox(" Ελέγξτε τις τιμές - εκπτώσεις !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Me.Cursor = Cursors.Default
                sender.enabled = True
                Exit Sub
            End If

            If Not sind_ethnikotites_ok(sender, e) Then
                Exit Sub
            End If

            If ekptPoso <> 0 OrElse ekptPososto <> 0 OrElse ekptFree <> 0 OrElse ekptCFee <> 0 Then
                ekptosiOK = True
            Else
                ekptosiOK = False
            End If

            If kwdikoKratisisDB = -1 Then 'iNSERT PROKEITAI GIA NEo EINTRAG
                Try 'edw alaksa->o aritmos kratisis Diabazetai apo to Table Etaireia (attribute aakratisis)!!!!!!!! 
                    Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
                    maxkrat = CType(Me.DbhotelDataSet.etaireia(0).aakratisis, Int16)
                    ' '=>GIA INSERT
                Catch ex As Exception
                    Try
                        maxkrat = Me.KratiseisTableAdapter.GetMaxArithKratisis(etos)
                    Catch ex1 As InvalidOperationException
                        maxkrat = 0
                    End Try
                End Try
                If Not afixiOK And Not overOK Then 'APLH KRATHSH
                    Try
                        kwdikos = execute_insert_kratisi_afixi_transaction(maxkrat + 1, ekptosiOK, countPaid, overOK, False) '"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|\" + Me.DbhotelDataSet.etaireia(0).basi
                        If kwdikos = -1 Then ' connection apetyxe
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            MsgBox(" Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            Exit Sub
                        Else ' DOMISI
                            If currenttipos > 0 And currenttipos < 13 Then
                                Dim telodkratisis As New teloskratisis(connectionString, kwdikos, DwmTbx.Text, praktortimolkwd, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), CType(SynolLbl.Text, Single), ekptPoso, 1)
                                'TEST SQL SERVER 
                                Try

                                    Dim calender As New GoogleCalendarNew(connectionString, kwdikos, maxkrat + 1, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), DwmTbx.Text, DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
                                    calender.create_new_entry()
                                    If currenttipos = 10 Then
                                        calender.set_calendarid_thalasses(1)
                                        calender.create_new_entry()
                                    End If



                                Catch ex As Exception
                                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Google Calendar !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End Try
                                'WEBHOTELIER
                                If praktoreiokwd = 62 And currenttipos = 10 Then
                                    If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                        If Not DwmTbx.Text.Equals("") Then
                                            Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")
                                            If Not webhotel.StopSells(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), True) Then
                                                MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                            End If
                                        End If
                                    End If
                                End If
                                'Try

                                '    Dim calender As New GoogleCalendar(maxkrat + 1, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), DwmTbx.Text, DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
                                '    calender.send_entry()
                                '    If currenttipos = 10 Then
                                '        calender = New GoogleCalendar(maxkrat + 1, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), "THLS", DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
                                '        calender.send_entry()
                                '    End If



                                'Catch ex As Exception
                                '    MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Google Calendar !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                'End Try
                                'TEST SQL SERVER 
                                Try
                                    response = MsgBox(" Αποστολή directions;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                    If response = MsgBoxResult.Yes Then
                                        SendMailwithDirections(DwmTbx.Text, VoucherTbx.Text, OnomTbx1.Text)
                                    End If
                                Catch ex As Exception
                                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την αποστολή directions !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End Try
                                'TEST SQL SERVER 
                                Try
                                    response = MsgBox(" Αποστολή email σε Πρακτορεία για ενημέρωση;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                    If response = MsgBoxResult.Yes Then
                                        SendMailPrakt(DwmTbx.Text, 1)
                                    End If
                                Catch ex As Exception
                                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση των Πρακτορείων!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End Try

                                'TEST SQL SERVER 
                                Try
                                    Dim retings As New RentingsXls(CType(Me.VoucherTbx.Text, String), Me.DbhotelDataSet.etaireia(0).basi)
                                Catch ex As Exception
                                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Renting_emails !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End Try
                                'TEST SQL SERVER 
                                If currenttipos = 10 Then
                                    Try

                                        KratiseisTableadpter1.FillforThalassesByZeitInterval(Me.DbhotelDataSet1.kratiseis, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date, currenttipos,
                                                                                             DateTimePicker3.Value.Date.AddDays(-1), DateTimePicker3.Value.Date.AddDays(-1), currenttipos,
                                                                                             DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), currenttipos)

                                        Dim stopSalesDates As String
                                        If Me.DbhotelDataSet1.kratiseis.Count > 4 Then
                                            Dim datumKlDwm() As Int16
                                            ReDim datumKlDwm(DateDiff(DateInterval.Day, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1)))
                                            stopSalesDates = fuehle_datum_krat_xenodox_thalases(datumKlDwm)
                                            If stopSalesDates.Length <> 0 Then
                                                response = MsgBox(" Stop Sales:" + ChrW(13) + stopSalesDates + ChrW(13) + "Αποστολή email σε Πρακτορεία;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                                If response = MsgBoxResult.Yes Then
                                                    SendMailStopSales(stopSalesDates)
                                                End If
                                            End If


                                        End If


                                    Catch ex As Exception

                                    End Try
                                End If
                            End If
                        End If






                        'If webcon.Synchronize(connectionString, Me.DbhotelDataSet.etaireia(0).aakratisis + 1, 78, 668) Then




                        'End If

                    Catch ex As SqlException
                        MsgBox("Η Αποθήκευση απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        sender.enabled = True
                        Me.Cursor = Cursors.Default
                        Exit Sub
                    End Try
                Else 'AFIXI H OVERBOOK XWRIS NA YPARXEI PROTITERA KRATISI
                    If overOK And status = 1 Then
                        If CType(EnilikTbx.Text, Int16) <= 0 Then
                            MsgBox(" Δώστε Αριθμό Ενηλίκων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            EnilikTbx.Focus()
                            Exit Sub
                        End If
                        If DwmTbx.Text.Equals("") Or DwmTbx.Text.Equals("OV-BOOK") Then
                            response = MsgBox(" Διαδικασία Over;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                            If response = MsgBoxResult.Yes Then
                                Dim UnterForm As New OverUnterkuenfteFrm(sesionID, imeromErgasias, DateTimePicker3.Value, status)
                                Try
                                    UnterForm.ShowDialog()
                                Catch ex As InvalidOperationException

                                End Try
                                arithDwmat = "OV-BOOK"
                            Else
                                Me.Cursor = Cursors.Default
                                sender.enabled = True
                                Exit Sub
                            End If
                        Else
                            MsgBox(" Over με Δωμάτιο !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        End If

                    ElseIf afixiOK Then
                        If Not DwmTbx.Text.Equals("") And Not DwmTbx.Text.Equals("OV-BOOK") Then
                            arithDwmat = DwmTbx.Text
                        Else
                            MsgBox(" Άφιξη χωρίς Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        End If
                        If CType(EnilikTbx.Text, Int16) <= 0 Then
                            MsgBox(" Δώστε Αριθμό Ενηλίκων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            EnilikTbx.Focus()
                            Exit Sub
                        End If
                    End If
                    'WEBHOTELIER
                    If praktoreiokwd = 62 And currenttipos = 10 Then
                        If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                            If Not DwmTbx.Text.Equals("") Then
                                Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")
                                If Not webhotel.StopSells(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), True) Then
                                    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End If
                            End If
                        End If
                    End If
                    'ENHMERVSH AFIXIS XWRIS PROTITERH KRATISI
                    countPaid = CType(EthnAnzTbx1.Text, Int16) + CType(EthnAnzTbx2.Text, Int16) - CType(EnilikTbx.Text, Int16)

                    Try
                        kwdikos = execute_insert_kratisi_afixi_transaction(maxkrat + 1, ekptosiOK, countPaid, overOK, True) '"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|\" + Me.DbhotelDataSet.etaireia(0).basi,
                        Dim telodkratisis As New teloskratisis(connectionString, kwdikos, DwmTbx.Text, praktortimolkwd, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), CType(SynolLbl.Text, Single), ekptPoso, 1)
                    Catch ex As SqlException
                        MsgBox("Η Αποθήκευση απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        sender.enabled = True
                        Me.Cursor = Cursors.Default
                        Me.OverunterkuenfteTableAdapter.DeleteUnterkByOver(sesionID)
                        Exit Sub
                    End Try

                End If
                If kwdikos <> -1 Then

                    'If Insert_Kratisi_for_Web(kwdikos, Date.Today, Date.Today.Year, praktortimolkwd, CType(Me.VoucherTbx.Text, String), CType(EnilikTbx.Text, Short),
                    '                              CType(EthnKwd1.Text, Short), CType(EthnAnzTbx1.Text, Byte), CType(TilefTbx.Text, String), CType(EpithimTbx.Text, String), CType(SimetTbx.Text, Short),
                    '                               CType(ProkatTbx.Text, Single), CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value, Date), CType(currenttipos, Integer),
                    '                                CType(optionChk.Checked, Boolean), CType(DwmTbx.Text, String), CType(PliromiCbx.SelectedItem, String), CType(SynolLbl.Text, Single),
                    '                               afixiOK, False, CType(timokatalog(0).ypnos, Single), CType(timokatalog(0).prwino, Single)) Then

                    'Else
                    '    MsgBox(" Η ενημέρωση του WebServer απέτυχε", MsgBoxStyle.Critical, "winfo\nikEl.")
                    'End If
                    Try 'Enimerwsi tou status->PROSOXI TA DWMATIA STATUS PREPEI NA PARAMEINOUN STATHERA...->
                        'STOUS PARAMETROUYS TOU XENODOXEIOY DEN PREPEI NA MPOREI O USER NA ALAZEI TA STATUS (KWD 1= RESERVATION, KWD=6 OVERBOOKED)
                        If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                            ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                            'If Not set_availabilities_all(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), "minus") Then
                            '    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            'End If
                            'End If
                        End If
                        ''WEBHOTELIER 
                        'If praktoreiokwd = 62 And currenttipos = 10 Then
                        '    If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                        '        If Not DwmTbx.Text.Equals("") Then
                        '            Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")
                        '            If Not webhotel.StopSells(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), True) Then
                        '                MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        '            End If
                        '        End If
                        '    End If
                        'End If
                        If afixiOK And Not DwmTbx.Text.Equals("") Then
                            Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikos, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 5)
                        ElseIf Not DwmTbx.Text.Equals("") Then

                            If Not optionChk.Checked Then
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikos, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 1)
                            Else
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikos, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 4)
                            End If


                            'If overOK And Not arithDwmat = Nothing Then
                            '    Me.StatusTableAdapter.InsertStatusDwmatiou(arithDwmat, kwdikos, DateTimePicker2.Value, DateTimePicker3.Value.AddDays(-1), 6, imeromErgasias)
                        End If
                    Catch ex As SqlException
                        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του πίνακα Reservation (status Δωματίων) ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    End Try
                    Me.EnilikesTableAdapter.UpdateKratisiByKratisi(kwdikos, sesionID)
                    If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
                        Try
                            countDB = Me.PaidiaTableAdapter.InsertPaidi(kwdikos, LTrim(CotTbx1.Text), LTrim(PaidiTbx1.Text))
                            countPaid = countDB
                        Catch ex As SqlException
                            MsgBox("Παρουσιάστηκε πρόβλημα στην Αποθήκευση του 1ου Παιδιού ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try
                    End If
                    If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
                        Try
                            countDB = Me.PaidiaTableAdapter.InsertPaidi(kwdikos, LTrim(CotTbx2.Text), LTrim(PaidiTbx2.Text))
                            countPaid = countPaid + countDB
                        Catch ex As SqlException
                            MsgBox("Παρουσιάστηκε πρόβλημα στην Αποθήκευση του 2ου Παιδιού ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try

                    End If
                    If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
                        Try
                            countDB = Me.PaidiaTableAdapter.InsertPaidi(kwdikos, LTrim(CotTbx3.Text), LTrim(PaidiTbx3.Text))
                            countPaid = countPaid + countDB
                        Catch ex As SqlException
                            MsgBox("Παρουσιάστηκε πρόβλημα στην Αποθήκευση του 3ου Παιδιού ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try

                    End If

                    If overOK And status = 1 Then 'edw exw dimiourgisei overunterkuenfte Table-> gia parakolouthisi pou diamenoun ta over-> prepei na anoigei mia maska pou o user na kataxwrei pou paei h kratisi!!!!
                        Try
                            epistrofi = Me.OverunterkuenfteTableAdapter.GetMaxHmerMexriByOver(sesionID)
                        Catch ex As Exception
                            '#1/1/1900# 'INITIAL WERT GIA EPISTROFI APO OVER
                            epistrofi = DateTimePicker3.Value.AddDays(-1)
                        End Try
                        Try
                            Me.OverTableAdapter.InsertOver(kwdikos, epistrofi, imeromErgasias, epistrofi, False)
                            Try
                                kwdikosOver = Me.OverTableAdapter.GetKwdByKratisi(kwdikos, False)
                                Me.OverunterkuenfteTableAdapter.UpdateOverByOver(kwdikosOver, sesionID)
                            Catch ex As InvalidOperationException
                                MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            End Try
                        Catch ex As SqlException ' h kratisi bei over teble ist unique
                            MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try


                    End If
                    Me.ApyTableAdapter.FillByKratisi(Me.DbhotelDataSet.apy, sesionID)
                    If Me.DbhotelDataSet.apy.Count <> 0 Then
                        Me.ApyTableAdapter.UpdateKratisiBySesion(kwdikos, sesionID)
                        Me.KratiseisTableAdapter.SetPrivatTimolByKwd(True, kwdikos) 'kanw setzen TRUE to privatimologio 
                    End If
                    If Not afixiOK And Not overOK Then
                        MsgBox("Επιτυχής Αποθήκευση της Κρατησης ! Νέος Αριθμός Κράτησης: " + (maxkrat + 1).ToString + " " & vbCrLf & "<Εισάγετε τον νέο αριθμό στο πεδίο 'Αρ. Κρατ.'" & vbCrLf & "και πατήστε τον φακό για περαιτέρω Επεξεργασία>", MsgBoxStyle.Information, "winfo\nikEl.")

                    Else
                        MsgBox(" Η Διαδικασία Αφίξεως ολοκληρώθηκε επιτυχώς! Νέος Αριθμός Κράτησης: " + (maxkrat + 1).ToString + " " & vbCrLf & "Στο Menu <Αλλαγές στοιχείων Διαμενόντων> εχετε την δυνατότητα περαιτέρω Επεξεργασίας", MsgBoxStyle.Information, "winfo\nikEl.")
                    End If
                Else
                    sender.enabled = True
                    Me.Cursor = Cursors.Default
                    Exit Sub
                End If
                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                init_ekptoseis()
                ReDim timokatalog(-1)
                kratiseis_zeig(False)
            Else 'UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE UPDATE
                'Try
                'KANONIKH APLH ALLAGH  KRATHSHS ->xwris prosthiki fusika sto Biblio Portas
                If Not afixiOK And Not overOK Then 'mono apli kratisi
                    Try
                        'countPaid = EthnAnzTbx1.Text + EthnAnzTbx2.Text - EnilikTbx.Text
                        countDB = execute_update_kratisi_afixi_transaction(connectionString, kwdikoKratisisDB, False, ekptosiOK, False)
                    Catch ex As SqlException
                        MsgBox("Η Αποθήκευση απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        sender.enabled = True
                        Me.Cursor = Cursors.Default
                        Exit Sub
                    End Try
                    If countDB = 1 Then ' egine Update ENA eintrag apo Kratiseis
                        Dim telodkratisis As New teloskratisis(connectionString, kwdikoKratisisDB, DwmTbx.Text, praktortimolkwd, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), CType(SynolLbl.Text, Single), ekptPoso, 2)
                        Dim count As Int16
                        count = Me.StatusTableAdapter.ExistReservationByKratisi(kwdikoKratisisDB)

                        If count <> 0 Then  'Update Status se periptosi pou yparxei kratisi me dwmatio 
                            ' If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                            '  If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                            'If Not DwmTbx.Text.Equals("OV-BOOK") Then
                            '    If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                            '        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            '    End If
                            'End If
                            'End If
                            'End If


                            'TEST SQL SERVER 
                            If praktoreiokwd = 62 And currenttipos = 10 Then
                                If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                        'MsgBox(Me.DbhotelDataSet.kratiseis(0).praktoreio)
                                        If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                            MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                        End If
                                    End If
                                End If
                            End If
                            If DwmTbx.Text.Equals("") Then
                                Me.StatusTableAdapter.DeleteStatusDwmatiouByKratisi(kwdikoKratisisDB) 'ean upirxe dwmatio kai diagraftike apo tin kratisi->egine pleon kratisi xwris dwmatio
                            Else


                                If Not optionChk.Checked Then
                                    '  Me.StatusTableAdapter.UpdateReservierungByKratisiStatus(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB, 1)
                                    Me.StatusTableAdapter.UpdateStatusByKratisi(1, DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB)
                                Else
                                    Me.StatusTableAdapter.UpdateStatusByKratisi(4, DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB)
                                End If
                                'DOMISI ->alakse imerominia ;h Bila!!!
                                If Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals(DwmTbx.Text) OrElse (CType(DateTimePicker2.Value.Date, Date)) <> Me.DbhotelDataSet.kratiseis(0).afixi OrElse (CType(DateTimePicker3.Value.Date, Date)) <> Me.DbhotelDataSet.kratiseis(0).anaxwrisi Then
                                    'TEST SQL SERVER 
                                    Try
                                        If Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals(DwmTbx.Text) Then
                                            Dim calender As New GoogleCalendarNew(connectionString, kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).arithmos, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), DwmTbx.Text, DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
                                            calender.update_entry()
                                        Else
                                            Dim calender As New GoogleCalendarNew(connectionString, kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).arithmos, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), Me.DbhotelDataSet.kratiseis(0).dwmatio, DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
                                            calender.delete_entry()
                                            calender.create_new_entry()
                                        End If

                                    Catch ex As Exception
                                        MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Google Calendar !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    End Try
                                    '    'TEST SQL SERVER 
                                    Try
                                        If Not CType(ProkatTbx.Text, Single) = 0 AndAlso Me.DbhotelDataSet.kratiseis(0).prokataboli = 0 Then
                                            Try
                                                response = MsgBox(" Αποστολή email σε Πρακτορεία για ενημέρωση;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                                If response = MsgBoxResult.Yes Then
                                                    SendMailPrakt(DwmTbx.Text, 1)
                                                End If
                                            Catch ex As Exception
                                                MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση των Πρακτορείων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                            End Try


                                        End If
                                    Catch ex As InvalidCastException

                                    End Try


                                End If

                            End If
                                ElseIf Not DwmTbx.Text.Equals("") Then
                            'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                            '    ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                            '    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                            '        If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                            '            MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            '        End If
                            '    End If

                            '    'End If
                            'End If

                            'TEST SQL SERVER 
                            If praktoreiokwd = 62 And currenttipos = 10 Then
                                If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                        If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                            MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                        End If
                                    End If
                                End If
                            End If
                            If Not optionChk.Checked Then
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 1)
                            Else
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 4)
                            End If

                        End If



                    Else ' Kanena Eintrag den egine Update!
                        If countDB = 0 Then
                            MsgBox("Η Αποθήκευση απέτυχε : Πιθανώς η Κράτηση έχει τροποποιηθεί απο άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        Else
                            MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        End If

                    End If

                    'If Update_Kratisi_for_Web(kwdikoKratisisDB, praktortimolkwd, CType(Me.VoucherTbx.Text, String), CType(EnilikTbx.Text, Short),
                    '                              CType(EthnKwd1.Text, Short), CType(EthnAnzTbx1.Text, Byte), CType(TilefTbx.Text, String), CType(EpithimTbx.Text, String), CType(SimetTbx.Text, Short),
                    '                               CType(ProkatTbx.Text, Single), CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value, Date), CType(currenttipos, Integer),
                    '                                CType(optionChk.Checked, Boolean), CType(DwmTbx.Text, String), CType(PliromiCbx.SelectedItem, String), CType(SynolLbl.Text, Single),
                    '                               afixiOK, False, CType(timokatalog(0).ypnos, Single), CType(timokatalog(0).prwino, Single)) Then
                    'Else

                    '    MsgBox(" Η ενημέρωση του WebServer απέτυχε", MsgBoxStyle.Critical, "winfo\nikEl.")
                    'End If
                Else
                    'kanw Update kratiseis/timesKratiseis kai Insert sto BiblioPortas!!!!!!!!!!
                    'if afixiOK orelse overOK then 
                    If (overOK And (DwmTbx.Text.Equals("") Or DwmTbx.Text.Equals("OV-BOOK"))) OrElse (afixiOK And Not DwmTbx.Text.Equals("")) Then
                        Try
                            If CType(EnilikTbx.Text, Int16) <= 0 Then ' gia afixi prepei i arithmos twn enilikwn na einai > 0!
                                MsgBox(" Δώστε Αριθμό Ενηλίκων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                sender.enabled = True
                                Me.Cursor = Cursors.Default
                                EnilikTbx.Focus()
                                Exit Sub
                            End If
                            If overOK Then
                                If DwmTbx.Text.Equals("") Or DwmTbx.Text.Equals("OV-BOOK") Then
                                    If status = 1 Then 'to Over Button!
                                        response = MsgBox(" Διαδικασία Over;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                                        If response = MsgBoxResult.No Then

                                            Me.Cursor = Cursors.Default
                                            sender.enabled = True
                                            Exit Sub
                                        End If

                                    End If
                                Else
                                    MsgBox(" Over με Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    sender.enabled = True
                                    Me.Cursor = Cursors.Default
                                    Exit Sub
                                End If

                            ElseIf afixiOK Then
                                If DwmTbx.Text.Equals("") Then
                                    MsgBox(" Άφιξη χωρίς Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    sender.enabled = True
                                    Me.Cursor = Cursors.Default
                                    Exit Sub
                                End If
                            End If

                            'kanei return ta Eintraege tis kratiseis pou eginan Update i -1 ean eixa Exception zb keini Connection zu DB
                            countDB = execute_update_kratisi_afixi_transaction(connectionString, kwdikoKratisisDB, overOK, ekptosiOK, True)
                            If countDB = 1 Then 'Connection OK
                                If overOK Then
                                    If status = 1 Then 'to Over Button!

                                        If response = MsgBoxResult.Yes Then
                                            Dim UnterForm As New OverUnterkuenfteFrm(sesionID, imeromErgasias, DateTimePicker3.Value.Date, status)
                                            Try
                                                UnterForm.ShowDialog()
                                            Catch ex As InvalidOperationException

                                            End Try
                                            arithDwmat = "OV-BOOK"
                                            'ean upirxe protiteri kratisi gia dwmatio deleten !!!!!!!!!!
                                            Try
                                                If Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("") OrElse Not DwmTbx.Text.Equals("") OrElse Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then 'OrElse Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK")
                                                    'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                                                    '    ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then

                                                    '    If Not set_availabilities_all_status("", DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                                    '        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                                    '    End If

                                                    '    'End If
                                                    'End If
                                                    Me.StatusTableAdapter.DeleteByKratisiEnarxi(kwdikoKratisisDB, imeromErgasias)
                                                End If
                                            Catch ex As NullReferenceException

                                            End Try

                                        End If
                                    End If

                                ElseIf afixiOK Then
                                    'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                                    '    ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                                    '    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                    '        If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                    '            MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    '        End If
                                    '    End If


                                    '    'End If
                                    'End If
                                    If praktoreiokwd = 62 And currenttipos = 10 Then
                                        If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                            If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                                If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                                    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                                End If
                                            End If
                                        End If
                                    End If
                                    If Me.DbhotelDataSet.kratiseis(0).dwmatio = Nothing Then
                                        Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), 5)
                                    Else
                                        ' uparxei Status->Reservierung!->
                                        Me.StatusTableAdapter.UpdateStatusByKratisi(5, DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB)
                                    End If
                                End If

                                'If Update_Kratisi_for_Web(kwdikoKratisisDB, praktortimolkwd, CType(Me.VoucherTbx.Text, String), CType(EnilikTbx.Text, Short),
                                '                                                 CType(EthnKwd1.Text, Short), CType(EthnAnzTbx1.Text, Byte), CType(TilefTbx.Text, String), CType(EpithimTbx.Text, String), CType(SimetTbx.Text, Short),
                                '                                                  CType(ProkatTbx.Text, Single), CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value, Date), CType(currenttipos, Integer),
                                '                                                   CType(optionChk.Checked, Boolean), CType(DwmTbx.Text, String), CType(PliromiCbx.SelectedItem, String), CType(SynolLbl.Text, Single),
                                '                                                  afixiOK, False, CType(timokatalog(0).ypnos, Single), CType(timokatalog(0).prwino, Single)) Then
                                'Else

                                '    MsgBox(" Η ενημέρωση του WebServer απέτυχε", MsgBoxStyle.Critical, "winfo\nikEl.")
                                'End If



                            Else
                                If countDB = -1 Then
                                    MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                                    sender.enabled = True
                                    Me.Cursor = Cursors.Default
                                    Exit Sub
                                ElseIf countDB = 0 Then
                                    MsgBox(" Πιθανώς η Κράτηση έχει τροποποιηθεί απο άλλον User  !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    sender.enabled = True
                                    Me.Cursor = Cursors.Default
                                    Exit Sub
                                End If

                            End If

                        Catch ex As SqlException
                            MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            sender.enabled = True
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        End Try
                    Else
                        MsgBox(" Για Άφιξη πρέπει να δώσετε Αριθμό Δωματίου " & vbCrLf & " Overbooking αντιθέτως χωρίς Δωμάτιο ! ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        sender.enabled = True
                        Me.Cursor = Cursors.Default
                        Exit Sub
                    End If


                End If

                ' afou ola t basika exoun ginei (kratiseis,timeskratiseis,biblioportas) asxoloume twra me paidia,
                'Over kai Overunterkuenfte pou DEN einai so KRITISCH!!!
                update_paidia()
                Dim arKratisis As Int16
                Try
                    arKratisis = Me.KratiseisTableAdapter.GetArKratByKwd(kwdikoKratisisDB)

                    If afixiOK Or (overOK And status = 1) Then
                        If overOK And status = 1 Then 'edw exw dimiourgisei overunterkuenfte Table-> gia parakolouthisi pou diamenoun ta over-> prepei na anoigei mia maska pou o user na kataxwrei pou paei h krtisi!!!!
                            Try
                                epistrofi = Me.OverunterkuenfteTableAdapter.GetMaxHmerMexriByOver(sesionID)
                            Catch ex As Exception
                                'epistrofi = #1/1/1900#
                                epistrofi = DateTimePicker3.Value.AddDays(-1)
                            End Try
                            Try
                                Me.OverTableAdapter.InsertOver(kwdikoKratisisDB, epistrofi, imeromErgasias, epistrofi, False)
                                Try
                                    kwdikosOver = Me.OverTableAdapter.GetKwdByKratisi(kwdikoKratisisDB, False)
                                    Me.OverunterkuenfteTableAdapter.UpdateOverByOver(kwdikosOver, sesionID)
                                Catch ex As InvalidOperationException
                                    MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End Try
                            Catch ex As SqlException
                                MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            End Try
                        End If
                        MsgBox("Η Διαδικασία της Άφιξης ολοκληρωθηκε επιτυχώς !" & vbCrLf & "Στο Menu <Αλλαγές στοιχείων Διαμενόντων> έχετε" & vbCrLf & " την δυνατότητα περαιτέρω Επεξεργασίας", MsgBoxStyle.Information, "winfo\nikEl.")
                    Else
                        MsgBox(" Οι Αλλαγές στην Κράτηση με Αριθμό " + arKratisis.ToString + " αποθηκεύθηκαν επιτυχώς !", MsgBoxStyle.Information, "winfo\nikEl.")
                        'DOMISI
                        If Me.DbhotelDataSet.kratiseis(0).afixi <> Me.DateTimePicker2.Value.Date OrElse Me.DbhotelDataSet.kratiseis(0).anaxwrisi <> Me.DateTimePicker3.Value.Date Then
                            'If praktortimolkwd <> 10 Then
                            'Dim datum As String
                            'datum = DateTimePicker2.Value.Date.Day.ToString + "-" + DateTimePicker2.Value.Date.Month.ToString + "-" + DateTimePicker2.Value.Date.Year.ToString
                            'Dim targetAdapter As New dbhotelDataSetTableAdapters.linksTableAdapter
                            'targetAdapter.FillLinksByVilaDescr(Me.DbhotelDataSet.links, DwmTbx.Text, "leisure")
                            'If Me.DbhotelDataSet.links.Count <> 0 Then
                            'If currenttipos > 0 And currenttipos < 13 Then
                            '    response = MsgBox(" Ενημέρωση  Ημερολογίων?", MsgBoxStyle.YesNo, "winfo\nikEl.")
                            '    If response = MsgBoxResult.Yes Then
                            '        'If Not IsDBNull(Me.DbhotelDataSet.links(0).Item("link")) Then
                            '        Dim leisure As New Leisure(DwmTbx.Text, DateTimePicker2.Value.Date) '(Me.DbhotelDataSet.links(0).link.ToString, DateTimePicker2.Value.Date)
                            '        leisure.Show()
                            '        Me.DbhotelDataSet.links.Clear()
                            '        'Dim leisure As New Leisure(Me.DbhotelDataSet.links(0).link.ToString, Me.DbhotelDataSet.kratiseis(0).afixi)
                            '        'leisure.Show()
                            '        'Me.DbhotelDataSet.links.Clear()
                            '        'End If
                            '    End If
                            'End If

                            'End If
                            'End If
                        End If


                    End If
                Catch ex As InvalidOperationException
                    MsgBox("Η Διαδικασία δεν μπόρεσε να ολοκληρωθεί επιτυχώς: Πιθανώς η Κράτηση έχει τροποποιηθεί απο άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End Try



                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                init_ekptoseis()
                ReDim timokatalog(-1)

                kratiseis_zeig(False)

            End If
        Else
            MsgBox("Η Διαδικασία δεν έχει ολοκληρωθεί ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.enabled = True
            Me.Cursor = Cursors.Default
            Exit Sub
        End If
        'MsgBox(" Επιτυχής Αποθήκευση !", MsgBoxStyle.Information, "winfo\nikEl.")
        sender.enabled = True
        Me.Cursor = Cursors.Default
    End Sub


    Function Insert_Kratisi_for_Web(ByVal kwdikos As Integer, ByVal immeromkratisis As Date, ByVal year As Int16, ByVal praktimologio As Integer,
                                   ByVal voucher As String, ByVal enilikes As Int16, ByVal ethnikotites As Integer, ByVal anzethnikotites As Int16, ByVal tel As String,
                                   ByVal epithimia As String, ByVal simetoxi As Int16, ByVal prokat As Single, ByVal afixi As Date, ByVal anaxwrisi As Date, ByVal tipos As Integer, ByVal guarant As Boolean,
                                   ByVal dwm As String, ByVal pliromi As String, ByVal synolo As Single, ByVal checkin As Boolean, ByVal checkout As Boolean, ByVal ypnos As Single, ByVal prwino As Single) As Boolean

        Dim appSettings = ConfigurationManager.AppSettings
        'Dim webconn As New WebConnect.WebConnect
        Dim countPaidia As Int16 = 0
        Dim Kratisi As New WebConnect.kratiseis
        Kratisi.kwd = kwdikos
        Kratisi.dbhotel = kwdikos
        Kratisi.imeromkratisis = immeromkratisis
        Kratisi.etos = year
        Kratisi.praktimologio = praktimologio
        Kratisi.voucher = voucher
        Kratisi.xrewsi = timokatalog(0).xrewsi
        Kratisi.enilikes = enilikes
        Kratisi.onoma = CType(OnomTbx1.Text, String)
        If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
            countPaidia += 1
        End If
        If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
            countPaidia += 1
        End If
        If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
            countPaidia += 1
        End If
        Kratisi.paidia = countPaidia
        Kratisi.praktoreio = CType(appSettings("Individual"), Integer)
        Kratisi.simbolaio = CType(appSettings("Simbolaio"), Integer)
        Kratisi.touristperiod = CType(appSettings("Touristperiod"), Integer)
        If ethnikotites = 0 Then
            Kratisi.ethnikotites = 1 ' Ellines
        Else
            Kratisi.ethnikotites = ethnikotites
        End If
        If anzethnikotites = 0 Then
            Kratisi.anzethnikotites = 1 ' Ellines
        Else
            Kratisi.anzethnikotites = anzethnikotites
        End If

        Kratisi.tilefonomem = tel
        Kratisi.epithimia = epithimia
        Kratisi.simetoxi = simetoxi
        Kratisi.prokataboli = prokat
        Kratisi.afixi = afixi
        Kratisi.anaxwrisi = anaxwrisi
        If tipos <> 0 Then
            Kratisi.tipos = tipos
        Else
            Kratisi.tipos = Nothing

        End If

        Kratisi.guarantie = guarant
        If Not dwmatio.Equals("") Then
            Kratisi.dwmatio = dwm
        Else
            Kratisi.dwmatio = String.Empty
        End If

        Kratisi.pliromi = pliromi
        Kratisi.synolo = synolo
        Kratisi.checkin = checkin
        Kratisi.checkout = checkout
        Kratisi.ypnos = ypnos
        Kratisi.prwino = prwino
        Kratisi.sum = synolo

        'Try
        '    webconn.Create(Kratisi)

        '    Return True
        'Catch ex As Exception
        '    MsgBox(ex.Message)
        '    Return False
        'End Try

    End Function
    Private Sub WebUploadBtn_Click(sender As Object, e As EventArgs) Handles WebUploadBtn.Click
        'Dim response As MsgBoxResult
        'response = MsgBox("Ενημέρωση Webserver με αυτήν την κράτηση;", MsgBoxStyle.YesNo, "winfo\nikEl.")
        'If response = MsgBoxResult.Yes Then
        '    If Insert_Kratisi_for_Web(kwdikoKratisisDB, Date.Today, Date.Today.Year, praktortimolkwd, CType(Me.VoucherTbx.Text, String), CType(EnilikTbx.Text, Short),
        '                                       CType(EthnKwd1.Text, Short), CType(EthnAnzTbx1.Text, Byte), CType(TilefTbx.Text, String), CType(EpithimTbx.Text, String), CType(SimetTbx.Text, Short),
        '                                        CType(ProkatTbx.Text, Single), CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value, Date), CType(currenttipos, Integer),
        '                                         CType(optionChk.Checked, Boolean), CType(DwmTbx.Text, String), CType(PliromiCbx.SelectedItem, String), CType(SynolLbl.Text, Single),
        '                                        False, False, CType(timokatalog(0).ypnos, Single), CType(timokatalog(0).prwino, Single)) Then

        '    Else
        '        MsgBox(" Η ενημέρωση του WebServer απέτυχε", MsgBoxStyle.Critical, "winfo\nikEl.")
        '    End If
        'End If

        ''Update_Kratisi_for_Web(kwdikoKratisisDB, praktortimolkwd, CType(Me.VoucherTbx.Text, String), CType(EnilikTbx.Text, Short),
        ''                                                                         CType(EthnKwd1.Text, Short), CType(EthnAnzTbx1.Text, Byte), CType(TilefTbx.Text, String), CType(EpithimTbx.Text, String), CType(SimetTbx.Text, Short),
        ''                                                                          CType(ProkatTbx.Text, Single), CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value, Date), CType(currenttipos, Integer),
        ''                                                                           CType(optionChk.Checked, Boolean), CType(DwmTbx.Text, String), CType(PliromiCbx.SelectedItem, String), CType(SynolLbl.Text, Single),
        ''                                                                          afixiOK, False, CType(timokatalog(0).ypnos, Single), CType(timokatalog(0).prwino, Single)) Then
    End Sub
    Function Update_Kratisi_for_Web(ByVal kwdikos As Integer, ByVal praktimologio As Integer,
                                   ByVal voucher As String, ByVal enilikes As Int16, ByVal ethnikotites As Integer, ByVal anzethnikotites As Int16, ByVal tel As String,
                                   ByVal epithimia As String, ByVal simetoxi As Int16, ByVal prokat As Single, ByVal afixi As Date, ByVal anaxwrisi As Date, ByVal tipos As Integer, ByVal guarant As Boolean,
                                   ByVal dwm As String, ByVal pliromi As String, ByVal synolo As Single, ByVal checkin As Boolean, ByVal checkout As Boolean, ByVal ypnos As Single, ByVal prwino As Single) As Boolean

        Dim appSettings = ConfigurationManager.AppSettings
        'Dim webconn As New WebConnect.WebConnect
        Dim countPaidia As Int16 = 0
        Dim Kratisi As New WebConnect.kratiseis


        Kratisi.kwd = kwdikos
        Kratisi.praktimologio = praktimologio
        Kratisi.voucher = voucher
        Kratisi.xrewsi = timokatalog(0).xrewsi
        Kratisi.enilikes = enilikes
        'Enilikestbl.onomateponimo = CType(OnomTbx1.Text, String)
        'Dim onom As New List(Of WebConnect.enilikes)
        'onom.Add(Enilikestbl)
        'Kratisi.onoma1 = onom
        Kratisi.onoma = CType(OnomTbx1.Text, String)
        If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
            countPaidia += 1
        End If
        If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
            countPaidia += 1
        End If
        If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
            countPaidia += 1
        End If
        Kratisi.paidia = countPaidia
        Kratisi.praktoreio = CType(appSettings("Individual"), Integer)
        Kratisi.simbolaio = CType(appSettings("Simbolaio"), Integer)
        Kratisi.touristperiod = CType(appSettings("Touristperiod"), Integer)
        If ethnikotites = 0 Then
            Kratisi.ethnikotites = 1 ' Ellines
        Else
            Kratisi.ethnikotites = ethnikotites
        End If
        If anzethnikotites = 0 Then
            Kratisi.anzethnikotites = 1 ' Ellines
        Else
            Kratisi.anzethnikotites = anzethnikotites
        End If

        Kratisi.tilefonomem = tel
        Kratisi.epithimia = epithimia
        Kratisi.simetoxi = simetoxi
        Kratisi.prokataboli = prokat
        Kratisi.afixi = afixi
        Kratisi.anaxwrisi = anaxwrisi
        Kratisi.tipos = tipos
        Kratisi.guarantie = guarant
        Kratisi.dwmatio = dwm
        Kratisi.pliromi = pliromi
        Kratisi.synolo = synolo
        Kratisi.checkin = checkin
        Kratisi.checkout = checkout
        Kratisi.ypnos = ypnos
        Kratisi.prwino = prwino
        Kratisi.sum = synolo

        'Try
        '    webconn.Update(Kratisi)

        '    Return True
        'Catch ex As Exception
        '    MsgBox(ex.Message)
        '    Return False
        'End Try

    End Function
    'Private Function set_availabilities(ByVal dwm As String, ByVal apo As Date, ByVal mexri As Date, ByVal operatos As String) As Boolean
    '    Dim roomRateTipos As String = ""

    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("arithmos", dwm)
    '        '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '        command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '        'WHERE tbl_dwmatia.arithmos NOT IN (
    '        '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '        '   FROM tbl_kratiseis
    '        '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '        myReader = command.ExecuteReader()
    '        While myReader.Read()
    '            roomRateTipos = myReader.GetString(0)
    '            Exit While
    '        End While
    '        ' Always call Read before accessing data.
    '        If roomRateTipos <> "" Then
    '            Dim hotel As New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, mexri, "1")
    '            hotel.set_roomratetype_id(roomRateTipos)
    '            hotel.set_availabilities_operator(operatos)

    '            If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTipos + " " + apo + " " + mexri + " " + operatos + vbCrLf)
    '            Else
    '                Return False
    '            End If

    '            'Return hotel.make_send_XML_file_for_request()
    '            'Return True
    '            'Else
    '            '    Return False
    '        End If

    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_all(ByVal dwm As String, ByVal apo As Date, ByVal mexri As Date, ByVal operatos As String) As Boolean
    '    Dim roomRateTipos As String = ""
    '    Dim datumKlDwm() As Int16
    '    Dim anzahl As Int16

    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("arithmos", dwm)
    '        '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '        command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '        'WHERE tbl_dwmatia.arithmos NOT IN (
    '        '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '        '   FROM tbl_kratiseis
    '        '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '        myReader = command.ExecuteReader()
    '        While myReader.Read()
    '            roomRateTipos = myReader.GetString(0)
    '            Exit While
    '        End While
    '        ' Always call Read before accessing data.
    '        If roomRateTipos <> "" Then
    '            'Dim hotel As New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, mexri, "1")
    '            'hotel.set_roomratetype_id(roomRateTipos)
    '            'hotel.set_availabilities_operator(operatos)
    '            ReDim datumKlDwm(mexri.Subtract(apo).Days)
    '            Me.KratiseisTableAdapter1.FillByTipAfixeisAnax(Me.DbhotelDataSet1.kratiseis, mexri, apo, roomRateTipos)
    '            If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
    '                fuehle_datum_krat1_xenodox(datumKlDwm, apo, mexri)
    '            End If
    '            'anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(tiposKwd)
    '            anzahl = get_anzahl_rooms_by_kathgoria(roomRateTipos)
    '            Dim hotel As New SetAvailabilities("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, datumKlDwm, anzahl)
    '            hotel.set_roomratetype_id(roomRateTipos)
    '            If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTipos + " " + apo + " " + mexri + " " + operatos + vbCrLf)
    '            Else
    '                Return False
    '            End If

    '            'Return hotel.make_send_XML_file_for_request()
    '            'Return True
    '            'Else
    '            '    Return False
    '        End If

    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_status(ByVal dwmNew As String, ByVal neaEnarxi As Date, ByVal neaLixi As Date, ByVal kwdikosKrat As Integer) As Boolean
    '    Dim roomRateTiposOld As String = ""
    '    Dim roomRateTiposNew As String = ""
    '    Dim dwmOld As String = ""
    '    Dim enarxiOld, lixiOld As Date
    '    Dim hotel As SetMainCalendarKratisis

    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikosKrat)
    '        command.CommandText = "SELECT dwmatio, enarxi,lixi, dwmatiostatus FROM status WHERE kratisi=?"
    '        myReader = command.ExecuteReader()
    '        While myReader.Read
    '            dwmOld = myReader.GetString(0)
    '            enarxiOld = myReader.GetDateTime(1)
    '            lixiOld = myReader.GetDateTime(2)
    '        End While
    '        command.Parameters.Clear()
    '        myReader.Close()
    '        If dwmOld <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwmOld)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTiposOld = myReader.GetString(0)
    '                Exit While
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()
    '        Else
    '            Try
    '                command.Parameters.AddWithValue("kratisi", dwmOld)
    '                command.CommandText = "SELECT room_rate_type, afixi, anaxwrisi FROM Reservations WHERE (kratisi=?)"
    '                myReader = command.ExecuteReader()
    '                While myReader.Read
    '                    roomRateTiposOld = myReader.GetString(0)
    '                    enarxiOld = myReader.GetDateTime(1)
    '                    lixiOld = myReader.GetDateTime(2).AddDays(-1)
    '                End While
    '                command.Parameters.Clear()
    '                myReader.Close()
    '            Catch ex As Exception
    '                command.Parameters.Clear()
    '                myReader.Close()
    '                MsgBox("Παρουσιάστηκε πρόβλημα με το άδειο δωμάτιο ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '            End Try

    '        End If
    '        If dwmNew <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwmNew)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?))"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTiposNew = myReader.GetString(0)
    '                Exit While
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()
    '        End If
    '        If dwmNew <> dwmOld Then
    '            If roomRateTiposNew <> roomRateTiposOld Then
    '                If roomRateTiposOld <> "" Then

    '                    hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", enarxiOld, lixiOld, "1")
    '                    hotel.set_roomratetype_id(roomRateTiposOld)

    '                    hotel.set_availabilities_operator("plus")

    '                    If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                        File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposOld + " " + enarxiOld + " " + lixiOld + " " + "plus" + vbCrLf)
    '                    Else
    '                        Return False
    '                    End If


    '                End If
    '                If roomRateTiposNew <> "" Then

    '                    hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaEnarxi, neaLixi, "1")
    '                    hotel.set_roomratetype_id(roomRateTiposNew)
    '                    hotel.set_availabilities_operator("minus")
    '                    If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                        File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaEnarxi + " " + neaLixi + " " + "minus" + vbCrLf)
    '                    Else
    '                        Return False
    '                    End If


    '                End If


    '            End If

    '        ElseIf dwmOld = dwmNew And dwmNew <> "" Then
    '            If enarxiOld < neaEnarxi Then ' nea afixi pio meta apo programatismeni -> eleyuervse damtio
    '                hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", enarxiOld, neaEnarxi.AddDays(-1), "1")
    '                hotel.set_roomratetype_id(roomRateTiposNew)
    '                hotel.set_availabilities_operator("plus")
    '                If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + enarxiOld + " " + neaEnarxi.AddDays(-1) + " " + "plus" + vbCrLf)
    '                Else
    '                    Return False
    '                End If

    '            ElseIf neaEnarxi < enarxiOld Then
    '                hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaEnarxi, enarxiOld.AddDays(-1), "1")
    '                hotel.set_roomratetype_id(roomRateTiposNew)
    '                hotel.set_availabilities_operator("minus")
    '                If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaEnarxi + " " + enarxiOld.AddDays(-1) + " " + "minus" + vbCrLf)
    '                Else
    '                    Return False
    '                End If

    '            End If
    '            If lixiOld < neaLixi Then ' epektasi anxwrisis
    '                hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", lixiOld.AddDays(+1), neaLixi, "1")
    '                hotel.set_roomratetype_id(roomRateTiposNew)
    '                hotel.set_availabilities_operator("minus")
    '                If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + lixiOld.AddDays(+1) + " " + neaLixi + " " + "minus" + vbCrLf)
    '                Else
    '                    Return False
    '                End If

    '            ElseIf neaLixi < lixiOld Then
    '                hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaLixi.AddDays(+1), lixiOld, "1")
    '                hotel.set_roomratetype_id(roomRateTiposNew)
    '                hotel.set_availabilities_operator("plus")
    '                If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaLixi.AddDays(+1) + " " + lixiOld + " " + "plus" + vbCrLf)
    '                Else
    '                    Return False
    '                End If

    '            End If
    '        End If




    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_all_status(ByVal dwmNew As String, ByVal neaEnarxi As Date, ByVal neaLixi As Date, ByVal kwdikosKrat As Integer) As Boolean
    '    Dim roomRateTiposOld As String = ""
    '    Dim roomRateTiposNew As String = ""
    '    Dim dwmOld As String = ""
    '    Dim enarxiOld, lixiOld As Date
    '    Dim hotel As SetAvailabilities
    '    Dim datumKlDwm() As Int16
    '    Dim anzahl As Int16
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikosKrat)
    '        command.CommandText = "SELECT dwmatio, enarxi,lixi, dwmatiostatus FROM status WHERE kratisi=?"
    '        myReader = command.ExecuteReader()
    '        While myReader.Read
    '            dwmOld = myReader.GetString(0)
    '            enarxiOld = myReader.GetDateTime(1)
    '            lixiOld = myReader.GetDateTime(2)
    '        End While
    '        command.Parameters.Clear()
    '        myReader.Close()
    '        If dwmOld <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwmOld)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTiposOld = myReader.GetString(0)
    '                Exit While
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()
    '        Else
    '            Try
    '                command.Parameters.AddWithValue("kratisi", dwmOld)
    '                command.CommandText = "SELECT room_rate_type, afixi, anaxwrisi FROM Reservations WHERE (kratisi=?)"
    '                myReader = command.ExecuteReader()
    '                While myReader.Read
    '                    roomRateTiposOld = myReader.GetString(0)
    '                    enarxiOld = myReader.GetDateTime(1)
    '                    lixiOld = myReader.GetDateTime(2).AddDays(-1)
    '                End While
    '                command.Parameters.Clear()
    '                myReader.Close()
    '            Catch ex As Exception
    '                command.Parameters.Clear()
    '                myReader.Close()
    '                MsgBox("Παρουσιάστηκε πρόβλημα με το άδειο δωμάτιο ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '            End Try

    '        End If
    '        If dwmNew <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwmNew)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTiposNew = myReader.GetString(0)
    '                Exit While
    '            End While
    '            command.Parameters.Clear()
    '            myReader.Close()
    '        End If
    '        If dwmNew <> dwmOld Then
    '            If roomRateTiposNew <> roomRateTiposOld Then
    '                If roomRateTiposOld <> "" Then

    '                    'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", enarxiOld, lixiOld, "1")
    '                    ReDim datumKlDwm(lixiOld.Subtract(enarxiOld).Days)
    '                    Me.KratiseisTableAdapter1.FillByTipAfixeisAnax(Me.DbhotelDataSet1.kratiseis, lixiOld, enarxiOld, roomRateTiposOld)
    '                    If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
    '                        fuehle_datum_krat1_xenodox(datumKlDwm, enarxiOld, lixiOld)
    '                    End If
    '                    '    anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(roomRateTiposOld)
    '                    anzahl = get_anzahl_rooms_by_kathgoria(roomRateTiposOld)
    '                    hotel = New SetAvailabilities("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", enarxiOld, datumKlDwm, anzahl)

    '                    hotel.set_roomratetype_id(roomRateTiposOld)

    '                    '  hotel.set_availabilities_operator("plus")

    '                    If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                        File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposOld + " " + enarxiOld + " " + lixiOld + " " + "plus" + vbCrLf)
    '                    Else
    '                        Return True
    '                    End If


    '                End If
    '                If roomRateTiposNew <> "" Then

    '                    'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaEnarxi, neaLixi, "1")
    '                    'hotel.set_roomratetype_id(roomRateTiposNew)
    '                    'hotel.set_availabilities_operator("minus")
    '                    ReDim datumKlDwm(neaLixi.Subtract(neaEnarxi).Days)
    '                    Me.KratiseisTableAdapter1.FillByTipAfixeisAnax(Me.DbhotelDataSet1.kratiseis, neaLixi, neaEnarxi, roomRateTiposNew)
    '                    If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
    '                        fuehle_datum_krat1_xenodox(datumKlDwm, neaEnarxi, neaLixi)
    '                    End If
    '                    ' anzahl = Me.KatigoriesTableAdapter.AnzahlByTipos(roomRateTiposOld)
    '                    anzahl = get_anzahl_rooms_by_kathgoria(roomRateTiposNew)
    '                    hotel = New SetAvailabilities("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaEnarxi, datumKlDwm, anzahl)

    '                    hotel.set_roomratetype_id(roomRateTiposNew)

    '                    If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                        File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaEnarxi + " " + neaLixi + " " + "minus" + vbCrLf)
    '                    Else
    '                        Return False
    '                    End If


    '                End If


    '            End If

    '        ElseIf dwmOld = dwmNew And dwmNew <> "" Then
    '            Dim apo, mexri As Date
    '            Dim enimerwsiOK As Boolean = False
    '            apo = neaEnarxi
    '            mexri = neaLixi
    '            If enarxiOld < neaEnarxi Then ' nea afixi pio meta apo programatismeni -> eleyuervse damtio
    '                'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", enarxiOld, neaEnarxi.AddDays(-1), "1")
    '                'hotel.set_roomratetype_id(roomRateTiposNew)
    '                'hotel.set_availabilities_operator("plus")


    '                'If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                '    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + enarxiOld + " " + neaEnarxi.AddDays(-1) + " " + "plus" + vbCrLf)
    '                'Else
    '                '    Return False
    '                'End If
    '                apo = enarxiOld
    '                enimerwsiOK = True
    '            ElseIf neaEnarxi < enarxiOld Then
    '                'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaEnarxi, enarxiOld.AddDays(-1), "1")
    '                'hotel.set_roomratetype_id(roomRateTiposNew)
    '                'hotel.set_availabilities_operator("minus")
    '                'If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                '    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaEnarxi + " " + enarxiOld.AddDays(-1) + " " + "minus" + vbCrLf)
    '                'Else
    '                '    Return False
    '                'End If
    '                apo = neaEnarxi
    '                enimerwsiOK = True

    '            End If
    '            If lixiOld < neaLixi Then ' epektasi anxwrisis
    '                'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", lixiOld.AddDays(+1), neaLixi, "1")
    '                'hotel.set_roomratetype_id(roomRateTiposNew)
    '                'hotel.set_availabilities_operator("minus")
    '                'If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                '    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + lixiOld.AddDays(+1) + " " + neaLixi + " " + "minus" + vbCrLf)
    '                'Else
    '                '    Return False
    '                'End If
    '                mexri = neaLixi
    '                enimerwsiOK = True
    '            ElseIf neaLixi < lixiOld Then
    '                'hotel = New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", neaLixi.AddDays(+1), lixiOld, "1")
    '                'hotel.set_roomratetype_id(roomRateTiposNew)
    '                'hotel.set_availabilities_operator("plus")
    '                'If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                '    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaLixi.AddDays(+1) + " " + lixiOld + " " + "plus" + vbCrLf)
    '                'Else
    '                '    Return False
    '                'End If
    '                mexri = lixiOld
    '                enimerwsiOK = True
    '            End If
    '            If enimerwsiOK Then
    '                ReDim datumKlDwm(mexri.Subtract(apo).Days)
    '                Me.KratiseisTableAdapter1.FillByTipAfixeisAnax(Me.DbhotelDataSet1.kratiseis, mexri, apo, roomRateTiposNew)
    '                If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
    '                    fuehle_datum_krat1_xenodox(datumKlDwm, apo, mexri)
    '                End If
    '                anzahl = get_anzahl_rooms_by_kathgoria(roomRateTiposNew)
    '                hotel = New SetAvailabilities("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, datumKlDwm, anzahl)

    '                hotel.set_roomratetype_id(roomRateTiposNew)

    '                If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTiposNew + " " + neaEnarxi + " " + neaLixi + " " + "minus" + vbCrLf)
    '                Else
    '                    Return False
    '                End If
    '            Else
    '                Return True
    '            End If


    '        End If




    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_all_status_WEBHOTELIER(ByVal dwmNew As String, ByVal neaEnarxi As Date, ByVal neaLixi As Date, ByVal kwdikosKrat As Integer) As Boolean
    '    'Dim roomRateTiposOld As String = ""
    '    'Dim roomRateTiposNew As String = ""
    '    Dim dwmOld As String = ""
    '    Dim enarxiOld, lixiOld As Date
    '    'Dim hotel As SetAvailabilities
    '    'Dim datumKlDwm() As Int16
    '    Dim anzahl As Int16
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikosKrat)
    '        command.CommandText = "SELECT dwmatio, enarxi,lixi, dwmatiostatus FROM status WHERE kratisi=?"
    '        myReader = command.ExecuteReader()
    '        While myReader.Read
    '            dwmOld = myReader.GetString(0)
    '            enarxiOld = myReader.GetDateTime(1)
    '            lixiOld = myReader.GetDateTime(2)
    '        End While
    '        command.Parameters.Clear()
    '        myReader.Close()


    '        If dwmNew <> dwmOld Then
    '            Dim webhotel As New WebHotelier.RoomRateTypes(Me.DbhotelDataSet.etaireia(0).connectionstring, "https://rest.reserve-online.net/manage/availability", "WINHOTEST", "922EF87595A93C769FB5B42DF89C13A51DDACE3C", "WINHOTEST")
    '            If webhotel.StopSells(dwmOld, enarxiOld, lixiOld, False) Then
    '                If webhotel.StopSells(dwmNew, neaEnarxi, neaLixi, True) Then
    '                    Return True
    '                Else
    '                    Return False
    '                End If
    '            Else
    '                Return False
    '            End If

    '        ElseIf dwmOld = dwmNew And dwmNew <> "" Then
    '            Dim apo, mexri As Date
    '            Dim enimerwsiOK As Boolean = False
    '            apo = neaEnarxi
    '            mexri = neaLixi
    '            If enarxiOld < neaEnarxi Then ' nea afixi pio meta apo programatismeni -> eleyuervse damtio

    '                apo = enarxiOld
    '                enimerwsiOK = True
    '            ElseIf neaEnarxi < enarxiOld Then

    '                apo = neaEnarxi
    '                enimerwsiOK = True

    '            End If
    '            If lixiOld < neaLixi Then ' epektasi anxwrisis

    '                mexri = neaLixi
    '                enimerwsiOK = True
    '            ElseIf neaLixi < lixiOld Then

    '                mexri = lixiOld
    '                enimerwsiOK = True
    '            End If
    '            If enimerwsiOK Then
    '                Dim webhotel As New WebHotelier.RoomRateTypes(Me.DbhotelDataSet.etaireia(0).connectionstring, "https://rest.reserve-online.net/manage/availability", "WINHOTEST", "922EF87595A93C769FB5B42DF89C13A51DDACE3C", "WINHOTEST")
    '                If webhotel.StopSells(dwmNew, enarxiOld, lixiOld, False) Then
    '                    If webhotel.StopSells(dwmNew, neaEnarxi, neaLixi, True) Then
    '                        Return True
    '                    Else
    '                        Return False
    '                    End If
    '                Else
    '                    Return False
    '                End If


    '            End If

    '            Return True
    '        End If

    '    End Using
    '    Return True
    'End Function
    Private Function set_availabilities_all_status_WEBHOTELIER(ByVal dwmNew As String, ByVal neaEnarxi As Date, ByVal neaLixi As Date, ByVal kwdikosKrat As Integer) As Boolean
        Dim dwmOld As String = ""
        Dim enarxiOld, lixiOld As Date
        Dim anzahl As Int16

        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader

            connection.Open()
            command.Connection = connection
            command.Parameters.AddWithValue("@kratisi", kwdikosKrat)
            command.CommandText = "SELECT dwmatio, enarxi, lixi, dwmatiostatus FROM status WHERE kratisi=@kratisi"

            myReader = command.ExecuteReader()

            While myReader.Read
                dwmOld = myReader.GetString(0)
                enarxiOld = myReader.GetDateTime(1)
                lixiOld = myReader.GetDateTime(2)
            End While

            command.Parameters.Clear()
            myReader.Close()
            'MsgBox(Me.DbhotelDataSet.kratiseis(0).praktoreio)
            'If dwmNew <> dwmOld OrElse Me.DbhotelDataSet.kratiseis(0).praktoreio <> praktKwd Then
            If dwmNew <> dwmOld OrElse
   (Me.DbhotelDataSet.kratiseis IsNot Nothing AndAlso
    Me.DbhotelDataSet.kratiseis.Rows.Count > 0 AndAlso
    Not IsDBNull(Me.DbhotelDataSet.kratiseis(0).praktoreio) AndAlso
    Me.DbhotelDataSet.kratiseis(0).praktoreio <> praktKwd) Then
                Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")

                If webhotel.StopSells(dwmOld, enarxiOld, lixiOld, False) Then
                    If webhotel.StopSells(dwmNew, neaEnarxi, neaLixi, True) Then
                        Return True
                    Else
                        Return False
                    End If
                Else
                    Return False
                End If
            ElseIf dwmOld = dwmNew And dwmNew <> "" Then
                Dim apo, mexri As Date
                Dim enimerwsiOK As Boolean = False
                apo = neaEnarxi
                mexri = neaLixi

                If enarxiOld < neaEnarxi Then ' nea afixi pio meta apo programatismeni -> eleyuervse damtio
                    apo = enarxiOld
                    enimerwsiOK = True
                ElseIf neaEnarxi < enarxiOld Then
                    apo = neaEnarxi
                    enimerwsiOK = True
                End If

                If lixiOld < neaLixi Then ' epektasi anxwrisis
                    mexri = neaLixi
                    enimerwsiOK = True
                ElseIf neaLixi < lixiOld Then
                    mexri = lixiOld
                    enimerwsiOK = True
                ElseIf Me.DbhotelDataSet.kratiseis(0).praktoreio <> praktoreiokwd Then
                    enimerwsiOK = True
                End If

                If enimerwsiOK Then
                    Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")

                    If webhotel.StopSells(dwmNew, enarxiOld, lixiOld, False) Then
                        If webhotel.StopSells(dwmNew, neaEnarxi, neaLixi, True) Then
                            Return True
                        Else
                            Return False
                        End If
                    Else
                        Return False
                    End If
                End If

                Return True
            End If
        End Using

        Return True
    End Function

    'Private Function set_availabilities_deleted(ByVal kwdikos As Int64) As Boolean
    '    Dim roomRateTipos As String = ""
    '    Dim dwm As String = ""
    '    Dim apo, mexri As Date
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikos)
    '        command.CommandText = "SELECT  dwmatio, enarxi, lixi FROM status WHERE (kratisi=?)"
    '        myReader = command.ExecuteReader()
    '        ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
    '        While myReader.Read()
    '            'kalutera diktes apo pou mexri pou sto imeresStat
    '            dwm = myReader.GetString(0)
    '            apo = myReader.GetDateTime(1)
    '            mexri = myReader.GetDateTime(2)


    '        End While
    '        myReader.Close()
    '        command.Parameters.Clear()

    '        If dwm <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwm)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?))"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTipos = myReader.GetString(0)
    '                Exit While
    '            End While
    '        End If

    '        ' Always call Read before accessing data.
    '        If roomRateTipos <> "" Then
    '            Dim hotel As New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, mexri, "1")
    '            hotel.set_roomratetype_id(roomRateTipos)
    '            hotel.set_availabilities_operator("plus")

    '            If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTipos + " " + apo + " " + mexri + " " + "plus" + vbCrLf)
    '            Else
    '                Return False
    '            End If


    '        End If

    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_all_deleted(ByVal kwdikos As Int64) As Boolean
    '    Dim roomRateTipos As String = ""
    '    Dim dwm As String = ""
    '    Dim apo, mexri As Date
    '    Dim datumKlDwm() As Int16
    '    Dim anzahl, i As Int16
    '    Dim hotel As SetAvailabilities
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikos)
    '        command.CommandText = "SELECT  dwmatio, enarxi, lixi FROM status WHERE (kratisi=?)"
    '        myReader = command.ExecuteReader()
    '        ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
    '        While myReader.Read()
    '            'kalutera diktes apo pou mexri pou sto imeresStat
    '            dwm = myReader.GetString(0)
    '            apo = myReader.GetDateTime(1)
    '            mexri = myReader.GetDateTime(2)


    '        End While
    '        myReader.Close()
    '        command.Parameters.Clear()

    '        If dwm <> "" Then
    '            command.Parameters.AddWithValue("arithmos", dwm)
    '            '  command.CommandText = "SELECT dwmatia.arithmos, dwmatia.klines FROM dwmatia INNER JOIN katigories ON dwmatia.katigoria=katigories.kwd WHERE (katigories.tipos=?) AND (dwmatia.arithmos NOT IN (SELECT DISTINCT kratiseis.dwmatio FROM kratiseis WHERE (kratiseis.afixi<?) and (kratiseis.anaxwrisi>?)))" 'WHERE   kratiseis.afixi<? AND   kratiseis.anaxwrisi>?
    '            command.CommandText = "SELECT RoomRateTypes.id, dwmatia.arithmos FROM RoomRateTypes INNER JOIN (katigories INNER JOIN dwmatia ON katigories.kwd = dwmatia.katigoria) ON RoomRateTypes.tipos = katigories.tipos WHERE (((dwmatia.arithmos)=?)) ORDER BY RoomRateTypes.id ASC"
    '            'WHERE tbl_dwmatia.arithmos NOT IN (
    '            '   SELECT DISTINCT tbl_kratiseis.dwmatio
    '            '   FROM tbl_kratiseis
    '            '   WHERE tbl_kratiseis.afixi < STR_TO_DATE('$mexri','%d/%m/%Y') AND tbl_kratiseis.anaxwrisi > STR_TO_DATE('$apo','%d/%m/%Y')) order by tbl_dwmatia.arithmos ASC"
    '            myReader = command.ExecuteReader()
    '            While myReader.Read()
    '                roomRateTipos = myReader.GetString(0)
    '                Exit While
    '            End While
    '        End If

    '        ' Always call Read before accessing data.
    '        If roomRateTipos <> "" Then
    '            'Dim hotel As New SetMainCalendarKratisis("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, mexri, "1")
    '            'hotel.set_roomratetype_id(roomRateTipos)
    '            'hotel.set_availabilities_operator("plus")

    '            'If hotel.make_send_XML_file_for_Availabilities_request() Then
    '            '    File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTipos + " " + apo + " " + mexri + " " + "plus" + vbCrLf)
    '            'Else
    '            '    Return False
    '            'End If

    '            ReDim datumKlDwm(mexri.Subtract(apo).Days)
    '            Me.KratiseisTableAdapter1.FillByTipAfixeisAnax(Me.DbhotelDataSet1.kratiseis, mexri, apo, roomRateTipos)
    '            If Me.DbhotelDataSet1.kratiseis.Count <> 0 Then
    '                fuehle_datum_krat1_xenodox(datumKlDwm, apo, mexri)
    '                For i = 0 To datumKlDwm.Length - 1
    '                    datumKlDwm(i) = datumKlDwm(i) - 1
    '                Next
    '            End If
    '            anzahl = get_anzahl_rooms_by_kathgoria(roomRateTipos)
    '            hotel = New SetAvailabilities("https://hotelavailabilities.com/pmsapi", "kallergisapi", "K@ll3rgisXML", "1502", apo, datumKlDwm, anzahl)

    '            hotel.set_roomratetype_id(roomRateTipos)

    '            If hotel.make_send_XML_file_for_Availabilities_request() Then
    '                File.AppendAllText(availPath, DateTime.Now + " " + "1502 " + roomRateTipos + " " + apo + " " + mexri + " " + "plus" + vbCrLf)
    '            Else
    '                Return False
    '            End If
    '        End If

    '    End Using
    '    Return True
    'End Function
    'Private Function set_availabilities_all_deleted_WEBHOTELIER(ByVal kwdikos As Int64) As Boolean

    '    Dim dwm As String = ""
    '    Dim apo, mexri As Date

    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim myReader As OleDb.OleDbDataReader
    '        connection.Open()
    '        ' Assign transaction object for a pending local transaction.
    '        command.Connection = connection
    '        command.Parameters.AddWithValue("kratisi", kwdikos)
    '        command.CommandText = "SELECT  dwmatio, enarxi, lixi FROM status WHERE (kratisi=?)"
    '        myReader = command.ExecuteReader()
    '        ' PROSOXi ALAKSA Noembrios 2018 !!! giat;i den doyleue to systhma gia kratiseis Xristougennwn  pou patousan se 2 eti
    '        While myReader.Read()
    '            'kalutera diktes apo pou mexri pou sto imeresStat
    '            dwm = myReader.GetString(0)
    '            apo = myReader.GetDateTime(1)
    '            mexri = myReader.GetDateTime(2)


    '        End While
    '        myReader.Close()
    '        command.Parameters.Clear()

    '        If dwm <> "" Then
    '            Dim webhotel As New WebHotelier.RoomRateTypes(Me.DbhotelDataSet.etaireia(0).connectionstring, "https://rest.reserve-online.net/manage/availability", "WINHOTEST", "922EF87595A93C769FB5B42DF89C13A51DDACE3C", "WINHOTEST")
    '            If Not webhotel.StopSells(dwm, apo, mexri, False) Then
    '                Return False
    '            End If
    '        End If



    '    End Using
    '    Return True
    'End Function
    Private Function set_availabilities_all_deleted_WEBHOTELIER(ByVal kwdikos As Int64) As Boolean
        Dim dwm As String = ""
        Dim apo, mexri As Date

        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader

            connection.Open()
            command.Connection = connection
            command.Parameters.AddWithValue("@kratisi", kwdikos)
            command.CommandText = "SELECT dwmatio, enarxi, lixi FROM status WHERE (kratisi=@kratisi)"

            myReader = command.ExecuteReader()

            While myReader.Read()
                dwm = myReader.GetString(0)
                apo = myReader.GetDateTime(1)
                mexri = myReader.GetDateTime(2)
            End While

            myReader.Close()
            command.Parameters.Clear()

            If dwm <> "" Then
                Dim webhotel As New WebHotelier.RoomRateTypes(connectionString, "https://rest.reserve-online.net/manage/availability", "THALASSES", "0845A70BBB0AA9E7C68F08530391D7084DF9A25D", "THALASSES")
                If Not webhotel.StopSells(dwm, apo, mexri, False) Then
                    Return False
                End If
            End If
        End Using

        Return True
    End Function

    Private Sub fuehle_datum_krat1_xenodox(ByRef datumKrat() As Int16, ByVal apo As Date, ByVal mexri As Date)
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet1.kratiseis.Count - 1

            If Me.DbhotelDataSet1.kratiseis(j).afixi.Date <= apo Then
                index1 = 0
            Else
                index1 = Me.DbhotelDataSet1.kratiseis(j).afixi.DayOfYear - apo.DayOfYear
            End If
            If Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= mexri Then
                index2 = datumKrat.Length - 1
            Else
                index2 = Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.Date.AddDays(-1).DayOfYear - apo.DayOfYear
            End If

            For k = index1 To index2
                datumKrat(k) = datumKrat(k) + 1
            Next
        Next

    End Sub
    'Private Function get_anzahl_rooms_by_kathgoria(ByVal roomtype As Int32) As Int16
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim anzahl As Int16
    '        Dim overKwd As Integer = -1
    '        Dim command As New OleDb.OleDbCommand()

    '        Try
    '            connection.Open()

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection

    '            command.Parameters.AddWithValue("id", roomtype)
    '            command.CommandText = "SELECT total_rooms FROM RoomRateTypes where (id=?)"

    '            Dim myReader As OleDb.OleDbDataReader
    '            myReader = command.ExecuteReader()
    '            ' Always call Read before accessing data.
    '            While myReader.Read()
    '                anzahl = myReader.GetInt16(0)
    '            End While
    '            myReader.Close()




    '            Return anzahl
    '        Catch ex As Exception


    '        End Try



    '    End Using


    'End Function
    Private Function get_anzahl_rooms_by_kathgoria(ByVal roomtype As Int32) As Int16
        Using connection As New SqlConnection(connectionString)
            Dim anzahl As Int16
            Dim overKwd As Integer = -1
            Dim command As New SqlCommand()

            Try
                connection.Open()
                command.Connection = connection
                command.Parameters.AddWithValue("@id", roomtype)
                command.CommandText = "SELECT total_rooms FROM RoomRateTypes WHERE (id=@id)"

                Dim myReader As SqlDataReader
                myReader = command.ExecuteReader()

                While myReader.Read()
                    anzahl = myReader.GetInt16(0)
                End While

                myReader.Close()

                Return anzahl
            Catch ex As Exception
                ' Handle exception here
            End Try
        End Using
    End Function

    'Private Function get_calender_id(ByVal dwmatio As String) As String
    '    Dim j As Int16
    '    For j = 0 To Me.DbhotelDataSet.calendar.Count - 1
    '        If Me.DbhotelDataSet.calendar(j).vila = dwmatio Then
    '            Return Me.DbhotelDataSet.calendar(j).calendarid
    '        End If
    '    Next
    '    Return ""
    'End Function
    Private Function fuehle_datum_krat_xenodox_thalases(ByRef datumKrat() As Int16) As String
        Dim j, index1, index2, k As Int16

        For j = 0 To Me.DbhotelDataSet1.kratiseis.Count - 1

            If Me.DbhotelDataSet1.kratiseis(j).afixi.Date <= DateTimePicker2.Value.Date Then
                index1 = 0
            Else
                index1 = DateDiff(DateInterval.Day, DateTimePicker2.Value.Date, Me.DbhotelDataSet1.kratiseis(j).afixi)
            End If
            If Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.Date.AddDays(-1) >= DateTimePicker3.Value.Date Then
                index2 = datumKrat.Length - 1
            Else
                index2 = DateDiff(DateInterval.Day, DateTimePicker2.Value.Date, Me.DbhotelDataSet1.kratiseis(j).anaxwrisi.AddDays(-1))
            End If

            For k = index1 To index2
                datumKrat(k) = datumKrat(k) + 1
            Next
        Next
        Dim myStringBuilder As New System.Text.StringBuilder
        For k = index1 To index2
            If datumKrat(k) >= 4 Then
                myStringBuilder.Append(DateTimePicker2.Value.Date.AddDays(k).ToShortDateString)
                myStringBuilder.AppendLine()
            End If
            datumKrat(k) = datumKrat(k) + 1
        Next
        Return myStringBuilder.ToString

    End Function
    Sub SendMailStopSales(ByVal dates As String)
        Dim theThread _
            As New Threading.Thread(AddressOf SendStopSales)
        theThread.Start(dates)
    End Sub
    Private Sub SendStopSales(ByVal stopdates As String)
        Dim from, smtpServer, smtpUsername, smtpPassword, subject, allbody As String
        Dim body() As String
        Dim j, i As Int16
        Dim recipients As New List(Of String)
        Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
        mailadapter.Fill(Me.DbhotelDataSet.Mail)
        from = Me.DbhotelDataSet.Mail(0).ffrom
        subject = Me.DbhotelDataSet.Mail(4).subject
        smtpServer = Me.DbhotelDataSet.Mail(0).smtpServer
        smtpUsername = Me.DbhotelDataSet.Mail(0).smtpUsername
        smtpPassword = Me.DbhotelDataSet.Mail(0).smtpPassword
        body = Me.DbhotelDataSet.Mail(4).body.Split("$")
        allbody = body(0) + stopdates + body(1)

        PraktoreiaTableadpter1.FillStopSales(Me.DbhotelDataSet1.praktoreia)


        For j = 0 To Me.DbhotelDataSet1.praktoreia.Count - 1
            Try
                i = Me.DbhotelDataSet1.praktoreia(j).email.IndexOf("@") ' einai sosto to mail->dld periexei @??
                If i <> -1 Then
                    recipients.Add(Me.DbhotelDataSet1.praktoreia(j).email)
                    'SendMail(from, Me.DbhotelDataSet1.praktoreia(j).email, subject, allbody, smtpServer, smtpUsername, smtpPassword)
                End If

            Catch ex As NullReferenceException

            End Try
        Next
        If recipients.Count > 0 Then
            SendMailList(from, recipients, subject, allbody, smtpServer, smtpUsername, smtpPassword)

        End If
    End Sub
    Sub SendMailPrakt(ByVal vila As String, ByVal flag As Byte)
        Dim apo, mexri As Date
        Dim perigrafi As String

        perigrafi = get_perigrafi_vilas(vila)
        apo = DateTimePicker2.Value.Date
        mexri = DateTimePicker3.Value.Date

        Dim parameter As String
        parameter = vila + "$" + perigrafi + "$" + apo + "$" + mexri

        If flag = 1 Then
            Dim theThread _
           As New Threading.Thread(AddressOf SendMailtoPraktoreia)
            theThread.Start(parameter)
        ElseIf flag = 2 Then
            Dim theThread _
        As New Threading.Thread(AddressOf SendMailtoPraktoreiaCancel)
            theThread.Start(parameter)
        End If

    End Sub

    Private Sub SendMailtoPraktoreia(ByVal parameter As String)
        Dim from, smtpServer, smtpUsername, smtpPassword, subject, allbody As String
        allbody = ""
        Dim mesage As String = "mails to agencies: "
        Dim body() As String
        Dim param() As String
        Dim vila, perigrafi, apo, mexri As String
        param = parameter.Split("$")
        vila = param(0)
        perigrafi = param(1)
        apo = param(2)
        mexri = param(3)
        Dim recipients As New List(Of String)
        Dim j, i As Int16
        Name = ""
        Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
        mailadapter.Fill(Me.DbhotelDataSet.Mail)
        'Dim praktadapter As New dbhotelDataSetTableAdapters.praktoreiaTableAdapter
        ' exei idi alaksei i imeromergasias-> ean apykwd =O tote stelnontai mailme to poy alaksei imeromergasias s'autoys pou efugan
        'praktadapter.FillEmailPrakt(Me.DbhotelDataSet.praktoreia)

        'Dim dwmpraktadapter As New dbhotelDataSet1TableAdapters.vilapraktoreiaTableAdapter
        Me.Vilapraktoreia1TableAdapter.FillPraktByDwm(Me.DbhotelDataSet1.vilapraktoreia1, vila)

        from = Me.DbhotelDataSet.Mail(0).ffrom

        subject = Me.DbhotelDataSet.Mail(1).subject
        smtpServer = Me.DbhotelDataSet.Mail(0).smtpServer
        smtpUsername = Me.DbhotelDataSet.Mail(0).smtpUsername
        smtpPassword = Me.DbhotelDataSet.Mail(0).smtpPassword
        body = Me.DbhotelDataSet.Mail(1).body.Split("$")
        'too = "mkallergis@gmail.com"

        For j = 0 To Me.DbhotelDataSet1.vilapraktoreia1.Count - 1

            Try
                i = Me.DbhotelDataSet1.vilapraktoreia1(j).email.IndexOf("@") ' einai sosto to mail->dld periexei @??
                If i <> -1 Then
                    'gia  na min ksanasteilw sto IDIO mai (ean exoun kataxorithei >1 onmata se mia kratisi)

                    'If Not IsDBNull(Me.DbhotelDataSet.praktoreia(j).Item("ipeuthinos")) Then
                    '    Name = Me.DbhotelDataSet.praktoreia(j).ipeuthinos
                    'Else
                    '    Name = ""
                    'End If
                    Name = ""
                    If vila.Equals("HRA") Then
                        vila = "MAVI"
                    End If
                    If Me.DbhotelDataSet1.vilapraktoreia1(j).praktoreio <> 17 Then

                        allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
                    Else
                        Dim kwdikos As String = ""
                        Select Case vila
                            Case "AFR"
                                kwdikos = "HER02071"
                            Case "ALE"
                                kwdikos = "HER02069"
                            Case "ARCH"
                                kwdikos = "HER02065"
                            Case "EEAN"
                                kwdikos = "HER02072"
                            Case "MAIL"
                                kwdikos = "HER02072"
                            Case "PERS"
                                kwdikos = "HER02072"
                            Case "THOI"
                                kwdikos = "HER02072"
                        End Select
                        allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " " + kwdikos + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
                    End If


                    'MsgBox("Sending Email to " + Me.DbhotelDataSet1.vilapraktoreia1(j).email)
                    recipients.Add(Me.DbhotelDataSet1.vilapraktoreia1(j).email)
                    'SendMail(from, Me.DbhotelDataSet1.vilapraktoreia1(j).email, subject, allbody, smtpServer, smtpUsername, smtpPassword)

                    mesage = mesage + ChrW(13) + Me.DbhotelDataSet1.vilapraktoreia1(j).email


                End If
            Catch ex As NullReferenceException

            End Try

        Next
        If recipients.Count > 0 Then
            SendMailList(from, recipients, subject, allbody, smtpServer, smtpUsername, smtpPassword)
            MsgBox(mesage)
        End If



    End Sub

    'Private Sub SendMailtoPraktoreiaCancel(ByVal parameter As String)
    '    Dim from, smtpServer, smtpUsername, smtpPassword, subject, allbody As String
    '    Dim mesage As String = "mails to agencies: "
    '    Dim textMessage As String
    '    Dim body() As String
    '    Dim param() As String
    '    Dim vila, perigrafi, apo, mexri As String
    '    param = parameter.Split("$")
    '    vila = param(0)
    '    perigrafi = param(1)
    '    apo = param(2)
    '    mexri = param(3)

    '    Dim j, i As Int16
    '    Name = ""
    '    Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
    '    mailadapter.Fill(Me.DbhotelDataSet.Mail)
    '    'Dim praktadapter As New dbhotelDataSetTableAdapters.praktoreiaTableAdapter
    '    ' exei idi alaksei i imeromergasias-> ean apykwd =O tote stelnontai mailme to poy alaksei imeromergasias s'autoys pou efugan
    '    'praktadapter.FillEmailPrakt(Me.DbhotelDataSet.praktoreia)

    '    'Dim dwmpraktadapter As New dbhotelDataSet1TableAdapters.vilapraktoreiaTableAdapter
    '    Me.Vilapraktoreia1TableAdapter.FillPraktByDwm(Me.DbhotelDataSet1.vilapraktoreia1, vila)

    '    from = Me.DbhotelDataSet.Mail(0).ffrom
    '    'ALLAGH 2022
    '    subject = "CANCELATION" 'Me.DbhotelDataSet.Mail(6).subject
    '    smtpServer = Me.DbhotelDataSet.Mail(0).smtpServer
    '    smtpUsername = Me.DbhotelDataSet.Mail(0).smtpUsername
    '    smtpPassword = Me.DbhotelDataSet.Mail(0).smtpPassword
    '    textMessage = Me.DbhotelDataSet.Mail(6).body.Replace("availability", "cancelation")
    '    body = textMessage.Split("$")
    '    'too = "mkallergis@gmail.com"

    '    For j = 0 To Me.DbhotelDataSet1.vilapraktoreia1.Count - 1

    '        Try
    '            i = Me.DbhotelDataSet1.vilapraktoreia1(j).email.IndexOf("@") ' einai sosto to mail->dld periexei @??
    '            If i <> -1 Then
    '                'gia  na min ksanasteilw sto IDIO mai (ean exoun kataxorithei >1 onmata se mia kratisi)

    '                'If Not IsDBNull(Me.DbhotelDataSet.praktoreia(j).Item("ipeuthinos")) Then
    '                '    Name = Me.DbhotelDataSet.praktoreia(j).ipeuthinos
    '                'Else
    '                '    Name = ""
    '                'End If
    '                Name = ""
    '                If vila.Equals("HRA") Then
    '                    vila = "MAVI"
    '                End If
    '                If Me.DbhotelDataSet1.vilapraktoreia1(j).praktoreio <> 17 Then
    '                    allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
    '                Else
    '                    Dim kwdikos As String = ""
    '                    Select Case vila
    '                        Case "AFR"
    '                            kwdikos = "HER02071"
    '                        Case "ALE"
    '                            kwdikos = "HER02069"
    '                        Case "ARCH"
    '                            kwdikos = "HER02065"
    '                        Case "EEAN"
    '                            kwdikos = "HER02072"
    '                        Case "MAIL"
    '                            kwdikos = "HER02072"
    '                        Case "PERS"
    '                            kwdikos = "HER02072"
    '                        Case "THOI"
    '                            kwdikos = "HER02072"
    '                    End Select
    '                    allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " " + kwdikos + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
    '                End If


    '                'MsgBox("Sending Email to " + Me.DbhotelDataSet1.vilapraktoreia1(j).email)

    '                SendMail(from, Me.DbhotelDataSet1.vilapraktoreia1(j).email, subject, allbody, smtpServer, smtpUsername, smtpPassword)

    '                mesage = mesage + ChrW(13) + Me.DbhotelDataSet1.vilapraktoreia1(j).email


    '            End If
    '        Catch ex As NullReferenceException

    '        End Try

    '    Next


    '    MsgBox(mesage)

    'End Sub
    Private Sub SendMailtoPraktoreiaCancel(ByVal parameter As String)
        Dim from, smtpServer, smtpUsername, smtpPassword, subject, allbody As String
        allbody = ""
        Dim mesage As String = "mails to agencies: "
        Dim textMessage As String
        Dim body() As String
        Dim param() As String
        Dim vila, perigrafi, apo, mexri As String
        param = parameter.Split("$")
        vila = param(0)
        perigrafi = param(1)
        apo = param(2)
        mexri = param(3)
        Dim recipients As New List(Of String)
        Dim j, i As Int16
        Name = ""
        Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
        mailadapter.Fill(Me.DbhotelDataSet.Mail)
        'Dim praktadapter As New dbhotelDataSetTableAdapters.praktoreiaTableAdapter
        ' exei idi alaksei i imeromergasias-> ean apykwd =O tote stelnontai mailme to poy alaksei imeromergasias s'autoys pou efugan
        'praktadapter.FillEmailPrakt(Me.DbhotelDataSet.praktoreia)

        'Dim dwmpraktadapter As New dbhotelDataSet1TableAdapters.vilapraktoreiaTableAdapter
        Me.Vilapraktoreia1TableAdapter.FillPraktByDwm(Me.DbhotelDataSet1.vilapraktoreia1, vila)

        from = Me.DbhotelDataSet.Mail(0).ffrom
        'ALLAGH 2022
        subject = "CANCELATION" 'Me.DbhotelDataSet.Mail(6).subject
        smtpServer = Me.DbhotelDataSet.Mail(0).smtpServer
        smtpUsername = Me.DbhotelDataSet.Mail(0).smtpUsername
        smtpPassword = Me.DbhotelDataSet.Mail(0).smtpPassword
        textMessage = Me.DbhotelDataSet.Mail(6).body.Replace("availability", "cancelation")
        body = textMessage.Split("$")
        'too = "mkallergis@gmail.com"

        For j = 0 To Me.DbhotelDataSet1.vilapraktoreia1.Count - 1

            Try
                i = Me.DbhotelDataSet1.vilapraktoreia1(j).email.IndexOf("@") ' einai sosto to mail->dld periexei @??
                If i <> -1 Then
                    'gia  na min ksanasteilw sto IDIO mai (ean exoun kataxorithei >1 onmata se mia kratisi)

                    'If Not IsDBNull(Me.DbhotelDataSet.praktoreia(j).Item("ipeuthinos")) Then
                    '    Name = Me.DbhotelDataSet.praktoreia(j).ipeuthinos
                    'Else
                    '    Name = ""
                    'End If
                    Name = ""
                    If vila.Equals("HRA") Then
                        vila = "MAVI"
                    End If
                    If Me.DbhotelDataSet1.vilapraktoreia1(j).praktoreio <> 17 Then
                        allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
                    Else
                        Dim kwdikos As String = ""
                        Select Case vila
                            Case "AFR"
                                kwdikos = "HER02071"
                            Case "ALE"
                                kwdikos = "HER02069"
                            Case "ARCH"
                                kwdikos = "HER02065"
                            Case "EEAN"
                                kwdikos = "HER02072"
                            Case "MAIL"
                                kwdikos = "HER02072"
                            Case "PERS"
                                kwdikos = "HER02072"
                            Case "THOI"
                                kwdikos = "HER02072"
                        End Select
                        allbody = body(0) + Name + "," + ChrW(13) + body(1) + "location: " + perigrafi + " " + kwdikos + " (" + vila + ")" + ChrW(13) + "arrival: " + apo + ChrW(13) + "departure: " + mexri + ChrW(13) + body(2)
                    End If


                    'MsgBox("Sending Email to " + Me.DbhotelDataSet1.vilapraktoreia1(j).email)

                    recipients.Add(Me.DbhotelDataSet1.vilapraktoreia1(j).email)

                    mesage = mesage + ChrW(13) + Me.DbhotelDataSet1.vilapraktoreia1(j).email


                End If
            Catch ex As NullReferenceException

            End Try

        Next
        If recipients.Count > 0 Then
            SendMailList(from, recipients, subject, allbody, smtpServer, smtpUsername, smtpPassword)
            MsgBox(mesage)
        End If



    End Sub
    Private Function get_perigrafi_vilas(ByVal vila As String) As String
        Dim j As Int16

        For j = 0 To Me.DbhotelDataSet.dwmatia.Count - 1
            If Me.DbhotelDataSet.dwmatia(j).arithmos.Equals(vila) Then
                Return Me.DbhotelDataSet.dwmatia(j).perigrafi
            End If
        Next
        Return ""
    End Function
    Sub SendMailwithDirections(ByVal vila As String, ByVal emailadress As String, ByVal name As String)
        Dim parameter As String
        parameter = vila + "$" + emailadress + "$" + name
        Dim theThread _
            As New Threading.Thread(AddressOf SendMailDirections)
        theThread.Start(parameter)
    End Sub
    Private Sub SendMailDirections(ByVal parameter As String)
        Dim from, body, smtpServer, smtpUsername, smtpPassword, subject As String
        Dim mailTemp, name, vila As String
        Dim j, i As Int16
        'Dim datum As Date

        Dim param() As String
        param = parameter.Split("$")
        vila = param(0)
        mailTemp = param(1)
        name = param(2)
        Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
        mailadapter.Fill(Me.DbhotelDataSet.Mail)


        'Me.AfixeisAnaxwriseis2TableAdapter.AfixeisByEtosImerom_(Me.DbhotelDataSet.AfixeisAnaxwriseis2, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, etos, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date, ImerKatastPicker.Value.Date)


        from = Me.DbhotelDataSet.Mail(0).ffrom
        subject = Me.DbhotelDataSet.Mail(2).subject
        smtpServer = Me.DbhotelDataSet.Mail(0).smtpServer
        smtpUsername = Me.DbhotelDataSet.Mail(0).smtpUsername
        smtpPassword = Me.DbhotelDataSet.Mail(0).smtpPassword
        'too = "mkallergis@gmail.com"
        body = "Dear Mrs./Mr. " + name + "," + ChrW(13) + ChrW(13) + Me.DbhotelDataSet.Mail(2).body
        SendMailMultiAttachKratisis(from, mailTemp, subject, body, vila, smtpServer, smtpUsername, smtpPassword)

    End Sub
    'Public Sub SendMailMultiAttach(ByVal from As String, ByVal [to] As String, ByVal subject As String, ByVal body As String, ByVal dwmatio As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String)
    '    Dim j As Int16
    '    Dim instance As Attachment
    '    Dim pathstart As String = ""
    '    Dim fileName As String = ""
    '    Dim directionsAdapter As New dbhotelDataSetTableAdapters.directionsTableAdapter
    '    directionsAdapter.FillDirectionsByVila(Me.DbhotelDataSet.directions, dwmatio)
    '    Try

    '        Dim message As New MailMessage(from, [to], subject, body)

    '        For j = 0 To Me.DbhotelDataSet.directions.Count - 1
    '            If Not IsDBNull(Me.DbhotelDataSet.directions(j).Item("path")) Then
    '                Try
    '                    pathstart = Environment.GetEnvironmentVariable("location")
    '                    If pathstart <> "" Then
    '                        fileName = Me.DbhotelDataSet.directions(j).path.Replace("N:", pathstart)
    '                        instance = New Attachment(fileName)
    '                    Else
    '                        instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
    '                    End If

    '                Catch ex1 As ArgumentNullException
    '                    instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
    '                End Try
    '                'Dim instance As New Attachment(Me.DbhotelDataSet.directions(j).path)
    '                message.Attachments.Add(instance)
    '            End If
    '        Next


    '        'Dim instance As New Attachment(fileName)

    '        Dim smtpClient As New SmtpClient(smtpServer, 25)

    '        smtpClient.UseDefaultCredentials = False

    '        Dim credentials As New NetworkCredential(smtpUsername, smtpPassword)

    '        smtpClient.Credentials = credentials
    '        smtpClient.EnableSsl = True
    '        smtpClient.Send(message)


    '    Catch ex1 As System.IO.FileNotFoundException
    '        MsgBox("Δεν βρέθηκε Attachment για Directions ", MsgBoxStyle.Exclamation)
    '    Catch ex3 As System.FormatException
    '        MsgBox("Η Διεύθυνση email για αποστολή Directions είναι λάθος καταχωρημένη ", MsgBoxStyle.Exclamation)
    '    Catch ex2 As System.IO.DirectoryNotFoundException
    '        MsgBox("Δεν βρέθηκε o φάκελος για αποστολή Directions ", MsgBoxStyle.Exclamation)

    '    Catch ex As Exception
    '        MsgBox("Αδυναμία αποστολής email ", MsgBoxStyle.Exclamation)
    '    End Try
    'End Sub

    Public Shared Sub SendMailList(ByVal from As String, ByVal recipients As List(Of String), ByVal subject As String, ByVal body As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String)

        Dim message As New MailMessage()

        message.From = New MailAddress(from)

        For Each recipient As String In recipients
            message.Bcc.Add(recipient)
        Next

        message.Subject = subject
        message.Body = body

        Dim smtpClient As New SmtpClient(smtpServer, 25)

        smtpClient.UseDefaultCredentials = False
        Dim credentials As New NetworkCredential(smtpUsername, smtpPassword)
        smtpClient.Credentials = credentials
        smtpClient.EnableSsl = True

        smtpClient.Send(message)
    End Sub


    Public Shared Sub SendMail(ByVal from As String, ByVal [to] As String, ByVal subject As String, ByVal body As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String)
        'Dim fileName As String = "C:\winfo\testAtach.xlsx"
        'Dim instance As New Attachment(fileName)
        'Dim message As New MailMessage(from, [to], subject, body)
        Dim message As New MailMessage(from, [to], subject, body)
        'message.Attachments.Add(instance)

        Dim smtpClient As New SmtpClient(smtpServer, 25) 'System.Net.Mail.SmtpException 'The operation has timed out.'

        'Dim smtpClient As New SmtpClient("mail.usilkcreations.gr", 25)
        ' Dim smtpClient As New SmtpClient("smtp.mail.yahoo.com", 25)

        smtpClient.UseDefaultCredentials = False
        Dim credentials As New NetworkCredential(smtpUsername, smtpPassword)

        'Dim credentials As New NetworkCredential("sales@usilkcreations.gr", "c2FsZXNA")
        'Dim credentials As New NetworkCredential("dlahnidakis@yahoo.gr", "vvjzcttsdqhuuwrl")
        smtpClient.Credentials = credentials
        smtpClient.EnableSsl = True

        smtpClient.Send(message)

    End Sub
    Public Function execute_insert_kratisi_afixi_transaction(ByVal arkrat As Int16, ByVal ekptosiOK As Boolean,
    ByVal countPaid As Int16, ByVal overOK As Boolean, ByVal checkin As Boolean) As Integer
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim kwdikos As Integer
            Dim counter As Byte = 0
            Dim j, countPaidia As Int16
            Dim paratiriseis As String = ""


            If overOK Then
                paratiriseis = "OV-BOOK "
            End If
            'If optionChk.Checked Then
            '    paratiriseis = paratiriseis + "Guarantee "
            'End If
            If ekptosiOK Then
                paratiriseis = paratiriseis + "τιμ.χωρ.Εκπτ."
            End If
            If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
                countPaidia += 1
            End If
            If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
                countPaidia += 1
            End If
            If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
                countPaidia += 1
            End If
            ' Set the Connection to the new OleDbConnection.
            'command.Connection = connection

            ' Open the connection and execute the transaction.
            Try


                connection.Open()

                ' Start a local transaction with ReadCommitted isolation level.
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                ' Execute the commands.
                command.Parameters.AddWithValue("@etos", CType(etos, Short))
                command.Parameters.AddWithValue("@arithmos", CType(arkrat, Short))
                command.Parameters.AddWithValue("@praktoreio", CType(praktoreiokwd, Integer))
                command.Parameters.AddWithValue("@praktimologio", CType(praktortimolkwd, Integer))
                command.Parameters.AddWithValue("@voucher", Me.VoucherTbx.Text)
                command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Short))
                command.Parameters.AddWithValue("@paidia", CType(countPaidia, Short))
                command.Parameters.AddWithValue("@afixi", DateTimePicker2.Value.Date)
                command.Parameters.Add("@wra", SqlDbType.Time).Value = DateTimePicker2.Value.TimeOfDay
                command.Parameters.AddWithValue("@anaxwrisi", DateTimePicker3.Value)
                command.Parameters.AddWithValue("@klines", CType(currentklines, Integer))
                command.Parameters.AddWithValue("@tipos", CType(currenttipos, Integer))
                command.Parameters.Add("@guarantie", SqlDbType.Bit).Value = optionChk.Checked

                If overOK Then
                    command.Parameters.AddWithValue("@dwmatio", "OV-BOOK")
                Else
                    command.Parameters.AddWithValue("@dwmatio", DwmTbx.Text)
                End If
                command.Parameters.AddWithValue("@pliromi", PliromiCbx.SelectedItem)
                command.Parameters.AddWithValue("@synolo", CType(SynolLbl.Text, Single)) 'CType(SynolLbl.Text, Single)
                command.Parameters.AddWithValue("@anzethnikotites", CType(EthnAnzTbx1.Text, Byte))
                command.Parameters.AddWithValue("@anzethnikotites2", CType(EthnAnzTbx2.Text, Byte))
                command.Parameters.AddWithValue("@ethnikotites2", CType(EthnKwd2.Text, Short))
                command.Parameters.AddWithValue("@epithimdate", DateTimePicker4.Value.Date)
                command.Parameters.AddWithValue("@epithimia", EpithimTbx.Text)
                command.Parameters.AddWithValue("@prokataboli", CType(ProkatTbx.Text, Single))
                command.Parameters.AddWithValue("@prokatdate", DateTimePicker5.Value.Date)
                command.Parameters.AddWithValue("@simetoxi", CType(SimetTbx.Text, Short))
                command.Parameters.AddWithValue("@tilefonomem", TilefTbx.Text)
                command.Parameters.Add("@imeromkratisis", SqlDbType.DateTime2).Value = DateTime.Now.Date 'imeromErgasias
                command.Parameters.AddWithValue("@simbolaio", CType(currentsimbolaio, Integer))
                command.Parameters.AddWithValue("@ethnikotites", CType(EthnKwd1.Text, Short))
                command.Parameters.Add("@allagesdwmatiwn", SqlDbType.Bit).Value = heatChk.Checked
                command.Parameters.Add("@checkin", SqlDbType.Bit).Value = checkin
                command.Parameters.AddWithValue("@datein", DateTimePicker2.Value.Date)
                command.Parameters.Add("@ekptosi", SqlDbType.Bit).Value = ekptosiOK
                command.Parameters.AddWithValue("@ekptposo", CType(ekptPoso, Single))
                command.Parameters.AddWithValue("@ekptpososto", CType(ekptPososto, Single))
                command.Parameters.AddWithValue("@ekptimeres", CType(ekptFree, Single))
                command.Parameters.AddWithValue("@fee", CType(ekptCFee, Single))
                command.Parameters.AddWithValue("@identifikation", CType(sesionID, Integer))

                ' command.CommandText = "INSERT INTO kratiseis (etos, arithmos, praktoreio, praktimologio, voucher, enilikes, paidia, afixi, wra, anaxwrisi, klines, tipos, guarantie, dwmatio, pliromi, synolo, anzethnikotites, anzethnikotites2, ethnikotites2, epithimdate, epithimia, prokataboli, prokatdate, simetoxi, tilefonomem, imeromkratisis, simbolaio, ethnikotites, allagesdwmatiwn, checkin, checkout, datein, dateout, ekptosi, ekptposo, ekptpososto, ekptimeres, fee, timologio, identifikation) VALUES (@etos, @arithmos, @praktoreio, @praktimologio, @voucher, @enilikes, @paidia, @afixi, @wra, @anaxwrisi, @klines, @tipos, @guarantie, @dwmatio, @pliromi, @synolo, @anzethnikotites, @anzethnikotites2, @ethnikotites2, @epithimdate, @epithimia, @prokataboli, @prokatdate, @simetoxi, @tilefonomem, @imeromkratisis, @simbolaio, @ethnikotites, @allagesdwmatiwn, @checkin, 0, @datein, '1/1/1900', @ekptosi, @ekptposo, @ekptpososto, @ekptimeres, @fee, 0, @identifikation)"
                command.CommandText = "INSERT INTO kratiseis (etos, arithmos, praktoreio, praktimologio, voucher, enilikes, paidia, afixi, wra, anaxwrisi, klines, tipos, guarantie, dwmatio, pliromi, synolo, anzethnikotites, anzethnikotites2, ethnikotites2, epithimdate, epithimia, prokataboli, prokatdate, simetoxi, tilefonomem, imeromkratisis, simbolaio, ethnikotites, allagesdwmatiwn, checkin, checkout, datein, dateout, ekptosi, ekptposo, ekptpososto, ekptimeres, fee, timologio, identifikation) " &
                    "OUTPUT INSERTED.kwd " &
                    "VALUES (@etos, @arithmos, @praktoreio, @praktimologio, @voucher, @enilikes, @paidia, @afixi, @wra, @anaxwrisi, @klines, @tipos, @guarantie, @dwmatio, @pliromi, @synolo, @anzethnikotites, @anzethnikotites2, @ethnikotites2, @epithimdate, @epithimia, @prokataboli, @prokatdate, @simetoxi, @tilefonomem, @imeromkratisis, @simbolaio, @ethnikotites, @allagesdwmatiwn, @checkin, 0, @datein, '1/1/1900', @ekptosi, @ekptposo, @ekptpososto, @ekptimeres, @fee, 0, @identifikation)"
                Try
                    'command.ExecuteNonQuery()
                    kwdikos = CInt(command.ExecuteScalar())
                    '{System.Data.SqlClient.SqlError: The INSERT statement conflicted With the FOREIGN KEY constraint "kratiseis${0491B51F-8C3D-4318-B7CE-5DBDD9C03BB0}". The conflict occurred In database "dbhotel", table "dbo.ethnikotites", column 'kwd'.}
                    command.Parameters.Clear()
                Catch ex As SqlException
                    For Each errorItem As SqlError In ex.Errors
                        Console.WriteLine("Error Message: " & errorItem.Message)
                        Console.WriteLine("Error Number: " & errorItem.Number)
                        Console.WriteLine("Error Line Number: " & errorItem.LineNumber)
                        Console.WriteLine("Error Procedure: " & errorItem.Procedure)
                    Next
                    For Each param As SqlParameter In command.Parameters
                        Console.WriteLine("Parameter Name: " & param.ParameterName)
                        Console.WriteLine("Parameter Value: " & param.Value.ToString())
                    Next
                End Try



                'command.Parameters.AddWithValue("@etos", CType(etos, Integer))
                'command.Parameters.AddWithValue("@arithmos", CType(arkrat, Int16))
                'command.CommandText = "SELECT kwd FROM kratiseis where (etos=@etos) and (arithmos=@arithmos)"
                'Dim myReader As SqlDataReader
                'myReader = command.ExecuteReader()
                '' Always call Read before accessing data.
                'While myReader.Read()
                '    kwdikos = myReader.GetInt32(0)
                '    counter += 1
                'End While


                '' always call Close when done reading.
                'myReader.Close()
                'command.Parameters.Clear()

                'If counter <> 1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
                '    transaction.Rollback()
                '    Return -1
                'End If



                command.Parameters.AddWithValue("@aakratisis", CType(arkrat, Int16))
                command.CommandText = "UPDATE etaireia SET  aakratisis=@aakratisis"
                command.ExecuteNonQuery()
                command.Parameters.Clear()


                For j = 0 To timokatalog.Length - 1
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                    command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosi, Single))
                    command.Parameters.AddWithValue("@apo", CType(timokatalog(j).apo, Date))
                    command.Parameters.AddWithValue("@mexri", CType(timokatalog(j).mexri, Date))
                    command.Parameters.AddWithValue("@imeres", CType(timokatalog(j).imeresPlirom, Byte))
                    command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                    command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                    command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geuma, Single))
                    command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipno, Single))
                    command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxi, Single))
                    command.Parameters.AddWithValue("@synolo", CType(timokatalog(j).synolo, Single))
                    command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))

                    If timokatalog(j).xrewsi = 0 Then
                        If timokatalog(j).prwino > 0 Then
                            command.Parameters.AddWithValue("@xrewsi", 2)
                        Else
                            command.Parameters.AddWithValue("@xrewsi", 1)
                        End If
                    Else
                        command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer)) '
                    End If

                    command.CommandText = "INSERT INTO timeskratisis (kratisi, timi, ekptosi, apo, mexri, imeres, ypnos, prwino, geuma, deipno, extra, synolo, touristperiod, xrewsi) " &
                    "VALUES (@kratisi, @timi, @ekptosi, @apo, @mexri, @imeres, @ypnos, @prwino, @geuma, @deipno, @extra, @synolo, @touristperiod, @xrewsi)"

                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                Next

                If checkin Then

                    command.Parameters.AddWithValue("@etos", CType(etos, Integer))
                    command.Parameters.AddWithValue("@imerominia", CType(DateTimePicker2.Value.Date, Date))
                    command.Parameters.AddWithValue("@status", CType(1, Byte))
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                    command.Parameters.AddWithValue("@dwmatio", CType(DwmTbx.Text, String))
                    command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                    command.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                    command.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))
                    command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(0).xrewsi, Integer))
                    If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                    Else
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                    End If

                    command.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                    command.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                    command.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                    command.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                    command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))

                    command.Parameters.AddWithValue("@ypnos", CType(timokatalog(0).ypnos, Single))
                    command.Parameters.AddWithValue("@prwino", CType(timokatalog(0).prwino, Single))
                    command.Parameters.AddWithValue("@geumata", CType(timokatalog(0).geuma + timokatalog(0).deipno, Single))
                    command.Parameters.AddWithValue("@extras", CType(timokatalog(0).paroxi, Single))
                    command.Parameters.AddWithValue("@synolo", CType((timokatalog(0).ypnos + timokatalog(0).prwino + timokatalog(0).deipno + timokatalog(0).geuma + timokatalog(0).paroxi), Single))
                    command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))
                    command.Parameters.AddWithValue("@paratiriseis", CType(paratiriseis, String))

                    command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
                    "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma," &
                    "@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                End If

                transaction.Commit()
                Return kwdikos
            Catch ex As Exception
                MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using

    End Function
    'edw IDI idi katixwrimeni krathshs
    'return 1->alles OK 0->H Kratisi exei diagrafei apo allon User -1->kati then pige kalla me Connection zu DB
    Public Function execute_update_kratisi_afixi_transaction(ByVal connectionString As String, ByVal kwdikos As Integer, ByVal overOK As Boolean, ByVal ekptosiOK As Boolean, ByVal checkIn As Boolean) As Int16
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim rows, j, countPaidia As Int16
            Dim countTimesKrat As Int16
            Dim paratiriseis As String = ""
            'Dim ypnosEkpt, prwinoEkpt, geumataEkpt, extasEkpt, synEkpt As Single
            If overOK Then
                paratiriseis = "OV-BOOK "
            End If
            'If optionChk.Checked Then
            '    paratiriseis = paratiriseis + "Guarantee "
            'End If
            If ekptosiOK Then
                paratiriseis = paratiriseis + "τιμ.χωρ.Εκπτ."
            End If
            If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
                countPaidia += 1
            End If
            If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
                countPaidia += 1
            End If
            If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
                countPaidia += 1
            End If
            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.AddWithValue("@praktoreio", CType(praktoreiokwd, Integer))
                command.Parameters.AddWithValue("@praktimologio", CType(praktortimolkwd, Integer))
                command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                command.Parameters.AddWithValue("@paidia", CType(countPaidia, Int16))
                command.Parameters.AddWithValue("@afixi", CType(DateTimePicker2.Value.Date, Date))
                command.Parameters.AddWithValue("@wra", CType(DateTimePicker2.Value.TimeOfDay, TimeSpan))
                command.Parameters.AddWithValue("@anaxwrisi", CType(DateTimePicker3.Value, Date))
                command.Parameters.AddWithValue("@klines", CType(currentklines, Integer))
                command.Parameters.AddWithValue("@tipos", CType(currenttipos, Integer))
                command.Parameters.AddWithValue("@guarantie", CType(optionChk.Checked, Boolean))
                command.Parameters.AddWithValue("@allagesdwmatiwn", CType(heatChk.Checked, Boolean))
                If overOK Then
                    command.Parameters.AddWithValue("@dwmatio", "OV-BOOK")
                Else
                    command.Parameters.AddWithValue("@dwmatio", CType(DwmTbx.Text, String))
                End If
                command.Parameters.AddWithValue("@pliromi", CType(PliromiCbx.SelectedItem, String))
                command.Parameters.AddWithValue("@synolo", CType(SynolLbl.Text, Single))
                command.Parameters.AddWithValue("@ethnikotites", CType(EthnKwd1.Text, Int16))
                command.Parameters.AddWithValue("@anzethnikotites", CType(EthnAnzTbx1.Text, Byte))
                command.Parameters.AddWithValue("@anzethnikotites2", CType(EthnAnzTbx2.Text, Byte))
                command.Parameters.AddWithValue("@ethnikotites2", CType(EthnKwd2.Text, Int16))
                command.Parameters.AddWithValue("@epithimdate", CType(DateTimePicker4.Value.Date, Date))
                command.Parameters.AddWithValue("@epithimia", CType(EpithimTbx.Text, String))
                command.Parameters.AddWithValue("@prokataboli", CType(ProkatTbx.Text, Single))
                command.Parameters.AddWithValue("@prokatdate", CType(DateTimePicker5.Value.Date, Date))
                command.Parameters.AddWithValue("@simetoxi", CType(SimetTbx.Text, Int16))
                command.Parameters.AddWithValue("@tilefonomem", CType(TilefTbx.Text, String))
                command.Parameters.AddWithValue("@simbolaio", CType(currentsimbolaio, Integer))
                command.Parameters.AddWithValue("@ekptosi", CType(ekptosiOK, Boolean))
                command.Parameters.AddWithValue("@ekptposo", CType(ekptPoso, Single))
                command.Parameters.AddWithValue("@ekptpososto", CType(ekptPososto, Single))
                command.Parameters.AddWithValue("@ekptimeres", CType(ekptFree, Single))
                command.Parameters.AddWithValue("@fee", CType(ekptCFee, Single))
                command.Parameters.AddWithValue("@checkin", CType(checkIn, Boolean))
                command.Parameters.AddWithValue("@kwd", CType(kwdikos, Integer))

                command.CommandText = "UPDATE kratiseis SET praktoreio=@praktoreio, praktimologio=@praktimologio, voucher=@voucher, enilikes=@enilikes, paidia=@paidia, afixi=@afixi, wra=@wra, anaxwrisi=@anaxwrisi, klines=@klines, tipos=@tipos, guarantie=@guarantie, allagesdwmatiwn=@allagesdwmatiwn, dwmatio=@dwmatio, pliromi=@pliromi, synolo=@synolo, ethnikotites=@ethnikotites, anzethnikotites=@anzethnikotites, anzethnikotites2=@anzethnikotites2, ethnikotites2=@ethnikotites2, epithimdate=@epithimdate, epithimia=@epithimia, prokataboli=@prokataboli, prokatdate=@prokatdate, simetoxi=@simetoxi, tilefonomem=@tilefonomem, simbolaio=@simbolaio, ekptosi=@ekptosi, ekptposo=@ekptposo, ekptpososto=@ekptpososto, ekptimeres=@ekptimeres, fee=@fee, checkin=@checkin, timologio=0 WHERE kwd=@kwd AND checkin=0"

                rows = command.ExecuteNonQuery()

                command.Parameters.Clear()

                If rows = 0 Then ' H Kratisi exei pithanws diagrafei apo allon User!!!!!!!!!!!!!!
                    transaction.Rollback()
                    Return rows
                End If


                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "SELECT * FROM timeskratisis where (kratisi=@kratisi)"

                Dim myReader As SqlDataReader
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                While myReader.Read()
                    countTimesKrat += 1
                End While
                myReader.Close()
                command.Parameters.Clear()

                If countTimesKrat = timokatalog.Length AndAlso timokatalog(0).kwdDB <> -1 Then
                    For j = 0 To timokatalog.Length - 1
                        command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                        command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosi, Single))
                        command.Parameters.AddWithValue("@apo", CType(timokatalog(j).apo, Date))
                        command.Parameters.AddWithValue("@mexri", CType(timokatalog(j).mexri, Date))
                        command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                        command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                        command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geuma, Single))
                        command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipno, Single))
                        command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxi, Single))
                        command.Parameters.AddWithValue("@synolo", CType(timokatalog(j).synolo, Single))
                        command.Parameters.AddWithValue("@imeres", CType(timokatalog(j).imeresPlirom, Byte))
                        command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                        command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))
                        command.Parameters.AddWithValue("@kwd", CType(timokatalog(j).kwdDB, Integer))

                        command.CommandText = "UPDATE timeskratisis SET timi=@timi, ekptosi=@ekptosi, apo=@apo, mexri=@mexri, ypnos=@ypnos, prwino=@prwino, geuma=@geuma, deipno=@deipno, extra=@extra, synolo=@synolo, imeres=@imeres, touristperiod=@touristperiod, xrewsi=@xrewsi WHERE kwd=@kwd"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()

                    Next
                Else
                    command.Parameters.AddWithValue("kwd", CType(kwdikos, Integer))
                    command.CommandText = "DELETE FROM timeskratisis where (kratisi=@kwd)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()
                    For j = 0 To timokatalog.Length - 1
                        command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                        command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                        command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosi, Single))
                        command.Parameters.AddWithValue("@apo", CType(timokatalog(j).apo, Date))
                        command.Parameters.AddWithValue("@mexri", CType(timokatalog(j).mexri, Date))
                        command.Parameters.AddWithValue("@imeres", CType(timokatalog(j).imeresPlirom, Byte))
                        command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                        command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                        command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geuma, Single))
                        command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipno, Single))
                        command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxi, Single))
                        command.Parameters.AddWithValue("@synolo", CType(timokatalog(j).synolo, Single))
                        command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                        command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))

                        command.CommandText = "INSERT INTO timeskratisis (kratisi, timi, ekptosi, apo, mexri, imeres, ypnos, prwino, geuma, deipno, extra, synolo, touristperiod, xrewsi) " &
                                              "VALUES (@kratisi, @timi, @ekptosi, @apo, @mexri, @imeres, @ypnos, @prwino, @geuma, @deipno, @extra, @synolo, @touristperiod, @xrewsi)"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()


                    Next
                End If
                If checkIn Then
                    command.Parameters.AddWithValue("@etos", CType(etos, Short))
                    command.Parameters.AddWithValue("@imerominia", CType(DateTimePicker2.Value.Date, Date))
                    command.Parameters.AddWithValue("@status", CType(1, Byte))
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                    command.Parameters.AddWithValue("@dwmatio", CType(DwmTbx.Text, String))
                    command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Short))
                    command.Parameters.AddWithValue("@anilika", CType(countPaidia, Short))
                    command.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaidia, Short))
                    command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(0).xrewsi, Integer))

                    If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                    Else
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                    End If

                    command.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                    command.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Short))
                    command.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                    command.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Short))
                    command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))
                    command.Parameters.AddWithValue("@ypnos", CType(timokatalog(0).ypnos, Single))
                    command.Parameters.AddWithValue("@prwino", CType(timokatalog(0).prwino, Single))
                    command.Parameters.AddWithValue("@geumata", CType(timokatalog(0).geuma + timokatalog(0).deipno, Single))
                    command.Parameters.AddWithValue("@extras", CType(timokatalog(0).paroxi, Single))
                    command.Parameters.AddWithValue("@synolo", CType((timokatalog(0).ypnos + timokatalog(0).prwino + timokatalog(0).deipno + timokatalog(0).geuma + timokatalog(0).paroxi), Single))
                    command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))
                    command.Parameters.AddWithValue("@paratiriseis", CType(paratiriseis, String))

                    command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2, " &
                      "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) " &
                      "VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma, " &
                      "@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, " &
                      "@praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                    command.ExecuteNonQuery()
                    command.Parameters.Clear()


                End If

                transaction.Commit()
                Return rows
            Catch ex As Exception
                MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using
    End Function
    'kLICK STO BUTTON APOTHIKEUSI STOYS DIAMENWNTES!
    Private Sub diamenwta_speichern(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim j, updRows As Int16
        Dim flag As Int16
        Try
            Me.Cursor = Cursors.WaitCursor

            flag = update_stoixeia_diamenwnta(sender, e)
            If flag = 1 Or flag = 2 Then ' ola OK me allages stin Kratisi 
                'ALAXE H ANAXWRISI!!!!!!!!!!!!!!!!!!->alakse kai tis  Imerominies sto Status H STO over TABLE!!!!!!!!!!!!!!!!!!!
                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> DateTimePicker3.Value.Date Then
                    '  If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                        'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                        '    If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                        '        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        '    End If
                        'End If
                        If praktoreiokwd = 62 And currenttipos = 10 Then
                            If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                    If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    End If
                                End If
                            End If
                        End If
                    End If
                    'End If
                    If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date < DateTimePicker3.Value.Date Then ' Diamoni epimikynetai!!!!!!!!!!!
                        Me.StatusTableAdapter.FillByKratisiLixi(Me.DbhotelDataSet.status, kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1))
                        If Me.DbhotelDataSet.status.Count <> 0 And flag <> 2 Then '(ean exei ginei KAI allagi dwmatiuou tote flag=2->EXEI TAKTOPOIITHEI (STO ALLAGES_DWMATIOUOK) PROSPERNA!!!!!!!!!
                            Me.StatusTableAdapter.UpdateLixiByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DbhotelDataSet.status(0).kwd)
                        End If
                    ElseIf Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date > DateTimePicker3.Value.Date Then ' Diamoni mikraainei
                        Me.StatusTableAdapter.FillByKratisStatus(Me.DbhotelDataSet.status, kwdikoKratisisDB, 5)
                        For j = 0 To Me.DbhotelDataSet.status.Count - 1
                            If Me.DbhotelDataSet.status(j).enarxi <= DateTimePicker3.Value.AddDays(-1) And Me.DbhotelDataSet.status(j).lixi >= DateTimePicker3.Value.AddDays(-1) Then
                                Me.StatusTableAdapter.UpdateLixiByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DbhotelDataSet.status(j).kwd)
                                Me.KratiseisTableAdapter.UpdateArDwmatiouByKwd(Me.DbhotelDataSet.status(j).dwmatio, Me.DbhotelDataSet.status(j).kratisi)
                            ElseIf Me.DbhotelDataSet.status(j).enarxi > DateTimePicker3.Value.AddDays(-1) And Me.DbhotelDataSet.status(j).lixi > DateTimePicker3.Value.AddDays(-1) Then
                                Me.StatusTableAdapter.DeleteByKwd(Me.DbhotelDataSet.status(j).kwd)
                            End If
                        Next
                    End If

                    Me.OverTableAdapter.FillOverByKratisi(Me.DbhotelDataSet.over, kwdikoKratisisDB)
                    If Me.DbhotelDataSet.over.Count <> 0 Then
                        For j = 0 To Me.DbhotelDataSet.over.Count - 1
                            If Me.DbhotelDataSet.over(j).epistrofiOK = False Then
                                If Me.DbhotelDataSet.over(j).apo < Me.DateTimePicker3.Value Or imeromErgasias = Me.DateTimePicker3.Value Then 'anaxwrisi einai ADYNATON  na einai PRIN thn HmeromErgasias->Hoechstens tin idia mera me Over Anaxwrisis=>KLEISIMO OVER
                                    'Me.kleisimo_over(Me.DateTimePicker3.Value.Date.AddDays(-1))
                                    Me.OverTableAdapter.UpdateOverByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DateTimePicker3.Value.Date.AddDays(-1), False, Me.DbhotelDataSet.over(j).kwd)
                                Else
                                    'If Me.DbhotelDataSet.over(j).apo < Me.DateTimePicker3.Value Then
                                    '    Me.OverTableAdapter.UpdateOverByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DateTimePicker3.Value.Date.AddDays(-1), False, Me.DbhotelDataSet.over(j).kwd)
                                    'Else
                                    Me.OverTableAdapter.DeleteOverByKwd(Me.DbhotelDataSet.over(j).kwd)
                                    Me.OverunterkuenfteTableAdapter.DeleteUnterkByOver(Me.DbhotelDataSet.over(j).kwd)
                                    'End If

                                End If
                            Else
                                If Me.DbhotelDataSet.over(j).apo <= Me.DateTimePicker3.Value.AddDays(-1) AndAlso Me.DbhotelDataSet.over(j).mexri >= Me.DateTimePicker3.Value.AddDays(-1) Then
                                    updRows = Me.OverTableAdapter.UpdateOverByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DateTimePicker3.Value.Date.AddDays(-1), False, Me.DbhotelDataSet.over(j).kwd)
                                    If updRows = 1 Then
                                        Me.KratiseisTableAdapter.UpdateArDwmatiouByKwd("OV-BOOK", kwdikoKratisisDB)
                                    End If
                                Else
                                    If Me.DbhotelDataSet.over(j).apo >= Me.DateTimePicker3.Value Then
                                        Me.OverTableAdapter.DeleteOverByKwd(Me.DbhotelDataSet.over(j).kwd)
                                        Me.OverunterkuenfteTableAdapter.DeleteUnterkByOver(Me.DbhotelDataSet.over(j).kwd)
                                    ElseIf Me.DbhotelDataSet.over(j).mexri = Me.DbhotelDataSet.kratiseis(0).anaxwrisi.AddDays(-1) AndAlso Me.DbhotelDataSet.over(j).mexri < Me.DateTimePicker3.Value.AddDays(-1) Then
                                        'Me.OverTableAdapter.UpdateOverByKwd(Me.DateTimePicker3.Value.Date.AddDays(-1), Me.DateTimePicker3.Value.Date.AddDays(-1), False, Me.DbhotelDataSet.over(j).kwd)
                                    End If
                                End If

                            End If



                        Next
                    End If
                    Dim teloskratisis As New teloskratisis(connectionString, kwdikoKratisisDB, DwmTbx.Text, praktortimolkwd, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), CType(SynolLbl.Text, Single), ekptPoso, 2)
                End If

                update_paidia()
                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                init_ekptoseis()
                ReDim timokatalog(-1)
                kratiseis_zeig(False)

            End If

        Catch ex As System.Exception
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try
        Me.Cursor = Cursors.Default



    End Sub
    Private Function update_stoixeia_diamenwnta(ByVal sender As System.Object, ByVal e As System.EventArgs) As Int16
        Dim flag As Int16
        Dim ekptosiOK As Boolean = False
        Dim overOK As Boolean = False

        If Not ist_xrewsi_ok() Then
            MsgBox("Δεν έχει επιλεγεί τύπος χρέωσης !", MsgBoxStyle.Critical, "winfo\nikEl.")
            'Me.Cursor = Cursors.Default
            sender.enabled = True
            Return -1
        End If
        If CType(EnilikTbx.Text, Int16) <= 0 Then
            MsgBox(" Δώστε Αριθμό Ενηλίκων !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.enabled = True
            'Me.Cursor = Cursors.Default
            EnilikTbx.Focus()
            Return -1
        End If
        If Not sind_ethnikotites_ok(sender, e) Then
            Return -1
        End If

        If ekptPoso <> 0 OrElse ekptPososto <> 0 OrElse ekptFree <> 0 OrElse ekptCFee <> 0 Then
            ekptosiOK = True
        Else
            ekptosiOK = False
        End If
        ersetze_temp_vor_speichern()

        'Try
        If DwmTbx.Text.Equals("OV-BOOK") Then
            overOK = True
        End If
        flag = execute_update_diamenwnta_transaction(connectionString, kwdikoKratisisDB, ekptosiOK, overOK)
        praktoreiokwdValue = -1
        If currenttipos > 0 And currenttipos < 13 Then
            Try
                If Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals(DwmTbx.Text) Then
                    Dim calender As New GoogleCalendarNew(connectionString, Me.DbhotelDataSet.kratiseis(0).kwd, Me.DbhotelDataSet.kratiseis(0).arithmos, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), DwmTbx.Text, DwmTbx.Text, "", "")
                    calender.update_entry()
                    If currenttipos = 10 Then
                        calender.set_calendarid_thalasses(1)
                        calender.update_entry()
                    End If
                End If




            Catch ex As Exception
                MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Google Calendar !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End Try
            'TEST SQL SERVER 
            'Try

            '    Dim calender As New GoogleCalendar("", "", Me.DbhotelDataSet.kratiseis(0).afixi, Me.DbhotelDataSet.kratiseis(0).anaxwrisi, Me.DbhotelDataSet.kratiseis(0).dwmatio, Me.DbhotelDataSet.kratiseis(0).dwmatio, "", "")
            '    calender.delete_entry()
            '    calender.set_values(Me.DbhotelDataSet.kratiseis(0).arithmos, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), DwmTbx.Text, DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
            '    calender.send_entry()
            '    If currenttipos = 10 Then
            '        calender = New GoogleCalendar("", "", Me.DbhotelDataSet.kratiseis(0).afixi, Me.DbhotelDataSet.kratiseis(0).anaxwrisi, "thls", Me.DbhotelDataSet.kratiseis(0).dwmatio, "", "")
            '        calender.delete_entry()
            '        calender.set_values(Me.DbhotelDataSet.kratiseis(0).arithmos, OnomTbx1.Text, CType(DateTimePicker2.Value.Date, Date), CType(DateTimePicker3.Value.Date, Date), "thls", DwmTbx.Text, EpithimTbx.Text, PraktTbx.Text)
            '        calender.send_entry()
            '    End If
            'Catch ex As Exception
            '    MsgBox(" παρουσιάστηκε σφάλμα κατά την ενημέρωση του google calendar !", MsgBoxStyle.Exclamation, "winfo\nikel.")
            'End Try
        End If


        Return flag
    End Function

    'H Function Kanei return -1 fehler, 0 den uparxei pleon i Kratisi(delete apo allon User), 1 alles gut me allages (xwris allagi DWmatiou),2 alles gut me alages (KAI allagi dwmatiou!!)
    ' ;h update biblio portas pou PREPEI na einai kai sti 2 periptwseis 1
    'diaforetika ean rows=0 tote tha ginei rollback (opws kai se opoiadipote alli periptwsi (exception)
    Public Function execute_update_diamenwnta_transaction(ByVal connectionString As String, ByVal kwdikos As Integer, ByVal ekptosiOK As Boolean, ByVal overOK As Boolean) As Int16
        Using connection As New SqlConnection(connectionString)

            Dim command, command2, command3 As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim rows, j As Int16
            Dim apoIn, mexriIn, apoUpd, mexriUpd, maxdatumBP As Date
            Dim imeresPlirIn, imeresPlirUpd As Int16
            Dim synoloIn, synoloUpd As Single
            Dim countTimesKrat, countPaid As Int16
            Dim paratiriseis As String = ""
            Dim insertOK, insert1OK, updateOK, dwmatChangeOK, anaxChangeOK, praktChangeOK, prodatumOK As Boolean
            Dim arDwmat As String
            Dim letztesDate As Date = "1/1/1900" 'tou bibliou portas gia thn kratisi
            Dim kwdikosPrakt As Integer
            Dim tempXrewsi As Int32
            Dim tempYpnos, tempPrwino, tempGeumata, tempExtras As Single

            'edw eisagw boolische variablen gia allagi Dwmatiou-Anaxwrisis-Praktoreiou (timologio)
            'gia enimerwsi tou bibliou portas sto telos (ean den exei idi ginei protitera logw alagis timwn))
            dwmatChangeOK = False
            anaxChangeOK = False
            praktChangeOK = False
            prodatumOK = False ' signalisiert ob diadikasia meta apo akyrosi kleisimatos->imerominia ergasias einai progenesteri!!!!!

            If status = 2 And praktoreiokwdValue <> -1 Then
                kwdikosPrakt = praktoreiokwdValue
                'praktoreiokwdValue = -1
            Else
                kwdikosPrakt = praktoreiokwd
                'kwdikosSimb = currentsimbolaio
            End If
            If Not PaidiTbx1.Text.Equals("0") And Not PaidiTbx2.Text.Equals("") Then
                countPaid += 1
            End If
            If Not PaidiTbx2.Text.Equals("0") And Not PaidiTbx1.Text.Equals("") Then
                countPaid += 1
            End If
            If Not PaidiTbx3.Text.Equals("0") And Not PaidiTbx3.Text.Equals("") Then
                countPaid += 1
            End If

            Try
                connection.Open()

                'Prwta kane Update tin Kratisi (stoixeia)
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction
                command2.Connection = connection
                command2.Transaction = transaction
                command3.Connection = connection
                command3.Transaction = transaction

                command.Parameters.AddWithValue("@praktoreio", CInt(kwdikosPrakt))
                If Me.DbhotelDataSet.kratiseis(0).praktimologio <> praktortimolkwd Then
                    praktChangeOK = True
                End If
                command.Parameters.AddWithValue("@praktimologio", CInt(praktortimolkwd))
                command.Parameters.AddWithValue("@voucher", Me.VoucherTbx.Text)
                command.Parameters.AddWithValue("@enilikes", CShort(EnilikTbx.Text))
                command.Parameters.AddWithValue("@paidia", countPaid)
                command.Parameters.AddWithValue("@afixi", DateTimePicker2.Value.Date)
                command.Parameters.AddWithValue("@wra", DateTimePicker2.Value.TimeOfDay.ToString)
                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                    anaxChangeOK = True
                End If
                command.Parameters.AddWithValue("@anaxwrisi", DateTimePicker3.Value)
                command.Parameters.AddWithValue("@klines", CInt(currentklines))
                command.Parameters.AddWithValue("@tipos", CInt(currenttipos))
                command.Parameters.AddWithValue("@guarantie", If(optionChk.Checked, 1, 0))
                command.Parameters.AddWithValue("@allagesdwmatiwn", If(heatChk.Checked, 1, 0))
                If DwmTbx.Text <> Me.DbhotelDataSet.kratiseis(0).dwmatio AndAlso imeromErgasias < DateTimePicker3.Value.Date Then
                    dwmatChangeOK = True
                End If
                command.Parameters.AddWithValue("@dwmatio", DwmTbx.Text)
                If overOK AndAlso Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") AndAlso imeromErgasias < DateTimePicker3.Value.Date Then
                    DwmTbx.Text = ""
                    dwmatChangeOK = True
                End If
                command.Parameters.AddWithValue("@pliromi", PliromiCbx.SelectedItem.ToString())
                command.Parameters.AddWithValue("@synolo", CSng(SynolLbl.Text))
                command.Parameters.AddWithValue("@ethnikotites", CShort(EthnKwd1.Text))
                command.Parameters.AddWithValue("@anzethnikotites", CByte(EthnAnzTbx1.Text))
                command.Parameters.AddWithValue("@anzethnikotites2", CByte(EthnAnzTbx2.Text))
                command.Parameters.AddWithValue("@ethnikotites2", CShort(EthnKwd2.Text))
                command.Parameters.AddWithValue("@epithimdate", DateTimePicker4.Value.Date)
                command.Parameters.AddWithValue("@epithimia", EpithimTbx.Text)
                command.Parameters.AddWithValue("@prokataboli", CSng(ProkatTbx.Text))
                command.Parameters.AddWithValue("@prokatdate", DateTimePicker5.Value.Date)
                command.Parameters.AddWithValue("@simetoxi", CShort(SimetTbx.Text))
                command.Parameters.AddWithValue("@tilefonomem", TilefTbx.Text)
                command.Parameters.AddWithValue("@simbolaio", CInt(currentsimbolaio))
                command.Parameters.AddWithValue("@ekptosi", If(ekptosiOK, 1, 0))
                command.Parameters.AddWithValue("@ekptposo", CSng(ekptPoso))
                command.Parameters.AddWithValue("@ekptpososto", CSng(ekptPososto))
                command.Parameters.AddWithValue("@ekptimeres", CSng(ekptFree))
                command.Parameters.AddWithValue("@fee", CSng(ekptCFee))
                command.Parameters.AddWithValue("@kwd", CInt(kwdikos))

                command.CommandText = "UPDATE kratiseis SET praktoreio=@praktoreio, praktimologio=@praktimologio, voucher=@voucher, enilikes=@enilikes, paidia=@paidia, afixi=@afixi, wra=@wra, anaxwrisi=@anaxwrisi, klines=@klines, tipos=@tipos, guarantie=@guarantie, allagesdwmatiwn=@allagesdwmatiwn, dwmatio=@dwmatio, pliromi=@pliromi, synolo=@synolo, ethnikotites=@ethnikotites, anzethnikotites=@anzethnikotites, anzethnikotites2=@anzethnikotites2, ethnikotites2=@ethnikotites2, epithimdate=@epithimdate, epithimia=@epithimia, prokataboli=@prokataboli, prokatdate=@prokatdate, simetoxi=@simetoxi, tilefonomem=@tilefonomem, simbolaio=@simbolaio, ekptosi=@ekptosi, ekptposo=@ekptposo, ekptpososto=@ekptpososto, ekptimeres=@ekptimeres, fee=@fee WHERE kwd=@kwd AND checkin=1"

                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()



                If rows = 0 Then
                    transaction.Rollback()
                    Return 0
                End If

                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "SELECT * FROM timeskratisis where (kratisi=@kratisi)"

                Dim myReader As SqlDataReader
                myReader = command.ExecuteReader()
                ' Always call Read before accessing data.
                While myReader.Read()
                    countTimesKrat += 1
                End While
                myReader.Close()
                command.Parameters.Clear()

                If ist_biblio_aktuel(connectionString, kwdikos) Then
                End If
                ' signalisiert ob diadikasia meta apo akyrosi kleisimatos->uparxei SPAETERE eintrag tis kratisis sto biblio Portas ->imerominia ergasias einai progenesteri!!!!!
                command.Parameters.AddWithValue("@etos", etos)
                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "SELECT MAX(imerominia) FROM biblioportas where (etos=@etos) and (kratisi=@kratisi)"
                'myReader = command.ExecuteReader(CommandBehavior.SingleResult)
                myReader = command.ExecuteReader(CommandBehavior.SingleResult)
                myReader.Read()

                Try
                    maxdatumBP = myReader.Item(0)
                    If maxdatumBP > imeromErgasias Then
                        prodatumOK = True 'imerominia ergasias einai progenesteri!!!!!->allagi tropou enimerwsis biblioou portas!
                    End If
                Catch ex As InvalidCastException
                    'nichts machen prodatum ist default false gesetzt!
                End Try

                myReader.Close()
                command.Parameters.Clear()


                If countTimesKrat = timokatalog.Length AndAlso timokatalog(0).kwdDB <> -1 Then 'elegxos ean oi toyristikes periodoi alaksan
                    For j = 0 To timokatalog.Length - 1
                        If (timokatalog(j).mexri >= imeromErgasias AndAlso imeromErgasias < DateTimePicker3.Value.Date) OrElse praktoreiokwdValue <> -1 Then ' mono oi current periodos (diladi pou eswkleiei tin imeromergasias If status = 2 And praktoreiokwdValue <> -1
                            If timokatalog(j).apo <= imeromErgasias Then
                                'ean alaksan oi times - xrewsi - arithmos enilikwn (mono imera afixis)
                                If timokatalog(j).ypnosDB <> timokatalog(j).ypnosTemp Or timokatalog(j).prwinoDB <> timokatalog(j).prwinoTemp Or
                                timokatalog(j).deipnoDB <> timokatalog(j).deipnoTemp Or timokatalog(j).geumaDB <> timokatalog(j).geumaTemp Or
                                timokatalog(j).paroxiDB <> timokatalog(j).paroxiTemp Or timokatalog(j).xrewsiDB <> timokatalog(j).xrewsi Or
                                (Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text And Me.DbhotelDataSet.kratiseis(0).afixi.Date = imeromErgasias) Or
                              (Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid And Me.DbhotelDataSet.kratiseis(0).afixi.Date = imeromErgasias) Then



                                    If timokatalog(j).apo < imeromErgasias Then
                                        insertOK = True 'insert neo timokatalogo dazwischen(DEDOULEUMENA periodou)
                                        apoIn = timokatalog(j).apo

                                        mexriIn = imeromErgasias.AddDays(-1)
                                        'allagi logw lathous 23/6/2020!!!!!!!!!!!!!!!!
                                        'imeresPlirIn = mexriIn.DayOfYear - apoIn.DayOfYear + 1
                                        imeresPlirIn = mexriIn.Subtract(apoIn).Days
                                        If timokatalog(j).dedoulPos <> 0 Then
                                            synoloIn = timokatalog(j).dedoulPos
                                        Else
                                            synoloIn = timokatalog(j).synoloDB
                                        End If
                                    End If
                                    If timokatalog(j).dedoulPos = 0 Then ' And imeromErgasias = timokatalog(j).apo
                                        imeresPlirUpd = timokatalog(j).imeresPlirom
                                    Else
                                        If j = timokatalog.Length - 1 Then
                                            '  imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear
                                            imeresPlirUpd = imeromErgasias.Subtract(timokatalog(j).apo).Days
                                        Else
                                            ' imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear + 1
                                            imeresPlirUpd = imeromErgasias.Subtract(timokatalog(j).apo).Days + 1
                                        End If
                                    End If
                                    updateOK = True 'update current periodo timeskratisis
                                    apoUpd = imeromErgasias
                                    mexriUpd = timokatalog(j).mexri
                                    synoloUpd = timokatalog(j).synolo
                                    command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    '    command.Parameters.AddWithValue("imerominia", CType(timokatalog(j - 1).apo, Date))
                                    command.CommandText = "SELECT * FROM biblioportas where (imerominia<=@imerominia) and (kratisi=@kratisi)and (status=1) ORDER BY imerominia DESC, kwd DESC"
                                    myReader = command.ExecuteReader(CommandBehavior.SingleResult)
                                    myReader.Read()
                                    command.Parameters.Clear()
                                    'SE PERIPTOSI exei proigoumenws bgei eilige theorimeni ektiposi tou Bibliou Portas!
                                    If myReader.Item("flag") = 1 And myReader.Item("imerominia") = imeromErgasias And
                                    (dwmatChangeOK Or anaxChangeOK Or praktChangeOK Or Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text Or Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid) Then
                                        paratiriseis = ""
                                        If dwmatChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Δωματίου"
                                        End If
                                        If anaxChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                        End If
                                        If praktChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Πρακτορείου"
                                        End If
                                        If Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text OrElse Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid Then
                                            paratiriseis = paratiriseis + " αλλ.αρ.Διαμενόντων"
                                        End If
                                    Else
                                        If Me.DbhotelDataSet.kratiseis(0).afixi.Date <> imeromErgasias Then
                                            paratiriseis = "αλλ. Χρέωσης"
                                            If dwmatChangeOK Then
                                                If Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then
                                                    paratiriseis = paratiriseis + " επιστρ. Overb."
                                                Else
                                                    paratiriseis = paratiriseis + " αλλ. Δωματίου"
                                                End If

                                            End If
                                            If anaxChangeOK Then
                                                paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                            End If
                                        End If
                                    End If

                                    'yparxei IDI EINTRAG sto Biblio Portas-> H ALLAGH TIMWN EGINE META THN AFIXI
                                    'akoma kai extrem periptwsi na exei ginei EPISHMH EKTYPWSH KATA THN DIARKEIA THS HMERAS (KAI OXI STO KLEISIMO)->PREPEI NA KSANATYPWTHEI ME ALLAGES!
                                    If myReader.Item("imerominia") <> imeromErgasias Or myReader.Item("flag") = 1 Then
                                        'se periptwsi pou den exei alaksei i anaxwrisi kai o pelatis feugei espeumena simera ->enimerwse to biblio portas (eidalws tha enimerwthei me tin anaxwrisi)
                                        If Not anaxChangeOK Or imeromErgasias <> Me.DateTimePicker3.Value Then
                                            '->ANAXWRISI sto  BIBLIO PORTAS
                                            'command.Parameters.AddWithValue("etos", CType(myReader.Item("etos"), Integer))
                                            'command.Parameters.AddWithValue("imerominia", CType(imeromErgasias, Date))
                                            'command.Parameters.AddWithValue("status", CType(2, Byte)) ' anaxwrisi
                                            'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
                                            'command.Parameters.AddWithValue("voucher", CType(myReader.Item("voucher"), String))
                                            'If prodatumOK Then
                                            '    arDwmat = myReader.Item("dwmatio")
                                            'Else
                                            '    arDwmat = ""
                                            'End If
                                            'command.Parameters.AddWithValue("dwmatio", CType(myReader.Item("dwmatio"), String)) 'Me.DbhotelDataSet.kratiseis(0).dwmatio
                                            'command.Parameters.AddWithValue("enilikes", CType(myReader.Item("enilikes"), Int16))
                                            'command.Parameters.AddWithValue("anilika", CType(myReader.Item("anilika"), Int16))
                                            'command.Parameters.AddWithValue("atoma", CType(myReader.Item("atoma"), Int16))
                                            'tempXrewsi = myReader.Item("xrewsi")
                                            'command.Parameters.AddWithValue("xrewsi", CType(myReader.Item("xrewsi"), Integer))
                                            'command.Parameters.AddWithValue("onomateponimo", CType(myReader.Item("onomateponimo"), String))
                                            'command.Parameters.AddWithValue("anzethnikotita", CType(myReader.Item("anzethnikotita"), Byte))
                                            'command.Parameters.AddWithValue("ethnikotita", CType(myReader.Item("ethnikotita"), Int16))
                                            'command.Parameters.AddWithValue("anzethnikotita2", CType(myReader.Item("anzethnikotita2"), Byte))
                                            'command.Parameters.AddWithValue("ethnikotita2", CType(myReader.Item("ethnikotita2"), Int16))
                                            'command.Parameters.AddWithValue("praktoreio", CType(myReader.Item("praktoreio"), Integer))
                                            'tempYpnos = myReader.Item("ypnos")
                                            'command.Parameters.AddWithValue("ypnos", CType(myReader.Item("ypnos"), Single))
                                            'tempPrwino = myReader.Item("prwino")
                                            'command.Parameters.AddWithValue("prwino", CType(myReader.Item("prwino"), Single))
                                            'tempGeumata = myReader.Item("geumata")
                                            'command.Parameters.AddWithValue("geumata", CType(myReader.Item("geumata"), Single))
                                            'tempExtras = myReader.Item("extras")
                                            'command.Parameters.AddWithValue("extras", CType(myReader.Item("extras"), Single))
                                            'command.Parameters.AddWithValue("synolo", CType(myReader.Item("synolo"), Single))
                                            'command.Parameters.AddWithValue("datum", CType(myReader.Item("imerominia"), Date)) 'anaxwrisi me imerominia ergasias
                                            ''paratiriseis = myReader.Item("paratiriseis") + paratiriseis
                                            'command.Parameters.AddWithValue("paratiriseis", paratiriseis)
                                            'command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
                                            '"praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) values (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma," &
                                            '"xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2,praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, 0)"
                                            'myReader.Close()
                                            'command.ExecuteNonQuery()
                                            'command.Parameters.Clear()
                                            command.Parameters.AddWithValue("@etos", CInt(myReader.Item("etos")))
                                            command.Parameters.AddWithValue("@imerominia", CDate(imeromErgasias))
                                            command.Parameters.AddWithValue("@status", CByte(2)) ' anaxwrisi
                                            command.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                            command.Parameters.AddWithValue("@voucher", CStr(myReader.Item("voucher")))
                                            If prodatumOK Then
                                                arDwmat = CStr(myReader.Item("dwmatio"))
                                            Else
                                                arDwmat = ""
                                            End If
                                            command.Parameters.AddWithValue("@dwmatio", CStr(myReader.Item("dwmatio")))
                                            command.Parameters.AddWithValue("@enilikes", CShort(myReader.Item("enilikes")))
                                            command.Parameters.AddWithValue("@anilika", CShort(myReader.Item("anilika")))
                                            command.Parameters.AddWithValue("@atoma", CShort(myReader.Item("atoma")))
                                            tempXrewsi = CInt(myReader.Item("xrewsi"))
                                            command.Parameters.AddWithValue("@xrewsi", CInt(myReader.Item("xrewsi")))
                                            command.Parameters.AddWithValue("@onomateponimo", CStr(myReader.Item("onomateponimo")))
                                            command.Parameters.AddWithValue("@anzethnikotita", CByte(myReader.Item("anzethnikotita")))
                                            command.Parameters.AddWithValue("@ethnikotita", CShort(myReader.Item("ethnikotita")))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CByte(myReader.Item("anzethnikotita2")))
                                            command.Parameters.AddWithValue("@ethnikotita2", CShort(myReader.Item("ethnikotita2")))
                                            command.Parameters.AddWithValue("@praktoreio", CInt(myReader.Item("praktoreio")))
                                            tempYpnos = CSng(myReader.Item("ypnos"))
                                            command.Parameters.AddWithValue("@ypnos", CSng(myReader.Item("ypnos")))
                                            tempPrwino = CSng(myReader.Item("prwino"))
                                            command.Parameters.AddWithValue("@prwino", CSng(myReader.Item("prwino")))
                                            tempGeumata = CSng(myReader.Item("geumata"))
                                            command.Parameters.AddWithValue("@geumata", CSng(myReader.Item("geumata")))
                                            tempExtras = CSng(myReader.Item("extras"))
                                            command.Parameters.AddWithValue("@extras", CSng(myReader.Item("extras")))
                                            command.Parameters.AddWithValue("@synolo", CSng(myReader.Item("synolo")))
                                            command.Parameters.AddWithValue("@datum", CDate(myReader.Item("imerominia")))
                                            command.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2, praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma, @xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                                            myReader.Close()
                                            command.ExecuteNonQuery()
                                            command.Parameters.Clear()


                                            '->AFIXI sto  BIBLIO PORTAS
                                            'command.Parameters.AddWithValue("etos", CType(etos, Integer))
                                            'command.Parameters.AddWithValue("imerominia", CType(imeromErgasias, Date))
                                            'command.Parameters.AddWithValue("status", CType(1, Byte))
                                            'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
                                            'command.Parameters.AddWithValue("voucher", CType(Me.VoucherTbx.Text, String))

                                            'If Not prodatumOK Then ' ean den yparxei spaetere eintrag sto biblio Portas tote mporei na alaksei to dwmatio 
                                            '    If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                            '        arDwmat = ""
                                            '    Else
                                            '        arDwmat = Me.DwmTbx.Text
                                            '    End If
                                            'End If
                                            'command.Parameters.AddWithValue("dwmatio", CType(arDwmat, String))
                                            'command.Parameters.AddWithValue("enilikes", CType(EnilikTbx.Text, Int16))
                                            'command.Parameters.AddWithValue("anilika", CType(countPaid, Int16))
                                            'command.Parameters.AddWithValue("atoma", CType(EnilikTbx.Text + countPaid, Int16))
                                            'command.Parameters.AddWithValue("xrewsi", CType(timokatalog(j).xrewsi, Integer))
                                            'If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                            '    command.Parameters.AddWithValue("onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text, String))
                                            'Else
                                            '    command.Parameters.AddWithValue("onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                                            'End If
                                            'command.Parameters.AddWithValue("anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                            'command.Parameters.AddWithValue("ethnikotita", CType(EthnKwd1.Text, Int16))
                                            'command.Parameters.AddWithValue("anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                            'command.Parameters.AddWithValue("ethnikotita2", CType(EthnKwd2.Text, Int16))
                                            'command.Parameters.AddWithValue("praktoreio", praktortimolkwd)
                                            'command.Parameters.AddWithValue("ypnos", CType(timokatalog(j).ypnos, Single))
                                            'command.Parameters.AddWithValue("prwino", CType(timokatalog(j).prwino, Single))
                                            'command.Parameters.AddWithValue("geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                            'command.Parameters.AddWithValue("extras", CType(timokatalog(j).paroxi, Single))
                                            'command.Parameters.AddWithValue("synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                            'command.Parameters.AddWithValue("datum", CType(DateTimePicker3.Value.Date, Date))
                                            'If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK OrElse Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                            '    If paratiriseis.Equals("") Then
                                            '        paratiriseis = "αλλ. Χρέωσης"
                                            '    End If
                                            '    If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                            '        If Not paratiriseis.Contains("OV-BOOK") Then
                                            '            paratiriseis = paratiriseis + " OV-BOOK "
                                            '        End If
                                            '    End If
                                            '    'If optionChk.Checked Then
                                            '    '    If Not paratiriseis.Contains("Guarantee") Then
                                            '    '        paratiriseis = paratiriseis + " Guarantee"
                                            '    '    End If
                                            '    'End If
                                            '    If ekptosiOK Then
                                            '        If Not paratiriseis.Contains("τιμ.χωρ.Εκπτ.") Then
                                            '            paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                            '        End If
                                            '    End If
                                            '    If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                            '        If Not paratiriseis.Contains("αλλ. Ημερ. Αναχ.") Then
                                            '            paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                            '        End If
                                            '    End If
                                            'Else
                                            '    If paratiriseis.Equals("") Then
                                            '        paratiriseis = "αλλ. Χρέωσης"
                                            '    End If
                                            'End If

                                            'command.Parameters.AddWithValue("paratiriseis", CType(paratiriseis, String))
                                            'command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
                                            '"praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) values (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma," &
                                            '"xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2,praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, 0)"

                                            'command.ExecuteNonQuery()
                                            'command.Parameters.Clear()
                                            command.Parameters.AddWithValue("@etos", CInt(etos))
                                            command.Parameters.AddWithValue("@imerominia", CDate(imeromErgasias))
                                            command.Parameters.AddWithValue("@status", CByte(1))
                                            command.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                            command.Parameters.AddWithValue("@voucher", CStr(Me.VoucherTbx.Text))

                                            If Not prodatumOK Then
                                                If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                                    arDwmat = ""
                                                Else
                                                    arDwmat = Me.DwmTbx.Text
                                                End If
                                            End If
                                            command.Parameters.AddWithValue("@dwmatio", CStr(arDwmat))
                                            command.Parameters.AddWithValue("@enilikes", CShort(EnilikTbx.Text))
                                            command.Parameters.AddWithValue("@anilika", CShort(countPaid))
                                            command.Parameters.AddWithValue("@atoma", CShort(EnilikTbx.Text + countPaid))
                                            command.Parameters.AddWithValue("@xrewsi", CInt(timokatalog(j).xrewsi))
                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command.Parameters.AddWithValue("@onomateponimo", CStr(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text))
                                            Else
                                                command.Parameters.AddWithValue("@onomateponimo", CStr(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text))
                                            End If
                                            command.Parameters.AddWithValue("@anzethnikotita", CByte(EthnAnzTbx1.Text))
                                            command.Parameters.AddWithValue("@ethnikotita", CShort(EthnKwd1.Text))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CByte(EthnAnzTbx2.Text))
                                            command.Parameters.AddWithValue("@ethnikotita2", CShort(EthnKwd2.Text))
                                            command.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                            command.Parameters.AddWithValue("@ypnos", CSng(timokatalog(j).ypnos))
                                            command.Parameters.AddWithValue("@prwino", CSng(timokatalog(j).prwino))
                                            command.Parameters.AddWithValue("@geumata", CSng(timokatalog(j).geuma + timokatalog(j).deipno))
                                            command.Parameters.AddWithValue("@extras", CSng(timokatalog(j).paroxi))
                                            command.Parameters.AddWithValue("@synolo", CSng(timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi))
                                            command.Parameters.AddWithValue("@datum", CDate(DateTimePicker3.Value.Date))

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK OrElse Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                                If paratiriseis.Equals("") Then
                                                    paratiriseis = "αλλ. Χρέωσης"
                                                End If
                                                If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                                    If Not paratiriseis.Contains("OV-BOOK") Then
                                                        paratiriseis = paratiriseis + " OV-BOOK "
                                                    End If
                                                End If
                                                If ekptosiOK Then
                                                    If Not paratiriseis.Contains("τιμ.χωρ.Εκπτ.") Then
                                                        paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                                    End If
                                                End If
                                                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                                    If Not paratiriseis.Contains("αλλ. Ημερ. Αναχ.") Then
                                                        paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                                    End If
                                                End If
                                            Else
                                                If paratiriseis.Equals("") Then
                                                    paratiriseis = "αλλ. Χρέωσης"
                                                End If
                                            End If

                                            command.Parameters.AddWithValue("@paratiriseis", CStr(paratiriseis))

                                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
                      "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma," &
                      "@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                                            command.ExecuteNonQuery()
                                            command.Parameters.Clear()


                                            If prodatumOK Then ' progenesteri imerominia Ergasias (apo akyrose kleisimatos imeras)

                                                If anaxChangeOK Then
                                                    'ean o User alakse tin anaxwrisi->exei epiptwsi sto Biblio Portas!!!!
                                                    If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                                        command2.Parameters.AddWithValue("@imerominia", CDate(DateTimePicker3.Value.Date))
                                                        command2.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                                        command2.CommandText = "DELETE FROM biblioportas WHERE (imerominia >= @imerominia) AND (kratisi = @kratisi)"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                        command2.Parameters.AddWithValue("@datum", CDate(DateTimePicker3.Value.Date))
                                                        command2.Parameters.AddWithValue("@imerominia", CDate(imeromErgasias))
                                                        command2.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                                        command2.Parameters.AddWithValue("@datum", CDate(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date))
                                                        command2.CommandText = "UPDATE biblioportas SET datum = @datum WHERE (imerominia >= @imerominia) AND (status = 1) AND (kratisi = @kratisi) AND (datum = @datum)"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                    Else
                                                        command2.Parameters.AddWithValue("@datum1", CDate(DateTimePicker3.Value.Date))
                                                        command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                        command2.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                                        command2.Parameters.AddWithValue("@datum2", CDate(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date))
                                                        command2.CommandText = "UPDATE biblioportas SET datum = @datum1 WHERE (imerominia >= @imerominia) AND (status = 1) AND (kratisi = @kratisi) AND (datum = @datum2)"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                    End If
                                                End If
                                                'koitaw gia metagenestera Eintraege me idia xrewsi
                                                command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                command2.Parameters.AddWithValue("@kratisi", CInt(kwdikos))
                                                command2.Parameters.AddWithValue("@xrewsi", tempXrewsi)
                                                command2.Parameters.AddWithValue("@ypnos", tempYpnos)
                                                command2.Parameters.AddWithValue("@prwino", tempPrwino)
                                                command2.Parameters.AddWithValue("@geumata", tempGeumata)
                                                command2.Parameters.AddWithValue("@extras", tempExtras)

                                                command2.CommandText = "SELECT * FROM biblioportas WHERE (imerominia > @imerominia) AND (kratisi = @kratisi) AND (xrewsi = @xrewsi) AND (ypnos = @ypnos) AND (prwino = @prwino) AND (geumata = @geumata) AND (extras = @extras) ORDER BY imerominia ASC, kwd ASC"

                                                Dim myReader2 As SqlDataReader
                                                myReader2 = command2.ExecuteReader()

                                                command2.Parameters.Clear()


                                                'ena Yparxoun  metagenestera Eintraege me idia xrewsi->Update xrewseis me tin NEA xrewsi 
                                                While myReader2.Read()

                                                    command3.Parameters.AddWithValue("@xrewsi", CInt(timokatalog(j).xrewsi))
                                                    command3.Parameters.AddWithValue("@ypnos", CSng(timokatalog(j).ypnos))
                                                    command3.Parameters.AddWithValue("@prwino", CSng(timokatalog(j).prwino))
                                                    command3.Parameters.AddWithValue("@geumata", CSng(timokatalog(j).geuma + timokatalog(j).deipno))
                                                    command3.Parameters.AddWithValue("@extras", CSng(timokatalog(j).paroxi))
                                                    command3.Parameters.AddWithValue("@synolo", CSng(timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi))
                                                    command3.Parameters.AddWithValue("@paratiriseis", paratiriseis) ' myReader.Item("paratiriseis") +
                                                    command3.Parameters.AddWithValue("@kwd", myReader2.Item("kwd"))

                                                    command3.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, paratiriseis = @paratiriseis WHERE kwd = @kwd"
                                                    command3.ExecuteNonQuery()

                                                    command3.Parameters.Clear()

                                                End While
                                                myReader2.Close()

                                                'kane Update ta genika stoixeia tis kratisis gia OLA ta Eintraege

                                                command2.Parameters.AddWithValue("@voucher", Me.VoucherTbx.Text)
                                                command2.Parameters.AddWithValue("@enilikes", CShort(EnilikTbx.Text))
                                                command2.Parameters.AddWithValue("@anilika", CShort(countPaid))
                                                command2.Parameters.AddWithValue("@atoma", CShort(EnilikTbx.Text) + CShort(countPaid))

                                                If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                    command2.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text)
                                                Else
                                                    command2.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text)
                                                End If

                                                command2.Parameters.AddWithValue("@anzethnikotita", CByte(EthnAnzTbx1.Text))
                                                command2.Parameters.AddWithValue("@ethnikotita", CShort(EthnKwd1.Text))
                                                command2.Parameters.AddWithValue("@anzethnikotita2", CByte(EthnAnzTbx2.Text))
                                                command2.Parameters.AddWithValue("@ethnikotita2", CShort(EthnKwd2.Text))
                                                command2.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                                command2.Parameters.AddWithValue("@kratisi", CInt(kwdikos))

                                                command2.CommandText = "UPDATE biblioportas SET voucher = @voucher, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio WHERE kratisi = @kratisi"
                                                command2.ExecuteNonQuery()

                                                command2.Parameters.Clear()

                                            End If

                                        End If

                                    Else ' ALLAGH TIMWN TIN IDIA MERA ME AFIXI->UPDATE BIBLIO PORTAS EAN DEN EXEI EKTYPOTHEI
                                        '('h YPARXEI EINTRAG APO PROIGOUMENO KLIESIMO STO BIBLIO PORTAS->px apo palaia automati allagh timwn h allagi Dwmatiou)

                                        If Not prodatumOK Then 'aktuelle imeromergasias ( ->den uparxei spaetere Eintrag sto Biblio Portas gai tin Kratisi! (apo px akyrosi kleisimatos)

                                            command.Parameters.AddWithValue("@voucher", Me.VoucherTbx.Text)

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                                arDwmat = ""
                                            Else
                                                arDwmat = Me.DwmTbx.Text
                                            End If

                                            If Not prodatumOK Then
                                                command.Parameters.AddWithValue("@dwmatio", arDwmat)
                                            End If

                                            command.Parameters.AddWithValue("@enilikes", CShort(EnilikTbx.Text))
                                            command.Parameters.AddWithValue("@anilika", CShort(countPaid))
                                            command.Parameters.AddWithValue("@atoma", CShort(EnilikTbx.Text) + CShort(countPaid))
                                            command.Parameters.AddWithValue("@xrewsi", CInt(timokatalog(j).xrewsi))

                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text)
                                            Else
                                                command.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text)
                                            End If

                                            command.Parameters.AddWithValue("@anzethnikotita", CByte(EthnAnzTbx1.Text))
                                            command.Parameters.AddWithValue("@ethnikotita", CShort(EthnKwd1.Text))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CByte(EthnAnzTbx2.Text))
                                            command.Parameters.AddWithValue("@ethnikotita2", CShort(EthnKwd2.Text))
                                            command.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                            command.Parameters.AddWithValue("@ypnos", CSng(timokatalog(j).ypnos))
                                            command.Parameters.AddWithValue("@prwino", CSng(timokatalog(j).prwino))
                                            command.Parameters.AddWithValue("@geumata", CSng(timokatalog(j).geuma + timokatalog(j).deipno))
                                            command.Parameters.AddWithValue("@extras", CSng(timokatalog(j).paroxi))
                                            command.Parameters.AddWithValue("@synolo", CSng(timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi))
                                            command.Parameters.AddWithValue("@datum", DateTimePicker3.Value.Date)

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK Then
                                                If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                                    If Not paratiriseis.Contains("OV-BOOK") Then
                                                        paratiriseis = paratiriseis + " OV-BOOK "
                                                    End If
                                                End If

                                                If ekptosiOK Then
                                                    If Not paratiriseis.Contains("τιμ.χωρ.Εκπτ.") Then
                                                        paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                                    End If
                                                End If
                                            End If

                                            If Not prodatumOK Then
                                                command.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                            End If

                                            command.Parameters.AddWithValue("@kwd", myReader.Item("kwd"))

                                            command.CommandText = "UPDATE biblioportas SET voucher = @voucher, dwmatio = @dwmatio, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, xrewsi = @xrewsi, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, datum = @datum, paratiriseis = @paratiriseis WHERE kwd = @kwd"
                                            myReader.Close()
                                            rows = command.ExecuteNonQuery()
                                            command.Parameters.Clear()

                                        Else ' edw diadikasia gia allages sto Biblio Portas meta apo akyrosi kleisimatos kai epanafora se 
                                            'PROGENESTERI HMEROMINIA ergasias (->uparxei spaetere Eintrag sto Biblio Portas gai tin Kratisi! (apo px akyrosi kleisimatos)
                                            'OI allages timwn metaferontai kai se METAGENESTARA eintraege tou Bibliou Portas!!!!
                                            If anaxChangeOK Then
                                                If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                                    command2.Parameters.AddWithValue("@imerominia", DateTimePicker3.Value.Date)
                                                    command2.Parameters.AddWithValue("@kratisi", kwdikos)
                                                    command2.CommandText = "DELETE FROM biblioportas WHERE imerominia >= @imerominia AND kratisi = @kratisi"
                                                    command2.ExecuteNonQuery()
                                                    command2.Parameters.Clear()

                                                    command2.Parameters.AddWithValue("@datum", DateTimePicker3.Value.Date)
                                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                    command2.Parameters.AddWithValue("@kratisi", kwdikos)
                                                    command2.Parameters.AddWithValue("@datum2", Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date)
                                                    command2.CommandText = "UPDATE biblioportas SET datum = @datum WHERE imerominia >= @imerominia AND status = 1 AND kratisi = @kratisi AND datum = @datum2"
                                                    command2.ExecuteNonQuery()
                                                    command2.Parameters.Clear()

                                                Else
                                                    'command2.Parameters.AddWithValue("datum", CType(DateTimePicker3.Value.Date, Date))
                                                    'command2.Parameters.AddWithValue("imerominia", imeromErgasias)
                                                    'command2.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
                                                    'command2.Parameters.AddWithValue("datum", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                    'command2.CommandText = "UPDATE biblioportas set datum=? where (imerominia>=?) and (status=1) and (kratisi=?)and (datum=?)" '(imerominia=?) and (status=1) and (kratisi=?)

                                                    'command2.ExecuteNonQuery()

                                                    'command2.Parameters.Clear()
                                                    command2.Parameters.AddWithValue("@datum1", DateTimePicker3.Value.Date)
                                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                    command2.Parameters.AddWithValue("@kratisi", kwdikos)
                                                    command2.Parameters.AddWithValue("@datum2", Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date)
                                                    command2.CommandText = "UPDATE biblioportas SET datum = @datum1 WHERE imerominia >= @imerominia AND status = 1 AND kratisi = @kratisi AND datum = @datum2"
                                                    command2.ExecuteNonQuery()
                                                    command2.Parameters.Clear()

                                                End If
                                            End If
                                            tempXrewsi = myReader.Item("xrewsi")
                                            tempYpnos = myReader.Item("ypnos")
                                            tempPrwino = myReader.Item("prwino")
                                            tempGeumata = myReader.Item("geumata")
                                            tempExtras = myReader.Item("extras")
                                            command2.Parameters.AddWithValue("@xrewsi", timokatalog(j).xrewsi)
                                            command2.Parameters.AddWithValue("@ypnos", timokatalog(j).ypnos)
                                            command2.Parameters.AddWithValue("@prwino", timokatalog(j).prwino)
                                            command2.Parameters.AddWithValue("@geumata", timokatalog(j).geuma + timokatalog(j).deipno)
                                            command2.Parameters.AddWithValue("@extras", timokatalog(j).paroxi)
                                            command2.Parameters.AddWithValue("@synolo", timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi)
                                            command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                            command2.Parameters.AddWithValue("@kratisi", kwdikos)
                                            command2.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo WHERE imerominia = @imerominia AND status = 1 AND kratisi = @kratisi"
                                            command2.ExecuteNonQuery()

                                            command2.Parameters.Clear()



                                            'koitaw gia metagenestera Eintraege me idia xrewsi
                                            command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                            command2.Parameters.AddWithValue("@kratisi", kwdikos)
                                            command2.Parameters.AddWithValue("@xrewsi", tempXrewsi)
                                            command2.Parameters.AddWithValue("@ypnos", tempYpnos)
                                            command2.Parameters.AddWithValue("@prwino", tempPrwino)
                                            command2.Parameters.AddWithValue("@geumata", tempGeumata)
                                            command2.Parameters.AddWithValue("@extras", tempExtras)

                                            command2.CommandText = "SELECT * FROM biblioportas WHERE (imerominia > @imerominia) AND (kratisi = @kratisi) AND (xrewsi = @xrewsi) AND (ypnos = @ypnos) AND (prwino = @prwino) AND (geumata = @geumata) AND (extras = @extras) ORDER BY imerominia ASC, kwd ASC"


                                            Dim myReader2 As SqlDataReader

                                            myReader2 = command2.ExecuteReader()


                                            command2.Parameters.Clear()

                                            'ena Yparxoun  metagenestera Eintraege me idia xrewsi->Update xrewseis me tin NEA xrewsi 
                                            While myReader2.Read()

                                                command3.Parameters.AddWithValue("@xrewsi", timokatalog(j).xrewsi)
                                                command3.Parameters.AddWithValue("@ypnos", timokatalog(j).ypnos)
                                                command3.Parameters.AddWithValue("@prwino", timokatalog(j).prwino)
                                                command3.Parameters.AddWithValue("@geumata", timokatalog(j).geuma + timokatalog(j).deipno)
                                                command3.Parameters.AddWithValue("@extras", timokatalog(j).paroxi)
                                                command3.Parameters.AddWithValue("@synolo", timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi)
                                                command3.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                                command3.Parameters.AddWithValue("@kwd", myReader2.Item("kwd"))

                                                command3.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, paratiriseis = @paratiriseis WHERE kwd = @kwd"

                                                command3.ExecuteNonQuery()
                                                command3.Parameters.Clear()

                                            End While
                                            myReader2.Close()

                                            'kane Update ta genika stoixeia tis kratisis gia OLA ta Eintraege

                                            command2.Parameters.AddWithValue("@voucher", Me.VoucherTbx.Text)
                                            command2.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                                            command2.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                                            command2.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text, Int16) + countPaid)


                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command2.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text)
                                            Else
                                                command2.Parameters.AddWithValue("@onomateponimo", OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text)
                                            End If
                                            command2.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                            command2.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                                            command2.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                            command2.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                                            command2.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                            command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))

                                            command2.CommandText = "UPDATE biblioportas SET voucher = @voucher, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio WHERE kratisi = @kratisi"

                                            command2.ExecuteNonQuery()
                                            command2.Parameters.Clear()


                                        End If

                                        myReader.Close()



                                    End If
                                    dwmatChangeOK = False 'flag gia na min ksanagrafei to biblio portas ean exei ginei kai alagh Dwmatiou
                                    anaxChangeOK = False
                                    praktChangeOK = False
                                    onomChangeOK = False
                                Else

                                    insertOK = False
                                    updateOK = True
                                    apoUpd = timokatalog(j).apo
                                    mexriUpd = timokatalog(j).mexri
                                    synoloUpd = timokatalog(j).synolo
                                    imeresPlirUpd = timokatalog(j).imeresPlirom
                                End If
                            Else
                                insertOK = False
                                updateOK = True
                                apoUpd = timokatalog(j).apo
                                mexriUpd = timokatalog(j).mexri
                                synoloUpd = timokatalog(j).synolo
                                imeresPlirUpd = timokatalog(j).imeresPlirom
                            End If
                        Else
                            If (anaxChangeOK And imeromErgasias = Me.DateTimePicker3.Value) Then 'o pelatis feugei ESPEUMENA simera!!!
                                insertOK = False
                                updateOK = True
                                apoUpd = timokatalog(j).apo
                                mexriUpd = timokatalog(j).mexri
                                synoloUpd = timokatalog(j).synolo
                                imeresPlirUpd = timokatalog(j).imeresPlirom
                            End If
                        End If
                        If insertOK Then
                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                            command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                            command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosiDB, Single))
                            command.Parameters.AddWithValue("@apo", CType(apoIn, Date))
                            command.Parameters.AddWithValue("@mexri", CType(mexriIn, Date))
                            command.Parameters.AddWithValue("@imeres", CType(imeresPlirIn, Byte))
                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnosDB, Single))
                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwinoDB, Single))
                            command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geumaDB, Single))
                            command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipnoDB, Single))
                            command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxiDB, Single))
                            command.Parameters.AddWithValue("@synolo", CType(synoloIn, Single))
                            If status = 2 And praktoreiokwdValue <> -1 Then
                                command.Parameters.AddWithValue("@touristperiod", -1)
                            Else
                                command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                            End If
                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsiDB, Integer))

                            command.CommandText = "INSERT INTO timeskratisis (kratisi, timi, ekptosi, apo, mexri, imeres, ypnos, prwino, geuma, deipno, extra, synolo, touristperiod, xrewsi) " &
                                                  "VALUES (@kratisi, @timi, @ekptosi, @apo, @mexri, @imeres, @ypnos, @prwino, @geuma, @deipno, @extra, @synolo, @touristperiod, @xrewsi)"

                            command.ExecuteNonQuery()
                            command.Parameters.Clear()

                        End If
                        If updateOK Then
                            command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                            command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosi, Single))
                            command.Parameters.AddWithValue("@apo", CType(apoUpd, Date))
                            command.Parameters.AddWithValue("@mexri", CType(mexriUpd, Date))
                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                            command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geuma, Single))
                            command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipno, Single))
                            command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxi, Single))
                            command.Parameters.AddWithValue("@synolo", CType(timokatalog(j).synolo, Single))
                            command.Parameters.AddWithValue("@imeres", CType(imeresPlirUpd, Byte))
                            If status = 2 And praktoreiokwdValue <> -1 Then
                                command.Parameters.AddWithValue("@touristperiod", -1)
                            Else
                                command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                            End If
                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))
                            command.Parameters.AddWithValue("@kwd", CType(timokatalog(j).kwdDB, Integer))

                            command.CommandText = "UPDATE timeskratisis SET timi=@timi, ekptosi=@ekptosi, apo=@apo, mexri=@mexri, ypnos=@ypnos, prwino=@prwino, geuma=@geuma, " &
                                                  "deipno=@deipno, extra=@extra, synolo=@synolo, imeres=@imeres, touristperiod=@touristperiod, xrewsi=@xrewsi WHERE kwd=@kwd"

                            command.ExecuteNonQuery()
                            command.Parameters.Clear()

                        End If
                    Next

                Else 'ALAKSAN OI TOOYRISTIKES PERIODOI!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                    'opws panw ->apla edw epireazetai to table timeskratisis
                    command.Parameters.AddWithValue("kwd", CType(kwdikos, Integer))
                    command.CommandText = "DELETE FROM timeskratisis where (kratisi=?)"
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()
                    For j = 0 To timokatalog.Length - 1
                        If (timokatalog(j).mexri >= imeromErgasias AndAlso imeromErgasias < DateTimePicker3.Value.Date) OrElse praktoreiokwdValue <> -1 Then ' mono oi periodoi pou paizoun ->palaioi preiodoi den einai energopoioimenoi outws oi allws
                            If timokatalog(j).apo <= imeromErgasias Then
                                'ean alaksan oi times - xrewsi - arithmos enilikwn (mono imera afixis)
                                If timokatalog(j).ypnosDB <> timokatalog(j).ypnosTemp Or timokatalog(j).prwinoDB <> timokatalog(j).prwinoTemp Or
                                                              timokatalog(j).deipnoDB <> timokatalog(j).deipnoTemp Or timokatalog(j).geumaDB <> timokatalog(j).geumaTemp Or
                                                              timokatalog(j).paroxiDB <> timokatalog(j).paroxiTemp Or timokatalog(j).xrewsiDB <> timokatalog(j).xrewsi Or
                                                              (Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text And Me.DbhotelDataSet.kratiseis(0).afixi.Date = imeromErgasias) Or
                                                            (Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid And Me.DbhotelDataSet.kratiseis(0).afixi.Date = imeromErgasias) Then

                                    If timokatalog(j).apo < imeromErgasias Then
                                        insertOK = True
                                        apoIn = timokatalog(j).apo
                                        mexriIn = imeromErgasias.AddDays(-1)
                                        imeresPlirIn = mexriIn.DayOfYear - apoIn.DayOfYear + 1
                                        If timokatalog(j).dedoulPos <> 0 Then
                                            synoloIn = timokatalog(j).dedoulPos
                                        Else
                                            synoloIn = timokatalog(j).synoloDB
                                        End If
                                    End If
                                    If timokatalog(j).dedoulPos = 0 Then
                                        imeresPlirUpd = timokatalog(j).imeresPlirom
                                    Else
                                        If j = timokatalog.Length - 1 Then
                                            'imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear
                                            imeresPlirUpd = imeromErgasias.Subtract(timokatalog(j).mexri).Days
                                        Else
                                            ' imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear + 1
                                            imeresPlirUpd = imeromErgasias.Subtract(timokatalog(j).mexri).Days + 1
                                        End If
                                    End If
                                    'If j = timokatalog.Length - 1 Then
                                    '    imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear
                                    'Else
                                    '    imeresPlirUpd = timokatalog(j).mexri.DayOfYear - imeromErgasias.DayOfYear + 1
                                    'End If
                                    'imeresPlirUpd = timokatalog(j).imeresPlirom
                                    insert1OK = True
                                    apoUpd = imeromErgasias
                                    mexriUpd = timokatalog(j).mexri
                                    synoloUpd = timokatalog(j).synolo

                                    'command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                    'command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    'command.CommandText = "SELECT * FROM biblioportas WHERE (imerominia<=@imerominia) AND (kratisi=@kratisi) AND (status=1) ORDER BY imerominia DESC, kwd DESC"

                                    'myReader = command.ExecuteReader(CommandBehavior.SingleRow)
                                    'myReader.Read()

                                    'command.Parameters.Clear()
                                    command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    command.CommandText = "SELECT * FROM biblioportas WHERE (imerominia<=@imerominia) AND (kratisi=@kratisi) AND (status=1) ORDER BY imerominia DESC, kwd DESC"

                                    myReader = command.ExecuteReader(CommandBehavior.SingleResult)
                                    myReader.Read()

                                    command.Parameters.Clear()

                                    If myReader.Item("flag") = 1 And myReader.Item("imerominia") = imeromErgasias And
                                  (dwmatChangeOK Or anaxChangeOK Or praktChangeOK Or Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text Or Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid) Then
                                        paratiriseis = "αλλ. Χρέωσης"
                                        If dwmatChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Δωματίου"
                                        End If
                                        If anaxChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                        End If
                                        If praktChangeOK Then
                                            paratiriseis = paratiriseis + " αλλ. Πρακτορείου"
                                        End If
                                        If Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text OrElse Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid Then
                                            paratiriseis = paratiriseis + " αλλ.αρ.Διαμενόντων"
                                        End If
                                    Else
                                        If Me.DbhotelDataSet.kratiseis(0).afixi.Date <> imeromErgasias Then
                                            paratiriseis = "αλλ. Χρέωσης"
                                            If dwmatChangeOK Then
                                                If Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then
                                                    paratiriseis = paratiriseis + " επιστρ. Overb."
                                                Else
                                                    paratiriseis = paratiriseis + " αλλ. Δωματίου"
                                                End If

                                            End If
                                            If anaxChangeOK Then
                                                paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                            End If
                                        End If

                                    End If

                                    'yparxei IDI EINTRAG sto Biblio Portas-> H ALLAGH TIMWN EGINE META THN AFIXI
                                    'akoma kai extrem periptwsi na exei ginei EPISHMH EKTYPWSH KATA THN DIARKEIA THS HMERAS (KAI OXI STO KLEISIMO)->PREPEI NA KSANATYPWTHEI ME ALLAGES!
                                    If myReader.Item("imerominia") <> imeromErgasias Or myReader.Item("flag") = 1 Then
                                        If Not anaxChangeOK Or imeromErgasias <> Me.DateTimePicker3.Value Then
                                            '->ANAXWRISI sto  BIBLIO PORTAS
                                            command.Parameters.AddWithValue("@etos", CType(myReader.Item("etos"), Integer))
                                            command.Parameters.AddWithValue("@imerominia", CType(imeromErgasias, Date))
                                            command.Parameters.AddWithValue("@status", CType(2, Byte)) ' anaxwrisi
                                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                            command.Parameters.AddWithValue("@voucher", CType(myReader.Item("voucher"), String))

                                            If prodatumOK Then
                                                arDwmat = myReader.Item("@dwmatio")
                                            Else
                                                arDwmat = ""
                                            End If
                                            command.Parameters.AddWithValue("@dwmatio", CType(myReader.Item("dwmatio"), String))
                                            command.Parameters.AddWithValue("@enilikes", CType(myReader.Item("enilikes"), Int16))
                                            command.Parameters.AddWithValue("@anilika", CType(myReader.Item("anilika"), Int16))
                                            command.Parameters.AddWithValue("@atoma", CType(myReader.Item("atoma"), Int16))
                                            tempXrewsi = myReader.Item("xrewsi")
                                            command.Parameters.AddWithValue("@xrewsi", CType(myReader.Item("xrewsi"), Integer))
                                            command.Parameters.AddWithValue("@onomateponimo", CType(myReader.Item("onomateponimo"), String))
                                            command.Parameters.AddWithValue("@anzethnikotita", CType(myReader.Item("anzethnikotita"), Byte))
                                            command.Parameters.AddWithValue("@ethnikotita", CType(myReader.Item("ethnikotita"), Int16))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CType(myReader.Item("anzethnikotita2"), Byte))
                                            command.Parameters.AddWithValue("@ethnikotita2", CType(myReader.Item("ethnikotita2"), Int16))
                                            command.Parameters.AddWithValue("@praktoreio", CType(myReader.Item("praktoreio"), Integer))
                                            tempYpnos = myReader.Item("ypnos")
                                            command.Parameters.AddWithValue("@ypnos", CType(myReader.Item("ypnos"), Single))
                                            tempPrwino = myReader.Item("prwino")
                                            command.Parameters.AddWithValue("@prwino", CType(myReader.Item("prwino"), Single))
                                            tempGeumata = myReader.Item("geumata")
                                            command.Parameters.AddWithValue("@geumata", CType(myReader.Item("geumata"), Single))
                                            tempExtras = myReader.Item("extras")
                                            command.Parameters.AddWithValue("@extras", CType(myReader.Item("extras"), Single))
                                            command.Parameters.AddWithValue("@synolo", CType(myReader.Item("synolo"), Single))
                                            command.Parameters.AddWithValue("@datum", CType(myReader.Item("imerominia"), Date))
                                            command.Parameters.AddWithValue("@paratiriseis", paratiriseis)

                                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
"praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma," &
"@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                                            myReader.Close()
                                            command.ExecuteNonQuery()
                                            command.Parameters.Clear()


                                            '->AFIXI sto  BIBLIO PORTAS
                                            command.Parameters.AddWithValue("@etos", CType(etos, Integer))
                                            command.Parameters.AddWithValue("@imerominia", CType(imeromErgasias, Date))
                                            command.Parameters.AddWithValue("@status", CType(1, Byte))
                                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                            command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))

                                            If Not prodatumOK Then
                                                If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                                    arDwmat = ""
                                                Else
                                                    arDwmat = Me.DwmTbx.Text
                                                End If
                                            End If

                                            command.Parameters.AddWithValue("@dwmatio", CType(arDwmat, String))
                                            command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                                            command.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                                            command.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))
                                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))

                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                                            Else
                                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                                            End If

                                            command.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                            command.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                            command.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                                            command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))
                                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                                            command.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                            command.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                                            command.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                            command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK OrElse Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                                If paratiriseis.Equals("") Then
                                                    paratiriseis = "αλλ. Χρέωσης"
                                                End If

                                                If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                                    If Not paratiriseis.Contains("OV-BOOK") Then
                                                        paratiriseis = paratiriseis + " OV-BOOK "
                                                    End If
                                                End If

                                                If ekptosiOK Then
                                                    If Not paratiriseis.Contains("τιμ.χωρ.Εκπτ.") Then
                                                        paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                                    End If
                                                End If

                                                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> Me.DateTimePicker3.Value.Date Then
                                                    If Not paratiriseis.Contains("αλλ. Ημερ. Αναχ.") Then
                                                        paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                                    End If
                                                End If
                                            Else
                                                If paratiriseis.Equals("") Then
                                                    paratiriseis = "αλλ. Χρέωσης"
                                                End If
                                            End If

                                            command.Parameters.AddWithValue("@paratiriseis", CType(paratiriseis, String))
                                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
"praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma," &
"@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                                            command.ExecuteNonQuery()
                                            command.Parameters.Clear()

                                            If prodatumOK Then 'EAN EINAI PROGENESTERI IMEROMINIA APO KANONIKH (PROILTHE APO AKYROSI KLEISIMATOS IMERAS)
                                                If anaxChangeOK Then
                                                    If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                                        command2.Parameters.AddWithValue("@imerominia1", CType(DateTimePicker3.Value.Date, Date))
                                                        command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                        command2.CommandText = "DELETE FROM biblioportas WHERE imerominia >= @imerominia1 AND kratisi = @kratisi"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                        command2.Parameters.AddWithValue("@datum1", CType(DateTimePicker3.Value.Date, Date))
                                                        command2.Parameters.AddWithValue("@imerominia2", imeromErgasias)
                                                        command2.Parameters.AddWithValue("@kratisi1", CType(kwdikos, Integer))
                                                        command2.Parameters.AddWithValue("@datum2", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                        command2.CommandText = "UPDATE biblioportas SET datum = @datum1 WHERE imerominia >= @imerominia2 AND status = 1 AND kratisi = @kratisi1 AND datum = @datum2"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                    Else
                                                        'command2.Parameters.AddWithValue("datum", CType(DateTimePicker3.Value.Date, Date))
                                                        'command2.Parameters.AddWithValue("imerominia", imeromErgasias)
                                                        'command2.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
                                                        'command2.Parameters.AddWithValue("datum", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                        'command2.CommandText = "UPDATE biblioportas set datum=? where (imerominia>=?) and (status=1) and (kratisi=?)and (datum=?)" '(imerominia=?) and (status=1) and (kratisi=?)

                                                        'command2.ExecuteNonQuery()

                                                        'command2.Parameters.Clear()
                                                        command2.Parameters.AddWithValue("@datum1", CType(DateTimePicker3.Value.Date, Date))
                                                        command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                        command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                        command2.Parameters.AddWithValue("@datum2", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                        command2.CommandText = "UPDATE biblioportas SET datum = @datum1 WHERE imerominia >= @imerominia AND status = 1 AND kratisi = @kratisi AND datum = @datum2"
                                                        command2.ExecuteNonQuery()
                                                        command2.Parameters.Clear()

                                                    End If
                                                End If
                                                'koitaw gia metagenestera Eintraege me idia xrewsi
                                                command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                command2.Parameters.AddWithValue("@xrewsi", tempXrewsi)
                                                command2.Parameters.AddWithValue("@ypnos", tempYpnos)
                                                command2.Parameters.AddWithValue("@prwino", tempPrwino)
                                                command2.Parameters.AddWithValue("@geumata", tempGeumata)
                                                command2.Parameters.AddWithValue("@extras", tempExtras)

                                                command2.CommandText = "SELECT * FROM biblioportas WHERE imerominia > @imerominia AND kratisi = @kratisi AND xrewsi = @xrewsi AND ypnos = @ypnos AND prwino = @prwino AND geumata = @geumata AND extras = @extras ORDER BY imerominia ASC, kwd ASC"

                                                Dim myReader2 As SqlDataReader = command2.ExecuteReader()

                                                command2.Parameters.Clear()

                                                'ena Yparxoun  metagenestera Eintraege me idia xrewsi->Update xrewseis me tin NEA xrewsi 
                                                While myReader2.Read()

                                                    command3.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))
                                                    command3.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                                                    command3.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                                                    command3.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                                    command3.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                                                    command3.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                                    command3.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                                    command3.Parameters.AddWithValue("@kwd", myReader2.Item("kwd"))

                                                    command3.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, paratiriseis = @paratiriseis WHERE kwd = @kwd"
                                                    command3.ExecuteNonQuery()

                                                    command3.Parameters.Clear()

                                                End While
                                                myReader2.Close()

                                                'kane Update ta genika stoixeia tis kratisis gia OLA ta Eintraege

                                                command2.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                                                command2.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                                                command2.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                                                command2.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))

                                                If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                    command2.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                                                Else
                                                    command2.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                                                End If

                                                command2.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                                command2.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                                                command2.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                                command2.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                                                command2.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                                command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))

                                                command2.CommandText = "UPDATE biblioportas SET voucher = @voucher, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio WHERE kratisi = @kratisi"
                                                command2.ExecuteNonQuery()

                                                command2.Parameters.Clear()

                                            End If

                                        End If

                                    Else ' HMEROMINIA ERGASIAS IDIA ME AFIXIS!!!!!!!!!!!!!!!!
                                        If Not prodatumOK Then
                                            command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                                arDwmat = ""
                                            Else
                                                arDwmat = Me.DwmTbx.Text
                                            End If

                                            If Not prodatumOK Then
                                                command.Parameters.AddWithValue("@dwmatio", CType(arDwmat, String))
                                            End If

                                            command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                                            command.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                                            command.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))
                                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))

                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                                            Else
                                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                                            End If

                                            command.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                            command.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                                            command.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                            command.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                                            command.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                                            command.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                            command.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                                            command.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                            command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))

                                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK Then
                                                paratiriseis = ""
                                                If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                                    paratiriseis = "OV-BOOK "
                                                End If
                                                If ekptosiOK Then
                                                    paratiriseis = paratiriseis + "τιμ.χωρ.Εκπτ."
                                                End If
                                            Else
                                                paratiriseis = ""
                                            End If

                                            If Not prodatumOK Then
                                                command.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                            End If

                                            command.Parameters.AddWithValue("@kwd", myReader.Item("kwd"))

                                            command.CommandText = "UPDATE biblioportas SET voucher = @voucher, dwmatio = @dwmatio, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, xrewsi = @xrewsi, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, datum = @datum, paratiriseis = @paratiriseis WHERE kwd = @kwd"

                                            myReader.Close()
                                            rows = command.ExecuteNonQuery()
                                            command.Parameters.Clear()

                                        Else ' edw diadikasia gia allages sto Biblio Portas meta apo akyrosi kleisimatos kai epanafora se 
                                            'PROGENESTERI HMEROMINIA ergasias
                                            'OI allages timwn metaferontai kai se METAGENESTARA eintraege tou Bibliou Portas!!!!
                                            If anaxChangeOK Then
                                                If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                                    command2.Parameters.AddWithValue("@imerominia", CType(DateTimePicker3.Value.Date, Date))
                                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                    command2.CommandText = "DELETE FROM biblioportas WHERE imerominia >= @imerominia AND kratisi = @kratisi"
                                                    command2.ExecuteNonQuery()
                                                    command2.Parameters.Clear()

                                                    command2.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))
                                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                    command2.Parameters.AddWithValue("@datum", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                    command2.CommandText = "UPDATE biblioportas SET datum = @datum WHERE imerominia >= @imerominia AND status = 1 AND kratisi = @kratisi AND datum = @datum"
                                                    command2.ExecuteNonQuery()

                                                    command2.Parameters.Clear()

                                                Else
                                                    command2.Parameters.AddWithValue("@datum1", CType(DateTimePicker3.Value.Date, Date))
                                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                                    command2.Parameters.AddWithValue("@datum2", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))
                                                    command2.CommandText = "UPDATE biblioportas SET datum = @datum1 WHERE imerominia >= @imerominia AND status = 1 AND kratisi = @kratisi AND datum = @datum2"
                                                    command2.ExecuteNonQuery()

                                                    command2.Parameters.Clear()

                                                End If
                                            End If
                                            tempXrewsi = myReader.Item("xrewsi")
                                            tempYpnos = myReader.Item("ypnos")
                                            tempPrwino = myReader.Item("prwino")
                                            tempGeumata = myReader.Item("geumata")
                                            tempExtras = myReader.Item("extras")
                                            command2.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))
                                            command2.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                                            command2.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                                            command2.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                            command2.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                                            command2.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                            command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                            command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                            command2.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo WHERE imerominia = @imerominia AND status = 1 AND kratisi = @kratisi"
                                            command2.ExecuteNonQuery()

                                            command2.Parameters.Clear()



                                            'koitaw gia metagenestera Eintraege me idia xrewsi
                                            command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                            command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                            command2.Parameters.AddWithValue("@xrewsi", tempXrewsi)
                                            command2.Parameters.AddWithValue("@ypnos", tempYpnos)
                                            command2.Parameters.AddWithValue("@prwino", tempPrwino)
                                            command2.Parameters.AddWithValue("@geumata", tempGeumata)
                                            command2.Parameters.AddWithValue("@extras", tempExtras)
                                            command2.CommandText = "SELECT * FROM biblioportas WHERE imerominia > @imerominia AND kratisi = @kratisi AND xrewsi = @xrewsi AND ypnos = @ypnos AND prwino = @prwino AND geumata = @geumata AND extras = @extras ORDER BY imerominia ASC, kwd ASC"

                                            Dim myReader2 As SqlDataReader
                                            myReader2 = command2.ExecuteReader()

                                            command2.Parameters.Clear()


                                            'ena Yparxoun  metagenestera Eintraege me idia xrewsi->Update xrewseis me tin NEA xrewsi 
                                            While myReader2.Read()

                                                command3.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))
                                                command3.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                                                command3.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                                                command3.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                                                command3.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                                                command3.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                                                command3.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                                                command3.Parameters.AddWithValue("@kwd", myReader2.Item("kwd"))

                                                command3.CommandText = "UPDATE biblioportas SET xrewsi = @xrewsi, ypnos = @ypnos, prwino = @prwino, geumata = @geumata, extras = @extras, synolo = @synolo, paratiriseis = @paratiriseis WHERE kwd = @kwd"
                                                command3.ExecuteNonQuery()

                                                command3.Parameters.Clear()

                                            End While
                                            myReader2.Close()

                                            'kane Update ta genika stoixeia tis kratisis gia OLA ta Eintraege

                                            command2.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                                            command2.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                                            command2.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                                            command2.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))

                                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                                command2.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                                            Else
                                                command2.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                                            End If

                                            command2.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                                            command2.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                                            command2.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                                            command2.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                                            command2.Parameters.AddWithValue("@praktoreio", praktortimolkwd)
                                            command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))

                                            command2.CommandText = "UPDATE biblioportas SET voucher = @voucher, enilikes = @enilikes, anilika = @anilika, atoma = @atoma, onomateponimo = @onomateponimo, anzethnikotita = @anzethnikotita, ethnikotita = @ethnikotita, anzethnikotita2 = @anzethnikotita2, ethnikotita2 = @ethnikotita2, praktoreio = @praktoreio WHERE kratisi = @kratisi"

                                            command2.ExecuteNonQuery()

                                            command2.Parameters.Clear()


                                        End If

                                        myReader.Close()


                                    End If
                                    dwmatChangeOK = False
                                    anaxChangeOK = False
                                    praktChangeOK = False
                                    onomChangeOK = False
                                Else
                                    insertOK = False
                                    insert1OK = True
                                    apoUpd = timokatalog(j).apo
                                    mexriUpd = timokatalog(j).mexri
                                    synoloUpd = timokatalog(j).synolo
                                    imeresPlirUpd = timokatalog(j).imeresPlirom
                                    'If j = timokatalog.Length - 1 Then
                                    '    imeresPlirUpd = mexriUpd.DayOfYear - apoUpd.DayOfYear
                                    'Else
                                    '    imeresPlirUpd = mexriUpd.DayOfYear - apoUpd.DayOfYear + 1
                                    'End If
                                End If
                            Else
                                insertOK = False
                                insert1OK = True
                                apoUpd = timokatalog(j).apo
                                mexriUpd = timokatalog(j).mexri
                                synoloUpd = timokatalog(j).synolo
                                imeresPlirUpd = timokatalog(j).imeresPlirom
                                'If j = timokatalog.Length - 1 Then
                                '    imeresPlirUpd = mexriUpd.DayOfYear - apoUpd.DayOfYear
                                'Else
                                '    imeresPlirUpd = mexriUpd.DayOfYear - apoUpd.DayOfYear + 1
                                'End If
                            End If
                        Else
                            insertOK = False
                            insert1OK = True
                            apoUpd = timokatalog(j).apo
                            mexriUpd = timokatalog(j).mexri
                            synoloUpd = timokatalog(j).synolo
                            imeresPlirUpd = timokatalog(j).imeresPlirom
                        End If
                        If insertOK Then
                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                            command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                            command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosiDB, Boolean))
                            command.Parameters.AddWithValue("@apo", CType(apoIn, Date))
                            command.Parameters.AddWithValue("@mexri", CType(mexriIn, Date))
                            command.Parameters.AddWithValue("@imeres", CType(imeresPlirIn, Byte))
                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnosDB, Single))
                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwinoDB, Single))
                            command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geumaDB, Single))
                            command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipnoDB, Single))
                            command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxiDB, Single))
                            command.Parameters.AddWithValue("@synolo", CType(synoloIn, Single))

                            If status = 2 And praktoreiokwdValue <> -1 Then
                                command.Parameters.AddWithValue("@touristperiod", -1)
                            Else
                                command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                            End If

                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsiDB, Integer))

                            command.CommandText = "INSERT INTO timeskratisis (kratisi, timi, ekptosi, apo, mexri, imeres, ypnos, prwino, geuma, deipno, extra, synolo, touristperiod, xrewsi) " &
                                                  "VALUES (@kratisi, @timi, @ekptosi, @apo, @mexri, @imeres, @ypnos, @prwino, @geuma, @deipno, @extra, @synolo, @touristperiod, @xrewsi)"

                            command.ExecuteNonQuery()

                            command.Parameters.Clear()

                        End If
                        If insert1OK Then
                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                            command.Parameters.AddWithValue("@timi", CType(timokatalog(j).timi, Integer))
                            command.Parameters.AddWithValue("@ekptosi", CType(timokatalog(j).ekptosi, Boolean))
                            command.Parameters.AddWithValue("@apo", CType(apoUpd, Date))
                            command.Parameters.AddWithValue("@mexri", CType(mexriUpd, Date))
                            command.Parameters.AddWithValue("@imeres", CType(imeresPlirUpd, Byte))
                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                            command.Parameters.AddWithValue("@geuma", CType(timokatalog(j).geuma, Single))
                            command.Parameters.AddWithValue("@deipno", CType(timokatalog(j).deipno, Single))
                            command.Parameters.AddWithValue("@extra", CType(timokatalog(j).paroxi, Single))
                            command.Parameters.AddWithValue("@synolo", CType(synoloUpd, Single))

                            If status = 2 And praktoreiokwdValue <> -1 Then
                                command.Parameters.AddWithValue("@touristperiod", -1)
                            Else
                                command.Parameters.AddWithValue("@touristperiod", CType(timokatalog(j).tourist, Integer))
                            End If

                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))

                            command.CommandText = "INSERT INTO timeskratisis (kratisi, timi, ekptosi, apo, mexri, imeres, ypnos, prwino, geuma, deipno, extra, synolo, touristperiod, xrewsi) " &
                                                  "VALUES (@kratisi, @timi, @ekptosi, @apo, @mexri, @imeres, @ypnos, @prwino, @geuma, @deipno, @extra, @synolo, @touristperiod, @xrewsi)"

                            command.ExecuteNonQuery()

                            command.Parameters.Clear()

                        End If
                    Next
                End If

                'alaske mono to dwmatio ;h i anaxwrisi (xwris na exoun alaksei times giati to thema me to biblio portas tha eixe idi
                'dieuthetithei panw)!!!!!!!!!!!!!!
                If dwmatChangeOK Or anaxChangeOK Then
                    For j = 0 To timokatalog.Length - 1
                        If timokatalog(j).mexriDB >= imeromErgasias AndAlso timokatalog(j).apo <= imeromErgasias Then
                            Exit For
                        End If
                    Next
                    command.Parameters.AddWithValue("@imerominia", imeromErgasias)
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))

                    command.CommandText = "SELECT * FROM biblioportas WHERE (imerominia <= @imerominia) AND (kratisi = @kratisi) AND (status = 1) ORDER BY imerominia DESC, kwd DESC"

                    myReader = command.ExecuteReader(CommandBehavior.SingleResult)
                    myReader.Read()

                    command.Parameters.Clear()


                    ' H ALLAGH  EGINE META THN AFIXI->ANAXWRISI-NEA AFIXI BIBLIO PORTAS
                    'akoma kai extrem periptwsi na exei ginei EPISHMH EKTYPWSH KATA THN DIARKEIA THS HMERAS (KAI OXI STO KLEISIMO)->PREPEI NA KSANATYPWTHEI ME ALLAGES!
                    If myReader.Item("imerominia") <> imeromErgasias OrElse myReader.Item("flag") = 1 Then 'prepei na knw antigrafi tou telaiytaiou eintrag me anaxwrisi-afixi 
                        paratiriseis = ""
                        If dwmatChangeOK Then
                            If Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then
                                paratiriseis = "Επιστρ.Overb."
                            Else
                                'If Me.DbhotelDataSet.kratiseis(0).afixi <> imeromErgasias Then
                                paratiriseis = "αλλ. Δωματίου"
                                'End If
                            End If
                        End If
                        If anaxChangeOK Then
                            paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                        End If
                        If praktChangeOK Then
                            paratiriseis = paratiriseis + " αλλ. Πρακτορείου"
                        End If
                        If Me.DbhotelDataSet.kratiseis(0).enilikes <> EnilikTbx.Text OrElse Me.DbhotelDataSet.kratiseis(0).paidia <> countPaid Then
                            paratiriseis = paratiriseis + " αλλ.αρ.Διαμενόντων"
                        End If

                        'Else
                        '    paratiriseis = ""
                        'End If
                        praktChangeOK = False

                        'se periptwsi pou den exei alaksei i anaxwrisi kai o pelatis feugei espeumena simera ->enimerwse to biblio portas (eidalws tha enimerwthei me tin anaxwrisi)
                        If Not anaxChangeOK Or imeromErgasias <> Me.DateTimePicker3.Value Then
                            command.Parameters.AddWithValue("@etos", CType(myReader.Item("etos"), Integer))
                            command.Parameters.AddWithValue("@imerominia", CType(imeromErgasias, Date))
                            command.Parameters.AddWithValue("@status", CType(2, Byte)) ' anaxwrisi
                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                            command.Parameters.AddWithValue("@voucher", CType(myReader.Item("voucher"), String))
                            If prodatumOK Then
                                arDwmat = myReader.Item("dwmatio")
                            Else
                                arDwmat = ""
                            End If
                            command.Parameters.AddWithValue("@dwmatio", CType(myReader.Item("dwmatio"), String))
                            command.Parameters.AddWithValue("@enilikes", CType(myReader.Item("enilikes"), Int16))
                            command.Parameters.AddWithValue("@anilika", CType(myReader.Item("anilika"), Int16))
                            command.Parameters.AddWithValue("@atoma", CType(myReader.Item("atoma"), Int16))
                            command.Parameters.AddWithValue("@xrewsi", CType(myReader.Item("xrewsi"), Integer))
                            command.Parameters.AddWithValue("@onomateponimo", CType(myReader.Item("onomateponimo"), String))
                            command.Parameters.AddWithValue("@anzethnikotita", CType(myReader.Item("anzethnikotita"), Byte))
                            command.Parameters.AddWithValue("@ethnikotita", CType(myReader.Item("ethnikotita"), Int16))
                            command.Parameters.AddWithValue("@anzethnikotita2", CType(myReader.Item("anzethnikotita2"), Byte))
                            command.Parameters.AddWithValue("@ethnikotita2", CType(myReader.Item("ethnikotita2"), Int16))
                            command.Parameters.AddWithValue("@praktoreio", CType(myReader.Item("praktoreio"), Integer))
                            command.Parameters.AddWithValue("@ypnos", CType(myReader.Item("ypnos"), Single))
                            command.Parameters.AddWithValue("@prwino", CType(myReader.Item("prwino"), Single))
                            command.Parameters.AddWithValue("@geumata", CType(myReader.Item("geumata"), Single))
                            command.Parameters.AddWithValue("@extras", CType(myReader.Item("extras"), Single))
                            command.Parameters.AddWithValue("@synolo", CType(myReader.Item("synolo"), Single))
                            command.Parameters.AddWithValue("@datum", CType(myReader.Item("imerominia"), Date))
                            command.Parameters.AddWithValue("@paratiriseis", paratiriseis) ' CType(myReader.Item("paratiriseis"), String) +
                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," &
                      "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma," &
                      "@xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"
                            myReader.Close()
                            command.ExecuteNonQuery()
                            command.Parameters.Clear()


                            command.Parameters.AddWithValue("@etos", CType(etos, Integer))
                            command.Parameters.AddWithValue("@imerominia", CType(imeromErgasias, Date))
                            command.Parameters.AddWithValue("@status", CType(1, Byte))
                            command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                            command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))

                            If Not prodatumOK Then
                                If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                    arDwmat = ""
                                Else
                                    arDwmat = Me.DwmTbx.Text
                                End If
                            End If
                            command.Parameters.AddWithValue("@dwmatio", CType(arDwmat, String))
                            command.Parameters.AddWithValue("@enilikes", CType(EnilikTbx.Text, Int16))
                            command.Parameters.AddWithValue("@anilika", CType(countPaid, Int16))
                            command.Parameters.AddWithValue("@atoma", CType(EnilikTbx.Text + countPaid, Int16))
                            command.Parameters.AddWithValue("@xrewsi", CType(timokatalog(j).xrewsi, Integer))

                            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                            Else
                                command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                            End If

                            command.Parameters.AddWithValue("@anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
                            command.Parameters.AddWithValue("@ethnikotita", CType(EthnKwd1.Text, Int16))
                            command.Parameters.AddWithValue("@anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
                            command.Parameters.AddWithValue("@ethnikotita2", CType(EthnKwd2.Text, Int16))
                            command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))
                            command.Parameters.AddWithValue("@ypnos", CType(timokatalog(j).ypnos, Single))
                            command.Parameters.AddWithValue("@prwino", CType(timokatalog(j).prwino, Single))
                            command.Parameters.AddWithValue("@geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
                            command.Parameters.AddWithValue("@extras", CType(timokatalog(j).paroxi, Single))
                            command.Parameters.AddWithValue("@synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
                            command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))

                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK OrElse ekptosiOK Then
                                If Me.DwmTbx.Text.Equals("OV-BOOK") Or overOK Then
                                    If Not paratiriseis.Contains("OV-BOOK") Then
                                        paratiriseis = paratiriseis + " OV-BOOK "
                                    End If
                                End If

                                If ekptosiOK Then
                                    paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                End If
                            End If

                            command.Parameters.AddWithValue("@paratiriseis", CType(paratiriseis, String))
                            command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2, praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) VALUES (@etos, @imerominia, @status, @kratisi, @voucher, @dwmatio, @enilikes, @anilika, @atoma, @xrewsi, @onomateponimo, @anzethnikotita, @ethnikotita, @anzethnikotita2, @ethnikotita2, @praktoreio, @ypnos, @prwino, @geumata, @extras, @synolo, @datum, @paratiriseis, 0)"

                            command.ExecuteNonQuery()
                            command.Parameters.Clear()

                            If prodatumOK Then ' se peiptwsi pou uparxei metagenestero eintrag sto biblio Portas ->deleten!!!
                                If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                    command2.Parameters.AddWithValue("@imerominia", CType(DateTimePicker3.Value.Date, Date))
                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    command2.CommandText = "DELETE FROM biblioportas WHERE (imerominia >= @imerominia) AND (kratisi = @kratisi)"
                                    command2.ExecuteNonQuery()
                                    command2.Parameters.Clear()

                                End If
                            End If
                        End If

                    Else 'idia imerominia->existiert schon Eintrag sto Biblio Portas->nur Update me nneo Dwmatio
                        If Not prodatumOK Then
                            If Me.DwmTbx.Text.Equals("OV-BOOK") Then
                                arDwmat = ""
                            Else
                                arDwmat = Me.DwmTbx.Text
                            End If
                            command.Parameters.AddWithValue("@voucher", CType(Me.VoucherTbx.Text, String))
                            command.Parameters.AddWithValue("@dwmatio", CType(arDwmat, String))
                            command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))
                            command.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))

                            If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse ekptosiOK OrElse overOK OrElse anaxChangeOK OrElse dwmatChangeOK Then
                                paratiriseis = ""
                                If dwmatChangeOK Then
                                    If Me.DbhotelDataSet.kratiseis(0).afixi.Date <> imeromErgasias Then
                                        paratiriseis = "αλλ. Δωματίου"
                                    End If
                                End If
                                If Me.DwmTbx.Text.Equals("OV-BOOK") OrElse overOK Then
                                    If Not paratiriseis.Contains("OV-BOOK") Then
                                        paratiriseis = paratiriseis + " OV-BOOK "
                                    End If
                                End If
                                If ekptosiOK Then
                                    paratiriseis = paratiriseis + " τιμ.χωρ.Εκπτ."
                                End If
                                If anaxChangeOK Then
                                    paratiriseis = paratiriseis + " αλλ. Ημερ. Αναχ."
                                End If
                            Else
                                paratiriseis = ""
                            End If

                            command.Parameters.AddWithValue("@paratiriseis", paratiriseis)
                            command.Parameters.AddWithValue("@kwd", myReader.Item("kwd"))

                            command.CommandText = "UPDATE biblioportas SET voucher=@voucher, dwmatio=@dwmatio, praktoreio=@praktoreio, datum=@datum, paratiriseis=@paratiriseis WHERE (kwd=@kwd)"

                            myReader.Close()
                            rows = command.ExecuteNonQuery()
                            command.Parameters.Clear()

                        Else
                            ' edw diadikasia gia allages sto Biblio Portas meta apo akyrosi kleisimatos kai epanafora se 
                            'PROGENESTERI HMEROMINIA
                            'koitaw gia metagenestera Eintraege me idia xrewsi
                            If anaxChangeOK Then
                                If DateTimePicker3.Value.Date < Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date Then
                                    command2.Parameters.AddWithValue("@imerominia", CType(DateTimePicker3.Value.Date, Date))
                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    command2.CommandText = "DELETE FROM biblioportas WHERE (imerominia>=@imerominia) AND (kratisi=@kratisi)"
                                    rows = command2.ExecuteNonQuery()

                                    command2.Parameters.Clear()
                                    command2.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))
                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    command2.Parameters.AddWithValue("@datum2", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))

                                    command2.CommandText = "UPDATE biblioportas SET datum=@datum WHERE (imerominia>=@imerominia) AND (status=1) AND (kratisi=@kratisi) AND (datum=@datum2)"
                                    command2.ExecuteNonQuery()

                                    command2.Parameters.Clear()

                                Else
                                    command2.Parameters.AddWithValue("@datum", CType(DateTimePicker3.Value.Date, Date))
                                    command2.Parameters.AddWithValue("@imerominia", imeromErgasias)
                                    command2.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                                    command2.Parameters.AddWithValue("@datum2", CType(Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Date))

                                    command2.CommandText = "UPDATE biblioportas SET datum=@datum WHERE (imerominia>=@imerominia) AND (status=1) AND (kratisi=@kratisi) AND (datum=@datum2)"
                                    command2.ExecuteNonQuery()

                                    command2.Parameters.Clear()

                                End If
                            End If

                        End If
                        'myReader.Close()

                    End If
                End If
                'edw uparxei i periptwsi pou kata thn diarkeia tis diamonis alaksei to praktoreiako timologio->edw alazei OLA ta eintraege tou bibliou portas
                'me autin tin kratisi _>einai sigoura LATHOS alla ....->erwtima pros Maniki....
                If praktChangeOK Then
                    command.Parameters.AddWithValue("@praktoreio", CType(praktortimolkwd, Integer))
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.CommandText = "UPDATE biblioportas SET praktoreio=@praktoreio WHERE (kratisi=@kratisi)"
                    myReader.Close()
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                End If
                If onomChangeOK AndAlso Me.DbhotelDataSet.kratiseis(0).afixi.Date = imeromErgasias Then
                    onomChangeOK = False
                    If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text, String))
                    Else
                        command.Parameters.AddWithValue("@onomateponimo", CType(OnomTbx1.Text + ChrW(13) + OnomTbx2.Text + ChrW(13) + OnomTbx3.Text, String))
                    End If
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.CommandText = "UPDATE biblioportas SET onomateponimo=@onomateponimo WHERE (kratisi=@kratisi)"
                    myReader.Close()
                    command.ExecuteNonQuery()
                    command.Parameters.Clear()

                End If
                If Not prodatumOK Then ' eimai se kaniniki imerominia ergasias
                    If rows = 1 Then
                        If DwmTbx.Text <> Me.DbhotelDataSet.kratiseis(0).dwmatio And imeromErgasias < DateTimePicker3.Value.Date Then
                            If allagi_dwmatiou_ok() Then
                                transaction.Commit()
                                Return 2 'olla OK me allgi dwmatiou->(xreiazetai sto update_dimawta procedure gia taktopoisi status dwmatiou meta apo allagi anaxwrisis)
                            End If
                        Else
                            transaction.Commit()
                            Return 1
                        End If
                    Else
                        transaction.Rollback()
                        MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Return -1
                    End If

                    'If allagi_dwmatiou_ok() And rows = 1 Then 'alagi dwmatiou OK kai allagi bibliou Portas OK!!!
                    '    transaction.Commit()
                    '    Return 2 'olla OK
                    'Else
                    '    transaction.Rollback()
                    '    MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    '    Return -1
                    'End If
                Else 'eimai se palaioteri imerominia ergasias (apo akyrosi kleisimatos) pou DEN epitrepeti i allagi Dwmatiou!!!!!!
                    transaction.Commit()
                    Return 1 'ola OK 
                End If


            Catch ex As Exception
                MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using
    End Function


    Private Function sind_ethnikotites_ok(ByVal sender As System.Object, ByVal e As System.EventArgs) As Boolean
        If EthnAnzTbx1.Text.Equals("0") AndAlso EthnKwd1.Text > 0 Then
            EthnKwd1.Text = 0
            EthnikTbx1.Clear()
        End If

        If Not EthnAnzTbx1.Text.Equals("0") AndAlso EthnKwd1.Text = 0 Then
            MsgBox("Επιλέξτε Εθνικότητα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.enabled = True
            Me.Cursor = Cursors.Default
            EthnikTbx1.Focus()
            If EthnKwd1.Text = 0 Then
                MsgBox("Δέν ολοκληρώθηκε η Αποθήκευση !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Return False
            End If
            '
        End If
        If EthnAnzTbx2.Text.Equals("0") AndAlso EthnKwd2.Text > 0 Then
            EthnKwd2.Text = 0
            EthnikTbx2.Clear()
        End If
        If Not EthnAnzTbx2.Text.Equals("0") AndAlso EthnKwd2.Text = 0 Then
            MsgBox("Επιλέξτε Εθνικότητα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            sender.enabled = True
            Me.Cursor = Cursors.Default
            EthnikTbx2.Focus()
            If EthnKwd2.Text = 0 Then
                MsgBox("Δέν ολοκληρώθηκε η Αποθήκευση !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Return False
            End If
            'Exit Sub
        End If
        If EthnKwd1.Text = 0 AndAlso EthnAnzTbx1.Text.Equals("0") AndAlso EthnKwd2.Text <> 0 AndAlso Not EthnAnzTbx2.Text.Equals("0") Then
            EthnKwd1.Text = EthnKwd2.Text
            EthnKwd2.Text = 0
            EthnAnzTbx1.Text = EthnAnzTbx2.Text
            EthnAnzTbx2.Text = 0
        End If
        Return True
    End Function
    'kLICK STO BUTTON OVER STOYS DIAMENWNTES!!!!!!!!!!!!!1
    Private Sub over_erneuern(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim response As MsgBoxResult
        Dim ekptosiOK As Boolean
        Dim countDB As Integer
        'Dim countPaid As Int16
        Dim kwdikosOv As Integer ' kwdikos db apo over table -> ;h sesionID se periptwsi pou den uparxei Eintrag sto over 
        If Not ist_xrewsi_ok() Then
            MsgBox("Δεν έχει επιλεγεί τύπος χρέωσης !", MsgBoxStyle.Critical, "winfo\nikEl.")
            Exit Sub
        End If
        If ekptPoso <> 0 OrElse ekptPososto <> 0 OrElse ekptFree <> 0 OrElse ekptCFee <> 0 Then
            ekptosiOK = True
        Else
            ekptosiOK = False
        End If
        'eretze_temp_vor_speichern()
        'execute_update_diamenwnta_transaction("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|\dbhotel.mdb", kwdikoKratisisDB, ekptosiOK)
        If status = 2 Then

            Try ' koitw eab uparxei over kataxwrisi idi
                kwdikosOv = Me.OverTableAdapter.GetKwdByKratisi(kwdikoKratisisDB, False)
            Catch ex As InvalidOperationException
                kwdikosOv = sesionID
            End Try
            If kwdikosOv <> sesionID AndAlso Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then 'uparxei over kataxwrisi
                MsgBox(" Για επιστροφή δώστε αριθμό Δωματίου και μετά πατήστε Αποθήκευση !", MsgBoxStyle.Information, "winfo\nikEl.")
                'Dim anaxDate As Date '
                'If Me.DbhotelDataSet.kratiseis(0).anaxwrisi < imeromErgasias Then 'Se periptosi pou i anaxwrish enai pleon eterixronismi=> anax<imeromErgasias!!!!!!!!
                '    anaxDate = imeromErgasias 'H Anaxwrisi Date exei properastei xwris na ginei Checkout->over akoma
                'Else
                '    anaxDate = Me.DbhotelDataSet.kratiseis(0).anaxwrisi
                'End If
                'overunterjuenfte arxika me sessionid  srin thesi tou kwdikou over speichern mexri na parei kwdiko over
                Dim UnterForm As New OverUnterkuenfteFrm(kwdikosOv, imeromErgasias, DateTimePicker3.Value.Date, status)
                Try
                    UnterForm.ShowDialog()
                Catch ex As InvalidOperationException

                End Try
                Dim epistrofi As Date
                Try
                    epistrofi = Me.OverunterkuenfteTableAdapter.GetMaxHmerMexriByOver(kwdikosOv)
                Catch ex As Exception
                    'epistrofi = #1/1/1900# 'INITIAL WERT GIA EPISTROFI APO OVER
                    epistrofi = DateTimePicker3.Value.AddDays(-1)
                End Try
                Me.OverTableAdapter.UpdateOverByKwd(epistrofi, epistrofi, False, kwdikosOv)

            Else

                response = MsgBox(" Διαδικασία Over;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                If response = MsgBoxResult.Yes Then
                    If status = 2 AndAlso Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") AndAlso imeromErgasias = DateTimePicker3.Value.Date Then
                        MsgBox(" Δεν είναι δυνατή η διαδικασία Over κατά την Ημέρα Αναχώρησης  !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        'sender.text = Me.DbhotelDataSet.kratiseis(0).dwmatio
                        Exit Sub
                    End If
                    'countPaid = EthnAnzTbx1.Text + EthnAnzTbx2.Text - EnilikTbx.Text
                    Try
                        ersetze_temp_vor_speichern()
                        countDB = execute_update_diamenwnta_transaction(connectionString, kwdikoKratisisDB, ekptosiOK, True)
                    Catch ex As SqlException
                        MsgBox(" Παρουσιάστηκε σφάλμα κατά την Διαδικασία !", MsgBoxStyle.Critical, "winfo\nikEl.")
                        Me.DwmTbx.Text = Me.DbhotelDataSet.kratiseis(0).dwmatio
                        Exit Sub
                    End Try
                    If countDB >= 1 Then
                        'Dim anaxDate As Date
                        'If Me.DbhotelDataSet.kratiseis(0).anaxwrisi < imeromErgasias Then
                        '    anaxDate = imeromErgasias 'H Anaxwrisi Date exei properastei xwris na ginei Checkout->over akoma

                        'Else
                        '    anaxDate = Me.DbhotelDataSet.kratiseis(0).anaxwrisi
                        'End If

                        'Dim UnterForm As New OverUnterkuenfteFrm(kwdikosOv, imeromErgasias, Me.DbhotelDataSet.kratiseis(0).anaxwrisi, status)
                        Dim UnterForm As New OverUnterkuenfteFrm(kwdikosOv, imeromErgasias, DateTimePicker3.Value.Date, status)
                        Try
                            UnterForm.ShowDialog()
                        Catch ex As InvalidOperationException

                        End Try
                        Me.KratiseisTableAdapter.UpdateArDwmatiouByKwd("OV-BOOK", kwdikoKratisisDB)
                        ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                        'If Not set_availabilities_status("", DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                        '    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        'End If
                        'End If
                        'Prosoxi kano befreien to dwmatio pou einai stis kratiseis->gia na brw to richtige Eintrag sta Status kanw Abfrage gia tin kratisi to Dwmatio kai 
                        'tin imerominia lixi tou Eintrag->ean exei polaples allages dwmativm oi anenerges exoun idi LIKSI autin imeromergasias (also simera) 
                        If imeromErgasias <> Me.DbhotelDataSet.kratiseis(0).afixi.Date Then
                            Dim count As Int16 = 0
                            'count = Me.StatusTableAdapter.IstFrischeStatus(kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).dwmatio, imeromErgasias)
                            'If count = 0 Then 'setze lixi sto Tupel tou status
                            '    Me.StatusTableAdapter.BefreieDwmByKratisiLixiDwmatio(imeromErgasias.AddDays(-1), kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).dwmatio, imeromErgasias)
                            'Else 'delete molis eixe eisaxthei
                            '    Me.StatusTableAdapter.DeleteByKratisiEnarxi(kwdikoKratisisDB, imeromErgasias)
                            'End If

                            'kane befreien to dwmatio
                            count = Me.StatusTableAdapter.BefreieDwmByKratisiLixiDwmatioEnarxi(imeromErgasias.AddDays(-1), kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).dwmatio, imeromErgasias, imeromErgasias)
                            If count = 0 Then 'to dwmATIO EXEI KATA PASA PITHANOTHTA ENARXI STATUS TIN IDIA HMEROMINIA ME ERGASIAS ->KANE DELETE!!
                                Me.StatusTableAdapter.DeleteByKratisiEnarxi(kwdikoKratisisDB, imeromErgasias)
                            End If


                        Else
                            Me.StatusTableAdapter.DeleteByKratisiEnarxi(kwdikoKratisisDB, imeromErgasias)
                        End If

                        'belege neu
                        'Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value, 5, imeromErgasias)
                        Dim epistrofi As Date
                        Try
                            epistrofi = Me.OverunterkuenfteTableAdapter.GetMaxHmerMexriByOver(sesionID)
                        Catch ex As Exception
                            'MsgBox(Me.DbhotelDataSet.kratiseis(0).anaxwrisi)
                            'epistrofi = #1/1/1900# 'INITIAL WERT GIA EPISTROFI APO OVER
                            epistrofi = DateTimePicker3.Value.AddDays(-1)
                        End Try
                        'If kwdikosOv = -1 Then
                        Try
                            Me.OverTableAdapter.InsertOver(kwdikoKratisisDB, epistrofi, imeromErgasias, epistrofi, False)
                            Try
                                kwdikosOv = Me.OverTableAdapter.GetKwdByKratisi(kwdikoKratisisDB, False)
                                Me.OverunterkuenfteTableAdapter.UpdateOverByOver(kwdikosOv, sesionID)
                            Catch ex As InvalidOperationException
                                MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            End Try
                        Catch ex As SqlException
                            MsgBox("Παρουσιάστηκε πρόβλημα στην καταχώριση των στοιχείων για Over", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try
                        'End If


                        DwmTbx.Text = "OV-BOOK"
                        Me.DbhotelDataSet.kratiseis.Clear()
                        kwdikoKratisisDB = -1
                        sesionID = get_sesion()
                        init_ekptoseis()
                        ReDim timokatalog(-1)
                        kratiseis_zeig(False)
                        'End If
                        'Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                    Else
                        If countDB = 0 Then
                            MsgBox(" Η Κράτηση εχει πιθανώς διαγραφεί από άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            Exit Sub
                            'Else '-1
                            '    MsgBox(" Παρουσιάστηκε σφάλμα κατά την Διαδικασία Αλλαγής Δωματίου !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            '    Exit Sub
                        End If
                    End If

                End If

            End If

        End If
        'imeromErgasias = imeromErgasias.AddDays(10)
        'imeromErgasias = "18/7/2007"
    End Sub
    Private Sub release_period_pruefen()
        If status = 1 Then
            Dim releazeP, diff As Int16
            'MsgBox(timokatalog(0).tourist.ToString)
            Try
                releazeP = Me.TouristperiodoiTableAdapter.GetReleazeByKwd(timokatalog(0).tourist.ToString)
            Catch ex As InvalidOperationException
                releazeP = 0
            End Try
            Try
                diff = Me.DateTimePicker2.Value.Date.DayOfYear - (CType(ImeromKratTbx.Text, Date).DayOfYear + releazeP)
            Catch ex As InvalidCastException
                diff = 0
            End Try
            If releazeP <> 0 AndAlso diff < 0 Then
                MsgBox(" Εκτός Release Period ! (" + diff.ToString + ")", MsgBoxStyle.Information, "winfo\nikEl.")
            End If
        End If
    End Sub

    Private Sub OnomTbx1_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OnomTbx1.Enter, OnomTbx2.Enter, OnomTbx3.Enter
        Dim j, count, anzahlEnil As Int16
        Dim onomAlt, onomNeu As String
        Dim find() As Control
        Dim kwdikos As Integer

        onomAlt = ""
        onomNeu = ""

        If status = 2 Then ' edw elegxw allages-prosthiki onomatwn->gia eventuelle nachtraegliche eisagwgi sto Biblio Portas

            Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikoKratisisDB)
            For j = 0 To Me.DbhotelDataSet.enilikes.Count - 1
                anzahlEnil += 1
                If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                    If j < 1 Then
                        onomAlt = onomAlt + LTrim(Me.DbhotelDataSet.enilikes(j).onomateponimo)
                    End If
                Else
                    If j < 3 Then
                        onomAlt = onomAlt + LTrim(Me.DbhotelDataSet.enilikes(j).onomateponimo)
                    End If
                End If

            Next
        End If

        'Dim kwdEnilikwn() As Integer
        'If kwdikoKratisisDB <> -1 Then
        If kwdikoKratisisDB = -1 Then
            kwdikos = sesionID
        Else
            kwdikos = kwdikoKratisisDB
        End If
        'MsgBox(praktortimolkwd)
        Dim form As New OnomataKratisisFrm(kwdikos, imeromErgasias, praktortimolkwd)
        form.StartPosition = FormStartPosition.CenterParent
        Try
            form.ShowDialog()
        Catch ex As InvalidOperationException

        End Try

        Me.DbhotelDataSet.enilikes.Clear()
        Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikos)
        If Me.DbhotelDataSet.enilikes.Count <= 3 Then
            count = Me.DbhotelDataSet.enilikes.Count
        Else
            count = 3
        End If
        OnomTbx1.Clear()
        OnomTbx2.Clear()
        OnomTbx3.Clear()
        For j = 0 To count - 1
            find = Kratiseis2Pnl.Controls.Find("OnomTbx" + (j + 1).ToString, False)
            find(0).Text = Me.DbhotelDataSet.enilikes(j).onomateponimo
            If status = 2 Then
                If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                    If j < 1 Then
                        onomNeu = onomNeu + LTrim(Me.DbhotelDataSet.enilikes(j).onomateponimo)
                    End If
                Else
                    If j < 3 Then
                        onomNeu = onomNeu + LTrim(Me.DbhotelDataSet.enilikes(j).onomateponimo)
                    End If
                End If

            End If


        Next


        If status = 2 Then ' edw elegxw allages-prosthiki onomatwn->gia eventuelle nachtraegliche eisagwgi sto Biblio Portas
            'onomChangeOK einai globale variable tin opoia tin sinantame sto execute_update_diamenwnta_transaction 
            If Me.DbhotelDataSet.etaireia(0).biblportas = 1 Then
                If anzahlEnil > 1 Then
                    onomChangeOK = True
                End If
            Else
                If Me.DbhotelDataSet.enilikes.Count <> anzahlEnil Then
                    onomChangeOK = True
                End If
            End If
            If Not onomChangeOK AndAlso Not onomAlt.Equals(onomNeu) Then
                onomChangeOK = True
            End If
        End If



        PaidiTbx1.Focus()
        'Else
        'MsgBox(" Υπάρχει η Δυνατότητα εισαγωγής πλέον των 3 Ατόμων: Εισάγετε τα 3 πρώτα Ονομ/πώνυμα στα 3 αντίστοιχα πεδία, " & vbCrLf & " ολοκληρώστε την εισαγωγή της νέας κράτησης με αποθήκευση και έπειτα μπορείτε να εισάγετε και άλλα Ατομα" & vbCrLf & " πατώντας αυτό το κουμπί ξανά ! ", MsgBoxStyle.Information, "winfo\nikEl.")
        'End If
    End Sub
    Private Sub OnomTbx1_TextChanged(sender As Object, e As EventArgs) Handles OnomTbx1.TextChanged
        If OnomTbx1.Text <> "" Then
            Dim fores As Int16
            'If repeaterLbl.Text <> "" AndAlso repeaterLbl.Text.Length > 7 Then
            '    Try
            '        fores = CType(repeaterLbl.Text.Substring(7, repeaterLbl.Text.Length - 7), Int16)
            '    Catch ex As InvalidCastException

            '    End Try
            'End If
            fores = ist_repeater(connectionString, 2)

            If fores > 0 Then
                repeaterLbl.Text = "repeat_" + fores.ToString
            Else
                repeaterLbl.Text = ""
            End If


        End If
    End Sub
    Private Sub apy_Btn_click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ApyBtn.Click
        Dim kwdikos As Integer

        If kwdikoKratisisDB = -1 Then
            kwdikos = sesionID
        Else
            kwdikos = kwdikoKratisisDB
        End If

        Dim form As New ApyFrm(kwdikos)
        form.StartPosition = FormStartPosition.CenterParent
        Try
            form.ShowDialog()
            form.Dispose()
        Catch ex As Exception

        End Try
        'Me.ApyTableAdapter.FillByKratisi(Me.DbhotelDataSet.apy, kwdikoKratisisDB)
    End Sub
    Private Sub nea_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim response As MsgBoxResult
        response = MsgBox(" Δεν αποθηκεύθηκαν οι αλλαγές ! Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
        If response = MsgBoxResult.Yes Then

            'delete_daten_von_system_absturz()
            Me.DbhotelDataSet.kratiseis.Clear()
            kwdikoKratisisDB = -1
            sesionID = get_sesion()
            init_ekptoseis()
            ReDim timokatalog(-1)
            kratiseis_zeig(False)
        End If

    End Sub
    'Private Sub delete_daten_von_system_absturz()
    '    Me.PaidiaTableAdapter.DeletePaidiaByKratisi(sesionID)
    '    Me.EnilikesTableAdapter.DeleteEnilikesByKratisi(sesionID)
    '    Me.ApyTableAdapter.DeleteApyByKratisi(sesionID)
    'End Sub
    Private Sub delete_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim response As MsgBoxResult
        Dim countDB As Int16

        If kwdikoKratisisDB <> -1 Then
            If status = 1 Then
                response = MsgBox(" ΠΡΟΣΟΧΗ: Να γίνει διαγραφή αυτής της Κράτησης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            ElseIf status = 2 Then
                MsgBox("ΠΡΟΣΟΧΗ: Ακύρωση της Αφιξης (χωρίς Διαγραφή της Κράτησης) γίνεται στο Μενού Κρατήσεις-Αφίξεις !" & vbCrLf & " Εδώ γίνεται μόνο Διαγραφή της Κράτησης!", MsgBoxStyle.Information, "winfo\nikEl.")

                response = MsgBox(" ΠΡΟΣΟΧΗ: Να γίνει οριστική διαγραφή αυτής της Κράτησης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            End If

            If response = MsgBoxResult.Yes Then

                Try
                    'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                    '   If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                    'If Not set_availabilities_all_deleted(kwdikoKratisisDB) Then
                    '    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'End If
                    'End If
                    'End If
                    If praktoreiokwd = 62 And currenttipos = 10 Then
                        If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                            If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                If Not set_availabilities_all_deleted_WEBHOTELIER(kwdikoKratisisDB) Then
                                    MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                End If
                            End If
                        End If
                    End If


                    If currenttipos > 0 And currenttipos < 13 Then
                        'TEST SQL SERVER 
                        Try

                            Dim calender As New GoogleCalendarNew(connectionString, kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).arithmos, "", Me.DbhotelDataSet.kratiseis(0).afixi, Me.DbhotelDataSet.kratiseis(0).anaxwrisi, Me.DbhotelDataSet.kratiseis(0).dwmatio, Me.DbhotelDataSet.kratiseis(0).dwmatio, "", "")
                            'calender.DeleteEvent("mv1rt76rgmgd63jg0d83st5tlk@group.calendar.google.com", "ia5006i4jupp2t42ihpuvdbi2s")
                            calender.delete_entry()
                            If currenttipos = 10 Then
                                calender.set_calendarid_thalasses(2)
                                calender.delete_entry()
                            End If

                        Catch ex As Exception
                            MsgBox(" Παρουσιάστηκε σφάλμα κατά την Ενημέρωση του Google Calendar: " + ex.Message, MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        End Try

                    End If
                    countDB = delete_kratisi_transaction(connectionString, kwdikoKratisisDB)

                Catch ex As SqlException
                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την διαδικασία Διαγραφής !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Exit Sub
                End Try
                If countDB = 1 Then
                    'Dim WebConn As New WebConnect.WebConnect
                    'Try
                    '    WebConn.Delete(kwdikoKratisisDB)
                    'Catch ex As Exception
                    '    MsgBox(" Παρουσιάστηκε σφάλμα ενημέρωσης του Web Server !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'End Try

                    MsgBox(" H Κράτηση διαγράφηκε !", MsgBoxStyle.Information, "winfo\nikEl.")

                    response = MsgBox(" Ενημέρωση Πρακτορείων?", MsgBoxStyle.YesNo, "winfo\nikEl.")
                    If response = MsgBoxResult.Yes Then

                        SendMailPrakt(DwmTbx.Text, 2)
                    End If


                ElseIf countDB = 0 Then
                    MsgBox(" Η Κράτηση εχει πιθανώς διαγραφεί από άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If

                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                'init_ekptoseis()
                ReDim timokatalog(-1)
                init_ekptoseis()
                kratiseis_zeig(False)
            End If
        Else
            MsgBox(" Δεν έχει επιλεχθεί Κράτηση προς Διαγραφή !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If
    End Sub
    Private Function delete_kratisi_transaction(ByVal connectionString As String, ByVal kwdikos As Integer) As Int16
        'Using connection As New OleDb.OleDbConnection(connectionString)
        '    Dim overKwd As Integer = -1
        '    Dim command As New OleDb.OleDbCommand()
        '    Dim transaction As OleDb.OleDbTransaction = Nothing
        '    Dim rows As Int16
        '    Try
        '        connection.Open()
        '        transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

        '        ' Assign transaction object for a pending local transaction.
        '        command.Connection = connection
        '        command.Transaction = transaction

        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM timeskratisis where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM paidia where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM enilikes where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM apy where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM status where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        If status = 2 Then
        '            command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '            command.CommandText = "SELECT kwd FROM over where (kratisi=?)"
        '            Dim myReader As OleDb.OleDbDataReader
        '            myReader = command.ExecuteReader()
        '            ' Always call Read before accessing data.
        '            While myReader.Read()
        '                overKwd = myReader.GetInt32(0)
        '            End While
        '            myReader.Close()
        '            If overKwd <> -1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
        '                command.Parameters.Clear()
        '                command.Parameters.AddWithValue("over", overKwd)
        '                command.CommandText = "DELETE FROM overunterkuenfte where (over=?)"
        '                command.ExecuteNonQuery()
        '                command.Parameters.Clear()

        '                command.Parameters.Clear()
        '                command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '                command.CommandText = "DELETE FROM over where (kratisi=?)"
        '                command.ExecuteNonQuery()
        '                command.Parameters.Clear()
        '            End If
        '            'command.Parameters.Clear()
        '            'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '            'command.CommandText = "DELETE FROM nonshow where (kratisi=?)"
        '            'command.ExecuteNonQuery()
        '            'command.Parameters.Clear()

        '            command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '            command.CommandText = "DELETE FROM biblioportas where (kratisi=?)"
        '            rows = command.ExecuteNonQuery()
        '            command.Parameters.Clear()
        '        End If

        '        command.Parameters.Clear()
        '        command.Parameters.AddWithValue("kwd", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM kratiseis where (kwd=?)"
        '        rows = command.ExecuteNonQuery()
        '        command.Parameters.Clear()


        '        transaction.Commit()
        '        Return rows
        '    Catch ex As Exception
        '        MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
        '        Try
        '            transaction.Rollback()
        '            Return -1
        '        Catch
        '            Return -1
        '        End Try

        '    End Try



        'End Using

        Using connection As New SqlConnection(connectionString)
            Dim overKwd As Integer = -1
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim rows As Integer

            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.AddWithValue("@kratisi", kwdikos)
                command.CommandText = "DELETE FROM timeskratisis WHERE (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                ' Continue with the rest of your code using SqlCommand and SqlConnection.
                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM paidia where (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM enilikes where (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM apy where (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM status where (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                If status = 2 Then
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.CommandText = "SELECT kwd FROM [over] where (kratisi=@kratisi)"
                    Dim myReader As SqlDataReader
                    myReader = command.ExecuteReader()
                    ' Always call Read before accessing data.
                    While myReader.Read()
                        overKwd = myReader.GetInt32(0)
                    End While
                    myReader.Close()
                    If overKwd <> -1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
                        command.Parameters.Clear()
                        command.Parameters.AddWithValue("@over", overKwd)
                        command.CommandText = "DELETE FROM overunterkuenfte where ([over]=@over)"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()

                        command.Parameters.Clear()
                        command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                        command.CommandText = "DELETE FROM [over] where (kratisi=@kratisi)"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()
                    End If

                    command.Parameters.Clear()

                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.CommandText = "DELETE FROM biblioportas where (kratisi=@kratisi)"
                    rows = command.ExecuteNonQuery()
                    command.Parameters.Clear()
                End If
                command.Parameters.Clear()
                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM eventarkratisi where (kratisi=@kratisi)"
                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.Clear()
                command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM telosdiamonis where (kratisi=@kratisi)"
                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.Clear()
                command.Parameters.AddWithValue("@kwd", CType(kwdikos, Integer))
                command.CommandText = "DELETE FROM kratiseis where (kwd=@kwd)"
                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()




                transaction.Commit()
                Return rows
            Catch ex As Exception
                ' Handle the exception and perform rollback if necessary.
                MsgBox("Η Διαδικασία απέτυχε!", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using

    End Function

    ' ton non show einai energopoihmeno MONO thn hmera tis Afixis
    'Private Sub non_show_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)

    '    update_stoixeia_diamenwnta(sender, e)

    '    If Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("Ov-Book") Then
    '        Me.NonshowTableAdapter.InsertNonShow(kwdikoKratisisDB, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), Nothing)
    '        'aNA HMERA EPITREPETAI MONO ENA EINTRAG GIA STATUS (ektos apo apli reservation) DWMATIOU (GIA MIA KRATISI)(MPOREI OMWS NA YPARXOUN PERISOTERA EINTRAEGE APO DIAFORETIKES KRATISEIS!)
    '        'ich gehe davon aus dass exist 1 Eintrag  status gia to (dwmatio, kratisi)apo tin afixi pou exw kanei proigoumenws(tin idia imera!)   
    '        Me.StatusTableAdapter.UpdateStatusDwmatiouByKratisiEnarxi(8, kwdikoKratisisDB, imeromErgasias)
    '        ButtonsPnl.Controls.Clear()
    '        'Me.male_timokatalogous_pnl(-1, -1, False)
    '        MsgBox(" Το Δωμάτιο " + DwmTbx.Text + " εχει πλέον Status n.S. (non Show). Για Αλλαγή κάνετε <CheckOut> ή σε περίπτωση εμφάνισης <εμφάνιση No Show>", MsgBoxStyle.Information, "winfo\nikEl.")
    '    Else
    '        MsgBox(" Εχει επιλεχθεί OVER για την Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
    '    End If
    '    update_paidia()
    '    Me.DbhotelDataSet.kratiseis.Clear()
    '    kwdikoKratisisDB = -1
    '    sesionID = get_sesion()
    '    init_ekptoseis()
    '    ReDim timokatalog(-1)
    '    kratiseis_zeig(False)
    'End Sub
    Private Sub non_show_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim response As MsgBoxResult
        Dim countDB As Int16

        If kwdikoKratisisDB <> -1 Then
            response = MsgBox(" Εισαγωγή αυτής της Κράτησης στις non show Κρατήσεις ;", MsgBoxStyle.YesNo, "winfo\nikEl.")

            If response = MsgBoxResult.Yes Then
                Me.NonshowkratiseisTableAdapter.InsertNonShowKratisi(ImeromKratTbx.Text, etos, Me.DbhotelDataSet.kratiseis(0).arithmos, Me.DbhotelDataSet.kratiseis(0).simbolaio,
                     praktoreiokwd, praktortimolkwd, Me.DbhotelDataSet.kratiseis(0).privatimologio, VoucherTbx.Text, Me.DbhotelDataSet.kratiseis(0).enilikes, Me.DbhotelDataSet.kratiseis(0).paidia,
                     Me.DbhotelDataSet.kratiseis(0).ethnikotites, Me.DbhotelDataSet.kratiseis(0).anzethnikotites, Me.DbhotelDataSet.kratiseis(0).ethnikotites2, Me.DbhotelDataSet.kratiseis(0).anzethnikotites2,
                      Me.DbhotelDataSet.kratiseis(0).afixi.Date, Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, currentklines, currenttipos, Me.DbhotelDataSet.kratiseis(0).guarantie, Me.DbhotelDataSet.kratiseis(0).dwmatio,
                      Me.DbhotelDataSet.kratiseis(0).synolo, OnomTbx1.Text, OnomTbx2.Text, OnomTbx3.Text, timokatalog(0).xrewsi)

                Try
                    countDB = delete_kratisi_transaction(connectionString, kwdikoKratisisDB)
                Catch ex As SqlException
                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την διαδικασία !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Exit Sub
                End Try
                If countDB = 1 Then
                    MsgBox(" Επιτυχής Διαδικασία !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'Dim WebConn As New WebConnect.WebConnect
                    'Try
                    '    WebConn.Delete(kwdikoKratisisDB)
                    'Catch ex As Exception
                    '    MsgBox(" Παρουσιάστηκε σφάλμα ενημέρωσης του Web Server !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'End Try


                ElseIf countDB = 0 Then
                    MsgBox(" Η Κράτηση εχει πιθανώς διαγραφεί από άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If

                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                'init_ekptoseis()
                ReDim timokatalog(-1)
                init_ekptoseis()
                kratiseis_zeig(False)
            End If
        Else
            MsgBox(" Στις Non Show Κρατήσεις μπαίνουν μόνο ήδη υπάρχουσες Κρατήσεις !", MsgBoxStyle.Information, "winfo\nikEl.")
        End If



        ''Dim praktoreiokwd, praktortimolkwd, currentklines, currenttipos, currentsimbolaio, praktXrewsKwd As Integer ' apoimeres
        'update_stoixeia_diamenwnta(sender, e)

        'If Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("Ov-Book") Then
        '    Me.NonshowTableAdapter.InsertNonShow(kwdikoKratisisDB, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), Nothing)
        '    'aNA HMERA EPITREPETAI MONO ENA EINTRAG GIA STATUS (ektos apo apli reservation) DWMATIOU (GIA MIA KRATISI)(MPOREI OMWS NA YPARXOUN PERISOTERA EINTRAEGE APO DIAFORETIKES KRATISEIS!)
        '    'ich gehe davon aus dass exist 1 Eintrag  status gia to (dwmatio, kratisi)apo tin afixi pou exw kanei proigoumenws(tin idia imera!)   
        '    Me.StatusTableAdapter.UpdateStatusDwmatiouByKratisiEnarxi(8, kwdikoKratisisDB, imeromErgasias)
        '    ButtonsPnl.Controls.Clear()
        '    'Me.male_timokatalogous_pnl(-1, -1, False)
        '    MsgBox(" Το Δωμάτιο " + DwmTbx.Text + " εχει πλέον Status n.S. (non Show). Για Αλλαγή κάνετε <CheckOut> ή σε περίπτωση εμφάνισης <εμφάνιση No Show>", MsgBoxStyle.Information, "winfo\nikEl.")
        'Else
        '    MsgBox(" Εχει επιλεχθεί OVER για την Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        'End If
        'update_paidia()
        'Me.DbhotelDataSet.kratiseis.Clear()
        'kwdikoKratisisDB = -1
        'sesionID = get_sesion()
        'init_ekptoseis()
        'ReDim timokatalog(-1)
        'kratiseis_zeig(False)
    End Sub
    Private Sub delete_nonshow_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim response As MsgBoxResult
        Dim countDB As Int16

        If kwdikoKratisisDB <> -1 Then
            If status = 1 Then
                response = MsgBox(" ΠΡΟΣΟΧΗ: Να γίνει διαγραφή αυτής της Κράτησης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            ElseIf status = 2 Then
                MsgBox("ΠΡΟΣΟΧΗ: Ακύρωση της Αφιξης (χωρίς Διαγραφή της Κράτησης) γίνεται στο Μενού Κρατήσεις-Αφίξεις !" & vbCrLf & " Εδώ γίνεται μόνο Διαγραφή της Κράτησης!", MsgBoxStyle.Information, "winfo\nikEl.")

                response = MsgBox(" ΠΡΟΣΟΧΗ: Να γίνει οριστική διαγραφή αυτής της Κράτησης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            End If

            If response = MsgBoxResult.Yes Then

                Try
                    countDB = delete_kratisi_transaction(connectionString, kwdikoKratisisDB)
                Catch ex As SqlException
                    MsgBox(" Παρουσιάστηκε σφάλμα κατά την διαδικασία Διαγραφής !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Exit Sub
                End Try
                If countDB = 1 Then
                    MsgBox(" H Κράτηση διαγράφηκε !", MsgBoxStyle.Information, "winfo\nikEl.")
                    'Dim WebConn As New WebConnect.WebConnect
                    'Try
                    '    WebConn.Delete(kwdikoKratisisDB)
                    'Catch ex As Exception
                    '    MsgBox(" Παρουσιάστηκε σφάλμα ενημέρωσης του Web Server !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    'End Try
                ElseIf countDB = 0 Then
                    MsgBox(" Η Κράτηση εχει πιθανώς διαγραφεί από άλλον User !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If

                Me.DbhotelDataSet.kratiseis.Clear()
                kwdikoKratisisDB = -1
                sesionID = get_sesion()
                'init_ekptoseis()
                ReDim timokatalog(-1)
                init_ekptoseis()
                kratiseis_zeig(False)
            End If
        Else
            MsgBox(" Δεν έχει επιλεχθεί Κράτηση προς Διαγραφή !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If
    End Sub
    'Private Sub show_kratisi(ByVal sender As System.Object, ByVal e As System.EventArgs)
    '    Dim apo As Date
    '    apo = Me.NonshowTableAdapter.GetImeromApo(kwdikoKratisisDB)
    '    'nONsHOW -EINTRAEGE EPITREPONTAI MONO 1(EAN THN IDIA MERA KANW NONSHOW KAI KAPAKI META SHOW->TO EINTRAG DIAGRAFETAI)
    '    'EAN EMFANISTEI SE DIAFORETIKH HMERA -> APLA ENIMERONW TO 'MEXRI' STO DB (PAIRNEI IMEROMINIAERGASIAS -1 HMERA)
    '    If apo = imeromErgasias Then 'idia mera me afixi
    '        Me.NonshowTableAdapter.DeleteNonShowByKratisi(kwdikoKratisisDB)
    '        Me.StatusTableAdapter.UpdateStatusDwmatiouByKratisiEnarxi(5, kwdikoKratisisDB, imeromErgasias) 'ginetai STAY
    '    Else
    '        Me.NonshowTableAdapter.UpdateNonShowSetMexriByKratisi(imeromErgasias.AddDays(-1), kwdikoKratisisDB) 'lixi setzen
    '        'lixi setzen by status
    '        Me.StatusTableAdapter.BefreieDwmByKratisiLixiDwmatio(imeromErgasias.AddDays(-1), kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).dwmatio, imeromErgasias)
    '        Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value.Date, 1)
    '    End If
    '    'ean o user alakse ton ar dwmatiou xwris na kanei speichern->update dwmtio sto table twn Kratisewn
    '    ButtonsPnl.Controls.Clear()
    '    Me.male_timokatalogous_pnl(-1, -1, False, 2)
    '    MsgBox(" Το Δωμάτιο " + DwmTbx.Text + " έχει πλέον Status S (Stay)!", MsgBoxStyle.Information, "winfo\nikEl.")
    '    'NonShowLbl.Text = ""
    'End Sub
    'ALLAGH DWMATIOU!!!!!!!!!!!!!!!!!1]
    Private Sub DwmTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmTbx.Leave
        Dim count, j As Int16
        Dim existOK As Boolean = False
        Dim anaforaDwm, info As String
        Dim afixi, anaxwrisi As Date
        anaforaDwm = "Status Δωματίου " + sender.text + " :"
        If Not sender.text.Equals("") Then
            If status = 2 AndAlso Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals(sender.text) AndAlso imeromErgasias = DateTimePicker3.Value.Date Then
                MsgBox(" Δεν είναι δυνατή η αλλαγή Δωματίου κατά την Ημέρα Αναχώρησης  !", MsgBoxStyle.Critical, "winfo\nikEl.")
                sender.text = Me.DbhotelDataSet.kratiseis(0).dwmatio
                Exit Sub
            End If

            ', currentklines, currenttipo
            Try
                Me.Cursor = Cursors.WaitCursor
                If imeromErgasias <= DateTimePicker2.Value.Date Then
                    afixi = DateTimePicker2.Value.Date
                Else
                    afixi = imeromErgasias
                End If

                anaxwrisi = DateTimePicker3.Value.AddDays(-1).Date

                Me.StatusTableAdapter.StatusDwmatiouByDiamoni(Me.DbhotelDataSet.status, kwdikoKratisisDB, sender.text, afixi, afixi, kwdikoKratisisDB, sender.text, anaxwrisi, anaxwrisi, kwdikoKratisisDB, sender.text, afixi, anaxwrisi)

                If Me.DbhotelDataSet.status.Count <> 0 Then
                    existOK = True
                    For j = 0 To Me.DbhotelDataSet.status.Count - 1
                        If Me.DbhotelDataSet.status(j).dwmatiostatus = 5 Then
                            info = "Κατειλημμένο " + Me.DbhotelDataSet.status(j).enarxi + " μέχρι και " + Me.DbhotelDataSet.status(j).lixi + " (Αρ.Κρατ.: " + Me.DbhotelDataSet.status(j).arithmos.ToString + ")"

                            anaforaDwm = anaforaDwm + ChrW(13) + info


                            'MsgBox(" Το Δωμάτιο " + DwmTbx.Text + " είναι κατειλημμένο!", MsgBoxStyle.Information, "winfo\nikEl.")
                            'Exit Sub
                        ElseIf (Me.DbhotelDataSet.status(j).dwmatiostatus = 1) Then
                            info = "Reservation " + Me.DbhotelDataSet.status(j).enarxi + " μέχρι και " + Me.DbhotelDataSet.status(j).lixi + " (Αρ.Κρατ.: " + Me.DbhotelDataSet.status(j).arithmos.ToString + ")"
                            anaforaDwm = anaforaDwm + ChrW(13) + info
                            'MsgBox(" Υπάρχει Reservation για το Δωμάτιο " + DwmTbx.Text + " !", MsgBoxStyle.Information, "winfo\nikEl.")
                            'Exit Sub
                        End If
                    Next
                    MsgBox(anaforaDwm, MsgBoxStyle.Information, "winfo\nikEl.")
                Else

                    Me.StatusTableAdapter.FillStatusForExternalViles(Me.DbhotelDataSet.status, sender.text, afixi, afixi, sender.text, anaxwrisi, anaxwrisi, sender.text, afixi, anaxwrisi)
                    If Me.DbhotelDataSet.status.Count <> 0 Then
                        info = "Not available " + Me.DbhotelDataSet.status(j).enarxi + " μέχρι και " + Me.DbhotelDataSet.status(j).lixi

                        anaforaDwm = anaforaDwm + ChrW(13) + info
                        MsgBox(anaforaDwm, MsgBoxStyle.Information, "winfo\nikEl.")
                    Else

                        count = Me.DwmatiaTableAdapter.ExistArDwmatiou(sender.text)
                        If count = 0 And Not DwmTbx.Text.Equals("OV-BOOK") Then
                            MsgBox(" Δεν υπάρχει αυτό το Δωμάτιο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            sender.clear()
                            sender.focus()
                            Me.Cursor = Cursors.Default
                            Exit Sub
                        Else
                            'If currenttipos = 11 Then ' URBAN
                            '    Me.KratiseisTableadpter1.FilMinAfixiMaxAnaxwrisiEtosUrban(Me.DbhotelDataSet1.kratiseis, etos, sender.Text)
                            '    Dim DaysStayed As Int32 = Me.DbhotelDataSet1.kratiseis(0).afixi.Subtract(Me.DbhotelDataSet1.kratiseis(0).afixi).Days

                            '    If DaysStayed > 90 Then
                            '        MsgBox("Υπέρβαση του τριμήνου!", MsgBoxStyle.Exclamation)
                            '        'Else
                            '        '    MsgBox("ασδασδασου τριμήνου!", MsgBoxStyle.Exclamation)

                            '    End If

                            'End If
                            count = 0
                            If currentklines > 0 Or currenttipos > 0 Then
                                count = Me.DwmatiaTableAdapter.IstDwmatioVomKatigoria(sender.text, currenttipos, sender.text, currentklines)
                                If count = 0 Then
                                    MsgBox(" Δωμάτιο άλλης Κατηγορίας !", MsgBoxStyle.Information, "winfo\nikEl.")
                                End If
                            End If
                        End If



                    End If




                End If


            Catch ex As System.Exception
                Me.Cursor = Cursors.Default
                System.Windows.Forms.MessageBox.Show(ex.Message)

            End Try
            Me.Cursor = Cursors.Default

        End If
        If status = 2 AndAlso DwmTbx.Text.Equals("") Then
            MsgBox(" Δώστε Αριθμό Δωματίου !", MsgBoxStyle.Information, "winfo\nikEl.")
            DwmTbx.Text = Me.DbhotelDataSet.kratiseis(0).dwmatio
        End If
    End Sub
    Private Function allagi_dwmatiou_ok() As Boolean
        'Dim response As MsgBoxResult
        Dim counter As Int16
        If status = 2 Then ' diamenwntes
            Try
                If Not DwmTbx.Text.Equals("") AndAlso DwmTbx.Text <> Me.DbhotelDataSet.kratiseis(0).dwmatio Then
                    If Not Me.DbhotelDataSet.kratiseis(0).dwmatio.Equals("OV-BOOK") Then 'Allagi Dwmatiou (allo Noumero (oxi keno!))
                        '  If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                        If Not DwmTbx.Text.Equals("OV-BOOK") Then
                            'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                            '    If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                            '        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            '    End If
                            'End If
                            If praktoreiokwd = 62 And currenttipos = 10 Then
                                If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then
                                    If Not DwmTbx.Text.Equals("OV-BOOK") Then
                                        If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                            MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                        End If
                                    End If
                                End If
                            End If
                        End If
                        'End If
                        If imeromErgasias = Me.DbhotelDataSet.kratiseis(0).afixi.Date Then 'allagh epitopou tin idia mera afixis
                            Me.StatusTableAdapter.ZimmerAnaxWechselByKratEnarxiDwmalt(DwmTbx.Text, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB, imeromErgasias, Me.DbhotelDataSet.kratiseis(0).dwmatio)
                        Else
                            counter = Me.StatusTableAdapter.BefreieDwmByKratisiLixiDwmatioEnarxi(imeromErgasias.AddDays(-1), kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).dwmatio, imeromErgasias, imeromErgasias) '.AddDays(-1),
                            'MsgBox(counter)
                            'belege neu
                            If counter = 0 Then
                                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date <> imeromErgasias Then 'to dwmATIO EXEI KATA PASA PITHANOTHTA ENARXI STATUS TIN IDIA HMEROMINIA ME ERGASIAS ->KANE update to uparxon status me to neo dwmatio
                                    Me.StatusTableAdapter.ZimmerAnaxWechselByKratEnarxiDwmalt(DwmTbx.Text, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB, imeromErgasias, Me.DbhotelDataSet.kratiseis(0).dwmatio)
                                Else ' FALL: To dwmatio einai schon apo mono tou befreit (logw epimikinsis anaxwrisis epeilaptettai i lixi)->apla insert to neo dwmatio status
                                    Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value.AddDays(-1), 5)
                                End If
                            Else 'meta apo befreiung tou paliou insert neu dwmatio status
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value.AddDays(-1), 5)
                            End If
                        End If
                        'Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                    ElseIf Not DwmTbx.Text.Equals("") Then 'Htan OVER BOOK!!!! kai pernei DWMATIO (oxi keno Dwmatio)
                        ' If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 4 OrElse praktortimolkwd = 43 OrElse praktortimolkwd = 50) Then
                        If Not DwmTbx.Text.Equals("OV-BOOK") Then
                            'If praktoreiokwd = 48 Or praktoreiokwd = 49 Then
                            '    If Not set_availabilities_all_status(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                            '        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του HotelAvailabilities ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                            '    End If
                            'End If
                            If praktoreiokwd = 62 And currenttipos = 10 Then
                                If Not (praktortimolkwd = 2 OrElse praktortimolkwd = 43) Then

                                    If Not set_availabilities_all_status_WEBHOTELIER(DwmTbx.Text, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB) Then
                                        MsgBox("Παρουσιάστηκε πρόβλημα στην Ενημέρωση του Webhotelier ", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                                    End If

                                End If
                            End If
                        End If
                        'End If
                        If imeromErgasias = Me.DbhotelDataSet.kratiseis(0).afixi.Date Then 'AKYROSI TOU OVER THN IDIA MERA THS AFIXIS
                            loesche_over_by_kratisi()
                            'Me.KratiseisTableAdapter.UpdateArDwmatiouByKwd(sender.text, kwdikoKratisisDB)
                            Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value.AddDays(-1), 5)
                            'Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                        Else 'EPISTROFI OVER
                            kleisimo_over(imeromErgasias.AddDays(-1))
                            'imeromErgasias = "27/5/2007"
                            If imeromErgasias = Me.DbhotelDataSet.kratiseis(0).afixi.Date Then 'allagh epitopou tin idia mera afixis
                                Me.StatusTableAdapter.ZimmerAnaxWechselByKratEnarxiDwmalt(DwmTbx.Text, Me.DateTimePicker3.Value.Date.AddDays(-1), kwdikoKratisisDB, imeromErgasias, Me.DbhotelDataSet.kratiseis(0).dwmatio)
                            Else
                                'Prosoxi kano befreien to dwmatio pou einai stis kratiseis->gia na brw to richtige Eintrag sta Status kanw Abfrage gia tin kratisi to Dwmatio kai 
                                'tin imerominia lixi tou Eintrag->ean exei polaples allages dwmativm oi anenerges exoun idi LIKSI autin imeromergasias (also simera) 
                                Me.StatusTableAdapter.InsertStatusDwmatiou(DwmTbx.Text, kwdikoKratisisDB, imeromErgasias, DateTimePicker3.Value.AddDays(-1), 5)

                            End If
                            'Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                        End If
                    End If
                End If
            Catch ex As Exception
                Return False
            End Try

        End If

        Return True

    End Function
    'Public Function execute_allagi_dwmatiou_transaction(ByVal connectionString As String, ByVal kwdikos As Integer, ByVal afixi As Date, ByVal overOK As Boolean, ByVal ekptosiOK As Boolean, ByVal countPaid As Int16)
    '    Using connection As New OleDb.OleDbConnection(connectionString)
    '        Dim command As New OleDb.OleDbCommand()
    '        Dim transaction As OleDb.OleDbTransaction = Nothing
    '        Dim rows, j As Int16
    '        Dim arDwmat As String = ""
    '        'Dim countTimesKrat As Int16
    '        Dim paratiriseis As String = ""

    '        Try
    '            connection.Open()
    '            transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '            ' Assign transaction object for a pending local transaction.
    '            command.Connection = connection
    '            command.Transaction = transaction

    '            If overOK Then
    '                command.Parameters.AddWithValue("dwmatio", CType("Ov-Book", String))
    '            Else
    '                command.Parameters.AddWithValue("dwmatio", CType(DwmTbx.Text, String))
    '            End If
    '            command.Parameters.AddWithValue("kwd", CType(kwdikos, Integer))
    '            command.CommandText = "UPDATE kratiseis SET  dwmatio=? where (kwd=?)"
    '            rows = command.ExecuteNonQuery()
    '            command.Parameters.Clear()

    '            If rows <> 1 Then
    '                transaction.Rollback()
    '                Return 0
    '            End If
    '            'For j = 0 To timokatalog.Length - 1
    '            '    If timokatalog(j).mexriDB >= imeromErgasias AndAlso timokatalog(j).apo <= imeromErgasias Then
    '            '        Exit For
    '            '    End If
    '            'Next
    '            'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
    '            ''    command.Parameters.AddWithValue("imerominia", CType(timokatalog(j - 1).apo, Date))
    '            'command.CommandText = "SELECT * FROM biblioportas where (kratisi=?)and (status=1) ORDER BY imerominia DESC"

    '            'Dim myReader As OleDb.OleDbDataReader
    '            'myReader = command.ExecuteReader(CommandBehavior.SingleRow)
    '            ''While myReader.Read()
    '            ''    MsgBox(myReader.Item("imerominia"))
    '            ''End While
    '            'myReader.Read()
    '            'command.Parameters.Clear()

    '            'If myReader.Item("imerominia") = imeromErgasias Then 'EXEI GRAFEI IDI STO BIBLIO PORTAS->IDIA MERA
    '            '    If overOK Then
    '            '        arDwmat = ""
    '            '    Else
    '            '        arDwmat = Me.DwmTbx.Text
    '            '    End If
    '            '    command.Parameters.AddWithValue("dwmatio", CType(arDwmat, String))
    '            '    command.Parameters.AddWithValue("enilikes", CType(EnilikTbx.Text, Int16))
    '            '    command.Parameters.AddWithValue("anilika", CType(countPaid, Int16))
    '            '    command.Parameters.AddWithValue("atoma", CType(EnilikTbx.Text + countPaid, Int16))
    '            '    command.Parameters.AddWithValue("xrewsi", CType(timokatalog(j).xrewsi, Integer))
    '            '    command.Parameters.AddWithValue("onomateponimo", CType(OnomTbx1.Text, String))
    '            '    command.Parameters.AddWithValue("anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita", CType(EthnKwd1.Text, Int16))
    '            '    command.Parameters.AddWithValue("anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita2", CType(EthnKwd2.Text, Int16))
    '            '    command.Parameters.AddWithValue("praktoreio", CType(praktoreiokwd, Integer))
    '            '    command.Parameters.AddWithValue("ypnos", CType(timokatalog(j).ypnos, Single))
    '            '    command.Parameters.AddWithValue("prwino", CType(timokatalog(j).prwino, Single))
    '            '    command.Parameters.AddWithValue("geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
    '            '    command.Parameters.AddWithValue("extras", CType(timokatalog(j).paroxi, Single))
    '            '    command.Parameters.AddWithValue("synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
    '            '    command.Parameters.AddWithValue("datum", CType(myReader.Item("datum"), Date))
    '            '    If Me.DwmTbx.Text.Equals("Ov-Book") OrElse ekptosiOK OrElse overOK Then
    '            '        paratiriseis = ""
    '            '        If Me.DwmTbx.Text.Equals("Ov-Book") OrElse overOK Then
    '            '            paratiriseis = "Ov-Book "
    '            '        End If
    '            '        If ekptosiOK Then
    '            '            paratiriseis = paratiriseis + "Εκπτωση"
    '            '        End If
    '            '    Else
    '            '        paratiriseis = ""
    '            '    End If
    '            '    command.Parameters.AddWithValue("paratiriseis", CType(paratiriseis, String))
    '            '    command.Parameters.AddWithValue("imerominia", CType(imeromErgasias, Date))
    '            '    command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
    '            '    command.CommandText = "UPDATE biblioportas set dwmatio=?, enilikes=?, anilika=?, atoma=?, xrewsi=?, onomateponimo=?, anzethnikotita=?, ethnikotita=?,anzethnikotita2=?,ethnikotita2=?,praktoreio=?, ypnos=?, prwino=?, geumata=?, extras=?, synolo=?,datum=?, paratiriseis=? where (imerominia=?) and (status=1) and (kratisi=?) " 'and 
    '            '    'command.CommandText = "UPDATE biblioportas set dwmatio=?, paratiriseis=?, flag=0 where (kratisi=?)"
    '            '    myReader.Close()
    '            '    rows = command.ExecuteNonQuery()
    '            '    command.Parameters.Clear()
    '            'Else 'EPISTROFI  (ALLI MERA APO AFIXI)

    '            '    command.Parameters.AddWithValue("etos", CType(myReader.Item("etos"), Integer))
    '            '    command.Parameters.AddWithValue("imerominia", CType(imeromErgasias, Date))
    '            '    command.Parameters.AddWithValue("status", CType(2, Byte)) ' anaxwrisi
    '            '    command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
    '            '    command.Parameters.AddWithValue("voucher", CType(myReader.Item("voucher"), String))
    '            '    command.Parameters.AddWithValue("dwmatio", CType(myReader.Item("dwmatio"), String)) 'Me.DbhotelDataSet.kratiseis(0).dwmatio
    '            '    command.Parameters.AddWithValue("enilikes", CType(myReader.Item("enilikes"), Int16))
    '            '    command.Parameters.AddWithValue("anilika", CType(myReader.Item("anilika"), Int16))
    '            '    command.Parameters.AddWithValue("atoma", CType(myReader.Item("atoma"), Int16))
    '            '    command.Parameters.AddWithValue("xrewsi", CType(myReader.Item("xrewsi"), Integer))
    '            '    command.Parameters.AddWithValue("onomateponimo", CType(myReader.Item("onomateponimo"), String))
    '            '    command.Parameters.AddWithValue("anzethnikotita", CType(myReader.Item("anzethnikotita"), Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita", CType(myReader.Item("ethnikotita"), Int16))
    '            '    command.Parameters.AddWithValue("anzethnikotita2", CType(myReader.Item("anzethnikotita2"), Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita2", CType(myReader.Item("ethnikotita2"), Int16))
    '            '    command.Parameters.AddWithValue("praktoreio", CType(myReader.Item("praktoreio"), Integer))
    '            '    command.Parameters.AddWithValue("ypnos", CType(myReader.Item("ypnos"), Single))
    '            '    command.Parameters.AddWithValue("prwino", CType(myReader.Item("prwino"), Single))
    '            '    command.Parameters.AddWithValue("geumata", CType(myReader.Item("geumata"), Single))
    '            '    command.Parameters.AddWithValue("extras", CType(myReader.Item("extras"), Single))
    '            '    command.Parameters.AddWithValue("synolo", CType(myReader.Item("synolo"), Single))
    '            '    command.Parameters.AddWithValue("datum", CType(myReader.Item("datum"), Date))
    '            '    command.Parameters.AddWithValue("paratiriseis", CType(myReader.Item("paratiriseis"), String))
    '            '    command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," & _
    '            '    "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) values (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma," & _
    '            '    "xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2,praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, 0)"
    '            '    myReader.Close()
    '            '    command.ExecuteNonQuery()
    '            '    command.Parameters.Clear()


    '            '    'epeita afixi sto Dwmatio


    '            '    'For j = 0 To timokatalog.Length - 1
    '            '    '    If timokatalog(j).mexriDB >= imeromErgasias AndAlso timokatalog(j).apo <= imeromErgasias Then
    '            '    '        Exit For
    '            '    '    End If
    '            '    'Next
    '            '    command.Parameters.AddWithValue("etos", CType(etos, Integer))
    '            '    command.Parameters.AddWithValue("imerominia", CType(imeromErgasias, Date))
    '            '    command.Parameters.AddWithValue("status", CType(1, Byte))
    '            '    command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
    '            '    command.Parameters.AddWithValue("voucher", CType(Me.VoucherTbx.Text, String))
    '            '    If overOK Then
    '            '        arDwmat = ""
    '            '    Else
    '            '        arDwmat = Me.DwmTbx.Text
    '            '    End If
    '            '    command.Parameters.AddWithValue("dwmatio", CType(arDwmat, String))
    '            '    command.Parameters.AddWithValue("enilikes", CType(EnilikTbx.Text, Int16))
    '            '    command.Parameters.AddWithValue("anilika", CType(countPaid, Int16))
    '            '    command.Parameters.AddWithValue("atoma", CType(EnilikTbx.Text + countPaid, Int16))
    '            '    command.Parameters.AddWithValue("xrewsi", CType(timokatalog(j).xrewsi, Integer))
    '            '    command.Parameters.AddWithValue("onomateponimo", CType(OnomTbx1.Text, String))
    '            '    command.Parameters.AddWithValue("anzethnikotita", CType(EthnAnzTbx1.Text, Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita", CType(EthnKwd1.Text, Int16))
    '            '    command.Parameters.AddWithValue("anzethnikotita2", CType(EthnAnzTbx2.Text, Byte))
    '            '    command.Parameters.AddWithValue("ethnikotita2", CType(EthnKwd2.Text, Int16))
    '            '    command.Parameters.AddWithValue("praktoreio", CType(praktoreiokwd, Integer))
    '            '    command.Parameters.AddWithValue("ypnos", CType(timokatalog(j).ypnos, Single))
    '            '    command.Parameters.AddWithValue("prwino", CType(timokatalog(j).prwino, Single))
    '            '    command.Parameters.AddWithValue("geumata", CType(timokatalog(j).geuma + timokatalog(j).deipno, Single))
    '            '    command.Parameters.AddWithValue("extras", CType(timokatalog(j).paroxi, Single))
    '            '    command.Parameters.AddWithValue("synolo", CType((timokatalog(j).ypnos + timokatalog(j).prwino + timokatalog(j).deipno + timokatalog(j).geuma + timokatalog(j).paroxi), Single))
    '            '    command.Parameters.AddWithValue("datum", CType(DateTimePicker3.Value, Date))
    '            '    If overOK OrElse ekptosiOK Then
    '            '        paratiriseis = ""
    '            '        If overOK Then
    '            '            paratiriseis = "Ov-Book "
    '            '            '    arDwmat = Nothing
    '            '            'Else
    '            '            '    arDwmat=
    '            '        End If
    '            '        If ekptosiOK Then
    '            '            paratiriseis = paratiriseis + "Εκπτωση"
    '            '        End If
    '            '    Else
    '            '        paratiriseis = ""
    '            '    End If

    '            '    command.Parameters.AddWithValue("paratiriseis", CType(paratiriseis, String))
    '            '    command.CommandText = "INSERT INTO biblioportas (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma, xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2," & _
    '            '    "praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, flag) values (etos, imerominia, status, kratisi, voucher, dwmatio, enilikes, anilika, atoma," & _
    '            '    "xrewsi, onomateponimo, anzethnikotita, ethnikotita, anzethnikotita2, ethnikotita2,praktoreio, ypnos, prwino, geumata, extras, synolo, datum, paratiriseis, 0)"

    '            '    command.ExecuteNonQuery()
    '            '    command.Parameters.Clear()
    '            'End If
    '            'dwmatioChanged = True
    '            transaction.Commit()
    '            Return rows
    '        Catch ex As Exception
    '            MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
    '            Try
    '                transaction.Rollback()
    '                Return -1
    '            Catch
    '                Return -1
    '            End Try
    '        End Try
    '    End Using
    'End Function
    'Dim tt As ToolTip


    Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EpithimTbx.MouseClick
        'initialize tt with 'New' keyword



        'set tooltip for any control here
        'don't put this in the mousehover event, 
        'or it'll keep running this code every time it fires

        tooltip.Show(EpithimTbx.Text, EpithimTbx)

    End Sub
    Private Sub DwmatFreeBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmatFreeBtn.Click
        Dim klines, tipos As Integer
        Dim dwmArith As String
        Dim index As Int16
        If DateTimePicker2.Value.Date < DateTimePicker3.Value.Date Then
            Try
                klines = Me.get_kwd_klins_byname(KlinesCbx.SelectedItem.ToString)
            Catch ex As NullReferenceException
                klines = 0
            End Try
            If klines = -1 Then
                klines = 0
            End If
            Try
                tipos = Me.get_kwd_tipos_byname(TipiCbx.SelectedItem.ToString)
            Catch ex As Exception
                tipos = 0
            End Try
            If tipos = -1 Then
                tipos = 0
            End If

            Dim form1 As New FreeDwmatia(DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1), klines, tipos)
            'form1.Text = "Ελεύθερα Δωμάτια " + DateTimePicker2.Value.Date + "-" + DateTimePicker3.Value.Date
            form1.ShowDialog()
            dwmArith = form1.return_arithmo_dwmatiou()
            If dwmArith <> Nothing Then
                DwmTbx.Text = form1.return_arithmo_dwmatiou()
                'DOMISI-> apenergopoiisi klinwn!!!
                If klines = 0 Then
                    klines = form1.return_klines_dwmatiou
                    index = get_index_klines(klines)
                    KlinesCbx.SelectedIndex = index + 1
                End If
                If tipos = 0 Then
                    tipos = form1.return_tipos_dwmatiou()
                    index = get_index_tipos(tipos)
                    TipiCbx.SelectedIndex = index + 1
                End If

            End If

            form1.Dispose()
        Else
            MsgBox(" Λάθος Ημερομηνίες !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End If
    End Sub
    Private Sub DwmSucheImeromBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmSucheImeromBtn.Click
        Dim klines, tipos As Integer
        Dim dwmArith As String
        Dim index As Int16
        Try
            klines = Me.get_kwd_klins_byname(KlinesCbx.SelectedItem.ToString)
        Catch ex As NullReferenceException
            klines = 0
        End Try
        If klines = -1 Then
            klines = 0
        End If
        Try
            tipos = Me.get_kwd_tipos_byname(TipiCbx.SelectedItem.ToString)
        Catch ex As Exception
            tipos = 0
        End Try
        If tipos = -1 Then
            tipos = 0
        End If
        If DateTimePicker2.Value.Date <= DateTimePicker3.Value.Date.AddDays(-1) Then
            Dim form1 As New FreeDwmatImerom(klines, tipos, DateTimePicker2.Value.Date, DateTimePicker3.Value.Date.AddDays(-1))
            'form1.Text = "Ελεύθερα Δωμάτια " + DateTimePicker2.Value.Date + "-" + DateTimePicker3.Value.Date
            form1.ShowDialog()
            dwmArith = form1.return_arithmo_dwmatiou()
            If dwmArith <> Nothing Then
                DwmTbx.Text = form1.return_arithmo_dwmatiou()
                'DOMISI-> apenergopoiisi klinwn!!!
                If klines = 0 Then
                    klines = form1.return_klines_dwmatiou
                    index = get_index_klines(klines)
                    KlinesCbx.SelectedIndex = index + 1
                End If
                If tipos = 0 Then
                    tipos = form1.return_tipos_dwmatiou()
                    index = get_index_tipos(tipos)
                    TipiCbx.SelectedIndex = index + 1
                End If

            End If


            form1.Dispose()
        End If
    End Sub
    Private Sub DwmatiaKratisisBtn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles DwmatiaKratisisBtn.Click
        'imeromErgasias = imeromErgasias.AddDays(+3)
        If kwdikoKratisisDB <> -1 Then
            Dim form1 As New DwmatiaKratisis(kwdikoKratisisDB, Me.DbhotelDataSet.kratiseis(0).afixi.Date, Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date, Me.DbhotelDataSet.kratiseis(0).checkin)
            form1.Text = "Δωμάτια Διαμονής Κράτησης " + Me.DbhotelDataSet.kratiseis(0).arithmos.ToString
            form1.ShowDialog()
            form1.Dispose()
        End If

    End Sub
    Private Sub loesche_over_by_kratisi()
        Dim kwdikosOv As Integer
        If status = 2 Then
            Try
                kwdikosOv = Me.OverTableAdapter.GetKwdByKratisi(kwdikoKratisisDB, False)
            Catch ex As InvalidOperationException
                MsgBox(" Δεν υπάρχει καταχώριση Over !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End Try
            Me.OverunterkuenfteTableAdapter.DeleteUnterkByOver(kwdikosOv)
            Me.OverTableAdapter.DeleteOverByKwd(kwdikosOv)
        End If
    End Sub
    Private Sub kleisimo_over(ByVal mexriOver As Date)
        Dim kwdikosOv, kwdUnterkunft As Integer
        If status = 2 Then
            Try
                kwdikosOv = Me.OverTableAdapter.GetKwdByKratisi(kwdikoKratisisDB, False) 'finde ENERGO over->epistrofiOK=false!!! 
            Catch ex As InvalidOperationException
                MsgBox(" Δεν υπάρχει καταχώριση Over !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End Try
            Me.DbhotelDataSet.overunterkuenfte.Clear()
            Me.OverunterkuenfteTableAdapter.FillByOver(Me.DbhotelDataSet.overunterkuenfte, kwdikosOv)
            If mexriOver >= Me.OverTableAdapter.GetImeromKataxBykwd(kwdikosOv) Then
                If Me.DbhotelDataSet.overunterkuenfte.Count <> 0 Then
                    kwdUnterkunft = Me.DbhotelDataSet.overunterkuenfte(Me.DbhotelDataSet.overunterkuenfte.Count - 1).kwd
                    Me.OverunterkuenfteTableAdapter.SetImeromMexriByKwd(mexriOver, kwdUnterkunft)
                End If
                Me.OverTableAdapter.CloseOverByKwd(mexriOver, True, kwdikosOv)
            Else
                Me.OverunterkuenfteTableAdapter.DeleteUnterkByOver(kwdikosOv)
                Me.OverTableAdapter.DeleteOverByKwd(kwdikosOv)
            End If
        End If
    End Sub
    Private Sub paidia_btn_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button4.Click
        Dim form As New PaidiaFrm(kwdikoKratisisDB)
        Dim j, count As Int16
        Dim find() As Control

        If kwdikoKratisisDB <> -1 Then
            form.ShowDialog()

            form.Dispose()
            Me.PaidiaTableAdapter.FillByKratisi(Me.DbhotelDataSet.paidia, kwdikoKratisisDB)

            If Me.DbhotelDataSet.paidia.Count <= 3 Then
                count = Me.DbhotelDataSet.paidia.Count
            Else
                count = 3
            End If
            PaidiTbx1.Clear()
            PaidiTbx2.Clear()
            PaidiTbx3.Clear()
            CotTbx1.Clear()
            CotTbx2.Clear()
            CotTbx3.Clear()
            For j = 0 To count - 1
                find = Kratiseis2Pnl.Controls.Find("CotTbx" + (j + 1).ToString, False)
                find(0).Text = Me.DbhotelDataSet.paidia(j).cot
                find = Kratiseis2Pnl.Controls.Find("PaidiTbx" + (j + 1).ToString, False)
                find(0).Text = Me.DbhotelDataSet.paidia(j).ilikia
            Next
        Else
            MsgBox(" Υπάρχει η Δυνατότητα εισαγωγής πλέον των 2 Παιδιών: Εισάγετε τα 2 πρώτα παιδιά στα 2 αντίστοιχα πεδία, " & vbCrLf & " ολοκληρώστε την εισαγωγή της νέας κράτησης με αποθήκευση και έπειτα μπορείτε να εισάγετε και άλλα Παιδιά" & vbCrLf & " πατώντας αυτό το κουμπί ξανά ! ", MsgBoxStyle.Information, "winfo\nikEl.")
        End If
    End Sub
    'Private Sub update_onomata()
    '    Dim find() As Control
    '    Dim j As Int16
    '    'Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikoKratisisDB)
    '    Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikoKratisisDB)


    '    For j = 0 To 2
    '        find = Kratiseis2Pnl.Controls.Find("OnomTbx" + (j + 1).ToString, False)
    '        Try
    '            If LTrim(find(0).Text) <> LTrim(Me.DbhotelDataSet.enilikes(j).onomateponimo) Then
    '                If LTrim(find(0).Text).Length <> 0 Then
    '                    Me.EnilikesTableAdapter.UpdateOnoma(LTrim(find(0).Text), Me.DbhotelDataSet.enilikes(j).kwd)
    '                Else
    '                    Me.EnilikesTableAdapter.DeleteOnoma(Me.DbhotelDataSet.enilikes(j).kwd)
    '                End If
    '            End If
    '        Catch ex As IndexOutOfRangeException
    '            If LTrim(find(0).Text).Length <> 0 Then
    '                Me.EnilikesTableAdapter.InsertOnoma(kwdikoKratisisDB, LTrim(find(0).Text))
    '            End If
    '        End Try

    '    Next

    'End Sub
    Private Sub update_paidia()
        Dim find1(), find2() As Control
        Dim j, i, count, moeglichNeu As Int16
        Dim neuPaidi As Boolean = False
        'Me.EnilikesTableAdapter.FillByKratisi(Me.DbhotelDataSet.enilikes, kwdikoKratisisDB)

        Me.PaidiaTableAdapter.FillByKratisi(Me.DbhotelDataSet.paidia, kwdikoKratisisDB)
        If Me.DbhotelDataSet.paidia.Count >= 3 Then
            count = Me.DbhotelDataSet.paidia.Count
        ElseIf Me.DbhotelDataSet.paidia.Count = 2 Then
            count = 2
            neuPaidi = True
            moeglichNeu = 1
        ElseIf Me.DbhotelDataSet.paidia.Count = 1 Then
            count = 1
            neuPaidi = True
            moeglichNeu = 2
        ElseIf Me.DbhotelDataSet.paidia.Count = 0 Then
            neuPaidi = True
            moeglichNeu = 3
        End If
        For j = 0 To count - 1
            find1 = Kratiseis2Pnl.Controls.Find("PaidiTbx" + (j + 1).ToString, False)
            find2 = Kratiseis2Pnl.Controls.Find("CotTbx" + (j + 1).ToString, False)
            Try
                If LTrim(find1(0).Text) <> LTrim(Me.DbhotelDataSet.paidia(j).ilikia) Or LTrim(find2(0).Text) <> LTrim(Me.DbhotelDataSet.paidia(j).cot) Then
                    If LTrim(find1(0).Text).Length <> 0 And LTrim(find1(0).Text) > 0 Then
                        Me.PaidiaTableAdapter.UpdatePaidi(LTrim(find2(0).Text), LTrim(find1(0).Text), Me.DbhotelDataSet.paidia(j).kwd)
                    ElseIf LTrim(find1(0).Text).Equals("0") Then
                        Me.PaidiaTableAdapter.DeletePaidi(Me.DbhotelDataSet.paidia(j).kwd)
                    End If
                End If
            Catch ex As SqlException
                MsgBox("Η Αποθήκευση των αλλαγών στα παιδιά απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                'If LTrim(find1(0).Text).Length <> 0 Then
                '    Me.PaidiaTableAdapter.InsertPaidi(kwdikoKratisisDB, LTrim(find2(0).Text), LTrim(find1(0).Text))
                'End If
            End Try
        Next
        If neuPaidi Then
            For i = j To j + moeglichNeu - 1
                find1 = Kratiseis2Pnl.Controls.Find("PaidiTbx" + (i + 1).ToString, False)
                find2 = Kratiseis2Pnl.Controls.Find("CotTbx" + (i + 1).ToString, False)
                If LTrim(find1(0).Text).Length <> 0 AndAlso LTrim(find1(0).Text) > 0 Then
                    Me.PaidiaTableAdapter.InsertPaidi(kwdikoKratisisDB, LTrim(find2(0).Text), LTrim(find1(0).Text))
                End If
            Next
        End If
    End Sub
    Private Sub KwdEthnikot_leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles kwdEthnik1.Leave, kwdEthnik2.Leave
        Try

            If CType(sender.text, Integer) > 0 Then

                Me.EthnikotitesTableAdapter.FillByKwdiko(Me.DbhotelDataSet.ethnikotites, CType(sender.text, Integer))
                If Me.DbhotelDataSet.ethnikotites.Count = 1 Then
                    If sender.name.Equals("kwdEthnik1") Then
                        kwdEthnik1.Text = Me.DbhotelDataSet.ethnikotites(0).kwd
                        EthnKwd1.Text = Me.DbhotelDataSet.ethnikotites(0).kwd
                        EthnikTbx1.Text = Me.DbhotelDataSet.ethnikotites(0).sintomeusi
                    Else
                        kwdEthnik2.Text = Me.DbhotelDataSet.ethnikotites(0).kwd
                        EthnKwd2.Text = Me.DbhotelDataSet.ethnikotites(0).kwd
                        EthnikTbx2.Text = Me.DbhotelDataSet.ethnikotites(0).sintomeusi
                    End If
                Else
                    MsgBox("Δεν επιλέχθηκε Εθνικότητα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    If sender.name.Equals("kwdEthnik1") Then
                        If EthnKwd1.Text = 0 Then
                            EthnikTbx1.Text = "<κλίκ εδώ>"
                            sender.clear()
                        Else
                            sender.text = EthnKwd1.Text
                        End If
                    ElseIf sender.name.Equals("kwdEthnik2") Then
                        If EthnKwd2.Text = 0 Then
                            EthnikTbx2.Text = "<κλίκ εδώ>"
                            sender.clear()
                        Else
                            sender.text = EthnKwd2.Text
                        End If
                    End If
                    TilefTbx.Focus()
                    Exit Sub
                End If
            Else
                MsgBox(" Δεν υπάρχει αυτός ο κωδικός Εθνικότητας ! (Επιλέξτε από λίστα κάνωντας κλίκ στο διπλανό πεδίο)", MsgBoxStyle.Information, "winfo\nikEl.")
                If sender.name.Equals("kwdEthnik1") Then
                    If EthnKwd1.Text = 0 Then
                        EthnikTbx1.Text = "<κλίκ εδώ>"
                        sender.clear()
                    Else
                        sender.text = EthnKwd1.Text
                    End If
                ElseIf sender.name.Equals("kwdEthnik2") Then
                    If EthnKwd2.Text = 0 Then
                        EthnikTbx2.Text = "<κλίκ εδώ>"
                        sender.clear()
                    Else
                        sender.text = EthnKwd2.Text
                    End If
                End If
                TilefTbx.Focus()
                Exit Sub
            End If
        Catch ex As InvalidCastException
            If Not sender.text.Equals("") Then
                MsgBox(" Δώστε κωδικό Εθνικότητας ή επιλέξτε από λίστα κάνωντας κλίκ στο διπλανό πεδίο !", MsgBoxStyle.Information, "winfo\nikEl.")
                sender.clear()
            Else
                If sender.name.Equals("kwdEthnik1") Then
                    If EthnKwd1.Text = 0 AndAlso EthnAnzTbx1.Text > 0 Then
                        EthnikTbx1.Text = "<κλίκ εδώ>"
                    ElseIf EthnKwd1.Text = 0 AndAlso EthnAnzTbx1.Text = 0 Then
                        sender.clear()
                    Else
                        sender.text = EthnKwd1.Text
                    End If
                ElseIf sender.name.Equals("kwdEthnik2") Then
                    If EthnKwd2.Text = 0 AndAlso EthnAnzTbx2.Text > 0 Then
                        EthnikTbx2.Text = "<κλίκ εδώ>"
                    ElseIf EthnKwd2.Text = 0 AndAlso EthnAnzTbx2.Text = 0 Then
                        sender.clear()
                    Else
                        sender.text = EthnKwd2.Text
                    End If
                End If
            End If

        End Try


    End Sub
    Private Sub EthnikTbx12_Enter(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EthnikTbx1.Enter, EthnikTbx2.Enter
        Dim EthnForm As New EthnikotitesFrm()
        Dim EthnikKwd As Integer
        Dim ethnosSintom As String

        EthnForm.StartPosition = FormStartPosition.CenterParent
        EthnForm.ShowDialog()
        EthnikKwd = EthnForm.return_ethnos_kwdikos
        'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
        'EthnKwd1.Clear()
        If EthnikKwd = Nothing Then
            MsgBox("Δεν επιλέχθηκε Εθνικότητα !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            If sender.name.Equals("EthnikTbx1") Then
                If EthnKwd1.Text = 0 Then
                    EthnikTbx1.Text = "<κλίκ εδώ>"
                End If
            ElseIf sender.name.Equals("EthnikTbx2") Then
                If EthnKwd2.Text = 0 Then
                    EthnikTbx2.Text = "<κλίκ εδώ>"
                End If
            End If
            TilefTbx.Focus()
            Exit Sub
        Else
            If sender.name.Equals("EthnikTbx1") Then
                EthnKwd1.Text = EthnikKwd
                kwdEthnik1.Text = EthnikKwd
            ElseIf sender.name.Equals("EthnikTbx2") Then
                EthnKwd2.Text = EthnikKwd
                kwdEthnik2.Text = EthnikKwd
            End If
        End If
        ' edw kanw herauskriegen ola ta simbolaia tou praktoreiou gia to etos

        ethnosSintom = EthnForm.return_ethnos_sintomeusi
        If ethnosSintom = Nothing Then
            If sender.name.Equals("EthnikTbx1") Then
                EthnikTbx1.Text = "<κλίκ εδώ>"
            ElseIf sender.name.Equals("EthnikTbx2") Then
                EthnikTbx2.Text = "<κλίκ εδώ>"
            End If
        Else
            If sender.name.Equals("EthnikTbx1") Then
                EthnikTbx1.Text = ethnosSintom
            ElseIf sender.name.Equals("EthnikTbx2") Then
                EthnikTbx2.Text = ethnosSintom
            End If
        End If
        EthnForm.Dispose()
        TilefTbx.Focus()
    End Sub

    Private Sub setze_sum_timokat()
        Dim i As Int16
        Dim sum, ekptosiPoso, timiImeras As Single

        For i = 0 To timokatalog.Length - 1
            sum = sum + timokatalog(i).synoloTemp + timokatalog(i).dedoulPos
        Next
        'sum = sum + dedouleumPoso
        If timokatalog.Length <> 0 Then
            timiImeras = rechne_timi_imeras()
        End If

        ekptosiPoso = rechne_ekptosi(sum, timiImeras)
        SynolLbl.Text = (sum - ekptosiPoso).ToString("N")
        EkptosiLbl.Text = "Έκπτωση: " + ekptosiPoso.ToString("N")
    End Sub
    Private Function rechne_timi_imeras() As Single
        Dim timiImeras As Single
        Try
            timiImeras = timokatalog(timokatalog.Length - 1).ypnosTemp + timokatalog(timokatalog.Length - 1).prwinoTemp + timokatalog(timokatalog.Length - 1).geumaTemp + timokatalog(timokatalog.Length - 1).deipnoTemp + timokatalog(timokatalog.Length - 1).paroxiTemp
        Catch ex As IndexOutOfRangeException
            MsgBox("Δεν υπάρχουν τιμές !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            Me.init_ekptoseis()
        End Try

        Return timiImeras
    End Function
    Private Function rechne_imeres_diamonis() As Single
        Dim i As Int16
        Dim sum As Single
        For i = 0 To timokatalog.Length - 1
            sum = sum + timokatalog(i).imeresTotal
        Next

        Return sum
    End Function
    Private Function rechne_ekptosi(ByVal synolo As Single, ByVal timiImeras As Single) As Single


        If ekptPososto <> 0 Then
            Return (synolo * ekptPososto / 100)

        ElseIf ekptPoso <> 0 Then

            Return (ekptPoso)

        ElseIf ekptFree <> 0 Then

            Return (ekptFree * timiImeras)

        ElseIf ekptCFee <> 0 Then
            Return -(ekptCFee * timiImeras)
        End If
        Return 0
    End Function
    Private Function rechne_ekptosi_vom_synola(ByVal synolo As Single, ByVal poso As Single, ByVal pososto As Single, ByVal free As Single, ByVal fee As Single) As Single
        Dim timiImeras As Single

        If ekptPososto <> 0 Then
            Return (synolo / (1 - ekptPososto / 100) - synolo)

        ElseIf ekptPoso <> 0 Then

            Return ekptPoso

        ElseIf ekptFree <> 0 Then
            timiImeras = rechne_timi_imeras()
            Return (ekptFree * timiImeras)

        ElseIf ekptCFee <> 0 Then
            timiImeras = rechne_timi_imeras()
            Return -(ekptCFee * timiImeras)
        End If
        Return 0
    End Function
    Public Sub init_ekptoseis()
        ekptPososto = 0
        ekptPoso = 0
        ekptFree = 0
        ekptCFee = 0
        Me.EkptosiLbl.Text = ""
        'EkptosiBtn.Visible = False
    End Sub
    Private Sub init_timokatalog()
        Dim i As Int16
        For i = 0 To timokatalog.Length - 1
            'timokatalog(i).status = 0
            timokatalog(i).kwdDB = -1
            timokatalog(i).tourist = -1
            timokatalog(i).simfonia = -1
            timokatalog(i).xrewsi = -1
            timokatalog(i).xrewsiDB = -1
            timokatalog(i).timi = -1
            timokatalog(i).apo = "1/1/" + etos.ToString
            timokatalog(i).mexri = "1/1/" + etos.ToString
            timokatalog(i).imeresTotal = 0
            timokatalog(i).imeresPlirom = 0
            timokatalog(i).imeresPliromDB = 0
            timokatalog(i).ekptosi = 0
            timokatalog(i).ekptosiDB = 0
            timokatalog(i).ypnosDB = 0
            timokatalog(i).ypnos = 0
            timokatalog(i).ypnosTemp = 0
            timokatalog(i).prwinoDB = 0
            timokatalog(i).prwino = 0
            timokatalog(i).prwinoTemp = 0
            timokatalog(i).geumaDB = 0
            timokatalog(i).geuma = 0
            timokatalog(i).geumaTemp = 0
            timokatalog(i).deipnoDB = 0
            timokatalog(i).deipno = 0
            timokatalog(i).deipnoTemp = 0
            timokatalog(i).paroxiDB = 0
            timokatalog(i).paroxi = 0
            timokatalog(i).paroxiTemp = 0
            timokatalog(i).synoloDB = 0
            timokatalog(i).synolo = 0
            timokatalog(i).synoloTemp = 0
            timokatalog(i).dedoulPos = 0
        Next
    End Sub
    Private Function ist_xrewsi_ok() As Boolean
        Dim index As Int16
        'Dim tempXrewsi As Integer
        For index = 0 To timokatalog.Length - 1

            If timokatalog(index).xrewsi = -1 Then
                Return False
            End If
            'If index = 0 Then
            '    tempXrewsi = timokatalog(index).xrewsi
            'ElseIf tempXrewsi <> timokatalog(index).xrewsi Then
            '    Return False
            'End If
        Next
        Return True

    End Function
    Private Sub ersetze_temp_vor_speichern()
        Dim index As Int16

        For index = 0 To timokatalog.Length - 1
            timokatalog(index).ypnos = timokatalog(index).ypnosTemp
            timokatalog(index).prwino = timokatalog(index).prwinoTemp
            timokatalog(index).geuma = timokatalog(index).geumaTemp
            timokatalog(index).deipno = timokatalog(index).deipnoTemp
            timokatalog(index).paroxi = timokatalog(index).paroxiTemp
            timokatalog(index).synolo = timokatalog(index).synoloTemp
        Next

    End Sub
    Private Function info_timiskratisis_by_kwdtimis(ByVal timi As Integer) As String
        Dim simf, xrews, klin, paid, info As String
        Dim kwdikosSimf As Integer
        'get_xrewsi_by_kwd(Me.DbhotelDataSet.times(i).xrewsi)
        Try
            kwdikosSimf = Me.TimesTableAdapter.GetSimfoniaByKwd(timi)
            simf = Me.SimfoniesTableAdapter.GetAAByKwd(kwdikosSimf)
            xrews = get_xrewsi_by_kwd(Me.TimesTableAdapter.GetXrewsiByKwd(timi))
            klin = Me.TimesTableAdapter.GetKlinesByKwd(timi)
            paid = Me.TimesTableAdapter.GetPaidiByklines(timi)
            info = "[(Συμφ:" + simf + ")(Χρ.:" + xrews + ")(Κλ.:" + klin + ")(Παιδ:" + paid + ")]"
        Catch ex As InvalidOperationException
            info = Nothing
        End Try

        Return info
    End Function
    Private Function info_timiskratisis_by_xrewsi(ByVal xrews As Integer) As String
        Dim info As String
        'get_xrewsi_by_kwd(Me.DbhotelDataSet.times(i).xrewsi)
        Try
            info = get_xrewsi_by_kwd(xrews)
            info = "[(Χρ.:" + info + ")]"
        Catch ex As InvalidOperationException
            info = "--"
        End Try

        Return info
    End Function
    'Edw exetazw ean yparxoun sto Biblio Portas spaetere Eintraege gia tin kratisi (apo akyrosi kleisimatos)
    '(apla xrisimopoiw ti n diadikasia me to connectionString gia pio grigora apo TableAdapter!!!!)
    Private Function ist_biblio_aktuel(ByVal connectionString As String, ByVal kwdikos As Int32) As Boolean
        'Using connection As New OleDb.OleDbConnection(connectionString)
        '    Dim command As New OleDb.OleDbCommand()
        '    Dim myReader As OleDb.OleDbDataReader
        '    Dim maxdatumBP As Date
        '    connection.Open()
        '    command.Connection = connection
        '    command.Parameters.AddWithValue("etos", etos)
        '    command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '    command.CommandText = "SELECT MAX(imerominia) FROM biblioportas where (etos=?) and (kratisi=?)"
        '    myReader = command.ExecuteReader(CommandBehavior.SingleResult)
        '    myReader.Read()
        '    Try
        '        maxdatumBP = myReader.Item(0)
        '        If maxdatumBP > imeromErgasias Then
        '            myReader.Close()
        '            command.Parameters.Clear()
        '            Return False
        '        Else
        '            myReader.Close()
        '            command.Parameters.Clear()
        '            Return True
        '        End If
        '    Catch ex As InvalidCastException
        '        myReader.Close()
        '        command.Parameters.Clear()
        '        Return True
        '    End Try
        'End Using
        Using connection As New SqlConnection(connectionString)
            Dim command As New SqlCommand()
            Dim myReader As SqlDataReader
            Dim maxdatumBP As Date

            connection.Open()
            command.Connection = connection
            command.Parameters.AddWithValue("@etos", etos)
            command.Parameters.AddWithValue("@kratisi", kwdikos)
            command.CommandText = "SELECT MAX(imerominia) FROM biblioportas WHERE (etos=@etos) AND (kratisi=@kratisi)"

            myReader = command.ExecuteReader(CommandBehavior.SingleResult)
            myReader.Read()

            Try
                maxdatumBP = myReader.GetDateTime(0)

                If maxdatumBP > imeromErgasias Then
                    myReader.Close()
                    command.Parameters.Clear()
                    Return False
                Else
                    myReader.Close()
                    command.Parameters.Clear()
                    Return True
                End If
            Catch ex As InvalidCastException
                myReader.Close()
                command.Parameters.Clear()
                Return True
            End Try
        End Using

    End Function
    Private Function get_index_timeskratisis(ByVal kwdTourPerDB As Integer) As Int16
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.timeskratisis.Count - 1
            If Me.DbhotelDataSet.timeskratisis(j).touristperiod = kwdTourPerDB Then
                Return j
            End If
        Next
        Return -1
    End Function
    Private Function get_ethikotita_by_kwdiko(ByVal kwd As Integer) As String
        Try
            Return Me.EthnikotitesTableAdapter.GetSintomeusiByKwd(kwd)
        Catch ex As Exception
            Return Nothing
        End Try
    End Function

    Private Function get_praktoreio_by_kwdiko(ByVal kwd As Integer) As String

        Try
            Return Me.PraktoreiaTableAdapter.GetEponimiaByKwd(kwd)
        Catch ex As Exception
            Return Nothing
        End Try
    End Function
    Private Function get_praktoreio_eponimia_by_kwdiko(ByVal kwd As Integer) As String
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.praktoreia.Count - 1
            If Me.DbhotelDataSet.praktoreia(j).kwd = kwd Then
                Return Me.DbhotelDataSet.praktoreia(j).eponimia
            End If
        Next
        Return Nothing
    End Function
    Private Function get_xrewsi_by_kwd(ByVal kwdikos As Integer) As String
        Try
            Return Me.XrewseisTableAdapter.GetXrewsiByKwd(kwdikos)
        Catch ex As Exception
            Return Nothing
        End Try

    End Function
    Private Function get_aasimbolaiou_by_kwd(ByVal kwdikos As Integer) As String
        Try
            Return Me.SimbolaiaTableAdapter.GetAAByKwd(kwdikos)
        Catch ex As Exception
            Return Nothing
        End Try

    End Function
    Private Function get_aa_simbolaiou_by_kwd(ByVal kwdikos As Integer) As Int16
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            If Me.DbhotelDataSet.simbolaia(j).kwd = kwdikos Then
                Return Me.DbhotelDataSet.simbolaia(j).aasimbolaiou
            End If
        Next
        Return -1

    End Function
    Private Function get_kwd_simbol_byAA(ByVal aa As String) As Integer

        Try

            Return Me.SimbolaiaTableAdapter.GetKwdByAaPraktEtos(aa, praktoreiokwd, etos)
        Catch ex As Exception
            Return -1
        End Try


    End Function
    Private Function get_kwd_simbolaiou_by_aa(ByVal aa As Int16) As Integer
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            If Me.DbhotelDataSet.simbolaia(j).aasimbolaiou = aa Then
                Return Me.DbhotelDataSet.simbolaia(j).kwd
            End If
        Next
        Return -1
    End Function
    Private Function get_kwd_praktoreiou_by_simbol_kwd(ByVal kwdikos As Integer) As Integer
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            If Me.DbhotelDataSet.simbolaia(j).kwd = kwdikos Then
                Return Me.DbhotelDataSet.simbolaia(j).praktoreio
            End If
        Next
        Return -1
    End Function
    Private Function get_perigrafi_simb_by_aa(ByVal aa As Int16) As String
        Dim j As Int16
        For j = 0 To Me.DbhotelDataSet.simbolaia.Count - 1
            If Me.DbhotelDataSet.simbolaia(j).aasimbolaiou = aa Then
                Return Me.DbhotelDataSet.simbolaia(j).perigrafi
            End If
        Next
        Return ""
    End Function

    Private Function get_kwd_klins_byname(ByVal name As String) As Integer

        Try
            Return Me.KlinesTableAdapter.GetKwdByPerigrafi(name)
        Catch ex As Exception
            Return -1
        End Try


    End Function

    Private Sub AirbnbBtn_Click(sender As Object, e As EventArgs) Handles AirbnbBtn.Click
        Try
            ' Show the spinner (progress bar) and set cursor to wait cursor
            ProgressBar1.Style = ProgressBarStyle.Marquee
            Me.Cursor = Cursors.WaitCursor

            ' Perform the main process
            CalendarExtrernalInit.Main(ConfigurationManager.ConnectionStrings("winhotel.My.MySettings.dbhotelConnectionString1").ConnectionString)

            ' Hide the spinner and reset cursor
            ProgressBar1.Style = ProgressBarStyle.Continuous
            Me.Cursor = Cursors.Default

            ' Show success message
            MsgBox("Τα ημερολόγια Airbnb ενημερώθηκαν !", MsgBoxStyle.Information, "winfo\nikEl.")
        Catch ex As Exception
            ' Hide the spinner and reset cursor
            ProgressBar1.Style = ProgressBarStyle.Continuous
            Me.Cursor = Cursors.Default

            ' Show error message
            MsgBox("Πρόβλημα ενημέρωσης ημερολογίων Airbnb !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        End Try
    End Sub


    Private Sub myIdTbx_TextChanged(sender As Object, e As EventArgs) Handles myIdTbx.TextChanged

    End Sub



    Private Function get_kwd_tipos_byname(ByVal name As String) As Integer

        Try
            Return Me.TipoiTableAdapter.GetKwdByTipo(name)
        Catch ex As Exception
            Return -1
        End Try


    End Function

    Private Function get_index_v_timokatalog(ByVal tourist As Integer)
        Dim j As Int16
        For j = 0 To timokatalog.Length - 1
            If timokatalog(j).tourist = tourist Then
                Return j
            End If
        Next
        Return -1

    End Function
    Private Function get_index_v_timokatalog_2(ByVal timeskratKwd As Integer)
        Dim j As Int16
        For j = 0 To timokatalog.Length - 1
            If timokatalog(j).kwdDB = timeskratKwd Then
                Return j
            End If
        Next
        Return -1

    End Function
    Private Function get_klines_by_kwdikos(ByVal kwdikos As Integer) As String
        Dim i As Int16

        For i = 0 To Me.DbhotelDataSet.klines.Count - 1
            If kwdikos = Me.DbhotelDataSet.klines(i).kwd Then
                Return Me.DbhotelDataSet.klines(i).perigrafi
            End If
        Next

        Return Nothing

    End Function

    Private Function get_tipos_by_kwdikos(ByVal kwdikos As Integer) As String
        'Dim i As Int16

        Try
            Return Me.TipoiTableAdapter.GetTiposByKwdiko(kwdikos)
        Catch ex As Exception
            Return Nothing
        End Try

    End Function

    Private Sub suche_kratiseis_Button_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button5.Click

        If status = 1 Then
            suche_kratiseis(sender, e)
        Else
            suche_diamenontes(sender, e)

        End If


    End Sub
    Private Sub suche_kratiseis(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kratisiArithm As String
        Dim kwdKratTemp As Integer
        Dim response As MsgBoxResult


        If isDBEintrag Then
            response = MsgBox("Προσοχή: Οι Aλλαγές στην Κράτηση θα χαθούν! Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            If response = MsgBoxResult.No Then
                Exit Sub
            End If
        End If
        blinkLbl.Text = ""
        myTimer.Stop()
        ButtonsPnl.Enabled = True
        Kratiseis4Pnl.Enabled = True
        Try
            If KratisiTbx.Text > 0 Then
                Dim count As Int16
                count = Me.KratiseisTableAdapter.ExistArKratisis(KratisiTbx.Text, etos)
                If count = 1 Then 'yparxei autos o arithmos kRatisis
                    'ANfrage kratiseis pou DEN exoun elthei!!!!!!!!!!!!!!!!!!!!(DEN Eexoun kanei CHECKIN)
                    'Me.KratiseisTableAdapter.FillStatus1ByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos)
                    Me.DbhotelDataSet.EnforceConstraints = False
                    Me.KratiseisTableAdapter.FillStatusByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos, False, False)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        'firstLoadDBEintrag = True
                        kwdikoKratisisDB = Me.DbhotelDataSet.kratiseis(0).kwd
                        praktoreiokwd = Me.DbhotelDataSet.kratiseis(0).praktoreio
                        currentklines = Me.DbhotelDataSet.kratiseis(0).klines
                        currenttipos = Me.DbhotelDataSet.kratiseis(0).tipos
                        currentsimbolaio = Me.DbhotelDataSet.kratiseis(0).simbolaio
                        ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                        ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                        ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                        ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                        Kratiseis4Pnl.Controls.Clear()
                        ButtonsPnl.Controls.Clear()
                        kratiseis_zeig(True)
                        ButtonsPnl.Enabled = True
                        Kratiseis4Pnl.Enabled = True
                    Else 'KOITW EAN EXOYN ERTHEI KAI MENOYN MESA
                        Me.KratiseisTableAdapter.FillStatusByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos, True, False)
                        If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                            'to <> to alaksa me < logw akyrosi_kleisimatos!!->epanafora se proigoumeni imerominia kai katargisi tis afiksis! 
                            If Me.DbhotelDataSet.kratiseis(0).afixi.Date < imeromErgasias OrElse Me.DbhotelDataSet.kratiseis(0).timologio = 1 Then
                                MsgBox("O Πελάτης έχει έρθει !", MsgBoxStyle.Information, "winfo\nikEl.")
                                KratisiTbx.Clear()
                                Exit Sub
                            End If
                            response = MsgBox("O Πελάτης ήλθε ! Ακύρωση Αφιξης;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                            If response = MsgBoxResult.Yes Then 'edw akirosi afixis!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1
                                Dim kwdikosKr As Integer
                                Try

                                    kwdikosKr = akyrosi_afixis_transaction(connectionString)
                                Catch ex As Exception
                                    MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                                    Exit Sub

                                End Try
                                If kwdikosKr <> -1 Then
                                    ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                                    ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                                    ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                                    ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                                    suche_kratiseis_Button_Click(sender, e)
                                End If


                            Else
                                KratisiTbx.Text = "NEA"
                                ekptPoso = 0
                                ekptPososto = 0
                                ekptFree = 0
                                ekptCFee = 0
                                KratisiTbx.Focus()
                            End If
                            'KratisiTbx.Clear()
                        Else
                            Me.KratiseisTableAdapter.FillStatusByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos, True, True)
                            If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                                MsgBox("O Πελάτης έχει αναχωρίσει ! ", MsgBoxStyle.Information, "winfo\nikEl.")
                                KratisiTbx.Clear()
                            End If
                        End If
                    End If
                Else
                    MsgBox("Δεν βρέθηκε κράτηση με αυτόν τον Αριθμό. Δώστε έναν άλλον αριθμό ή επιλέξτε απο λίστα. " & vbCrLf & "(Για επιλογή απο λίστα πατήστε το κουμπί ξανά!", MsgBoxStyle.Information, "winfo\nikEl.")
                    KratisiTbx.Clear()
                    ekptPoso = 0
                    ekptPososto = 0
                    ekptFree = 0
                    ekptCFee = 0
                End If
            End If
        Catch ex As InvalidCastException
            Dim form As New KratiseisSucheF(imeromErgasias, False, False, 1, rechte)

            form.ShowDialog()
            kwdKratTemp = form.return_kwdiko_kratisis()
            kratisiArithm = form.return_arithmo_kratisis
            form.Dispose()
            If kwdKratTemp <> -1 Then
                kwdikoKratisisDB = kwdKratTemp
                Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                KratisiTbx.Text = kratisiArithm
                kwdikoKratisisDB = kwdKratTemp
                ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                Kratiseis4Pnl.Controls.Clear()
                ButtonsPnl.Controls.Clear()
                kratiseis_zeig(True)
                ButtonsPnl.Enabled = True
                Kratiseis4Pnl.Enabled = True
                'Else
                '    MsgBox(" Δεν επιλέχθηκε Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
            End If
        End Try
    End Sub
    'kanei return ton kwdiko kkratisis ean pane ola OK
    Private Function akyrosi_afixis_transaction(ByVal connectionString As String) As Integer
        'Using connection As New OleDb.OleDbConnection(connectionString)
        '    Dim kwdikos As Integer
        '    Dim arDwm As String = Nothing
        '    Dim overKwd As Integer = -1
        '    Dim command As New OleDb.OleDbCommand()
        '    Dim transaction As OleDb.OleDbTransaction = Nothing
        '    Dim rows As Int16
        '    Try
        '        connection.Open()
        '        transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

        '        ' Assign transaction object for a pending local transaction.
        '        command.Connection = connection
        '        command.Transaction = transaction

        '        command.Parameters.AddWithValue("etos", etos)
        '        command.Parameters.AddWithValue("arithmos", CType(KratisiTbx.Text, Integer))
        '        command.CommandText = "SELECT kwd, dwmatio FROM kratiseis where (etos=?) and (arithmos=?)"
        '        Dim myReader As OleDb.OleDbDataReader
        '        myReader = command.ExecuteReader()
        '        ' Always call Read before accessing data.
        '        While myReader.Read()
        '            kwdikos = myReader.GetInt32(0)
        '            arDwm = myReader.GetString(1)
        '        End While
        '        myReader.Close()
        '        command.Parameters.Clear()

        '        If kwdikos = -1 Then
        '            MsgBox("Δεν βρέθηκε η Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '            Return -1
        '        End If

        '        If arDwm.Equals("OV-BOOK") Then
        '            arDwm = ""
        '            command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '            command.CommandText = "SELECT kwd FROM over where (kratisi=?)"
        '            myReader = command.ExecuteReader()
        '            ' Always call Read before accessing data.
        '            While myReader.Read()
        '                overKwd = myReader.GetInt32(0)
        '            End While
        '            myReader.Close()
        '            If overKwd <> -1 Then ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
        '                command.Parameters.Clear()
        '                command.Parameters.AddWithValue("over", overKwd)
        '                command.CommandText = "DELETE FROM overunterkuenfte where (over=?)"
        '                command.ExecuteNonQuery()
        '                command.Parameters.Clear()

        '                command.Parameters.Clear()
        '                command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '                command.CommandText = "DELETE FROM over where (kratisi=?)"
        '                command.ExecuteNonQuery()
        '                command.Parameters.Clear()
        '            End If
        '        Else
        '            command.Parameters.AddWithValue("kratisi", kwdikos)
        '            command.Parameters.AddWithValue("enarxi", imeromErgasias)
        '            command.CommandText = "UPDATE status SET dwmatiostatus=1 where (kratisi=?) and (enarxi>=?)" '
        '            rows = command.ExecuteNonQuery()
        '            command.Parameters.Clear()
        '        End If

        '        'command.Parameters.Clear()
        '        'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        'command.CommandText = "DELETE FROM nonshow where (kratisi=?)"
        '        'command.ExecuteNonQuery()
        '        'command.Parameters.Clear()
        '        'End If
        '        command.Parameters.Clear()
        '        command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
        '        command.CommandText = "DELETE FROM biblioportas where (kratisi=?)"
        '        command.ExecuteNonQuery()
        '        command.Parameters.Clear()

        '        command.Parameters.AddWithValue("dwmatio", arDwm)
        '        command.Parameters.AddWithValue("kwd", CType(kwdikos, Integer))
        '        command.CommandText = "UPDATE kratiseis set dwmatio=?, checkin=false, datein=#1/1/1900#,  dateout=#1/1/1900#, allagesdwmatiwn=false where (kwd=?)" 'datein=1/1/1900, datout=1/1/1900,
        '        rows = command.ExecuteNonQuery()
        '        command.Parameters.Clear()


        '        If rows = 0 Then
        '            transaction.Rollback()
        '            MsgBox("Δεν βρέθηκε η Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
        '            Return -1
        '        Else
        '            transaction.Commit()
        '            Return kwdikos
        '        End If

        '    Catch ex As Exception
        '        MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
        '        Try
        '            transaction.Rollback()
        '            Return -1
        '        Catch
        '            Return -1
        '        End Try

        '    End Try

        'End Using
        Using connection As New SqlConnection(connectionString)
            Dim kwdikos As Integer
            Dim arDwm As String = Nothing
            Dim overKwd As Integer = -1
            Dim command As New SqlCommand()
            Dim transaction As SqlTransaction = Nothing
            Dim rows As Int16
            Try
                connection.Open()
                transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

                ' Assign transaction object for a pending local transaction.
                command.Connection = connection
                command.Transaction = transaction

                command.Parameters.AddWithValue("@etos", etos)
                command.Parameters.AddWithValue("@arithmos", Integer.Parse(KratisiTbx.Text))
                command.CommandText = "SELECT kwd, dwmatio FROM kratiseis WHERE (etos=@etos) AND (arithmos=@arithmos)"
                Dim myReader As SqlDataReader
                myReader = command.ExecuteReader()

                ' Always call Read before accessing data.
                While myReader.Read()
                    kwdikos = myReader.GetInt32(0)
                    arDwm = myReader.GetString(1)
                End While

                myReader.Close()
                command.Parameters.Clear()

                If kwdikos = -1 Then
                    MsgBox("Δεν βρέθηκε η Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Return -1
                End If

                If arDwm.Equals("OV-BOOK") Then
                    arDwm = ""
                    command.Parameters.AddWithValue("@kratisi", kwdikos)
                    command.CommandText = "SELECT kwd FROM [over] WHERE (kratisi=@kratisi)"
                    myReader = command.ExecuteReader()

                    ' Always call Read before accessing data.
                    While myReader.Read()
                        overKwd = myReader.GetInt32(0)
                    End While

                    myReader.Close()

                    If overKwd <> -1 Then
                        ' paei na pei oti brethikan parapanw kratiseis me ton idio arithmo kratisis
                        command.Parameters.Clear()
                        command.Parameters.AddWithValue("@over", overKwd)
                        command.CommandText = "DELETE FROM overunterkuenfte WHERE (over=@over)"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()

                        command.Parameters.Clear()
                        command.Parameters.AddWithValue("@kratisi", kwdikos)
                        command.CommandText = "DELETE FROM [over] WHERE (kratisi=@kratisi)"
                        command.ExecuteNonQuery()
                        command.Parameters.Clear()
                    End If
                Else
                    command.Parameters.AddWithValue("@kratisi", CType(kwdikos, Integer))
                    command.Parameters.AddWithValue("@enarxi", CType(imeromErgasias, Date))
                    command.CommandText = "UPDATE status SET dwmatiostatus=1 WHERE (kratisi=@kratisi) AND (enarxi>=@enarxi)"
                    rows = command.ExecuteNonQuery()
                    command.Parameters.Clear()

                End If

                'command.Parameters.Clear()
                'command.Parameters.AddWithValue("kratisi", CType(kwdikos, Integer))
                'command.CommandText = "DELETE FROM nonshow where (kratisi=?)"
                'command.ExecuteNonQuery()
                'command.Parameters.Clear()
                'End If
                command.Parameters.Clear()
                command.Parameters.AddWithValue("@kratisi", kwdikos)
                command.CommandText = "DELETE FROM biblioportas WHERE (kratisi=@kratisi)"
                command.ExecuteNonQuery()
                command.Parameters.Clear()

                command.Parameters.AddWithValue("@dwmatio", arDwm)
                command.Parameters.AddWithValue("@kwd", CType(kwdikos, Integer))
                command.CommandText = "UPDATE kratiseis SET dwmatio=@dwmatio, checkin=0, datein='1900-01-01', dateout='1900-01-01', allagesdwmatiwn=0 WHERE (kwd=@kwd)"
                rows = command.ExecuteNonQuery()
                command.Parameters.Clear()

                If rows = 0 Then
                    transaction.Rollback()
                    MsgBox("Δεν βρέθηκε η Κράτηση !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                    Return -1
                Else
                    transaction.Commit()
                    Return kwdikos
                End If
            Catch ex As Exception
                MsgBox("Η Διαδικασία απέτυχε !", MsgBoxStyle.Critical, "winfo\nikEl.")
                Try
                    transaction.Rollback()
                    Return -1
                Catch
                    Return -1
                End Try
            End Try
        End Using

    End Function
    'Status=2 DIAMENWNTES!!!!!!!!!!!!!!!!
    Private Sub suche_diamenontes(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim kratisiArithm As String
        Dim kwdKratTemp As Integer
        Dim response As MsgBoxResult ', response2

        If isDBEintrag Then
            response = MsgBox("Προσοχή: Οι Aλλαγές θα χαθούν! Συνέχεια;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            If response = MsgBoxResult.No Then
                Exit Sub
            End If
        End If
        ButtonsPnl.Enabled = True
        Kratiseis4Pnl.Enabled = True
        Try
            If KratisiTbx.Text > 0 Then
                Dim count As Int16
                count = Me.KratiseisTableAdapter.ExistArKratisis(KratisiTbx.Text, etos)
                If count = 1 Then 'yparxei autos o arithmos kRatisis
                    'ANfrage kratiseis pou DEN exoun elthei!!!!!!!!!!!!!!!!!!!!(DEN Eexoun kanei CHECKIN)
                    'Me.KratiseisTableAdapter.FillStatus1ByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos)
                    Me.KratiseisTableAdapter.FillStatusByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos, True, False)
                    If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                        'menei MESA!!!!!!!ι
                        If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date < imeromErgasias Then
                            MsgBox("Ημερομηνία Αναχώρισης είναι προγενέστερη της τρέχουσας !", MsgBoxStyle.Critical, "winfo\nikEl.")
                            Exit Sub
                        End If
                        kwdikoKratisisDB = Me.DbhotelDataSet.kratiseis(0).kwd
                        praktoreiokwd = Me.DbhotelDataSet.kratiseis(0).praktoreio
                        praktoreiokwdValue = -1
                        currentklines = Me.DbhotelDataSet.kratiseis(0).klines
                        currenttipos = Me.DbhotelDataSet.kratiseis(0).tipos
                        currentsimbolaio = Me.DbhotelDataSet.kratiseis(0).simbolaio
                        ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                        ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                        ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                        ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                        Kratiseis4Pnl.Controls.Clear()
                        ButtonsPnl.Controls.Clear()
                        Kratiseis2Pnl.Enabled = True
                        Kratiseis3Pnl.Enabled = True
                        If Me.DbhotelDataSet.kratiseis(0).timologio = 0 Then
                            kratiseis_zeig(True)
                            ButtonsPnl.Enabled = True
                            Kratiseis4Pnl.Enabled = True
                        Else
                            kratiseis_zeig(True)
                            Kratiseis1Pnl.Enabled = False
                            Kratiseis2Pnl.Enabled = False
                            Kratiseis3Pnl.Enabled = False
                            Kratiseis4Pnl.Enabled = False
                            SynolPnl.Enabled = False
                            ButtonsPnl.Enabled = False
                            MsgBox("Εχει εκδοθεί Τιμολόγιο !", MsgBoxStyle.Information, "winfo\nikEl.")
                            Me.DbhotelDataSet.kratiseis.Clear()
                            kwdikoKratisisDB = -1
                            sesionID = get_sesion()
                            init_ekptoseis()
                            ReDim timokatalog(-1)
                            Kratiseis1Pnl.Enabled = True
                            Kratiseis2Pnl.Enabled = True
                            Kratiseis3Pnl.Enabled = True

                            SynolPnl.Enabled = True

                            kratiseis_zeig(False)
                            Kratiseis4Pnl.Enabled = True
                            ButtonsPnl.Enabled = True
                        End If

                    Else 'KOITW EAN EXOYN FYGEI
                        Me.KratiseisTableAdapter.FillStatusByArithmEtos(Me.DbhotelDataSet.kratiseis, KratisiTbx.Text, etos, True, True)
                        If Me.DbhotelDataSet.kratiseis.Count <> 0 Then
                            kwdikoKratisisDB = Me.DbhotelDataSet.kratiseis(0).kwd
                            praktoreiokwd = Me.DbhotelDataSet.kratiseis(0).praktoreio
                            praktoreiokwdValue = -1
                            currentklines = Me.DbhotelDataSet.kratiseis(0).klines
                            currenttipos = Me.DbhotelDataSet.kratiseis(0).tipos
                            currentsimbolaio = Me.DbhotelDataSet.kratiseis(0).simbolaio
                            ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                            ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                            ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                            ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                            Kratiseis4Pnl.Controls.Clear()
                            ButtonsPnl.Controls.Clear()
                            Kratiseis2Pnl.Enabled = True
                            Kratiseis3Pnl.Enabled = True
                            kratiseis_zeig(True)
                            Kratiseis1Pnl.Enabled = False
                            Kratiseis2Pnl.Enabled = False
                            Kratiseis3Pnl.Enabled = False
                            Kratiseis4Pnl.Enabled = False
                            SynolPnl.Enabled = False
                            ButtonsPnl.Enabled = False
                            MsgBox(" Ο Πελάτης έχει αναχωρήσει στίς " + Me.DbhotelDataSet.kratiseis(0).anaxwrisi + " !", MsgBoxStyle.Information, "winfo\nikEl.")
                            Me.DbhotelDataSet.kratiseis.Clear()
                            kwdikoKratisisDB = -1
                            sesionID = get_sesion()
                            init_ekptoseis()
                            ReDim timokatalog(-1)
                            Kratiseis1Pnl.Enabled = True
                            Kratiseis2Pnl.Enabled = True
                            Kratiseis3Pnl.Enabled = True
                            SynolPnl.Enabled = True
                            kratiseis_zeig(False)
                            Kratiseis4Pnl.Enabled = True
                            ButtonsPnl.Enabled = True

                        Else
                            MsgBox("Δεν έχει γίνει Άφιξη !", MsgBoxStyle.Information, "winfo\nikEl.")
                            'KratisiTbx.Clear()
                        End If
                    End If
                Else
                    MsgBox("Δεν βρέθηκε κράτηση με αυτόν τον Αριθμό. Δώστε έναν άλλον αριθμό ή επιλέξτε απο λίστα. " & vbCrLf & "(Για επιλογή απο λίστα πατήστε το κουμπί ξανά!", MsgBoxStyle.Information, "winfo\nikEl.")
                    KratisiTbx.Clear()
                End If
            End If
        Catch ex As InvalidCastException
            Dim form As New KratiseisSucheF(imeromErgasias, True, False, 1, rechte)

            form.ShowDialog()
            kwdKratTemp = form.return_kwdiko_kratisis()
            kratisiArithm = form.return_arithmo_kratisis
            form.Dispose()
            If kwdKratTemp <> -1 Then
                kwdikoKratisisDB = kwdKratTemp
                Me.KratiseisTableAdapter.FillByKwd(Me.DbhotelDataSet.kratiseis, kwdikoKratisisDB)
                If Me.DbhotelDataSet.kratiseis(0).anaxwrisi.Date < imeromErgasias Then
                    MsgBox("Ημερομηνία Αναχώρισης είναι προγενέστερη της τρέχουσας !", MsgBoxStyle.Critical, "winfo\nikEl.")
                    Exit Sub
                End If
                KratisiTbx.Text = kratisiArithm
                kwdikoKratisisDB = kwdKratTemp
                ekptPoso = Me.DbhotelDataSet.kratiseis(0).ekptposo
                ekptPososto = Me.DbhotelDataSet.kratiseis(0).ekptpososto
                ekptFree = Me.DbhotelDataSet.kratiseis(0).ekptimeres
                ekptCFee = Me.DbhotelDataSet.kratiseis(0).fee
                Kratiseis4Pnl.Controls.Clear()
                ButtonsPnl.Controls.Clear()
                Kratiseis2Pnl.Enabled = True
                Kratiseis3Pnl.Enabled = True
                If Me.DbhotelDataSet.kratiseis(0).timologio = 0 Then
                    kratiseis_zeig(True)
                    ButtonsPnl.Enabled = True
                    Kratiseis4Pnl.Enabled = True
                Else
                    kratiseis_zeig(True)
                    Kratiseis1Pnl.Enabled = False
                    Kratiseis2Pnl.Enabled = False
                    Kratiseis3Pnl.Enabled = False
                    Kratiseis4Pnl.Enabled = False
                    SynolPnl.Enabled = False
                    ButtonsPnl.Enabled = False
                    MsgBox("Εχει εκδοθεί Τιμολόγιο !", MsgBoxStyle.Information, "winfo\nikEl.")
                    Me.DbhotelDataSet.kratiseis.Clear()
                    kwdikoKratisisDB = -1
                    sesionID = get_sesion()
                    init_ekptoseis()
                    ReDim timokatalog(-1)
                    Kratiseis1Pnl.Enabled = True
                    Kratiseis2Pnl.Enabled = True
                    Kratiseis3Pnl.Enabled = True
                    Kratiseis4Pnl.Enabled = True
                    SynolPnl.Enabled = True
                    ButtonsPnl.Enabled = True
                    kratiseis_zeig(False)
                End If
            End If
        End Try

    End Sub
    Private Sub Tbx_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EnilikTbx.Leave, PaidiTbx1.Leave,
    PaidiTbx2.Leave, PaidiTbx3.Leave, EthnAnzTbx2.Leave
        Dim k As Byte = 0
        Try
            If CType(sender.text, Int16) < 0 Then
                sender.text = Math.Abs(CType(sender.text, Int16))
            End If
        Catch ex As InvalidCastException
            sender.text = 0
        End Try
        If PaidiTbx1.Text <> 0 Then
            k = k + 1
        End If
        If PaidiTbx2.Text <> 0 Then
            k = k + 1
        End If
        If PaidiTbx3.Text <> 0 Then
            k = k + 1
        End If
        If sender.name.Equals("EnilikTbx") Then
            If EnilikTbx.Text = 0 Then
                EthnKwd1.Text = 0
                kwdEthnik1.Clear()
                EthnikTbx1.Clear()
                EthnKwd2.Text = 0
                EthnikTbx2.Clear()
                kwdEthnik2.Clear()
                EthnAnzTbx1.Text = 0
                EthnAnzTbx2.Text = 0
            End If
        End If
        If sender.name.Equals("EthnAnzTbx2") Then
            If sender.text = 0 Then
                EthnKwd2.Text = 0
                kwdEthnik2.Clear()
                EthnikTbx2.Clear()
            End If
        End If
        If EnilikTbx.Text + k >= EthnAnzTbx2.Text Then
            EthnAnzTbx1.Text = EnilikTbx.Text + k - EthnAnzTbx2.Text
        Else
            EthnAnzTbx1.Text = 0
            EthnAnzTbx1.Focus()
        End If
    End Sub
    Private Sub CotTbx1_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CotTbx1.Leave, CotTbx2.Leave
        'Dim k As Byte = 0
        'Try
        '    If CType(sender.text, Int16) < 0 Then
        '        sender.text = Math.Abs(CType(sender.text, Int16))
        '    End If
        'Catch ex As InvalidCastException
        '    sender.text = 0
        'End Try
    End Sub
    Private Sub EthnAnzTbx1_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles EthnAnzTbx1.Leave
        Dim k As Byte = 0
        Try
            If CType(sender.text, Int16) < 0 Then
                sender.text = Math.Abs(CType(sender.text, Int16))
            End If
        Catch ex As InvalidCastException
            sender.text = 0

        End Try
        If sender.text = 0 Then
            EthnikTbx1.Clear()
            kwdEthnik1.Clear()
            EthnKwd1.Text = 0
        End If
        If PaidiTbx1.Text <> 0 Then
            k = k + 1
        End If
        If PaidiTbx2.Text <> 0 Then
            k = k + 1
        End If
        If PaidiTbx3.Text <> 0 Then
            k = k + 1
        End If
        If EthnAnzTbx1.Text <= EnilikTbx.Text + k Then
            EthnAnzTbx2.Text = EnilikTbx.Text + k - EthnAnzTbx1.Text
        Else
            EthnAnzTbx2.Text = 0
            EthnKwd2.Text = 0
            kwdEthnik1.Focus()
            'EthnAnzTbx2.Focus()
        End If
    End Sub
    Private Sub TextBox15_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles ProkatTbx.Leave
        Dim y As Single = 0
        Try
            If CType(sender.text, Integer) Then
                y = sender.text
                sender.text = y.ToString("F")
            End If
        Catch ex As InvalidCastException
            sender.text = y.ToString("F")
        End Try
    End Sub
    Private Sub TextBox16_Leave(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SimetTbx.Leave
        Try
            If CType(sender.text, Integer) Then

            End If
        Catch ex As InvalidCastException
            sender.text = "0"
        End Try
    End Sub
    Private Sub KwdPraktTbx_TextChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles KwdPraktTbx1.Leave, KwdPraktTbx2.Leave
        Try
            If CType(sender.text, Integer) > 0 Then
                If status = 1 Or status = 2 And isDBEintrag Then
                    Dim count As Int16
                    count = Me.PraktoreiaTableAdapter.ExistPraktoreia(sender.text)
                    If count <> 0 Then
                        Me.PraktoreiaTableAdapter.FillByKwdiko(Me.DbhotelDataSet.praktoreia, sender.text)
                    Else
                        MsgBox("O κωδικός δεν αντιστοιχεί σε  Πρακτορείο !", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                        sender.clear()
                        'sender.focus()
                        Exit Sub
                    End If
                    'praktoreiokwd = PraktForm.return_praktoreio_kwdikos
                    If sender.name.Equals("KwdPraktTbx1") AndAlso praktoreiokwd <> sender.text Then
                        Kratiseis4Pnl.Controls.Clear()
                        ButtonsPnl.Controls.Clear()
                        If status = 2 AndAlso Me.DbhotelDataSet.praktoreia(0).kwd <> praktoreiokwd Then 'diamewntes allagi Praktoreiou kata'AndAlso currentAfixi < imeromErgasias
                            'thn diarkeia diamonis (oxi 1 mera)->touristperios stis timeskratiseis DB pairnei -1 
                            MsgBox(" Με την Αλλαγή του Πρακτορείου πρέπει να ελεχθούν ξανά οι τιμές !", MsgBoxStyle.Information, "winfo\nikEl.")
                            praktoreiokwdValue = Me.DbhotelDataSet.praktoreia(0).kwd ' se autin tin periptwsi 
                        Else
                            praktoreiokwd = Me.DbhotelDataSet.praktoreia(0).kwd
                        End If
                        'praktoreiokwd = Me.DbhotelDataSet.praktoreia(0).kwd
                        praktortimolkwd = Me.DbhotelDataSet.praktoreia(0).kwd
                        currentsimbolaio = -1
                        'currentsimbolaioValue = -1
                        If KlinesCbx.Items.Count = 0 OrElse TipiCbx.Items.Count = 0 Then
                            init_klines_tipoi_cboxen()
                        Else
                            KlinesCbx.SelectedIndex = -1
                            TipiCbx.SelectedIndex = -1
                        End If
                        SimbCbx.Items.Clear()
                        Me.SimbolaiaTableAdapter.FillByPraktoreio(Me.DbhotelDataSet.simbolaia, praktoreiokwd, DateTimePicker3.Value.Date.AddDays(-1).Year)

                        fuehle_simbol_cboxen()
                        ReDim timokatalog(-1)
                        'End If
                        ' edw kanw herauskriegen ola ta simbolaia tou praktoreiou gia to etos
                        currenttipos = 0
                        currentklines = 0

                        Dim praktname As String

                        praktname = Me.DbhotelDataSet.praktoreia(0).eponimia

                        PraktTbx.Text = praktname
                        PraktTimolTbx.Text = praktname
                        KwdPraktTbx2.Text = KwdPraktTbx1.Text
                        If isDBEintrag Then
                            Me.TouristperiodoiTableAdapter.FillBySimbAnaxwrisiAfixi(Me.DbhotelDataSet.touristperiodoi, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker2.Value.Date,
                                           currentsimbolaio, DateTimePicker3.Value.AddDays(-1).Date, DateTimePicker3.Value.AddDays(-1).Date, currentsimbolaio, DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date)

                        End If
                        VoucherTbx.Focus()
                        If SimbCbx.Items.Count <> 0 Then
                            SimbCbx.SelectedIndex = 0
                        End If
                    Else
                        PraktTimolTbx.Text = Me.DbhotelDataSet.praktoreia(0).eponimia
                        praktortimolkwd = Me.DbhotelDataSet.praktoreia(0).kwd
                    End If
                Else
                    MsgBox("Δεν επιλέχθηκε Διαμένων: Πατήστε τον φακό για επιλογή απο Λίστα ή εισάγετε τον Αρ.Κράτησης στο αντίστοιχο πεδίο και μετά πατήστε τον φακό!", MsgBoxStyle.Exclamation, "winfo\nikEl.")
                End If

            End If
        Catch ex As InvalidCastException
            If Not sender.text.Equals("") Then
                MsgBox(" Δώστε Αριθμό !", MsgBoxStyle.Information, "winfo\nikEl.")
                sender.clear()
            End If

        End Try


    End Sub
    Private Function pruefe_ob_touristikes_periodoi_richtig() As Boolean
        Dim startIndex As Int16
        Dim istOK As Boolean = True

        Do Until startIndex > Me.DbhotelDataSet.touristperiodoi.Count - 1
            'posa eintraege 
            'firstIndex = startIndex
            If startIndex < Me.DbhotelDataSet.touristperiodoi.Count - 1 Then
                'gia kathemia kRatisi
                While Me.DbhotelDataSet.touristperiodoi(startIndex).mexri.AddDays(1) = Me.DbhotelDataSet.touristperiodoi(startIndex + 1).apo
                    startIndex = startIndex + 1
                    If startIndex + 1 > Me.DbhotelDataSet.touristperiodoi.Count - 1 Then
                        Exit Do
                    End If
                End While
                istOK = False
                Exit Do
            Else
                startIndex = startIndex + 1
                Exit Do
            End If
        Loop

        If istOK Then
            Return True
        Else
            Return False
        End If

    End Function
    Private Sub SimbCbx_Update(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles SimbCbx.TextUpdate

        MsgBox("Πατήστε το βελάκι δεξιά και μετά επιλέξτε Συμβόλαιο  !", MsgBoxStyle.Information, "winfo\nikEl.")
        SimbCbx.SelectedIndex = -1

    End Sub

    Private Sub PliromiCbx_Update(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles PliromiCbx.TextUpdate

        MsgBox("Πατήστε το βελάκι δεξιά για επιλογή  !", MsgBoxStyle.Information, "winfo\nikEl.")
        PliromiCbx.SelectedIndex = 0

    End Sub
    Private Function get_index_von_pliromicbox(ByVal pliromi As String) As Byte
        Dim j As Int16
        For j = 0 To PliromiCbx.Items.Count - 1
            If PliromiCbx.Items(j).ToString = Trim(pliromi) Then
                Return j
            End If
        Next
        Return Nothing
    End Function
    Private Function get_index_klines(ByVal kwdikos As Integer) As Int16
        Dim i As Int16
        For i = 0 To Me.DbhotelDataSet.klines.Count - 1
            If Me.DbhotelDataSet.klines(i).kwd = kwdikos Then
                Return i
            End If
        Next
        Return -1
    End Function
    Private Function get_index_tipos(ByVal kwdikos As Integer) As Int16
        Dim i As Int16

        For i = 0 To Me.DbhotelDataSet.tipoi.Count - 1
            If Me.DbhotelDataSet.tipoi(i).kwd = kwdikos Then
                Return i
            End If
        Next
        Return -1
    End Function
    Private Function get_index_simbolaio_cbox(ByVal simbolaio As String) As Int16
        Dim i As Int16

        For i = 0 To Me.SimbCbx.Items.Count - 1
            If Me.SimbCbx.Items(i).ToString = simbolaio Then
                Return i
            End If
        Next
        Return -1
    End Function
    Private Sub selectall(ByVal sender As System.Object, ByVal e As System.EventArgs)
        sender.SelectAll()

    End Sub
    'Private Sub komma_einschalten(ByVal sender As System.Object, ByVal e As KeyPressEventArgs)
    '    Select Case e.KeyChar
    '        ' Modify '.' to ',' and forward the key.
    '        Case ChrW(46)
    '            e.KeyChar = ","
    '            e.Handled = False
    '            ' Modify 'b' to 'a' and forward the key.
    '    End Select


    'End Sub

    Private Sub ErgasiesHmerasF_FormClosing(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
        Me.Finalize()
        Me.Dispose()
    End Sub


    Private Sub ErgasiesHmerasF_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        'TODO: This line of code loads data into the 'DbhotelDataSet1.afm' table. You can move, or remove it, as needed.


        'TODO: This line of code loads data into the 'DbhotelDataSet1.dwmatia' table. You can move, or remove it, as needed.
        '  Me.DwmatiaTableAdapter1.Fill(Me.DbhotelDataSet1.dwmatia)
        ' 'TODO: This line of code loads data into the 'DbhotelDataSet1.katigories' table. You can move, or remove it, as needed.
        '  Me.KatigoriesTableAdapter1.Fill(Me.DbhotelDataSet1.katigories)
        'TODO: This line of code loads data into the 'DbhotelDataSet1.kratiseis' table. You can move, or remove it, as needed.
        ' Me.KratiseisTableAdapter1.Fill(Me.DbhotelDataSet1.kratiseis)
        'TODO: This line of code loads data into the 'DbhotelDataSet1.klines' table. You can move, or remove it, as needed.
        ' Me.KlinesTableAdapter1.Fill(Me.DbhotelDataSet1.klines)
        'TODO: This line of code loads data into the 'DbhotelDataSet1.praktoreia' table. You can move, or remove it, as needed.
        'Me.PraktoreiaTableAdapter1.Fill(Me.DbhotelDataSet1.praktoreia)
        ''TODO: This line of code loads data into the 'DbhotelDataSet1.vilapraktoreia1' table. You can move, or remove it, as needed.
        'Me.Vilapraktoreia1TableAdapter.Fill(Me.DbhotelDataSet1.vilapraktoreia1)
        'TODO: This line of code loads data into the 'DbhotelDataSet1.vilapraktoreia' table. You can move, or remove it, as needed.
        'Me.VilapraktoreiaTableAdapter.Fill(Me.DbhotelDataSet1.vilapraktoreia)
        'TODO: This line of code loads data into the 'DbhotelDataSet.calendar' table. You can move, or remove it, as needed.
        '  Me.CalendarTableAdapter.Fill(Me.DbhotelDataSet.calendar)
        'TODO: This line of code loads data into the 'DbhotelDataSet.nonshowkratiseis' table. You can move, or remove it, as needed.
        'Me.NonshowkratiseisTableAdapter.Fill(Me.DbhotelDataSet.nonshowkratiseis)
        'Me.Text = "Εργασίες Ημέρας " + imeromErgasias

    End Sub
    Private Function get_sesion() As Integer
        Randomize()
        ' Generate random value between 1 and 6.
        Return -CInt(Int((100000000 * Rnd()) + 1))

    End Function

    Private Sub Button8_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim form1 As New Praktoreia(imeromErgasias)
        Try
            form1.ShowDialog()
        Catch ex As System.Exception
            System.Windows.Forms.MessageBox.Show(ex.Message)
        End Try

        form1.Dispose()
    End Sub

    'Private Sub Button9_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button9.Click
    '    Try
    '        Dim form1 As New KleisimoHmeras("1/6/2007")
    '        'form1.set_imerominia_ergasias()
    '        form1.ShowDialog()
    '        form1.Dispose()
    '    Catch ex As System.Exception
    '        System.Windows.Forms.MessageBox.Show(ex.Message)
    '    End Try
    'End Sub

    Private Sub pruefe_yperbasi_allotment()
        Dim yperbOK As Boolean
        Dim form1 As New AllotmentYperbasi(DateTimePicker2.Value.Date, DateTimePicker3.Value.AddDays(-1).Date, currentklines, currenttipos, currentsimbolaio, optionChk.Checked)

        yperbOK = form1.ist_yeprabasi
        If yperbOK Then
            form1.zeig_yperbasi_form()
            form1.ShowDialog()
        End If
        '
        form1.Dispose()
    End Sub
    'Private Sub Button10_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button10.Click
    '    Dim form1 As New TelosMinaErgasies()

    '    form1.ShowDialog()
    '    form1.Dispose()
    'End Sub

    'Private Sub Button11_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button11.Click
    '    Dim form1 As New ErgasiesTelosEtous()
    '    form1.ShowDialog()
    '    form1.Dispose()
    'End Sub

    Private Sub Button12_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        imeromErgasias = imeromErgasias.AddDays(1)
        Me.Text = "Εργασίες Ημέρας " + imeromErgasias
    End Sub



    Private Sub Button14_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)

    End Sub






    Private Sub Button15_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Dim form1 As New KleisimoHmeras(imeromErgasias, rechte)
        form1.ShowDialog()
        form1.Dispose()
    End Sub
    'Private Sub Button3_Click_1(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button3.Click
    '    Dim i As Int16
    '    Dim datum1, datum2 As Date
    '    datum1 = imeromErgasias
    '    datum2 = DateTimePicker3.Value.Date


    '    Using connection As New OleDb.OleDbConnection("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=|DataDirectory|\dbhotel.mdb")
    '        Dim command As New OleDb.OleDbCommand()
    '        'Dim transaction As OleDb.OleDbTransaction = Nothing

    '        'Try
    '        connection.Open()
    '        'transaction = connection.BeginTransaction(IsolationLevel.ReadCommitted)

    '        command.Connection = connection
    '        For i = 0 To 500
    '            'command.Transaction = transaction
    '            command.Parameters.AddWithValue("arithmos", i + 60)
    '            command.Parameters.AddWithValue("katigoria", 1)
    '            command.Parameters.AddWithValue("klines", 1)
    '            'command.Parameters.AddWithValue("identifikation", timolID)
    '            command.CommandText = "Insert into dwmatia (arithmos, katigoria, klines) VALUES (arithmos, katigoria, klines)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '            datum1 = datum1.AddDays(1)
    '            datum2 = datum2.AddDays(1)
    '            ' Always call Read before accessing data.
    '            command.Parameters.AddWithValue("dwmatio", i + 60)
    '            command.Parameters.AddWithValue("kratsi", 2)
    '            command.Parameters.AddWithValue("enarxi", datum1)
    '            command.Parameters.AddWithValue("lixi", datum2)
    '            command.Parameters.AddWithValue("dwmatiostatus", 1)
    '            command.CommandText = "Insert into status (dwmatio, kratisi, enarxi, lixi, dwmatiostatus) VALUES (dwmatio, kratisi, enarxi, lixi, dwmatiostatus)"
    '            command.ExecuteNonQuery()
    '            command.Parameters.Clear()
    '        Next
    '        'Catch ex As Exception

    '        'End Try

    '    End Using

    'End Sub
    Private Sub optionChk_CheckedChanged(sender As Object, e As EventArgs) Handles optionChk.CheckedChanged
        If status = 2 OrElse DwmTbx.Text = "" Then
            sender.checked = False
        End If
    End Sub
    Private Sub heatChk_CheckedChanged(sender As Object, e As EventArgs) Handles heatChk.CheckedChanged
        If DwmTbx.Text = "" Then
            sender.checked = False
        End If
    End Sub
    Private Sub disable_nodes()
        For Each node As TreeNode In TreeViewErgHmeras.Nodes
            If node.Name = "Guarantee" Or node.Name = "PraktEispr" Or node.Name = "Metritis" Or node.Name = "Logariasmoi" Or node.Name = "Kinisi" Or node.Name = "Status_Xenodox" Then
                node.ForeColor = Color.Gray
            End If
            GetAllChildren(node)
        Next
    End Sub

    Private Sub GetAllChildren(parentNode As TreeNode)
        For Each childNode As TreeNode In parentNode.Nodes
            If childNode.Name = "Logariasmoi" Or childNode.Name = "Metritis" Or childNode.Name = "gramatio_eispraksis" Or childNode.Name = "Emf_Kns_Tmt" Or childNode.Name = "Lista_Praktoreiwn" Or childNode.Name = "diamenontes_old" Or childNode.Name = "Estiatorio_katast" Then
                childNode.ForeColor = Color.Gray
            End If
            GetAllChildren(childNode)
        Next
    End Sub
    Private Sub TreeView1_BeforeSelect(sender As Object, e As TreeViewCancelEventArgs) _
     Handles TreeViewErgHmeras.BeforeSelect
        If (Color.Gray = e.Node.ForeColor) Or (rechte = 0 And Color.White = e.Node.BackColor) Then
            e.Cancel = True
        End If
    End Sub

    Public Sub New(ByVal imerominia As Date, ByVal flag As Byte)
        ' This call is required by the Windows Form Designer.
        InitializeComponent()
        rechte = flag
        'TODO: This line of code loads data into the 'DbhotelDataSet.gramatia' table. You can move, or remove it, as needed.
        'Me.GramatiaTableAdapter.Fill(Me.DbhotelDataSet.gramatia) Dim afmadapter As New dbhotelDataSetTableAdapters.
        '   tooltip.InitialDelay = 10000
        'Dim greekCulture As New System.Globalization.CultureInfo("el-GR")
        'System.Threading.Thread.CurrentThread.CurrentCulture = greekCulture
        imeromErgasias = imerominia
        etos = imeromErgasias.Year
        currentAfixi = imeromErgasias
        currentAnaxwrisi = currentAfixi.AddDays(7)
        DateTimePicker2.Value = currentAfixi
        DateTimePicker3.Value = currentAnaxwrisi
        sesionID = get_sesion()
        ' delete_timologia_von_systemabsturz()
        Me.EtaireiaTableAdapter.Fill(Me.DbhotelDataSet.etaireia)
        'connectionString = Me.DbhotelDataSet.etaireia(0).connectionstring
        connectionString = ConfigurationManager.ConnectionStrings("winhotel.My.MySettings.dbhotelConnectionString1").ConnectionString
        maxklines = Me.DbhotelDataSet.etaireia(0).maxklines

        Me.PistwtikesTableAdapter.Fill(Me.DbhotelDataSet.pistwtikes)
        'Me.DwmatiaTableAdapter.Fill(Me.DbhotelDataSet.dwmatia)
        'TODO: This line of code loads data into the 'DbhotelDataSet.tmimata' table. You can move, or remove it, as needed.
        ' Me.TmimataTableAdapter.FillByZentral(Me.DbhotelDataSet.tmimata, True)
        'Me.KatigoriesTableAdapter.Fill(Me.DbhotelDataSet.katigories)
        '   Me.PraktoreiaTableAdapter.Fill(Me.DbhotelDataSet.praktoreia)
        Me.KlinesTableAdapter.FillByMexriKlines(Me.DbhotelDataSet.klines, maxklines)
        Me.XrewseisTableAdapter.Fill(Me.DbhotelDataSet.xrewseis)
        If rechte = 1 Then
            Me.TipoiTableAdapter.Fill(Me.DbhotelDataSet.tipoi)
        Else
            Me.TipoiTableAdapter.FillXenodByKwds(Me.DbhotelDataSet.tipoi, 13, 25)
        End If

        Me.DwmatiastatusTableAdapter.Fill(Me.DbhotelDataSet.dwmatiastatus)
        Me.CalendarTableAdapter.Fill(Me.DbhotelDataSet.calendar)
        Me.SplitContainer1.Panel2.Controls.Clear()
        disable_nodes()
        ' Add any initialization after the InitializeComponent() call.
        Me.Text = "Εργασίες Ημέρας " + imeromErgasias
    End Sub

    Private Sub emailBtn_Click(sender As Object, e As EventArgs) Handles emailBtn.Click
        If VoucherTbx.Text.Contains("@") Then
            Dim response As MsgBoxResult
            response = MsgBox("Αποστολή email με Directions;", MsgBoxStyle.YesNo, "winfo\nikEl.")
            If response = MsgBoxResult.Yes Then
                Dim data As String
                Dim threadDirections As Threading.Thread
                Dim mailadapter As New dbhotelDataSetTableAdapters.MailTableAdapter
                DbhotelDataSet.EnforceConstraints = False
                mailadapter.Fill(Me.DbhotelDataSet.Mail)
                fromkr = Me.DbhotelDataSet.Mail(0).ffrom
                smtpServerkr = Me.DbhotelDataSet.Mail(0).smtpServer
                smtpUsernamekr = Me.DbhotelDataSet.Mail(0).smtpUsername
                smtpPasswordkr = Me.DbhotelDataSet.Mail(0).smtpPassword
                If currenttipos > 12 And currenttipos <= 25 Then

                    subjectkr = "Informations to the Hotel you booked in Crete"

                    ' bodykr = Me.DbhotelDataSet.Mail(2).body

                    data = DwmTbx.Text + "+" + VoucherTbx.Text + "+" + OnomTbx1.Text
                    threadDirections = SendMailwithDirectionsKratisis(data)
                Else

                    subjectkr = Me.DbhotelDataSet.Mail(2).subject

                    ' bodykr = "Dear Mrs./Mr. " + OnomTbx1.Text + "," + ChrW(13) + ChrW(13) + Me.DbhotelDataSet.Mail(2).body
                    data = DwmTbx.Text + "+" + VoucherTbx.Text + "+" + OnomTbx1.Text
                    threadDirections = SendMailwithDirectionsVila(data)

                    'SendMailMultiAttachVila(fromkr, VoucherTbx.Text, subjectkr, bodykr, DwmTbx.Text, smtpServerkr, smtpUsernamekr, smtpPasswordkr)
                End If

            End If
            If kwdikoKratisisDB <> -1 Then
                Try
                    If CType(KratisiTbx.Text, Int16) Then
                        response = MsgBox("Αποστολή Experiencies email;", MsgBoxStyle.YesNo, "winfo\nikEl.")
                        If response = MsgBoxResult.Yes Then

                            EmailSchedulerModule.MainKratisis(KratisiTbx.Text)
                        End If
                    End If
                Catch ex As InvalidCastException

                End Try
            End If


        End If



    End Sub

    Function SendMailwithDirectionsKratisis(ByVal data As String) As Threading.Thread
        Dim theThread _
            As New Threading.Thread(AddressOf SendMailDirectionsKratisis)
        theThread.Start(data)

        Return theThread

    End Function
    Function SendMailwithDirectionsVila(ByVal data As String) As Threading.Thread
        Dim theThread _
            As New Threading.Thread(AddressOf SendMailDirectionsVilas)
        theThread.Start(data)

        Return theThread

    End Function
    Private Sub SendMailDirectionsVilas(ByVal data As String)
        Dim parts As String()
        Try
            parts = data.Split(New Char() {"+"c})


        Catch ex1 As ArgumentOutOfRangeException
            Exit Sub

        Catch ex As IndexOutOfRangeException
            Exit Sub
        End Try
        If parts(0) <> "" And parts(2) <> "" And parts(1) <> "" Then
            Dim body_ As String

            body_ = "Dear Mrs./Mr. " + parts(2) + "," + ChrW(13) + ChrW(13) + Me.DbhotelDataSet.Mail(2).body
            SendMailMultiAttachVila(fromkr, parts(1), subjectkr, body_, parts(0), smtpServerkr, smtpUsernamekr, smtpPasswordkr)
        End If


    End Sub
    Private Sub SendMailDirectionsKratisis(ByVal data As String)
        Dim parts As String()
        Try
            parts = data.Split(New Char() {"+"c})


        Catch ex1 As ArgumentOutOfRangeException
            Exit Sub

        Catch ex As IndexOutOfRangeException
            Exit Sub
        End Try
        If parts(0) <> "" And parts(2) <> "" And parts(1) <> "" Then
            Dim body_ As String

            body_ = "Dear Mrs./Mr. " + parts(2) + "," + ChrW(13) + ChrW(13) + "in the Attachment you can find useful Informations how to to entry the Hotel on your Arrival" + ChrW(13) + ChrW(13) + "Best regards, " + ChrW(13) + "Stelios Christidis" + ChrW(13) + " Executive Director"

            SendMailMultiAttachKratisis(fromkr, parts(1), subjectkr, body_, parts(0), smtpServerkr, smtpUsernamekr, smtpPasswordkr)
        End If

    End Sub
    Public Sub SendMailMultiAttachKratisis(ByVal from As String, ByVal [to] As String, ByVal subject As String, ByVal body As String, ByVal dwmatio As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String)
        Dim j As Int16
        Dim instance As Attachment
        Dim pathstart As String = ""
        Dim fileName As String = ""
        Dim directionsAdapter As New dbhotelDataSetTableAdapters.directionsTableAdapter
        Dim directionsTable As New dbhotelDataSet.directionsDataTable
        directionsAdapter.FillDirectionsByVila(directionsTable, dwmatio)
        Try

            Dim message As New MailMessage(from, [to], subject, body)

            For j = 0 To directionsTable.Count - 1
                If Not IsDBNull(directionsTable(j).Item("path")) Then
                    Try

                        instance = New Attachment(directionsTable(j).path)
                        message.Attachments.Add(instance)

                    Catch ex As System.IO.DirectoryNotFoundException
                        MsgBox("Αδυναμία επισύναψης DIRECTIONS ", MsgBoxStyle.Exclamation)
                    End Try

                End If
            Next

            If message.Attachments.Count <> 0 Then
                Dim smtpClient As New SmtpClient(smtpServer, 25)

                smtpClient.UseDefaultCredentials = False

                Dim credentials As New NetworkCredential(smtpUsername, smtpPassword)

                smtpClient.Credentials = credentials
                smtpClient.EnableSsl = True
                smtpClient.Send(message)
            End If

            'Dim instance As New Attachment(fileName)


        Catch ex1 As System.IO.FileNotFoundException
            MsgBox("Δεν βρέθηκε Attachment για Directions ", MsgBoxStyle.Exclamation)
        Catch ex3 As System.FormatException
            MsgBox("Η Διεύθυνση email για αποστολή Directions είναι λάθος καταχωρημένη ", MsgBoxStyle.Exclamation)
        Catch ex2 As System.IO.DirectoryNotFoundException
            MsgBox("Δεν βρέθηκε o φάκελος για αποστολή Directions ", MsgBoxStyle.Exclamation)

        Catch ex As Exception
            MsgBox("Αδυναμία αποστολής email " + ex.ToString, MsgBoxStyle.Exclamation)
        End Try

    End Sub
    Public Sub SendMailMultiAttachVila(ByVal from As String, ByVal [to] As String, ByVal subject As String, ByVal body As String, ByVal dwmatio As String, ByVal smtpServer As String, ByVal smtpUsername As String, ByVal smtpPassword As String)
        Dim j As Int16
        Dim instance, instance2 As Attachment
        Dim fileName As String = ""
        Dim pathstart As String = ""
        Dim directionsAdapter As New dbhotelDataSetTableAdapters.directionsTableAdapter
        directionsAdapter.FillDirectionsByVila(Me.DbhotelDataSet.directions, dwmatio)
        Try

            Dim message As New MailMessage(from, [to], subject, body)

            For j = 0 To Me.DbhotelDataSet.directions.Count - 1
                If Not IsDBNull(Me.DbhotelDataSet.directions(j).Item("path")) Then
                    Try
                        'Try
                        '    'pathstart = Environment.GetEnvironmentVariable("location")
                        '    'If pathstart <> "" Then
                        '    '    fileName = Me.DbhotelDataSet.directions(j).path.Replace("N:", pathstart)
                        '    '    instance = New Attachment(fileName)
                        '    'Else
                        '    '    instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
                        '    'End If
                        '    instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
                        'Catch ex1 As ArgumentNullException
                        '    instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
                        'End Try
                        'Dim instance As New Attachment(Me.DbhotelDataSet.directions(j).path)
                        'Dim instance As New Attachment("c:\winfo\availabilities.txt")
                        instance = New Attachment(Me.DbhotelDataSet.directions(j).path)
                        message.Attachments.Add(instance)

                    Catch ex As System.IO.DirectoryNotFoundException
                        MsgBox("Αδυναμία επισύναψης questionare ", MsgBoxStyle.Exclamation)
                    End Try
                    Try
                        'If pathstart <> "" Then
                        '    instance2 = New Attachment(Me.DbhotelDataSet.etaireia(0).dieuthinsi)
                        'Else
                        '    fileName = Me.DbhotelDataSet.etaireia(0).dieuthinsi.Replace("N:", pathstart)
                        '    instance2 = New Attachment(fileName)
                        'End If
                        fileName = Me.DbhotelDataSet.etaireia(0).dieuthinsi
                        instance2 = New Attachment(fileName)
                        '  Dim instance2 As New Attachment(Me.DbhotelDataSet.etaireia(0).dieuthinsi)
                        message.Attachments.Add(instance2)
                    Catch ex As System.IO.DirectoryNotFoundException
                        MsgBox("Αδυναμία επισύναψης έντυπου υποδοχής ", MsgBoxStyle.Exclamation)
                    End Try
                End If
            Next

            If message.Attachments.Count <> 0 Then
                Dim smtpClient As New SmtpClient(smtpServer, 25)

                smtpClient.UseDefaultCredentials = False

                Dim credentials As New NetworkCredential(smtpUsername, smtpPassword)

                smtpClient.Credentials = credentials
                smtpClient.EnableSsl = True
                smtpClient.Send(message)
            End If


            'Dim instance As New Attachment(fileName)

        Catch ex1 As System.IO.FileNotFoundException
            MsgBox("Δεν βρέθηκε Attachment για Directions ", MsgBoxStyle.Exclamation)
        Catch ex3 As System.FormatException
            MsgBox("Η Διεύθυνση email για αποστολή Directions είναι λάθος καταχωρημένη ", MsgBoxStyle.Exclamation)
        Catch ex2 As System.IO.DirectoryNotFoundException
            MsgBox("Δεν βρέθηκε o φάκελος για αποστολή Directions ", MsgBoxStyle.Exclamation)

        Catch ex As Exception
            MsgBox("Αδυναμία αποστολής email ", MsgBoxStyle.Exclamation)
        End Try

    End Sub


End Class